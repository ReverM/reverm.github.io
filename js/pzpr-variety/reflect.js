/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["reflect"],{MouseEvent:{inputModes:{edit:["quesmark","quesmark-","number","info-line"],play:["line","peke","info-line"]},mouseinput_other:function(){this.inputMode.match(/quesmark/)&&this.mousestart&&this.inputQuesTriangle()},mouseinput_auto:function(){this.puzzle.playmode?"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.inputpeke():"right"===this.btn&&(this.mousestart||this.mousemove)&&this.inputpeke():this.puzzle.editmode&&this.mousestart&&this.inputQuesTriangle()},inputQuesTriangle:function(e){this.inputQues([0,2,3,4,5,11])}},KeyEvent:{enablemake:!0,keyinput:function(e){this.key_inputLineParts(e)||this.key_inputqnum(e)},key_inputLineParts:function(e){var t=this.cursor.getc();if("q"===e)t.setQues(2),t.setQnum(-1);else if("w"===e)t.setQues(3),t.setQnum(-1);else if("e"===e)t.setQues(4),t.setQnum(-1);else if("r"===e)t.setQues(5),t.setQnum(-1);else if("t"===e)t.setQues(11),t.setQnum(-1);else{if("y"!==e)return!1;t.setQues(0),t.setQnum(-1)}return t.drawaround(),!0}},Cell:{disInputHatena:!0,maxnum:function(){var e=this.ques,t=-1;return 2===e||3===e?t+=1+(this.by>>1):4!==e&&5!==e||(t+=this.board.rows-(this.by>>1)),3===e||4===e?t+=1+(this.bx>>1):2!==e&&5!==e||(t+=this.board.cols-(this.bx>>1)),t},minnum:3,getTriLine:function(){for(var e=new this.klass.BorderList,t=this.adjborder,i=t.left;!i.isnull&&i.isLine();)e.add(i),i=i.relbd(-2,0);for(i=t.right;!i.isnull&&i.isLine();)e.add(i),i=i.relbd(2,0);for(i=t.top;!i.isnull&&i.isLine();)e.add(i),i=i.relbd(0,-2);for(i=t.bottom;!i.isnull&&i.isLine();)e.add(i),i=i.relbd(0,2);return e}},Border:{enableLineNG:!0},Board:{hasborder:1},BoardExec:{adjustBoardData:function(e,t){if(e&this.TURNFLIP){var i={};switch(e){case this.FLIPY:i={2:5,3:4,4:3,5:2};break;case this.FLIPX:i={2:3,3:2,4:5,5:4};break;case this.TURNR:i={2:5,3:2,4:3,5:4};break;case this.TURNL:i={2:3,3:4,4:5,5:2}}for(var s=this.board.cellinside(t.x1,t.y1,t.x2,t.y2),n=0;n<s.length;n++){var r=s[n],u=i[r.ques];u&&(r.ques=u)}}}},LineGraph:{enabled:!0,isLineCross:!0},Graphic:{hideHatena:!0,irowake:!0,gridcolor_type:"LIGHT",paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawPekes(),this.drawLines(),this.drawTriangle(),this.drawTriangleBorder(),this.drawNumbers_reflect(),this.draw11s(),this.drawChassis(),this.drawTarget()},getTriangleColor:function(e){return 1===e.error||4===e.error||1===e.qinfo||4===e.qinfo?this.errcolor1:this.quescolor},drawTriangleBorder:function(){for(var e=this.vinc("cell_triangle_border","crispEdges",!0),t=this.range.borders,i=0;i<t.length;i++){var s=t[i],n=s.isVert(),r=s.sidecell[0].ques,u=s.sidecell[1].ques,l=s.bx*this.bw,o=s.by*this.bh;e.vid="b_tb_"+s.id,e.fillStyle=this.gridcolor,!n||3!==r&&4!==r||2!==u&&5!==u?n||2!==r&&3!==r||4!==u&&5!==u?e.vhide():e.fillRectCenter(l,o,this.bw,.5):e.fillRectCenter(l,o,.5,this.bh)}},draw11s:function(){for(var e=this.vinc("cell_ques","crispEdges",!0),t=this.range.cells,i=0;i<t.length;i++){var s,n,r,u=t[i];e.vid="c_lp11_"+u.id,11===u.ques?(s=(this.lw+2-1)/2,n=.38*this.cw,r=u.bx*this.bw,u=u.by*this.bh,e.fillStyle=this.quescolor,e.beginPath(),e.setOffsetLinePath(r,u,-s,-s,-s,-n,s,-n,s,-s,n,-s,n,s,s,s,s,n,-s,n,-s,s,-n,s,-n,-s,!0),e.fill()):e.vhide()}},drawNumbers_reflect:function(){for(var e=this.vinc("cell_number","auto"),t=(e.fillStyle="white",this.range.cells),i=0;i<t.length;i++){var s=t[i],n=this.getQuesNumberText(s);e.vid="cell_text_"+s.id,n?this.disptext(n,s.bx*this.bw,s.by*this.bh,{position:s.ques,ratio:.45}):e.vhide()}},getQuesNumberText:function(e){return 2<=e.ques&&e.ques<=5?this.getNumberTextCore(e.qnum):""},repaintParts:function(e){this.range.cells=e.cellinside(),this.draw11s()}},Encode:{decodePzpr:function(e){this.decodeReflectlink()},encodePzpr:function(e){this.encodeReflectlink()},decodeReflectlink:function(){for(var e=0,t=this.outbstr,i=this.board,s=0;s<t.length;s++){var n=t.charAt(s),r=i.cell[e];if("5"===n?r.ques=11:this.include(n,"1","4")?(r.ques=parseInt(n,10)+1,r.qnum=parseInt(t.substr(s+1,1),16),s++):this.include(n,"6","9")?(r.ques=parseInt(n,10)-4,r.qnum=parseInt(t.substr(s+1,2),16),s+=2):this.include(n,"a","z")&&(e+=parseInt(n,36)-10),0===r.qnum&&(r.qnum=-1),e++,!i.cell[e])break}this.outbstr=t.substr(s)},encodeReflectlink:function(e){for(var t="",i="",s=0,n=this.board,r=0;r<n.cell.length;r++){var u,l=n.cell[r].ques;11===l?i="5":2<=l&&l<=5?(u=n.cell[r].qnum)<=0?i=l-1+"0":1<=u&&u<16?i=""+(l-1)+u.toString(16):16<=u&&u<256&&(i=""+(l+4)+u.toString(16)):(i="",s++),0===s?t+=i:!i&&26!==s||(t+=(9+s).toString(36)+i,s=0)}0<s&&(t+=(9+s).toString(36)),this.outbstr+=t}},FileIO:{decodeData:function(){this.decodeCell(function(e,t){"+"===t?e.ques=11:"."!==t&&(e.ques=+t.charAt(0)+1,1<t.length&&(e.qnum=+t.substr(1)))}),this.decodeBorderLine()},encodeData:function(){this.encodeCell(function(e){return 11===e.ques?"+ ":2<=e.ques&&e.ques<=5?""+(e.ques-1)+(-1!==e.qnum?e.qnum:"")+" ":". "}),this.encodeBorderLine()}},AnsCheck:{checklist:["checkLineExist+","checkBranchLine","checkCrossOutOfMark","checkLongLines","checkTriangle","checkShortLines","checkNotCrossOnMark","checkDeadendLine+","checkOneLoop"],checkCrossOutOfMark:function(){this.checkAllCell(function(e){return 4===e.lcnt&&11!==e.ques},"lnCrossExMk")},checkTriangle:function(){for(var e=this.board,t=0;t<e.cell.length;t++){var i=e.cell[t];if(!(0===i.ques||11===i.ques||0<i.lcnt)){if(this.failcode.add("lnExTri"),this.checkOnly)break;i.seterr(4)}}},checkLongLines:function(){this.checkTriNumber(1,"lnLenGt")},checkShortLines:function(){this.checkTriNumber(2,"lnLenLt")},checkTriNumber:function(e,t){for(var i=!0,s=this.board,n=0;n<s.cell.length;n++){var r=s.cell[n];if(0!==r.ques&&11!==r.ques&&r.isValidNum()){var u=r.getTriLine();if(!(1===e?r.qnum>=u.length+1:r.qnum<=u.length+1)){if(i=!1,this.checkOnly)break;r.seterr(4),u.seterr(1)}}}i||(this.failcode.add(t),s.border.setnoerr())}}});
//# sourceMappingURL=reflect.js.map