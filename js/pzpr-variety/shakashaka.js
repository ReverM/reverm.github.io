/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,n){"object"==typeof module&&module.exports?module.exports=[t,n]:pzpr.classmgr.makeCustom(t,n)}(["shakashaka"],{MouseEvent:{inputModes:{edit:["number","clear"],play:["objblank","completion"]},mouseinput_auto:function(){var t;this.puzzle.playmode?(1==(t=+this.puzzle.getConfig("use_tri"))?"left"===this.btn?this.mousestart?this.inputTriangle_corner_start():this.mousemove&&null!==this.inputData&&this.inputMove():"right"===this.btn&&(this.mousestart||this.mousemove)&&this.inputDot():2==t?"left"===this.btn?this.mousestart?this.inputTriangle_pull_start():this.mousemove&&null===this.inputData?this.inputTriangle_pull_move():this.mousemove&&null!==this.inputData?this.inputMove():this.mouseend&&this.notInputted()&&this.inputTriangle_pull_end():"right"===this.btn&&(this.mousestart||this.mousemove)&&this.inputDot():3==t&&this.mousestart&&this.inputTriangle_onebtn(),this.mouseend&&this.notInputted()&&this.inputqcmp()):this.puzzle.editmode&&this.mousestart&&this.inputqnum()},inputMove:function(){2<=this.inputData&&this.inputData<=5?this.inputTriangle_drag():0!==this.inputData&&-1!==this.inputData||this.inputDot()},inputTriangle_corner_start:function(){var t=this.getcell();t.isnull||(this.inputData=this.checkCornerData(t),t.setAnswer(this.inputData),(this.mouseCell=t).draw())},checkCornerData:function(t){if(t.isNum())return-1;var n,e,i=null;if(this.puzzle.getConfig("support_tri")){var s,a=t.adjacent,u={count:0},r={top:[2,3],bottom:[4,5],left:[3,4],right:[2,5]};for(s in a){var o=a[s];u[s]=o.isWall()||o.qans===r[s][0]||o.qans===r[s][1],u[s]&&++u.count}if(2<u.count||2===u.count&&(u.top&&u.bottom||u.left&&u.right))return 0===t.qsub?-1:0;2===u.count&&(i=u.bottom&&u.left?2:u.bottom&&u.right?3:u.top&&u.right?4:u.top&&u.left?5:0)}return null===i&&(n=this.inputPoint.bx-t.bx,e=this.inputPoint.by-t.by,i=n<=0?e<=0?5:2:e<=0?4:3),i===t.qans?i=-1:1===t.qsub&&(i=0),i},inputTriangle_pull_start:function(){var t=this.getcell();t.isnull||t.isNum()?this.mousereset():(this.firstPoint.set(this.inputPoint),this.mouseCell=t)},inputTriangle_pull_move:function(){var t=this.mouseCell,n=this.inputPoint.bx-this.firstPoint.bx,e=this.inputPoint.by-this.firstPoint.by,i=.33;n<=-i&&i<=e?this.inputData=2:n<=-i&&e<=-i?this.inputData=5:i<=n&&i<=e?this.inputData=3:i<=n&&e<=-i&&(this.inputData=4),null!==this.inputData&&(this.inputData===t.qans&&(this.inputData=0),t.setAnswer(this.inputData)),t.draw()},inputTriangle_pull_end:function(){var t=this.inputPoint.bx-this.firstPoint.bx,n=this.inputPoint.by-this.firstPoint.by;Math.abs(t)<=.1&&Math.abs(n)<=.1&&((t=this.mouseCell).setAnswer(1!==t.qsub?-1:0),t.draw())},inputTriangle_drag:function(){var t,n,e,i,s,a;null===this.inputData||this.inputData<=0||((t=this.getcell()).isnull||t.isNum()||(n=t.bx-this.mouseCell.bx,e=t.by-this.mouseCell.by,i=this.checkCornerData(t),s=null,a=this.inputData,2==n&&2==e||-2==n&&-2==e?2!==a&&4!==a||(s=a):2==n&&-2==e||-2==n&&2==e?3!==a&&5!==a||(s=a):0==n&&-2==e?(2!==a&&3!==a||i===a)&&(4!==a&&5!==a||i!==a)||(s=[null,null,5,4,3,2][a]):0==n&&2==e?(4!==a&&5!==a||i===a)&&(2!==a&&3!==a||i!==a)||(s=[null,null,5,4,3,2][a]):-2==n&&0==e?(3!==a&&4!==a||i===a)&&(2!==a&&5!==a||i!==a)||(s=[null,null,3,2,5,4][a]):2!=n||0!=e||(2!==a&&5!==a||i===a)&&(3!==a&&4!==a||i!==a)||(s=[null,null,3,2,5,4][a]),null!==s&&(t.setAnswer(s),this.inputData=s,this.mouseCell=t),t.draw()))},inputDot:function(){var t=this.getcell();t.isnull||t.isNum()||(null===this.inputData&&(this.inputData=1===t.qsub?0:-1),t.setAnswer(this.inputData),(this.mouseCell=t).draw())},inputTriangle_onebtn:function(){var t,n=this.getcell();n.isnull||n.isNum()||(t=n.getAnswer(),"left"===this.btn?this.inputData=[0,2,1,3,4,5,-1][t+1]:"right"===this.btn&&(this.inputData=[5,-1,1,0,2,3,4][t+1]),n.setAnswer(this.inputData),(this.mouseCell=n).draw())},inputqcmp:function(){var t=this.getcell();t.isnull||t.noNum()||(t.setQcmp(+!t.qcmp),t.draw(),this.mousereset())}},KeyEvent:{enablemake:!0},Cell:{numberRemainsUnshaded:!0,maxnum:4,minnum:0,getAnswer:function(){return this.isNum()?0:0<this.qans?this.qans:1===this.qsub?-1:0},setAnswer:function(t){this.isNum()||(this.setQans(2<=t&&t<=5?t:0),this.setQsub(-1===t?1:0))},isTri:function(){return 0!==this.qans},isWall:function(){return this.isnull||this.isNum()},isCmp:function(){if(1===this.qcmp)return!0;if(!this.puzzle.execConfig("autocmp"))return!1;var t=this.adjacent;if(new this.klass.CellList([t.top,t.right,t.bottom,t.left]).some(function(t){return!t.isnull&&-1===t.qnum&&0===t.qans&&0===t.qsub}))return!1;return this.qnum===this.countDir4Cell(function(t){return t.isTri()})},posthook:{qnum:function(){this.redrawAdjacent()},qans:function(){this.redrawAdjacent()},qsub:function(){this.redrawAdjacent()}},redrawAdjacent:function(){var t=this.adjacent,t=new this.klass.CellList([t.top,t.right,t.bottom,t.left]);this.board.redrawAffected(t)}},Board:{addExtraInfo:function(){this.wrectmgr=this.addInfoList(this.klass.AreaWrectGraph)},redrawAffected:function(t){for(var n=0;n<t.length;n++){var e=t[n];e.isnull||-1===e.qnum||-2===e.qnum||e.draw()}}},BoardExec:{adjustBoardData:function(t,n){var e=[];switch(t){case this.FLIPY:e=[0,1,5,4,3,2];break;case this.FLIPX:e=[0,1,3,2,5,4];break;case this.TURNR:e=[0,1,5,2,3,4];break;case this.TURNL:e=[0,1,3,4,5,2];break;default:return}for(var i=this.board.cell,s=0;s<i.length;s++){var a=i[s],u=e[a.qans];u&&(a.qans=u)}}},"AreaWrectGraph:AreaGraphBase":{enabled:!0,relation:{"cell.qnum":"node","cell.qans":"node"},setComponentRefs:function(t,n){t.wrect=n},getObjNodeList:function(t){return t.wrectnodes},resetObjNodeList:function(t){t.wrectnodes=[]},isnodevalid:function(t){return-1===t.qnum},sldir:[[],[!0,!1,!0,!0,!1,!1],[!0,!1,!1,!1,!0,!0],[!0,!1,!1,!0,!0,!1],[!0,!1,!0,!1,!1,!0]],isedgevalidbynodeobj:function(t,n){return this.sldir[t.getdir(n,2)][t.qans]&&this.sldir[n.getdir(t,2)][n.qans]}},Graphic:{hideHatena:!0,autocmp:"number",gridcolor_type:"LIGHT",qanscolor:"black",fgcellcolor_func:"qnum",fontShadecolor:"white",qcmpcolor:"rgb(127,127,127)",paint:function(){this.drawBGCells(),this.drawDotCells(),this.drawDashedGrid(),this.drawQuesCells(),this.drawQuesNumbers(),this.drawTriangle(),this.drawChassis(),this.drawTarget()},getTriangleColor:function(t){return t.trial?this.trialcolor:this.shadecolor},getQuesNumberColor:function(t){return t.isCmp()?this.qcmpcolor:this.fontShadecolor}},Encode:{decodePzpr:function(t){this.decode4Cell()},encodePzpr:function(t){this.encode4Cell()},decodeKanpen:function(){this.fio.decodeCellQnumb()},encodeKanpen:function(){this.fio.encodeCellQnumb()}},FileIO:{decodeData:function(){this.decodeCellQnumb(),this.decodeCellQanssubcmp()},encodeData:function(){this.encodeCellQnumb(),this.encodeCellQanssubcmp()},decodeCellQanssubcmp:function(){this.decodeCell(function(t,n){"+"===n?t.qsub=1:"-"===n?t.qcmp=1:"."!==n&&(t.qans=+n)})},encodeCellQanssubcmp:function(){this.encodeCell(function(t){return 0!==t.qans?t.qans+" ":1===t.qsub?"+ ":1===t.qcmp?"- ":". "})},kanpenOpen:function(){this.decodeCell(function(t,n){"5"===n?t.qnum=-2:"."!==n&&(t.qnum=+n)}),this.decodeCell(function(t,n){"+"===n?t.qsub=1:"."!==n&&(t.qans=+n)})},kanpenSave:function(){this.encodeCell(function(t){return 0<=t.qnum?t.qnum+" ":-2===t.qnum?"5 ":". "}),this.encodeCell(function(t){return 1===t.qsub?"+ ":2<=t.qans?t.qans+" ":". "})},kanpenOpenXML:function(){this.decodeCellQnum_XMLBoard(),this.decodeCellShakashaka_XMLAnswer()},kanpenSaveXML:function(){this.encodeCellQnum_XMLBoard(),this.encodeCellShakashaka_XMLAnswer()},UNDECIDED_NUM_XML:-2,decodeCellShakashaka_XMLAnswer:function(){this.decodeCellXMLArow(function(t,n){"n"===n.charAt(0)?t.qans=2+(+n.substr(1)-1&3):"s"===n&&(t.qsub=1)})},encodeCellShakashaka_XMLAnswer:function(){this.encodeCellXMLArow(function(t){return 0<t.qans?"n"+(4+(t.qans-1&3)):1===t.qsub?"s":"u"})}},AnsCheck:{checklist:["checkTriangleExist","checkOverTriangle","checkWhiteArea","checkLessTriangle"],checkTriangleExist:function(){this.board.cell.some(function(t){return 0<t.qans})||this.failcode.add("brNoTriangle")},checkOverTriangle:function(){this.checkDir4Cell(function(t){return t.isTri()},2,"nmTriangleGt")},checkLessTriangle:function(){this.checkDir4Cell(function(t){return t.isTri()},1,"nmTriangleLt")},checkWhiteArea:function(){for(var t=this.board.wrectmgr.components,n=0;n<t.length;n++){var e=t[n].clist,i=e.getRectSize(),s=e.filter(function(t){return 0===t.qans}).length;if(i.cols*i.rows!==s&&!this.isAreaRect_slope(t[n])){if(this.failcode.add("cuNotRectx"),this.checkOnly)break;e.seterr(1)}}},isAreaRect_slope:function(t){for(var n=t.clist,e=0;e<n.length;e++){var i=n[e],s=i.adjacent,i=i.qans;if((4===i||5===i)!=(s.top.wrect!==t)||(2===i||3===i)!=(s.bottom.wrect!==t)||(2===i||5===i)!=(s.left.wrect!==t)||(3===i||4===i)!=(s.right.wrect!==t))return!1}return!0}}});
//# sourceMappingURL=shakashaka.js.map