/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["bonsan","heyabon","rectslider","satogaeri","timebomb"],{"MouseEvent@bonsan,heyabon":{inputModes:{edit:["number","clear"],play:["line","bgcolor","bgcolor1","bgcolor2","clear","completion"]}},"MouseEvent@satogaeri":{inputModes:{edit:["number","clear"],play:["line","clear","completion"]}},"MouseEvent@rectslider":{inputModes:{edit:["number","clear"],play:["line","bgcolor","subcircle","subcross","clear"]}},MouseEvent:{mouseinput:function(){switch(this.inputMode){case"completion":!this.mousestart&&"timebomb"!==this.pid||this.inputqcmp(1);break;case"boulder":return this.inputFixedNumber(0);default:return this.common.mouseinput.call(this)}},mouseinput_auto:function(){var e;this.puzzle.playmode?(this.mousestart&&(e=this.getcell(),this.initFirstCell(e),"timebomb"===this.pid&&0===e.qnum&&this.inputdark(e,1)),20<=this.inputData?this.inputdark(e,1,!0):"right"===this.btn&&"timebomb"===this.pid?this.inputBGcolor():this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.inputlight()):this.puzzle.editmode&&(this.mousestart||this.mousemove?"heyabon"!==this.pid&&"satogaeri"!==this.pid||this.inputborder():this.mouseend&&this.notInputted()&&this.inputqnum())},inputLine:function(){this.common.inputLine.call(this),!this.puzzle.execConfig("autocmp")||this.puzzle.execConfig("dispmove")||this.notInputted()||this.inputautodark()},inputautodark:function(){var e,t=this.puzzle.opemgr.lastope;"border"===t.group&&"line"===t.property&&(t=this.board.getb(t.bx,t.by),e=new this.klass.CellList,Array.prototype.push.apply(e,t.sideobj),(e=e.notnull().filter(function(e){return null!==e.path||e.isNum()})).each(function(e){null===e.path?e.isNum()&&e.draw():e.path.clist.each(function(e){e.isNum()&&e.draw()})}))},inputlight:function(){var e,t=this.getcell();t.isnull||("rectslider"!==(e=this.puzzle).pid&&this.inputdark(t,1)||"satogaeri"!==e.pid&&(this.mouseend&&this.notInputted()&&(this.mouseCell=this.board.emptycell),this.inputBGcolor()))},inputqcmp:function(e){var t=this.getcell();t.isnull||this.inputdark(t,e,!0)},inputdark:function(e,t,i){if((e=this.getcell()).isnull||e===this.mouseCell&&i)return!1;var i=this.puzzle.execConfig("dispmove")?e.base:e,n=this.inputPoint.bx-e.bx,o=this.inputPoint.by-e.by;return i.isNum()&&("completion"===this.inputMode||0===i.qnum&&"timebomb"===this.pid||-2===i.qnum&&n*n+o*o<.36)?(null===this.inputData&&(this.inputData=i.qcmp!==t?21:20),i.setQcmp(21===this.inputData?t:0),e.draw(),this.mouseCell=e,!0):(this.mouseCell=e,!1)}},"MouseEvent@timebomb":{inputModes:{edit:["number","clear","boulder"],play:["line","clear","objblank","completion"]},inputMoveLine:function(){this.common.inputMoveLine.call(this);var e=this.mouseCell;0===e.qnum&&(this.mouseCell=this.board.emptycell,e.draw())},inputDot:function(){this.inputBGcolor()},inputBGcolor:function(){var e=this.getcell();e.isnull||e===this.mouseCell||this.mouseend&&e!==this.firstCell||("left"===this.btn&&"objblank"!==this.inputMode&&-1===e.qnum?this.puzzle.execConfig("dispmove")&&e.path&&e.path.departure!==e&&(1!==e.lcnt||!e.path.departure.isnull)||(e.setAnum(-1===e.anum?0:-1),e.setQsub(0)):0!==e.lcnt||e.isNum()||(null===this.inputData&&(this.inputData=1!==e.qsub?11:10),e.setQsub(this.inputData-10)),e.draw(),this.mouseCell=e)}},KeyEvent:{enablemake:!0},Cell:{isCmp:function(){return this.isCmp_bonsan(this.puzzle.execConfig("autocmp"),this.puzzle.execConfig("dispmove"))},isCmp_bonsan:function(e,t){t=t?this.base:this;if(1===t.qcmp)return!0;if(!e)return!1;e=t.getNum();if(null===this.path)return 0===e;t=null!==this.path?this.path.clist:[this];if("timebomb"===this.pid)return e===t.length-1;var i=t.getRectSize();return(1===i.cols||1===i.rows)&&e===t.length-1},maxnum:function(){var e=this.board,t=this.bx,i=this.by,t=(t<e.maxbx>>1?e.maxbx-t:t)>>1,e=(i<e.maxby>>1?e.maxby-i:i)>>1;return Math.max(t,e)},minnum:0},"Cell@satogaeri":{posthook:{qcmp:function(e){this.path.destination.room.checkAutoCmp()}}},"Cell@timebomb":{posthook:{qnum:function(){this.path&&this.path.clist.draw()},anum:function(){this.path&&this.path.clist.draw()}},maxnum:function(){var e=this.board.cell.length-1;return Math.min(e,999)},noLP:function(e){return 0!==this.base.anum&&(0===this.qnum||this.puzzle.execConfig("dispmove")&&null!==this.distance&&this.distance<=0)},isDot:function(){return 1===this.qsub&&!this.isNum()&&0===this.lcnt}},Border:{prehook:{line:function(e){return this.puzzle.execConfig("dispmove")&&this.checkFormCurve(e)}},posthook:{line:function(e){!e&&this.sidecell[0].path&&this.sidecell[1].path&&this.board.linegraph.rebuild();for(var t=0;t<=1;t++)this.sidecell[t].path&&(this.sidecell[t].path.departure.draw(),this.sidecell[t].path.destination.draw())}}},"Border@satogaeri":{posthook:{line:function(e){if(e)this.sidecell[0].room.checkAutoCmp(),this.sidecell[1].room.checkAutoCmp(),this.sidecell[0].path.departure.room.checkAutoCmp(),this.sidecell[0].path.destination.room.checkAutoCmp();else for(var t=0;t<=1;t++)this.sidecell[t].path?(this.sidecell[t].path.departure.room.checkAutoCmp(),this.sidecell[t].path.destination.room.checkAutoCmp()):this.sidecell[t].room.checkAutoCmp()}}},"Border@timebomb":{prehook:{line:function(e){if(!e)return!1;if(this.isLineNG())return!0;if(!this.puzzle.execConfig("dispmove")||!this.sidecell[0].path||!this.sidecell[1].path)return!1;if(-2===this.sidecell[0].path.departure.qnum||-2===this.sidecell[1].path.departure.qnum)return!1;e=0===this.sidecell[0].path.departure.anum?1:0;return this.sidecell[e].distance-this.sidecell[1-e].distance!=1}}},"Cell@heyabon,satogaeri":{distance:null,getState:function(){var e=this.adjacent,t=this.adjborder,i=this.distance-1;return this.isDestination()?8:t.top.isLine()&&e.top.distance===i?0:t.left.isLine()&&e.left.distance===i?1:t.bottom.isLine()&&e.bottom.distance===i?2:t.right.isLine()&&e.right.distance===i?3:-1},setState:function(e){var t;isNaN(e)||(t=this.adjborder,0===e?t.top.line=1:1===e?t.left.line=1:2===e?t.bottom.line=1:3===e&&(t.right.line=1))}},Board:{cols:8,rows:8,hasborder:1},LineGraph:{relation:{"border.line":"link","cell.qnum":"move","cell.anum":"move"},enabled:!0,moveline:!0,resetExtraData:function(e){e.distance=0<=e.qnum?e.qnum:0===e.anum?0:null,this.common.resetExtraData.call(this,e)},setExtraData:function(e){if(this.common.setExtraData.call(this,e),(r=e.departure).isnull)return e.clist.each(function(e){e.distance=null}),void e.clist.draw();var t=r.qnum,i=-1!==r.anum,t=0<=t?t:i?0:this.board.cell.length;if(r.distance=t,0===r.lcnt)r.draw();else{for(var n=r.getdir(r.pathnodes[0].nodes[0].obj,2),o=r.getaddr(),s=r.distance;;){o.movedir(n,2);var r,c=(r=o.getc()).adjborder;if(r.isnull||3<=r.lcnt||0===r.lcnt)break;if(s+=i?1:-1,r.distance=s,r===e.destination)break;1!==n&&c.bottom.isLine()?n=2:2!==n&&c.top.isLine()?n=1:3!==n&&c.right.isLine()?n=4:4!==n&&c.left.isLine()&&(n=3)}e.clist.draw()}}},"AreaRoomGraph@bonsan,heyabon,satogaeri":{enabled:!0},"AreaShadeGraph@rectslider":{enabled:!0,relation:{"cell.qnum":"node","border.line":"move"},isnodevalid:function(e){return-1!==e.base.qnum},modifyOtherInfo:function(e,t){this.setEdgeByNodeObj(e.sidecell[0]),this.setEdgeByNodeObj(e.sidecell[1])}},"Graphic@bonsan,heyabon,rectslider":{bgcellcolor_func:"qsub2",autocmp:"number"},"Graphic@satogaeri":{bgcellcolor_func:"qcmp",autocmp:"room"},"CellList@satogaeri":{checkCmp:function(){return 1===this.filter(function(e){return e.isDestination()&&e.isCmp_bonsan(!0,!0)}).length}},Graphic:{hideHatena:!0,gridcolor_type:"LIGHT",numbercolor_func:"move",qsubcolor1:"rgb(224, 224, 255)",qsubcolor2:"rgb(255, 255, 144)",circlefillcolor_func:"qcmp",paint:function(){this.drawBGCells(),this.drawGrid(),"heyabon"!==this.pid&&"satogaeri"!==this.pid||this.drawBorders(),this.drawTip(),this.drawDepartures(),this.drawLines(),this.drawCircledNumbers(),"timebomb"===this.pid&&(this.drawDotCells(),this.drawStripedCircles()),this.drawChassis(),this.drawTarget()}},"Graphic@rectslider":{fontShadecolor:"white",qcmpcolor:"gray",paint:function(){this.drawDashedGrid(),this.drawTip(),this.drawDepartures(),this.drawLines(),this.drawQuesCells(),this.drawMBs(),this.drawQuesNumbers(),this.drawChassis(),this.drawTarget()},getQuesCellColor:function(e){var t=this.puzzle;if(-1===(t.execConfig("dispmove")?e.base:e).qnum)return null;if(t.execConfig("dispmove")&&t.mouse.mouseCell===e)return this.movecolor;t=e.error||e.qinfo;return 0===t?this.quescolor:1===t?this.errcolor1:null},getQuesNumberColor:function(e){return e.isCmp()?this.qcmpcolor:this.fontShadecolor}},"Graphic@timebomb":{autocmp:"number",hideHatena:!1,getStripedCircleColor:function(e){return-1!==(this.puzzle.execConfig("dispmove")?e.base:e).anum?"green":null},drawStripedCircles:function(){for(var e=this.vinc("cell_striped","auto",!0),t=this.circleratio,i=this.range.cells,n=(e.lineWidth=Math.max(this.cw*(t[0]-t[1]),1),this.cw*(t[0]+t[1])/2),o=0;o<i.length;o++){var s=i[o],r=this.getStripedCircleColor(s);if(e.vid="c_cirstr_"+s.id,r){var c=s.bx*this.bw+this.getCellHorizontalOffset(s),a=s.by*this.bh;e.strokeStyle=r,e.beginPath();for(var l=0;l<360;l+=45)e.arc(c,a,n,(l-15)*Math.PI/180,(l+15)*Math.PI/180,!1);e.stroke()}else e.vhide()}},getCircleFillColor:function(e){var t=this.puzzle.execConfig("dispmove"),i=t?e.base:e;return 0===i.qnum?e.error||e.qinfo?this.errcolor1:"black":0===i.anum&&t?this.circlebasecolor:this.getCircleFillColor_qcmp(e)},getQuesNumberColor:function(e){return 0===e.qnum?"white":this.getQuesNumberColor_move(e)},getQuesNumberText:function(e){if(0===e.qnum&&e.qcmp&&0===e.lcnt)return"X";if(this.puzzle.execConfig("dispmove")){if(-2===(i=(e.base||e).qnum)||null===e.distance)return-2===i?"?":null;var t=e.path&&e.path.departure?e.path.departure.qnum:null;return 0===t||-2===t?null:""+Math.max(0,e.distance)}var i;return 0<(i=e.qnum)?""+i:-2===i?"?":""}},"Encode@bonsan":{decodePzpr:function(e){this.checkpflag("c")||this.decodeBorder(),this.decodeNumber16()},encodePzpr:function(e){this.outpflag="c",this.encodeNumber16()}},"Encode@heyabon":{decodePzpr:function(e){this.decodeBorder(),this.decodeNumber16()},encodePzpr:function(e){this.encodeBorder(),this.encodeNumber16()}},"Encode@satogaeri":{decodePzpr:function(e){this.decodeBorder(),this.decodeNumber16()},encodePzpr:function(e){this.encodeBorder(),this.encodeNumber16()},decodeKanpen:function(){this.fio.decodeAreaRoom(),this.fio.decodeQnum_PBox_Sato()},encodeKanpen:function(){this.fio.encodeAreaRoom(),this.fio.encodeQnum_PBox_Sato()}},"Encode@rectslider,timebomb":{decodePzpr:function(e){this.decodeNumber16()},encodePzpr:function(e){this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeCellQsubQcmp(),"rectslider"!==this.pid&&"timebomb"!==this.pid&&this.decodeBorderQues(),this.decodeBorderLine()},encodeData:function(){this.encodeCellQnum(),this.encodeCellQsubQcmp(),"rectslider"!==this.pid&&"timebomb"!==this.pid&&this.encodeBorderQues(),this.encodeBorderLine()},decodeCellQsubQcmp:function(){this.decodeCell(function(e,t){"0"!==t&&(e.qsub=15&+t,e.qcmp=+t>>4&1,e.anum=+t>>5?0:-1)})},encodeCellQsubQcmp:function(){this.encodeCell(function(e){return e.qsub+(e.qcmp<<4)+(0===e.anum?32:0)+" "})},kanpenOpen:function(){this.decodeAreaRoom(),this.decodeQnum_PBox_Sato(),this.decodeLine_PBox_Sato()},kanpenSave:function(){this.encodeAreaRoom(),this.encodeQnum_PBox_Sato(),this.encodeLine_PBox_Sato()},decodeQnum_PBox_Sato:function(){this.decodeCell(function(e,t){"-"===t?e.qnum=-2:"."!==t&&(e.qnum=+t)})},encodeQnum_PBox_Sato:function(){this.encodeCell(function(e){return 0<=e.qnum?e.qnum+" ":-2===e.qnum?"- ":". "})},decodeLine_PBox_Sato:function(){this.decodeCell(function(e,t){e.setState(+t)})},encodeLine_PBox_Sato:function(){this.encodeCell(function(e){e=e.getState();return 0<=e?e+" ":". "})},kanpenOpenXML:function(){this.decodeAreaRoom_XMLBoard(),this.decodeCellQnum_XMLBoard(),this.decodeBorderLine_satogaeri_XMLAnswer()},kanpenSaveXML:function(){this.encodeAreaRoom_XMLBoard(),this.encodeCellQnum_XMLBoard(),this.encodeBorderLine_satogaeri_XMLAnswer()},UNDECIDED_NUM_XML:-2,decodeBorderLine_satogaeri_XMLAnswer:function(){this.decodeCellXMLArow(function(e,t){e.setState(+t.substr(1))})},encodeBorderLine_satogaeri_XMLAnswer:function(){this.encodeCellXMLArow(function(e){return"n"+e.getState()})}},AnsCheck:{checklist:["checkLineExist+","checkBranchLine","checkCrossLine","checkConnectObject","checkLineOverLetter","checkCurveLine@!timebomb","checkAdjacentLine@timebomb","checkMovedBlockRect@rectslider","checkMovedBlockSize@rectslider","checkLineLength","checkFractal@bonsan,heyabon","checkNoObjectBlock@satogaeri,heyabon","checkNoMoveCircle","checkBoulders@timebomb","checkDisconnectLine"],checkCurveLine:function(){this.checkAllArea(this.board.linegraph,function(e,t,i,n){return 1===e||1===t},"laCurve")},checkLineLength:function(){this.checkAllArea(this.board.linegraph,function(e,t,i,n){return n<0||1===i||n===i-1},"laLenNe")},checkNoMoveCircle:function(){this.checkAllCell(function(e){return 1<=e.qnum&&0===e.lcnt},"nmNoMove")},checkFractal:function(){var e=this.board.roommgr.components;e:for(var t=0;t<e.length;t++){var i=e[t].clist,n=i.getRectSize();n.xx=n.x1+n.x2,n.yy=n.y1+n.y2;for(var o=0;o<i.length;o++){var s=i[o];if(s.isDestination()!==this.board.getc(n.xx-s.bx,n.yy-s.by).isDestination()){if(this.failcode.add("bonsan"===this.pid?"brObjNotSym":"bkObjNotSym"),this.checkOnly)break e;i.filter(function(e){return e.isDestination()}).seterr(1)}}}},checkNoObjectBlock:function(){this.checkNoMovedObjectInRoom(this.board.roommgr)}},"AnsCheck@rectslider":{checkMovedBlockRect:function(){this.checkAllArea(this.board.sblkmgr,function(e,t,i,n){return e*t===i},"csNotRect")},checkMovedBlockSize:function(){this.checkAllArea(this.board.sblkmgr,function(e,t,i,n){return 1<i},"bkSize1")}},"AnsCheck@timebomb":{checkAdjacentLine:function(){this.checkSideCell(function(e,t){var i=e.getNum(),n=t.getNum();return 0!==i&&0!==n&&(-1===i||-1===n)&&(!(-1===i||!t.path||t.path.departure.isnull||t.path.departure===e)||(!(-1===n||!e.path||e.path.departure.isnull||e.path.departure===t)||e.path&&t.path&&!e.path.departure.isnull&&e.path.departure!==t.path.departure))},"lnAdjacent")},checkBoulders:function(){var t=this.board;this.checkAllCell(function(e){return 0===e.qnum&&!t.cellinside(e.bx-2,e.by-2,e.bx+2,e.by+2).some(function(e){return 0!==e.qnum&&e.path&&-1!==e.base.qnum})},"ceNoBomb")}}});
//# sourceMappingURL=bonsan.js.map