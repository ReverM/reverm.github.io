/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["kakuru","numrope","sananko"],{MouseEvent:{inputModes:{edit:["number","clear"],play:["number","clear"]},mouseinput_auto:function(){this.mousestart&&this.inputqnum()},inputqnum_main:function(e){this.puzzle.editmode&&this.inputshade_preqnum(e)||1!==e.ques&&this.common.inputqnum_main.call(this,e)},inputshade_preqnum:function(e){var t=null;return 1===e.ques?"left"===this.btn?t=-2:"right"===this.btn&&(t=-1):0===e.ques&&-1===e.qnum?"left"===this.btn&&(t=-3):-2===e.qnum&&"right"===this.btn&&(t=-3),null!==t&&(e.setNum(t),e.draw()),null!==t}},"MouseEvent@numrope":{inputModes:{edit:["number","line","clear"],play:["number","dragnum+","dragnum-","clear"]},mouseinput_auto:function(){(this.mousestart||this.mousemove)&&(this.puzzle.playmode?this.dragnumber_numrope():this.puzzle.editmode&&this.inputLine()),this.mouseend&&this.notInputted()&&(this.mouseCell=null,this.inputqnum())},mouseinput:function(){0===this.inputMode.indexOf("dragnum")?this.dragnumber_numrope():this.common.mouseinput.call(this)},dragnumber_numrope:function(){var e=this.getcell();if(!e.isnull&&e!==this.mouseCell){if(this.mouseCell.isnull)return-1!==e.qnum?this.inputData=0:-1!==e.anum?this.inputData=e.anum:this.inputData=-1,void(this.mouseCell=e);if(0===this.inputData&&-1===e.qnum&&(this.inputData=-1),-1===e.qnum){if(1<=this.inputData&&this.inputData<=9){if("dragnum+"===this.inputMode||"auto"===this.inputMode&&"left"===this.btn?this.inputData++:this.inputData--,!(1<=this.inputData&&this.inputData<=9))return;e.clrSnum(),e.setAnum(this.inputData)}else{if(-1!==this.inputData)return;e.setAnum(-1)}(this.mouseCell=e).draw()}}}},"MouseEvent@sananko":{inputModes:{edit:["number","clear"],play:["number","numblank","numexist","clear"]},mouseinput_auto:function(){this.puzzle.playmode&&(this.mousestart||this.mousemove)&&this.dragnumber_sananko(),this.mouseend&&this.notInputted()&&(this.mouseCell=this.board.emptycell,this.inputqnum())},dragnumber_sananko:function(){var e=this.getcell();if(!e.isnull&&e!==this.mouseCell)if(null===this.inputData){if("right"===this.btn&&this.mousemove)this.inputData=e.qsub?-1:-2;else if("left"===this.btn){if(this.inputData=e.anum,-1===this.inputData)for(var t=0;t<4;t++)-1!==e.snum[t]&&(this.inputData=e.snum);-1===this.inputData&&e.qsub&&(this.inputData=e.qsub-4),this.mouseCell=e}}else{if(null!==this.inputData&&"object"==typeof this.inputData&&-1===e.qnum){for(t=0;t<4;t++)e.setSnum(t,this.inputData[t]);e.draw()}else-1<=this.inputData&&-1===e.qnum?(e.clrSnum(),e.setAnum(this.inputData),e.setQsub(0),e.draw()):this.inputData<=-2&&-1===e.qnum&&(e.setAnum(-1),e.setQsub(this.inputData+4),e.draw());this.mouseCell=e}},inputDot:function(){var e=this.getcell();e.isnull||e===this.mouseCell||-1!==e.qnum||(null===this.inputData&&(this.inputData=1===e.qsub?0:1),e.setAnum(-1),e.setQsub(1===this.inputData?1:0),(this.mouseCell=e).draw())}},KeyEvent:{enablemake:!0,enableplay:!0,keyinput:function(e){this.key_inputqnum_kakuru(e)},key_inputqnum_kakuru:function(e){var t=this.cursor.getc();this.puzzle.playmode&&t.enableSubNumberArray&&"shift"===e&&t.noNum()?this.cursor.chtarget():"sananko"!==this.pid||!this.puzzle.playmode||"+"!==e&&"q"!==e&&"4"!==e?"sananko"!==this.pid||!this.puzzle.playmode||"-"!==e&&"w"!==e&&"5"!==e?"0"<=e&&e<="9"||"BS"===e||"-"===e?this.puzzle.playmode&&1===t.ques||this.key_inputqnum_main(t,e):" "===e?(t.setNum(-1),t.draw(),this.prev=t):!this.puzzle.editmode||"q"!==e&&"q1"!==e&&"q2"!==e||("q1"===(e="q"===e?1!==t.ques?"q1":"q2":e)?t.setNum(-3):"q2"===e&&t.setNum(-1),t.draw(),this.prev=t):this.key_inputqnum_main(t,"s2"):this.key_inputqnum_main(t,"s1")}},"KeyEvent@numrope":{moveTarget:function(e){return!e.match(/shift/)&&this.moveTCell(e)},keyinput:function(e){if(this.puzzle.editmode){var t,n,u=this.cursor.getc(),i=u.NDIR;switch(e){case"shift+up":i=u.UP;break;case"shift+down":i=u.DN;break;case"shift+left":i=u.LT;break;case"shift+right":i=u.RT}if(i!==u.NDIR)return t=u.getaddr(),(n=u.getaddr()).movedir(i,1),(n=n.getb()).isLine()?n.removeLine():n.setLine(),this.cursor.movedir(i,2),t.draw(),void this.cursor.draw()}this.key_inputqnum_kakuru(e)}},Cell:{enableSubNumberArray:!0,maxnum:function(){return this.puzzle.editmode?44:9},getNum:function(){return 1===this.ques?-3:-1!==this.qnum?this.qnum:this.anum},setNum:function(e){-3===e&&this.puzzle.editmode?(e=1===this.ques?0:1,this.setQnum(-1),this.setQues(e),this.setAnum(-1)):(this.puzzle.editmode&&this.setQues(0),this.common.setNum.call(this,e))}},"Cell@sananko":{numberAsObject:!0,numberWithMB:!0,minnum:function(){return this.puzzle.editmode?0:1},maxnum:function(){return this.puzzle.editmode?12:3}},"Cell@numrope":{isValidNum:function(){return!this.isnull&&0<=this.anum},maxnum:function(){return this.puzzle.editmode?36:9},noLP:function(e){return 0!==this.ques||-1!==this.qnum},posthook:{ques:function(){this.clearLines()},qnum:function(){this.clearLines()}},clearLines:function(){if(this.noLP())for(var e in this.adjborder)this.adjborder[e].setQues(0)}},Board:{cols:7,rows:7},"Board@numrope":{hasborder:1},"Border@numrope":{isLine:function(){return 0<this.ques},setLine:function(){this.setQues(1)},removeLine:function(e){this.setQues(0)},enableLineNG:!0,prehook:{ques:function(e){return this.checkStableLine(e)}}},"AreaNumberGraph@sananko":{enabled:!0,isnodevalid:function(e){return-1!==e.anum}},Graphic:{gridcolor_type:"LIGHT",circleratio:[.45,.45],paint:function(){this.drawTargetSubNumber(),this.drawBGCells(),this.drawGrid(),this.drawQuesCells(),"kakuru"===this.pid?this.drawCircledNumbers():(this.drawMBs(),this.drawQuesNumbers()),"numrope"===this.pid&&this.drawLines(),this.drawSubNumbers(),this.drawAnsNumbers(),this.drawChassis(),this.drawCursor()},getQuesCellColor:function(e){return 1!==e.ques&&-1===e.qnum?null:1===(e.error||e.qinfo)?this.errcolor1:this.quescolor},circlestrokecolor_func:"null",getCircleFillColor:function(e){return-1!==e.qnum?1===e.error?this.errbcolor1:"white":null},getBGCellColor:function(e){return-1===e.qnum&&-1===e.anum&&1===e.error?this.errbcolor1:null}},"Graphic@numrope#1":{getLineColor:function(e){return e.isLine()?"#aaaaaa":null}},"Graphic@numrope,sananko":{numbercolor_func:"fixed_shaded",fontShadecolor:"white"},Encode:{decodePzpr:function(e){this.decodeKakuru()},encodePzpr:function(e){this.encodeKakuru()},decodeKakuru:function(){for(var e=0,t=0,n=this.outbstr,u=this.board,t=0;t<n.length;t++){var i=n.charAt(t),s=u.cell[e];if("+"===i?s.ques=1:this.include(i,"k","z")?e+=parseInt(i,36)-19:"."!==i&&(s.qnum=this.decval(i)),e++,!u.cell[e])break}this.outbstr=n.substr(t)},encodeKakuru:function(e){for(var t="",n=0,u=this.board,i=0;i<u.cell.length;i++){var s="",r=u.cell[i];-1!==r.qnum?s=this.encval(r.qnum):1===r.ques?s="+":n++,0===n?t+=s:!s&&17!==n||(t+=1===n?"."+s:(n+18).toString(36)+s,n=0)}1===n?t+=".":1<n&&(t+=(n+18).toString(36)),this.outbstr+=t},decval:function(e){return"_"===e?-2:"0"<=e&&e<="9"||"a"<=e&&e<="j"?parseInt(e,36):"A"<=e&&e<="Z"?parseInt(e,36)+10:-1},encval:function(e){return-2===e?"_":1<=e&&e<=19?e.toString(36).toLowerCase():20<=e&&e<=45?(e-10).toString(36).toUpperCase():"0"}},"Encode@numrope":{decodePzpr:function(e){this.decodeBorder(),this.decodeKakuru()},encodePzpr:function(e){this.encodeBorder(),this.encodeKakuru()}},FileIO:{decodeData:function(){this.decodeCell(function(e,t){"b"===t?e.ques=1:"?"===t?e.qnum=-2:"."!==t&&(e.qnum=+t)}),"numrope"===this.pid&&this.decodeBorderQues(),this.decodeCell(function(e,t){"+"===(t=0<=t.indexOf("[")?this.setCellSnum(e,t):t)?e.qsub=1:"-"===t?e.qsub=2:"."!==t&&"0"!==t&&(e.anum=+t)})},encodeData:function(){this.encodeCell(function(e){return-2===e.qnum?"? ":0<=e.qnum?e.qnum+" ":1===e.ques?"b ":". "}),"numrope"===this.pid&&this.encodeBorderQues(),this.encodeCell(function(e){var t=".";return 1!==e.ques&&-1===e.qnum&&(t=-1!==e.anum?e.anum:1===e.qsub?"+":2===e.qsub?"-":"0"),e.enableSubNumberArray&&-1===e.anum&&(t+=this.getCellSnum(e)),t+" "})}},AnsCheck:{checklist:["checkRange","checkAroundPlNums","checkSumOfNumber","checkAdjacentNumbers","checkNoNumCell+"],checkRange:function(){var t="sananko"===this.pid?3:9;this.checkAllCell(function(e){return-1!==e.anum&&(e.anum<1||e.anum>t)},"nmRange")},checkAroundPlNums:function(e){var t=this.board;e:for(var n=0;n<t.cell.length;n++){var u=t.cell[n];if(!(1===u.ques||u.qnum<=0)){var i=u.bx,s=u.by,r={1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0},a=new this.klass.CellList,o=t.cellinside(i-2,s-2,i+2,s+2);a.add(u);for(var h=0;h<o.length;h++){var l,c=o[h];u===c||0!==c.ques||-1!==c.qnum||0<(l=c.anum)&&(r[l]++,a.add(c))}for(var m=1;m<=9;m++)if(!(r[m]<=1)){if(this.failcode.add("nqAroundDup"),this.checkOnly)break e;u.seterr(1),a.filter(function(e){return e.anum===m}).seterr(1)}}}},checkSumOfNumber:function(e){for(var t=this.board,n=0;n<t.cell.length;n++){var u=t.cell[n];if(!(1===u.ques||u.qnum<0)){var i=0,s=u.bx,r=u.by,a=new this.klass.CellList,o="kakuru"===this.puzzle.pid?t.cellinside(s-2,r-2,s+2,r+2):u.getdir4clist();a.add(u);for(var h=0;h<o.length;h++){var l=o[h];if(u!==(l=2===l.length?l[0]:l)&&0===l.ques&&-1===l.qnum){var c=l.anum;if(0<c)i+=c,a.add(l);else if(!e){i=u.qnum;break}}}if(u.qnum!==i){if(this.failcode.add("nqAroundSumNe"),this.checkOnly)break;a.seterr(1)}}}},checkAdjacentNumbers:function(){for(var e=this.board,t=0;t<e.cell.length;t++){var n=e.cell[t];if(!(n.anum<=0)){var u=n.bx,i=n.by,s=new this.klass.CellList,r=e.cellinside(u,i,u+2,i+2);s.add(n),r.add(e.getc(u-2,i+2));for(var a=0;a<r.length;a++){var o=r[a];n!==o&&n.anum===o.anum&&s.add(o)}if(!(s.length<=1)){if(this.failcode.add("nmAround"),this.checkOnly)break;s.seterr(1)}}}}},"AnsCheck@numrope":{checklist:["checkRange","checkSumOfNumber","checkAdjacentDiffNumber","checkNumberDifference","checkNumberInSequence","checkNoNumCell+"],checkNumberDifference:function(){this.checkSideAreaCell(function(e,t){return e.isValidNum()&&t.isValidNum()&&1<Math.abs(e.anum-t.anum)},!1,"nmSubNe1")},checkNumberInSequence:function(){this.checkAllCell(function(e){if(!e.isValidNum())return!1;for(var t=0,n=!1,u=!1,i=!1,s=e.getdir4cblist(),r=0;r<s.length;r++){var a=s[r];a[1].isLine()&&(a[0].isValidNum()?(t++,n|=e.anum>a[0].anum,u|=e.anum<a[0].anum):i=!0)}return!i&&2<=t&&(!n||!u)},"nmNotSeq")}},"AnsCheck@sananko":{checklist:["checkRange","checkAdjacentSameNumber","checkOverThreeCells","checkLessThreeCells","checkSumOfNumberStrict"],checkSumOfNumberStrict:function(){this.checkSumOfNumber(!0)},checkAdjacentSameNumber:function(){this.checkSideCell(function(e,t){return-1!==e.anum&&-1!==t.anum&&e.anum!==t.anum},"nmAdjacent")},checkLessThreeCells:function(){this.checkAllArea(this.board.nblkmgr,function(e,t,n,u){return 3<=n},"bkSizeLt3")},checkOverThreeCells:function(){this.checkAllArea(this.board.nblkmgr,function(e,t,n,u){return n<=3},"bkSizeGt3")}}});
//# sourceMappingURL=kakuru.js.map