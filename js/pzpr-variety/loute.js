/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["loute","sashigane","sashikazune"],{"MouseEvent@loute":{inputModes:{edit:["arrow","circle-unshade","undef","clear"],play:["border","subline"]}},"MouseEvent@sashigane":{inputModes:{edit:["arrow","number","undef","clear"],play:["border","subline"]},mouseinput_number:function(){this.mousestart&&this.inputqnum_loute()}},"MouseEvent@loute,sashigane#1":{mouseinput:function(){"undef"===this.inputMode||"circle-unshade"===this.inputMode?this.mousestart&&this.inputqnum_loute():this.common.mouseinput.call(this)},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&("left"===this.btn&&this.isBorderMode()?this.inputborder():this.inputQsubLine()):this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputarrow_cell():this.mouseend&&this.notInputted()&&this.inputqnum_loute())},inputarrow_cell_main:function(e,t){e.setQdir(e.qdir!==t?t:0),e.setQnum(-1)},inputqnum_loute:function(){var e=this.getcell();e.isnull||(e!==this.cursor.getc()&&"auto"===this.inputMode?this.setcursor(e):this.inputcell_loute(e))},inputcell_loute:function(e){var t=e.qdir,i=e.qnum,i=5===t?-1!==i?i:2:0===t?1:-2===t?0:t-5,t=-4,r=e.getmaxnum();"loute"===this.pid&&(r=2),"circle-unshade"!==this.inputMode&&!this.inputMode.match(/number/)||(t=1),"undef"===this.inputMode&&(r=1,t=0),"left"===this.btn?t<=i&&i<r?i++:i=t:"right"===this.btn&&(t<i&&i<=r?i--:i=r),2<=i?(e.setQdir(5),e.setNum(3<=i?i:-1)):(1===i?e.setQdir(0):0===i?e.setQdir(-2):e.setQdir(i+5),e.setNum(-1)),e.draw()}},"MouseEvent@sashikazune":{inputModes:{edit:["number","clear"],play:["diraux","border","subline"]},mouseinput_other:function(){"diraux"===this.inputMode&&this.inputarrow_cell()},inputarrow_cell_main:function(e,t){e.setQsub(e.qsub^1<<t+1)},autoedit_func:"qnum",autoplay_func:"border"},KeyEvent:{enablemake:!0},"KeyEvent@loute,sashigane":{moveTarget:function(e){return!e.match(/shift/)&&this.moveTCell(e)},keyinput:function(e){this.key_inputarrow(e)||("loute"===this.pid?this.key_arrow_loute(e):"sashigane"===this.pid&&this.key_inputqnum_sashigane(e))},key_arrow_loute:function(e){"1"===e?e="1":"2"===e?e="4":"3"===e?e="2":"4"===e?e="3":"5"===e||"q"===e?e="q":"6"!==e&&" "!==e||(e=" ");var t=this.cursor.getc(),i=-1;if("1"<=e&&e<="4")i=t.qdir!==(i=+e)?i:0;else if("-"===e)i=-2!==t.qdir?-2:0;else if("q"===e)i=5!==t.qdir?5:0;else if(" "===e||"BS"===e)i=0;else{if("s1"!==e)return;i=-2}t.setQdir(i),(this.prev=t).draw()},key_inputqnum_sashigane:function(e){var t=this.cursor.getc();"q"===e?(t.setQdir(5!==t.qdir?5:0),t.setQnum(-1)):"-"===e?(t.setQdir(-2!==t.qdir||-1!==t.qnum?-2:0),t.setQnum(-1)):"BS"===e&&5===t.qdir?-1!==t.qnum?(this.key_inputqnum_main(t,e),-2===t.qnum&&t.setQnum(-1)):(t.setQdir(0),t.setQnum(-2)):" "===e||"BS"===e?(t.setQdir(0),t.setQnum(-1)):(this.key_inputqnum_main(t,e),t.isNum()&&5!==t.qdir&&t.setQdir(5)),(this.prev=t).draw()}},Cell:{maxnum:function(){var e=this.board,t=this.bx,i=this.by;return((t<e.maxbx>>1?e.maxbx-t+2:t+2)>>1)+((i<e.maxby>>1?e.maxby-i+2:i+2)>>1)-1},minnum:3,place:0,getObjNum:function(){return this.qdir},isCircle:function(){return 5===this.qdir}},"Cell@sashikazune":{minnum:1,maxnum:function(){return Math.max(this.board.cols,this.board.rows)}},Board:{cols:8,rows:8,hasborder:1},"BoardExec@loute,sashigane":{adjustBoardData:function(e,t){this.adjustNumberArrow(e,t)}},AreaRoomGraph:{enabled:!0,resetExtraData:function(e){e.place=0},setExtraData:function(t){t.clist=new this.klass.CellList(t.getnodeobjs()),t.shape=0;var e=t.clist,i=e.getRectSize(),r=this.board.cellinside(i.x1,i.y1,i.x2,i.y2).filter(function(e){return e.room!==t}),s=r.getRectSize();if(0===r.length||s.cols*s.rows!==s.cnt||i.cols-1!==s.cols||i.rows-1!==s.rows)for(var n=t.shape=0;n<e.length;n++)e[n].place=0;else t.shape=1,this.setCellPlaces(e,i,s)},setCellPlaces:function(e,t,i){for(var r=this.board,s=0;s<e.length;s++)e[s].place=1;var n=t.x1===i.x1&&t.y1===i.y1,o=t.x2===i.x2&&t.y1===i.y1,a=t.x1===i.x1&&t.y2===i.y2,i=t.x2===i.x2&&t.y2===i.y2;n||i?(r.getc(t.x1,t.y2).place=2,r.getc(t.x2,t.y1).place=2):(a||o)&&(r.getc(t.x1,t.y1).place=2,r.getc(t.x2,t.y2).place=2),n?r.getc(t.x2,t.y2).place=3:a?r.getc(t.x2,t.y1).place=3:o?r.getc(t.x1,t.y2).place=3:i&&(r.getc(t.x1,t.y1).place=3)}},"AreaRoomGraph@sashikazune":{setCellPlaces:function(e,t,i){var r=this.board,s=null;if(t.x1===i.x1&&t.y1===i.y1)s=r.getc(t.x2,t.y2);else if(t.x1===i.x1&&t.y2===i.y2)s=r.getc(t.x2,t.y1);else if(t.x2===i.x2&&t.y1===i.y1)s=r.getc(t.x1,t.y2);else{if(t.x2!==i.x2||t.y2!==i.y2)return;s=r.getc(t.x1,t.y1)}for(var n=0;n<e.length;n++){var o=e[n];o.place=1+(Math.abs(o.bx-s.bx)+Math.abs(o.by-s.by)>>1)}}},Graphic:{gridcolor_type:"DLIGHT",bordercolor_func:"qans",numbercolor_func:"qnum",circleratio:[.4,.4],paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawCellArrows(),this.drawHatenas_loute(),"sashigane"===this.pid?this.drawCircledNumbers():"loute"===this.pid?this.drawCircles():(this.drawQuesNumbers(),this.drawArrowAuxMarks()),this.drawBorderQsubs(),this.drawChassis(),this.drawTarget()},getCircleStrokeColor:function(e){return e.isCircle()?this.quescolor:null},circlefillcolor_func:"null",drawHatenas_loute:function(){for(var e=this.vinc("cell_hatena","auto"),t=this.range.cells,i=0;i<t.length;i++){var r=t[i];e.vid="cell_text_h_"+r.id,-2===r.qdir?(e.fillStyle=1===r.error?this.errcolor1:this.quescolor,this.disptext("?",r.bx*this.bw,r.by*this.bh)):e.vhide()}}},"Graphic@sashikazune":{fontsizeratio:.75,drawArrowAuxMarks:function(){var e=this.vinc("cell_ticks","auto"),t=(e.lineWidth=1+this.cw/40|0,.15*this.cw);t<3&&(t=3);for(var i=0;i<this.board.cell.length;i++)for(var r,s,n,o,a,c,u=this.board.cell[i],l=u.bx,h=u.by,d=l*this.bw,m=h*this.bh,f=(e.strokeStyle="rgb(127,127,255)",[[-1,1],[1,1],[-1,0],[1,0]]),b=0;b<f.length;b++)e.vid="ut_cell"+b+"_"+u.id,u.qsub&1<<b+2?(r=f[b][0],o=[(c=(s=f[b][1])?m:d)+r*this.bw-+r*t,(n=s?d:m)+t],a=[c+r*this.bw-.5*r*t,n],c=[c+r*this.bw-+r*t,n-t],e.beginPath(),e.moveTo(o[+!!s],o[+!s]),e.lineTo(a[+!!s],a[+!s]),e.lineTo(c[+!!s],c[+!s]),e.moveTo(a[+!!s],a[+!s]),e.closePath(),e.stroke()):e.vhide()}},"Encode@loute":{decodePzpr:function(e){this.decodeLoute()},encodePzpr:function(e){this.encodeLoute()},decodeLoute:function(){for(var e=0,t=0,i=this.outbstr,r=this.board,t=0;t<i.length;t++){var s=r.cell[e],n=i.charAt(t);if(this.include(n,"0","9")||this.include(n,"a","f")?s.qdir=parseInt(n,16):"."===n?s.qdir=-2:"g"<=n&&n<="z"&&(e+=parseInt(n,36)-16),++e>=r.cell.length)break}this.outbstr=i.substr(t)},encodeLoute:function(){for(var e=0,t="",i=this.board,r=0;r<i.cell.length;r++){var s="",n=i.cell[r].qdir;-2===n?s=".":0!==n?s=n.toString(16):e++,0===e?t+=s:!s&&20!==e||(t+=(15+e).toString(36)+s,e=0)}0<e&&(t+=(15+e).toString(36)),this.outbstr+=t}},"Encode@sashigane":{decodePzpr:function(e){this.decodeSashigane()},encodePzpr:function(e){this.encodeSashigane()},decodeSashigane:function(){for(var e=0,t=0,i=this.outbstr,r=this.board,t=0;t<i.length;t++){var s=i.charAt(t),n=r.cell[e];if(this.include(s,"0","9")||this.include(s,"a","f")?(n.qdir=5,n.qnum=parseInt(s,16)):"-"===s?(n.qdir=5,n.qnum=parseInt(i.substr(t+1,2),16),t+=2):"."===s?n.qdir=5:"%"===s||"@"===s?n.qdir=-2:"g"<=s&&s<="j"?n.qdir=parseInt(s,20)-15:"k"<=s&&s<="z"&&(e+=parseInt(s,36)-20),e++,!r.cell[e])break}this.outbstr=i.substr(t+1)},encodeSashigane:function(){for(var e="",t=0,i=this.board,r=0;r<i.cell.length;r++){var s="",n=i.cell[r].qdir,o=i.cell[r].qnum;5===n?s=0<=o&&o<16?o.toString(16):16<=o&&o<256?"-"+o.toString(16):".":-2===n?s="@":0!==n?s=(n+15).toString(20):t++,0===t?e+=s:!s&&16!==t||(e+=(t+19).toString(36)+s,t=0)}0<t&&(e+=(t+19).toString(36)),this.outbstr+=e}},"Encode@sashikazune":{decodePzpr:function(e){this.decodeNumber16()},encodePzpr:function(e){this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeCell(function(e,t){"o"===t.charAt(0)?(e.qdir=5,1<t.length&&(e.qnum=+t.substr(1))):"-"===t?e.qdir=-2:"."!==t&&(e.qdir=+t)}),this.decodeBorderAns()},encodeData:function(){var t=this.pid;this.encodeCell(function(e){return"sashigane"===t&&5===e.qdir?"o"+(-1!==e.qnum?e.qnum:"")+" ":-2===e.qdir?"- ":0!==e.qdir?e.qdir+" ":". "}),this.encodeBorderAns()}},"FileIO@sashikazune":{decodeData:function(){this.decodeCellQnum(),this.decodeBorderAns(),this.decodeCellQsub()},encodeData:function(){this.encodeCellQnum(),this.encodeBorderAns(),this.encodeCellQsub()}},AnsCheck:{checklist:["checkArrowCorner1","checkArrowCorner2","checkCircleCorner","checkNumberAndSize+@sashigane","checkBorderDeadend","checkLblock"],checkArrowCorner1:function(){var e=this.board.roommgr.components;e:for(var t=0;t<e.length;t++)if(0!==e[t].shape)for(var i=e[t].clist,r=0;r<i.length;r++){var s=i[r],n=s.getObjNum();if(!(n<1||4<n||2===s.place)){if(this.failcode.add("arBlkEdge"),this.checkOnly)break e;i.seterr(1);break}}},checkArrowCorner2:function(){var e=this.board.roommgr.components;e:for(var t=0;t<e.length;t++)if(0!==e[t].shape)for(var i=e[t].clist,r=0;r<i.length;r++){var s=i[r],n=s.adjborder,o=s.getObjNum();if(!(o<1||4<o)&&(o===s.UP&&n.top.isBorder()||o===s.DN&&n.bottom.isBorder()||o===s.LT&&n.left.isBorder()||o===s.RT&&n.right.isBorder())){if(this.failcode.add("arNotPtCnr"),this.checkOnly)break e;i.seterr(1);break}}},checkCircleCorner:function(){var e=this.board.roommgr.components;e:for(var t=0;t<e.length;t++)if(0!==e[t].shape)for(var i=e[t].clist,r=0;r<i.length;r++){var s=i[r];if(s.isCircle()&&3!==s.place){if(this.failcode.add("ciNotOnCnr"),this.checkOnly)break e;i.seterr(1);break}}},checkLblock:function(){for(var e=this.board.roommgr.components,t=0;t<e.length;t++)if(0===e[t].shape){if(this.failcode.add("bkNotLshape"),this.checkOnly)break;e[t].clist.seterr(1)}}},"AnsCheck@sashikazune":{checklist:["checkNumberDistance","checkNumber3Count","checkBorderDeadend","checkLblock"],checkNumberDistance:function(){this.checkAllCell(function(e){return e.isValidNum()&&0!==e.place&&e.place!==e.getNum()},"nmDistNe")},checkNumber3Count:function(){this.checkAllBlock(this.board.roommgr,function(e){return e.isNum()&&0!==e.place},function(e,t,i,r){return i<=2},"bkNumGt2")}}});
//# sourceMappingURL=loute.js.map