/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["bosanowa"],{MouseEvent:{inputModes:{edit:["number","clear"],play:["number","subnumber","subnumber-","clear"]},mouseinput_clear:function(){this.inputclean_all()},mouseinput_other:function(){0===this.inputMode.indexOf("subnumber")&&this.mousestart&&this.inputsubnumber_border()},mouseinput_auto:function(){this.mousestart&&this.inputqnum_bosanowa()},inputqnum_bosanowa:function(){var e=this.getpos(.31);e.isinside()&&(this.cursor.equals(e)?e.oncell()&&this.inputcell_bosanowa(e):this.setcursor(e))},inputcell_bosanowa:function(e){var t,s,i,e=e.getc();e.isnull||(t=e.getmaxnum(),s=e.ques,i=e.getNum(),this.puzzle.editmode&&("left"===this.btn?7===s?(e.setNum(-1),e.setQues(0)):-1===i?(e.setNum(1),e.setQues(0)):i===t?(e.setNum(-1),e.setQues(7)):e.setNum(i+1):"right"===this.btn&&(7===s?(e.setNum(t),e.setQues(0)):1===i?(e.setNum(-1),e.setQues(0)):-1===i?(e.setNum(-1),e.setQues(7)):e.setNum(i-1))),this.puzzle.playmode&&0===s&&("left"===this.btn?i===t?e.setNum(-1):-1===i?e.setNum(1):e.setNum(i+1):"right"===this.btn&&(-1===i?e.setNum(t):1===i?e.setNum(-1):e.setNum(i-1))),e.drawaround())},inputsubnumber_border:function(){var e,t,s=this.getpos(.31),i=s.getb();!i.isnull&&i.isGrid()&&(this.cursor.equals(s)?(e="left"===this.btn,t=i.qsub,i.setQsub(t=e?t<99?t+1:-1:-1<t?t-1:99),i.drawaround()):this.setcursor(s))},inputclean_all:function(){var e,t=this.getpos(.31);this.prevPos.equals(t)||(t.oncell()?this.inputclean_cell():t.onborder()&&(e=t.getb(),new this.klass.BorderList([e]).ansclear(),e.drawaround()),this.prevPos=t)}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(e){return this.moveTBorder(e)},keyinput:function(e){this.key_inputqnum_bosanowa(e)},key_inputqnum_bosanowa:function(e){var t=this.cursor;if(t.oncell()){var s=t.getc();if(this.puzzle.editmode)if("w"===e)s.setQues(7!==s.ques?7:0),s.setNum(-1);else if("-"===e)s.setQues(0),s.setNum(-1);else if(" "===e||"BS"===e)-1!==s.getNum()?this.key_inputqnum(e):s.setQues(7);else{if(!("0"<=e&&e<="9"))return;0!==s.ques&&(s.setQues(0),s.setNum(-1)),this.key_inputqnum(e)}else if(this.puzzle.playmode){if(0!==s.ques)return;this.key_inputqnum(e)}}else{if(!t.onborder())return;s=t.getb();if(!s.isGrid())return;if("0"<=e&&e<="9"){var i=+e,r=s.qsub;!(r<=0||this.prev!==s)&&10*r+i<=99?s.setQsub(10*r+i):i<=99&&s.setQsub(i),this.prev=s}else if("BS"===e)(i=s.qsub)<10?s.setQsub(-1):s.setQsub(i/10|0);else{if("-"!==e&&" "!==e)return;s.setQsub(-1)}}t.drawaround()}},TargetCursor:{initCursor:function(){var e=this.board;this.bx=1+(e.cols-1&-2),this.by=1+(e.rows-1&-2)}},Cell:{ques:7},Border:{qsub:-1,isGrid:function(){return this.sidecell[0].isValid()&&this.sidecell[1].isValid()},isBorder:function(){return!!(this.sidecell[0].isEmpty()^this.sidecell[1].isEmpty())}},Board:{hasborder:2,initBoardSize:function(e,t){this.common.initBoardSize.call(this,e,t),this.puzzle.playeronly||((e=this.puzzle.cursor.getc()).isnull||(e.ques=0))}},Graphic:{circleratio:[.47,.42],paint:function(){this.drawBGCells();var e=+this.puzzle.getConfig("disptype_bosanowa");1==e?(this.drawCircles(),this.drawBDnumbase()):2==e?(this.drawOutside_souko(),this.drawGrid_souko(),this.drawBDnumbase()):3==e&&(this.drawBorders(),this.drawGrid_waritai()),this.drawQuesNumbers(),this.drawAnsNumbers(),this.drawSubNumbersBD(),this.puzzle.playeronly||this.outputImage||this.drawChassis(),this.drawTarget_bosanowa()},getCanvasCols:function(){var e=this.puzzle.getConfig("disptype_bosanowa");return this.getBoardCols()+2*this.margin+(2===e?2:0)},getCanvasRows:function(){var e=this.puzzle.getConfig("disptype_bosanowa");return this.getBoardRows()+2*this.margin+(2===e?2:0)},getCircleStrokeColor:function(e){return e.isValid()&&!e.isNum()?1===e.error?this.errcolor1:this.quescolor:null},circlefillcolor_func:"null",drawGrid_souko:function(){for(var e=this.vinc("grid_souko","crispEdges",!0),t=(e.lineWidth=1,e.strokeStyle="rgb(127,127,127)",this.range.borders),s=0;s<t.length;s++){var i,r,o,u=t[s];e.vid="b_grids_"+u.id,u.isGrid()?(i=u.bx*this.bw,r=u.by*this.bh,u.isVert()?(u=r-this.bh,o=r+this.bh+1,e.strokeDashedLine(i,u,i,o,[3])):(u=i-this.bw,o=i+this.bw+1,e.strokeDashedLine(u,r,o,r,[3]))):e.vhide()}},drawGrid_waritai:function(){for(var e=this.vinc("grid_waritai","crispEdges",!0),t=.2*this.cw,s=this.range.borders,i=0;i<s.length;i++){var r=s[i],o=r.isGrid(),u=r.bx*this.bw,n=r.by*this.bh;e.vid="b_grid_"+r.id,o?(e.fillStyle=this.gridcolor,r.isVert()?e.fillRectCenter(u,n,.5,this.bh):e.fillRectCenter(u,n,this.bw,.5)):e.vhide(),e.vid="b_grid2_"+r.id,o?(e.fillStyle=0===r.error?"white":this.errbcolor1,r.isVert()?e.fillRectCenter(u,n,.5,t):e.fillRectCenter(u,n,t,.5)):e.vhide()}},drawBDnumbase:function(){for(var e=this.vinc("border_number_base","crispEdges",!0),t=.2*this.cw,s=this.range.borders,i=0;i<s.length;i++){var r=s[i];e.vid="b_bbse_"+r.id,0<=r.qsub&&r.isGrid()?(e.fillStyle="white",e.fillRectCenter(r.bx*this.bw,r.by*this.bh,t,t)):e.vhide()}},drawSubNumbersBD:function(){for(var e=this.vinc("border_number","auto"),t={ratio:.35},s=this.range.borders,i=0;i<s.length;i++){var r=s[i];e.vid="border_text_"+r.id,0<=r.qsub?(e.fillStyle=r.trial?this.trialcolor:this.subcolor,this.disptext(""+r.qsub,r.bx*this.bw,r.by*this.bh,t)):e.vhide()}},drawOutside_souko:function(){for(var e=this.vinc("cell_outside_souko","crispEdges",!0),t=(e.fillStyle="rgb(127,127,127)",this.range),s=t.x1-2|1;s<=t.x2+2;s+=2)for(var i=t.y1-2|1;i<=t.y2+2;i+=2){var r=new this.klass.Address(s,i);e.vid=["c_full_",s,i].join("_"),!r.getc().isEmpty()||0!==r.relcell(-2,0).ques&&0!==r.relcell(2,0).ques&&0!==r.relcell(0,-2).ques&&0!==r.relcell(0,2).ques&&0!==r.relcell(-2,-2).ques&&0!==r.relcell(2,-2).ques&&0!==r.relcell(-2,2).ques&&0!==r.relcell(2,2).ques?e.vhide():e.fillRectCenter(s*this.bw,i*this.bh,this.bw+.5,this.bh+.5)}},drawTarget_bosanowa:function(){var e=this.puzzle.cursor.oncell();this.drawCursor(e)}},Encode:{decodePzpr:function(e){this.decodeBoard(),this.decodeNumber16();var t=this.puzzle;this.checkpflag("h")?t.setConfig("disptype_bosanowa",2):this.checkpflag("t")&&t.setConfig("disptype_bosanowa",3)},encodePzpr:function(e){this.encodeBosanowa();var t=this.puzzle;2===t.getConfig("disptype_bosanowa")?this.outpflag="h":3===t.getConfig("disptype_bosanowa")&&(this.outpflag="t")},decodeBoard:function(){for(var e=this.outbstr,t=0,s=this.board,i=[16,8,4,2,1],r=0;r<e.length;r++){for(var o=parseInt(e.charAt(r),32),u=0;u<5;u++)s.cell[t]&&(s.cell[t].ques=o&i[u]?7:0,t++);if(!s.cell[t])break}this.outbstr=e.substr(r+1)},encodeBosanowa:function(e){for(var t=9999,s=-1,i=9999,r=-1,o=this.board,u=0;u<o.cell.length;u++)(c=o.cell[u]).isEmpty()||(t>c.bx&&(t=c.bx),s<c.bx&&(s=c.bx),i>c.by&&(i=c.by),r<c.by&&(r=c.by));for(var n="",l=0,a=0,h=[16,8,4,2,1],d=i;d<=r;d+=2)for(var c,b=t;b<=s;b+=2)(c=o.getc(b,d)).isEmpty()&&(a+=h[l]),5===++l&&(n+=a.toString(32),a=l=0);0<l&&(n+=a.toString(32)),this.outbstr+=n;for(n="",l=0,d=i;d<=r;d+=2)for(b=t;b<=s;b+=2){var f="",m=o.getc(b,d).qnum;-2===m?f=".":0<=m&&m<16?f=m.toString(16):16<=m&&m<256?f="-"+m.toString(16):l++,0===l?n+=f:!f&&20!==l||(n+=(15+l).toString(36)+f,l=0)}0<l&&(n+=(15+l).toString(36)),this.outbstr+=n,this.outcols=(s-t+2)/2,this.outrows=(r-i+2)/2}},FileIO:{decodeData:function(){this.decodeCell(function(e,t){e.ques="."===t?7:0,"0"!==t&&"."!==t&&(e.qnum=+t)}),this.decodeCell(function(e,t){"0"!==t&&"."!==t&&(e.anum=+t)}),this.decodeBorder(function(e,t){"."!==t&&(e.qsub=+t)},1)},encodeData:function(){this.encodeCell(function(e){return 7===e.ques?". ":0<=e.qnum?e.qnum+" ":"0 "}),this.encodeCell(function(e){return 7===e.ques||-1!==e.qnum?". ":0<=e.anum?e.anum+" ":"0 "}),this.encodeBorder(function(e){return-1!==e.qsub?e.qsub+" ":". "},1)}},AnsCheck:{checklist:["checkSubsNumber","checkNoNumCell+"],checkSubsNumber:function(){for(var e=[],t=this.board,s=0;s<t.border.length;s++){var i=t.border[s],r=i.sidecell[0],o=i.sidecell[1];i.isGrid()?r.isValidNum()&&o.isValidNum()?e[s]=Math.abs(r.getNum()-o.getNum()):e[s]=-1:e[s]=null}for(var u=0;u<t.cell.length;u++){var n=t.cell[u];if(!n.isEmpty()&&!n.noNum()){var l=n.adjborder,a=n.getNum(),h=0,d=e[l.top.id];if(0<d)h+=d;else if(-1===d)continue;if(0<(d=e[l.bottom.id]))h+=d;else if(-1===d)continue;if(0<(d=e[l.left.id]))h+=d;else if(-1===d)continue;if(0<(d=e[l.right.id]))h+=d;else if(-1===d)continue;if(a!==h){if(this.failcode.add("nmSumOfDiff"),this.checkOnly)break;n.seterr(1)}}}}}});
//# sourceMappingURL=bosanowa.js.map