/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,i){"object"==typeof module&&module.exports?module.exports=[t,i]:pzpr.classmgr.makeCustom(t,i)}(["haisu","bdwalk","kaisu"],{MouseEvent:{draggingSG:!1,inputModes:{edit:["border","number"],play:["line","peke","diraux","info-line"]},mouseinput_other:function(){"diraux"===this.inputMode&&(this.mousestart||this.mousemove?this.inputdiraux_mousemove():this.mouseend&&this.notInputted()&&this.clickdiraux())},mouseinput_auto:function(){this.puzzle.playmode&&"right"===this.btn?this.mousestart?this.inputdiraux_mousedown():2===this.inputData||3===this.inputData?this.inputpeke():this.mousemove&&this.inputdiraux_mousemove():this.puzzle.playmode&&"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.clickdiraux():this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputEdit():this.mouseend&&this.inputEdit_end())},inputEdit:function(){var t=this.getcell();t.isnull||(null===this.inputData&&this.inputEdit_first(),this.draggingSG&&10===this.inputData?this.board.startpos.input(t):this.draggingSG&&11===this.inputData?this.board.goalpos.input(t):null!==this.inputData&&this.inputborder())},inputEdit_first:function(){var t=this.getpos(.33),i=this.board;i.startpos.equals(t)?(this.inputData=10,this.draggingSG=!0):i.goalpos.equals(t)?(this.inputData=11,this.draggingSG=!0):this.inputborder()},inputEdit_end:function(){var t=this.getcell();t.isnull||(this.draggingSG?(this.draggingSG=!1,t.draw()):this.notInputted()&&(t!==this.cursor.getc()?this.setcursor(t):this.inputqnum()))}},"MouseEvent@kaisu":{inputModes:{edit:["border","circle-unshade"],play:["line","peke","diraux","info-line"]}},"MouseEvent@bdwalk":{inputModes:{edit:["number"],play:["line","peke","diraux","info-line"]},inputborder:function(){},inputqnum_main:function(t){var i=[-1,-2,-3,-4,1],e=i.indexOf(t.qnum),i=-1===e?0:"left"===this.btn?i[e+1]:i[e-1];i?this.inputFixedNumber(i):this.common.inputqnum_main.call(this,t)}},KeyEvent:{enablemake:!0,keyinput:function(t){this.keydown&&this.puzzle.editmode&&this.key_inputqnum_haisu(t)},key_inputqnum_haisu:function(t){var i=this.cursor.getc(),e=this.board,s=i.ques;"s"===t?e.startpos.input(i):"g"===t?e.goalpos.input(i):this.key_inputqnum_main(i,t),-1===s||e.startpos.equals(i)||e.goalpos.equals(i)||(i.setQues(-1),i.draw())}},"KeyEvent@bdwalk":{keyinput:function(t){this.keydown&&this.puzzle.editmode&&this.key_inputqnum_bdwalk(t)},key_inputqnum_bdwalk:function(t){"u"===t?t="s2":"d"===t&&(t="s3"),this.key_inputqnum_haisu(t)}},Board:{cols:7,rows:7,hasborder:1,startpos:null,goalpos:null,createExtraObject:function(){var t=this.klass;this.startpos=new t.StartAddress(1,1),this.goalpos=new t.GoalAddress(2*this.cols-1,2*this.rows-1),this.startpos.partner=this.goalpos,this.goalpos.partner=this.startpos},initExtraObject:function(t,i){this.disableInfo(),1&t||1&i?this.startpos.init(1,2*i-1):this.startpos.init(1,1),this.goalpos.init(2*t-1,1),this.enableInfo()},exchangestartgoal:function(){var t=this.startpos.getc(),i=this.goalpos.getc();this.startpos.set(i),this.goalpos.set(t),this.startpos.draw(),this.goalpos.draw()},findHighestNumber:function(){var i=1;return this.cell.each(function(t){t.qnum>i&&(i=t.qnum)}),i}},LineGraph:{enabled:!0,makeClist:!0},"AreaRoomGraph@haisu,kaisu":{enabled:!0},"Cell@haisu":{maxnum:function(){return this.room.clist.length}},"Cell@kaisu":{disInputHatena:!0,maxnum:1},"Cell@bdwalk":{maxnum:99,setWalkLineError:function(t,i){if(!this.isnull&&!i.isnull)for(var e=new this.klass.Address,s=(e.set(this),this),o=this.board.emptycell,r=new this.klass.Address;;){if(s!==this&&2!==s.lcnt||s===i)break;for(var n=1;n<=4;n++)if(!(0<t&&n!==t)&&(r.set(e),r.movedir(n,2),r.getc()!==o)){if(e.movedir(n,1),e.getb().isLine()){e.getb().seterr(1),e.set(r),o=s,s=e.getc(),t=0;break}e.set(s)}if(4<n)break}}},GraphComponent:{visit:0},BoardExec:{posinfo:{},adjustBoardData:function(t,i){var e=this.board;this.posinfo_start=this.getAfterPos(t,i,e.startpos.getc()),this.posinfo_goal=this.getAfterPos(t,i,e.goalpos.getc())},adjustBoardData2:function(t,i){var e=this.board,s=this.puzzle.opemgr,o=this.posinfo_start,r=this.posinfo_goal,t=t&this.REDUCE&&(o.isdel||r.isdel)&&!s.undoExec&&!s.redoExec;t&&(s.forceRecord=!0),e.startpos.set(o.pos.getc()),e.goalpos.set(r.pos.getc()),e.startpos.equals(e.goalpos)&&(e.startpos.init(1,1),e.goalpos.init(e.maxbx-1,e.maxby-1)),t&&(s.forceRecord=!1)}},OperationManager:{addExtraOperation:function(){this.operationlist.push(this.klass.StartGoalOperation)}},Graphic:{irowake:!0,gridcolor_type:"LIGHT",paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawGrid(),"bdwalk"!==this.pid&&this.drawBorders(),"kaisu"===this.pid&&this.drawCircledNumbers(),this.drawLines(),this.drawPekes(),this.drawBorderAuxDir(),"kaisu"!==this.pid&&this.drawQuesNumbers(),this.drawChassis(),this.drawBoxBorders(!0),this.drawTarget()},getQuesNumberText:function(t){var i=this.board;return(i.startpos.getc()===t?"S":i.goalpos.getc()===t?"G":"")+(-3===t.qnum?"▲":-4===t.qnum?"▼":this.getNumberText(t,t.qnum))},getQuesNumberColor:function(t){var i=this.board;if(this.puzzle.mouse.draggingSG){var e=this.puzzle.mouse.inputData;if(i.startpos.getc()===t&&10===e||i.goalpos.getc()===t&&11===e)return"red"}return 1===(t.error||t.qinfo)?this.errcolor1:this.quescolor}},"Graphic@bdwalk":{icecolor:"rgb(204,204,204)",hideHatena:!0,getBGCellColor:function(t){var i=t.qnum<-1;return 1===t.error||1===t.qinfo?i?this.erricecolor:this.errbcolor1:i?this.icecolor:null},getNumberVerticalOffset:function(t){return this.fontsizeratio=t.qnum<-1?.7:.8,0}},"Graphic@kaisu":{getNumberText:function(){return""}},Encode:{decodePzpr:function(t){this.decodeSG(),this.decodeBorder(),this.decodeNumber16()},encodePzpr:function(t){this.encodeSG(),this.encodeBorder(),this.encodeNumber16()},decodeSG:function(){this.board.startpos.bx=2*this.decodeOneNumber16()-1,this.board.startpos.by=2*this.decodeOneNumber16()-1,this.board.goalpos.bx=2*this.decodeOneNumber16()-1,this.board.goalpos.by=2*this.decodeOneNumber16()-1},encodeSG:function(){this.outbstr+=this.writeNumber16((this.board.startpos.bx+1)/2),this.outbstr+=this.writeNumber16((this.board.startpos.by+1)/2),this.outbstr+=this.writeNumber16((this.board.goalpos.bx+1)/2),this.outbstr+=this.writeNumber16((this.board.goalpos.by+1)/2)}},"Encode@kaisu":{decodePzpr:function(t){this.decodeSG(),this.decodeBorder(),this.decode1Cell(1)},encodePzpr:function(t){this.encodeSG(),this.encodeBorder(),this.encode1Cell(1)}},"Encode@bdwalk":{decodePzpr:function(t){var e=this.board;this.decodeSG(),this.genericDecodeNumber16(e.cell.length,function(t,i){e.cell[t].qnum=0===i?-3:1===i?-4:1<i?i-1:i}),this.puzzle.setConfig("bdwalk_height",!this.checkpflag("m"))},encodePzpr:function(t){this.outpflag=this.puzzle.getConfig("bdwalk_height")?null:"m";var i=this.board;this.encodeSG(),this.genericEncodeNumber16(i.cell.length,function(t){t=i.cell[t].qnum;return-3===t?0:-4===t?1:t<0?t:t+1})}},FileIO:{decodeData:function(){this.decodeSG(),this.decodeBorderQues(),this.decodeCellQnum(),1<=this.filever?this.decodeBorderArrowAns():this.decodeBorderLine()},encodeData:function(){this.filever=1,this.encodeSG(),this.encodeBorderQues(),this.encodeCellQnum(),this.encodeBorderArrowAns()},decodeSG:function(){var t=this.readLine().split(" ");this.board.startpos.bx=parseInt(t[0]),this.board.startpos.by=parseInt(t[1]),this.board.goalpos.bx=parseInt(t[2]),this.board.goalpos.by=parseInt(t[3])},encodeSG:function(){this.writeLine(this.board.startpos.bx+" "+this.board.startpos.by+" "+this.board.goalpos.bx+" "+this.board.goalpos.by)}},"FileIO@bdwalk":{decodeData:function(){this.decodeConfig(),this.decodeSG(),this.decodeCellQnum(),this.decodeBorderArrowAns()},encodeData:function(){this.encodeConfig(),this.encodeSG(),this.encodeCellQnum(),this.encodeBorderArrowAns()},decodeCellQnum:function(){this.decodeCell(function(t,i){"-"===i?t.qnum=-2:"U"===i?t.qnum=-3:"D"===i?t.qnum=-4:"."!==i&&(t.qnum=+i)})},encodeCellQnum:function(){this.encodeCell(function(t){return 0<=t.qnum?t.qnum+" ":-2===t.qnum?"- ":-3===t.qnum?"U ":-4===t.qnum?"D ":". "})},decodeConfig:function(){"m"===this.dataarray[this.lineseek]?(this.puzzle.setConfig("bdwalk_height",!1),this.readLine()):this.puzzle.setConfig("bdwalk_height",!0)},encodeConfig:function(){this.puzzle.getConfig("bdwalk_height")||this.writeLine("m")}},AnsCheck:{checklist:["checkBranchLine","checkCrossLine","haisuPassThroughSG","haisuWalk","haisuDeadendOutOfSG","checkNoLine","checkOneLine"],haisuPassThroughSG:function(){var t=this.board,i=t.getc(t.startpos.bx,t.startpos.by),t=t.getc(t.goalpos.bx,t.goalpos.by),e=!1;1<i.lcnt&&(i.seterr(1),i.draw(),e=!0),1<t.lcnt&&(t.seterr(1),i.draw(),e=!0),e&&this.failcode.add("haisuSG")},haisuWalk:function(){var t=this.board,i=t.getc(t.startpos.bx,t.startpos.by),e=t.getc(t.goalpos.bx,t.goalpos.by),s=!1;if(1===i.lcnt){for(var o=t.roommgr.components,r=0;r<o.length;r++)o[r].visit=0;var n=i.room,a=null,h=null,d=i,l=new this.klass.CellList;for(n.visit=1;;){var a=d.room,u=h?t.getb(h.bx+d.bx>>1,h.by+d.by>>1):null,u=u&&u.isBorder();if("kaisu"===this.pid&&(c=null,u?(c=l,l=new this.klass.CellList):(d===e||1===d.lcnt&&l.length>=n.visit)&&(c=l),0<d.qnum&&l.add(d),c&&0<c.length&&c.length!==n.visit&&(c.seterr(1),s=!0)),u&&(a.visit++,n=a),"haisu"===this.pid&&0<d.qnum&&d.qnum!==a.visit&&(d.seterr(1),s=!0),d!==i&&2!==d.lcnt){"kaisu"===this.pid&&u&&d===e&&0<d.qnum&&1!==a.visit&&(d.seterr(1),s=!0);break}var c=[];d.relbd(-1,0).isLine()&&c.push(d.relcell(-2,0)),d.relbd(0,-1).isLine()&&c.push(d.relcell(0,-2)),d.relbd(1,0).isLine()&&c.push(d.relcell(2,0)),d.relbd(0,1).isLine()&&c.push(d.relcell(0,2)),d=1!==c.length&&c[0]===h?(h=d,c[1]):(h=d,c[0])}s&&this.failcode.add("haisuError")}},haisuDeadendOutOfSG:function(){var t=this.board,i=t.getc(t.startpos.bx,t.startpos.by),e=t.getc(t.goalpos.bx,t.goalpos.by);this.checkAllCell(function(t){return t!==i&&t!==e&&1===t.lcnt},"lnDeadEnd")}},"AnsCheck@bdwalk":{checklist:["checkBranchLine","checkCrossLine","haisuPassThroughSG","checkBdWalkLines","checkBdWalkVisited+","checkOneLine+"],errorPriorities:["bdwMismatch","bdwSkipElevator","bdwInvalidUp","bdwInvalidDown","bdwGroundFloor","bdwTopFloor"],walkLine:function(t,i){var e=this.board,s=e.emptycell,o=[],r=e.startpos.getc();if(t===e.goalpos.getc())return null;for(var n=new this.klass.Address,a=(n.set(t),t),h=s,d=new this.klass.Address,l=1<i?0:2,u=1,c=s.NDIR,p=[];;){if(this.checkonly&&0<o.length)return o;3===l&&i-1<=u&&(l=2,u=i),4===l&&u<=2&&(l=2,u=1);var b=a.qnum;if(-2===b&&2===l&&1===u?b=-3:-2===b&&2===l&&u===i&&(b=-4),b<-1&&(p.push(a),-4===b&&2===l&&1===u&&o.push({code:"bdwGroundFloor",list:(p=[a]).slice(),dir:c}),-3===b&&2===l&&u===i&&o.push({code:"bdwTopFloor",list:(p=[a]).slice(),dir:c}),-2===b&&(l=2===l?1:0),-3===b&&(3===l?u++:2!==l&&(u=1),l=3),-4===b&&(4===l?u--:2!==l&&(u=i),l=4),(g=(p[p.length-2]||s).qnum)<-1&&g!==a.qnum&&(p=[a],c=s.NDIR)),0<b){if(p.push(a),3===l&&b<=u?o.push({code:1===b?"bdwSkipElevator":"bdwInvalidDown",list:p.slice(),dir:c}):4===l&&u<=b&&o.push({code:b===i?"bdwSkipElevator":"bdwInvalidUp",list:p.slice(),dir:c}),2===l&&b!==u){var g,f="bdwMismatch";switch(g=(p[p.length-2]||s).qnum){case-2:f="bdwSkipElevator";break;case-3:f="bdwInvalidDown";break;case-4:f="bdwInvalidUp"}o.push({code:f,list:p.slice(),dir:c})}1===l&&b===u&&o.push({code:"bdwSkipElevator",list:p.slice(),dir:c}),l=2,u=b,p=[a],c=s.NDIR}if(a!==t&&2!==a.lcnt)break;for(var m=1;m<=4;m++)if(d.set(n),d.movedir(m,2),d.getc()!==h){if(n.movedir(m,1),n.getb().isLine()){n.set(d),h=a,c===s.NDIR&&(c=m),a=n.getc();break}n.set(a)}}return a===r?null:o},checkBdWalkLines:function(){var t=this.board.findHighestNumber()+(this.puzzle.getConfig("bdwalk_height")?this.board.rows*this.board.cols:0),i=!this.puzzle.getConfig("multierr"),e=!1;if(!this._prioMap){this._prioMap={};for(var s=0;s<this.errorPriorities.length;s++)this._prioMap[this.errorPriorities[s]]=s}for(var o=this._prioMap,r=this.board.linegraph.components,n=0;n<r.length;n++){var a=r[n].clist.filter(function(t){return 1===t.lcnt});if(2===a.length){var h=this.walkLine(a[0],t),a=this.walkLine(a[1],t);if(!(null!==h&&0===h.length||null!==a&&0===a.length)){if(this.checkonly)return void this.failcode.add((null===h?a:h)[0].code);e||(this.board.border.setnoerr(),e=!0);var d=this.errorPriorities.length,l=(null!==h&&h.forEach(function(t){d=Math.min(d,o[t.code])}),this.errorPriorities.length),u=(null!==a&&a.forEach(function(t){l=Math.min(l,o[t.code])}),Math.min(d,l)),h=u===d?h:a,c=this.failcode;h.forEach(function(t){i&&o[t.code]!==u||(t.list.forEach(function(t){t.seterr(1),t.setCrossBorderError()}),0<t.list.length&&t.dir&&t.list[0].setWalkLineError(t.dir,t.list[t.list.length-1]),c.add(t.code))})}}}},checkBdWalkVisited:function(){var i=this.board.startpos.getc(),e=this.board.goalpos.getc();this.checkAllCell(function(t){return(-1!==t.qnum||t===i||t===e)&&0===t.lcnt},"lnIsolate")}}});
//# sourceMappingURL=haisu.js.map