/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["amibo"],{MouseEvent:{inputModes:{edit:["number","clear"],play:["bar","peke"]},mouseinput_auto:function(){this.puzzle.playmode?((this.mousestart||this.mousemove)&&("left"===this.btn?this.inputTateyoko():"right"===this.btn&&this.inputpeke()),this.mouseend&&this.notInputted()&&(this.inputpeke_ifborder()||this.clickTateyoko())):this.puzzle.editmode&&this.mousestart&&this.inputqnum()},clickTateyoko:function(){var e=this.getcell();e.isnull||e.isNum()||(e.setQans(("left"===this.btn?{0:12,12:13,13:11,11:0}:{0:11,11:13,13:12,12:0})[e.qans]),e.draw())}},KeyEvent:{enablemake:!0},Cell:{numberRemainsUnshaded:!0,maxnum:function(){var e=this.board,t=this.bx,n=this.by,t=(t<e.maxbx>>1?e.maxbx-t:t)>>1,e=(n<e.maxby>>1?e.maxby-n:n)>>1;return Math.max(t,e)},minnum:2,getPoleBar:function(){var e=this.adjacent,t=[],n=e.top;return n.isnull||11!==n.qans&&12!==n.qans||t.push(n.barnodes[0].component),(n=e.bottom).isnull||11!==n.qans&&12!==n.qans||t.push(n.barnodes[0].component),(n=e.left).isnull||11!==n.qans&&13!==n.qans||t.push(n.barnodes[n.barnodes.length<2?0:1].component),(n=e.right).isnull||11!==n.qans&&13!==n.qans||t.push(n.barnodes[n.barnodes.length<2?0:1].component),t}},Board:{hasborder:1,cols:8,rows:8,addExtraInfo:function(){this.netgraph=this.addInfoList(this.klass.AreaNetGraph),this.bargraph=this.addInfoList(this.klass.AreaBarGraph)},irowakeRemake:function(){this.netgraph.newIrowake()}},BoardExec:{adjustBoardData:function(e,t){if(e&this.TURN)for(var n={0:0,11:11,12:13,13:12},o=this.board.cell,r=0;r<o.length;r++){var i=o[r];i.qans=n[i.qans]}}},"AreaNetGraph:AreaGraphBase":{enabled:!0,relation:{"cell.qans":"node"},coloring:!0,setComponentRefs:function(e,t){e.net=t},getObjNodeList:function(e){return e.netnodes},resetObjNodeList:function(e){e.netnodes=[]},isnodevalid:function(e){return 0<e.qans},isedgevalidbynodeobj:function(e,t){var n=e.getdir(t,2);return n===e.UP||n===e.DN?!(0===e.qans||13===e.qans||0===t.qans||13===t.qans):(n===e.LT||n===e.RT)&&!(0===e.qans||12===e.qans||0===t.qans||12===t.qans)},setExtraData:function(e){e.clist=new this.klass.CellList(e.getnodeobjs()),e.color||(e.color=this.puzzle.painter.getNewLineColor())},getLongColor:function(e){return this.klass.GraphBase.prototype.getLongColor.call(this,e)},setLongColor:function(e,t){this.klass.GraphBase.prototype.setLongColor.call(this,e,t)},repaintNodes:function(e){this.klass.AreaShadeGraph.prototype.repaintNodes.call(this,e)},newIrowake:function(){this.klass.GraphBase.prototype.newIrowake.call(this)}},"AreaBarGraph:AreaGraphBase":{enabled:!0,relation:{"cell.qans":"node"},setComponentRefs:function(e,t){e.bar=t},getObjNodeList:function(e){return e.barnodes},resetObjNodeList:function(e){e.barnodes=[]},isnodevalid:function(e){return 0<e.qans},isedgevalidbynodeobj:function(e,t){return this.klass.AreaNetGraph.prototype.isedgevalidbynodeobj.call(this,e,t)},calcNodeCount:function(e){return{0:0,11:2,12:1,13:1}[e.qans]},removeEdgeByNodeObj:function(e){for(var t=this.getSideObjByNodeObj(e),n=this.getObjNodeList(e),o=0;o<t.length;o++){var r=e.getdir(t[o],2),r=r===e.LT||r===e.RT,i=this.getObjNodeList(t[o]),s=n[n.length<2||!r?0:1],i=i[i.length<2||!r?0:1];s&&i&&this.removeEdge(s,i)}for(o=n.length;0<o;o--)this.deleteNode(e.barnodes[0])},addEdgeByNodeObj:function(e){for(var t=0,n=this.calcNodeCount(e);t<n;t++)this.createNode(e);for(var o,r,i,s=this.getSideObjByNodeObj(e),a=this.getObjNodeList(e),t=0;t<s.length;t++)this.isedgevalidbynodeobj(e,s[t])&&(o=(o=e.getdir(s[t],2))===e.LT||o===e.RT,i=this.getObjNodeList(s[t]),r=a[a.length<2||!o?0:1],i=i[i.length<2||!o?0:1],r&&i&&this.addEdge(r,i))},searchGraph:function(){for(var e=this.klass.AreaGraphBase.prototype.searchGraph.call(this),t=0;t<e.length;t++)this.setExtraData(e[t]);return e},setExtraData:function(e){var t;e.clist=new this.klass.CellList(e.getnodeobjs()),e.size=e.clist.length,1<e.nodes?(t=e.clist.getRectSize(),e.vert=1===t.cols):1===e.nodes[0].obj.barnodes.length?e.vert=12===e.nodes[0].obj.qans:e.vert=0===e.nodes[0].obj.barnodes.indexOf(e.nodes[0])},getCrossBars:function(e){for(var t=[],n=0;n<e.nodes.length;n++){var o=e.nodes[n];2===o.obj.barnodes.length&&t.push(o.obj.barnodes[1===o.obj.barnodes.indexOf(o)?0:1].component)}return t}},CellList:{setErrorBar:function(e){for(var t=0;t<this.length;t++){var n=this[t],o=n.error;4!==o&&(5===o?e||n.seterr(4):6===o?e&&n.seterr(4):n.seterr(e?5:6))}}},ObjectOperation:{decode:function(e){e=this.common.decode.call(this,e);return this.old=[0,12,13,11][this.old],this.num=[0,12,13,11][this.num],e}},Graphic:{hideHatena:!0,irowake:!0,gridcolor_type:"LIGHT",numbercolor_func:"fixed",circleratio:[.45,.4],setRange:function(e,t,n,o){this.common.setRange.call(this,e-2,t-2,n+2,o+2)},paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawTateyokos(),this.drawTateyokos_sub(),this.drawCircledNumbers(),this.drawPekeBorder(),this.drawChassis(),this.drawTarget()},drawTateyokos_sub:function(){for(var e=this.vinc("cell_tateyoko","crispEdges",!0),t=(e.fillStyle=this.linecolor,this.range.cells),n=this.bw,o=this.bh,r=0;r<t.length;r++){var i=t[r],s=i.isNum(),a=Math.max(n/3,3),l=n-a/2,h=i.bx*n,c=i.by*o,d=i.adjacent.top,u=d.qans;e.vid="c_bars1a_"+i.id,!s||11!==u&&12!==u?e.vhide():(e.fillStyle=this.getBarColor(d,!0),e.fillRect(h-n+l,c-o,a,o));u=(d=i.adjacent.bottom).qans;e.vid="c_bars1b_"+i.id,!s||11!==u&&12!==u?e.vhide():(e.fillStyle=this.getBarColor(d,!0),e.fillRect(h-n+l,1+c,a,o));u=(d=i.adjacent.left).qans;e.vid="c_bars2a_"+i.id,!s||11!==u&&13!==u?e.vhide():(e.fillStyle=this.getBarColor(d,!1),e.fillRect(h-n,c-o+l,n,a));u=(d=i.adjacent.right).qans;e.vid="c_bars2b_"+i.id,!s||11!==u&&13!==u?e.vhide():(e.fillStyle=this.getBarColor(d,!1),e.fillRect(1+h,c-o+l,n,a))}},drawPekeBorder:function(){for(var e=this.vinc("border_pbd","crispEdges",!0),t=.6*this.bw,n=this.lm,o=this.range.borders,r=0;r<o.length;r++){var i,s,a=o[r];e.vid="b_qsub2_"+a.id,2===a.qsub?(i=a.bx*this.bw,s=a.by*this.bh,e.fillStyle=a.trial?this.trialcolor:"rgb(64,64,64)",a.isVert()?e.fillRectCenter(i,s,n,t+n):e.fillRectCenter(i,s,t+n,n)):e.vhide()}},getBarColor:function(e,t){var n=e.error,t=1===n||4===n||5===n&&t||6===n&&!t;return this.addlw=0,e.trial&&this.puzzle.execConfig("irowake")?this.addlw=-this.lm:t&&(this.addlw=1),t?this.errlinecolor:0!==n?this.noerrcolor:this.puzzle.execConfig("irowake")&&e.net&&e.net.color?e.net.color:e.trial?this.trialcolor:this.linecolor}},Encode:{decodePzpr:function(e){this.decodeNumber10or16()},encodePzpr:function(e){this.encodeNumber10or16()}},FileIO:{decodeData:function(){this.decodeCell(function(e,t){"l"===t?e.qans=12:"-"===t?e.qans=13:"+"===t?e.qans=11:"#"===t?e.qnum=-2:"."!==t&&(e.qnum=+t)}),this.decodeBorderLine()},encodeData:function(){this.encodeCell(function(e){return 12===e.qans?"l ":13===e.qans?"- ":11===e.qans?"+ ":0<=e.qnum?e.qnum+" ":-2===e.qnum?"# ":". "}),this.encodeBorderLine()}},AnsCheck:{checklist:["checkBarExist+","checkNotMultiBar","checkLoop_amibo","checkLongBar","checkCrossedLength","checkShortBar","checkSingleBar","checkAllBarConnect+"],checkBarExist:function(){0<this.board.netgraph.components.length||this.failcode.add("brNoLine")},checkNotMultiBar:function(){this.checkOutgoingBars(1,"nmLineGt1")},checkSingleBar:function(){this.checkOutgoingBars(2,"nmNoLine")},checkOutgoingBars:function(e,t){for(var n=this.board,o=0;o<n.cell.length;o++){var r=n.cell[o];if(r.isNum()){var i=r.getPoleBar();if(!(1===e&&i.length<=1||2===e&&0<i.length)){if(this.failcode.add(t),this.checkOnly)break;r.seterr(1)}}}},checkLongBar:function(){this.checkPoleLength(1,"lbLenGt")},checkShortBar:function(){this.checkPoleLength(2,"lbLenLt")},checkPoleLength:function(e,t){for(var n=!0,o=this.board,r=0;r<o.cell.length;r++){var i=o.cell[r];if(i.isValidNum()){var s=i.getPoleBar()[0];if(s){var a=i.getNum(),l=s.clist,h=l.length;if(!(1===e&&h<=a||2===e&&a<=h)){if(n=!1,this.checkOnly)break;i.seterr(1),l.setErrorBar(s.vert)}}}}n||(this.failcode.add(t),o.cell.filter(function(e){return e.noNum()}).setnoerr())},checkCrossedLength:function(){for(var e=!0,t=this.board,n=t.bargraph.components,o=0,r=n.length;o<r;o++){for(var i=!1,s=n[o],a=t.bargraph.getCrossBars(s),l=0,h=a.length;l<h;l++)if(s.size===a[l].size){i=!0;break}if(!i){if(e=!1,this.checkOnly)break;s.clist.setErrorBar(s.vert)}}e||(this.failcode.add("lbNotCrossEq"),t.cell.filter(function(e){return e.noNum()}).setnoerr())},checkAllBarConnect:function(){this.checkOneArea(this.board.netgraph,"lbDivide")},checkLoop_amibo:function(){for(var e=this.board,t=e.netgraph.components,n=0;n<t.length;n++)if(0!==t[n].circuits){if(this.failcode.add("lbLoop"),this.checkOnly)return;e.cell.filter(function(e){return e.noNum()}).setnoerr(),this.searchloop(t[n],e.netgraph).seterr(4)}}}});
//# sourceMappingURL=amibo.js.map