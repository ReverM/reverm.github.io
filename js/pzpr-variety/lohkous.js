/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["lohkous"],{MouseEvent:{inputModes:{edit:[],play:["border","subline"]},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&("left"===this.btn&&this.isBorderMode()?this.inputborder():this.inputQsubLine()):this.puzzle.editmode&&this.mousestart&&this.setcursor(this.getcell())}},KeyEvent:{enablemake:!0,keyinput:function(e){this.key_inputqnums(e)}},Cell:{distinctQnums:!0,posthook:{qnums:function(){this.board.roommgr.setExtraData(this.room)}}},CellList:{seterr:function(e){if(this.board.isenableSetError())for(var t=0;t<this.length;t++)this[t].error|=e}},Board:{hasborder:1,cols:8,rows:8},AreaRoomGraph:{enabled:!0,setExtraData:function(e){var t=(e.clist=new this.klass.CellList(e.getnodeobjs())).filter(function(e){return 0<e.qnums.length});e.nums=1===t.length?t[0].qnums:[],e.clue=1===t.length?t[0]:this.emptycell,e.numcount=Math.min(2,t.length)}},Graphic:{gridcolor_type:"SLIGHT",bordercolor_func:"qans",getQuesNumberColor:function(e,t){return 1&e.error||e.error&8<<t?this.errcolor1:this.quescolor},getBGCellColor:function(e){return 1&e.error?this.errbcolor1:null},drawLineErrors:function(){this.vinc("cell_line_err","crispEdges",!0);for(var e=this.context,t=this.range.cells,r=0;r<=1;r++)for(var n=0;n<t.length;n++){var s=t[n];e.vid="line_err"+r+"_"+s.id,s.error&2<<r?(e.fillStyle=this.errbcolor1,e.fillRectCenter(s.bx*this.bw,s.by*this.bh,(r?.5:1)*this.bw,(r?1:.5)*this.bh)):e.vhide()}},paint:function(){this.drawBGCells(),this.drawLineErrors(),this.drawTapaNumbers(),this.drawDashedGrid(),this.drawBorders(),this.drawBorderQsubs(),this.drawChassis(),this.drawTarget()}},Encode:{decodePzpr:function(e){this.decodeNumber_lohkous()},encodePzpr:function(e){this.encodeNumber_lohkous()},decodeNumber_lohkous:function(){for(var e=0,t=0,r=!1,n=this.outbstr,s=this.board,t=0;t<n.length;t++){var o=s.cell[e],i=n.charAt(t);if(this.include(i,"0","9")){for(o.qnums=[];this.include(i,"0","9");)o.qnums.push("0"===i?-2:+i),i=n.charAt(++t);t--,e++,r=!0}else this.include(i,"a","z")&&(e+=parseInt(i,36)-9,r&&e--,r=!1);if(!s.cell[e])break}this.outbstr=n.substr(t+1)},encodeNumber_lohkous:function(){for(var e=0,t="",r=this.board,n=0;n<r.cell.length;n++){var s="",o=r.cell[n].qnums;if(0<o.length)for(var i=0;i<o.length;i++)s+=-2===o[i]?"0":o[i];else e++;0===e?(t+=s,e=1):""===s&&26!==e||(t+=(9+e).toString(36)+s,e=""===s?0:1)}1<e&&(t+=(9+e).toString(36)),this.outbstr+=t}},FileIO:{decodeData:function(){this.decodeQnums(),this.decodeBorderAns()},encodeData:function(){this.encodeQnums(),this.encodeBorderAns()}},AnsCheck:{checklist:["checkNoNumber","checkBorderUnused","checkUnknownSegments","checkMissingSegments","checkDoubleNumber+"],checkAllBlock:function(e,t,r){for(var n=!this.puzzle.getConfig("multierr"),s=this.board.roommgr.components,o=1===e?this.getAllSegments():{},i=0;i<s.length;i++){var l=s[i],c=o[s[i].id];if(l.numcount===e){var h=t.call(this,l,c,n);if(h){if(this.failcode.add(r),this.checkOnly)break;for(var u in h)isNaN(u)||h[u].seterr(+u);if(h.single&&n)return}}}},getAllSegments:function(){if(this._info.segments)return this._info.segments;var s={};function e(e,t,r){var n=t.length;s[e][n]||(s[e][n]=[]),s[e][n].push({clist:t,dir:r})}for(var t=this.board,r=t.roommgr.components,n=0;n<r.length;n++)r[n].id=n,s[n]={};for(var o=0;o<=1;o++)for(var i=o?t.maxbx:t.maxby,l=o?t.maxby:t.maxbx,c=1;c<=i;c+=2){for(var h=null,u=[],a=1;a<=l;a+=2){var d=o?t.getc(c,a):t.getc(a,c);h&&h.room!==d.room?(e(h.room.id,u,o),u=[d]):u.push(d),h=d}e(h.room.id,u,o)}return this._info.segments=s},checkNoNumber:function(){this.checkAllBlock(0,function(e,t,r){return{1:e.clist}},"ceNoNum")},checkDoubleNumber:function(){this.checkAllBlock(2,function(e,t,r){return{1:e.clist}},"bkNumGe2")},checkBorderUnused:function(){for(var e=this.board.border,t=0;t<e.length;t++){var r=e[t];if(!r.isnull&&r.qans){var n=r.sidecell[0].room,s=r.sidecell[1].room;if(!(n!==s||1<n.numcount)){if(this.failcode.add("bdUnused"),this.checkOnly)break;e.setnoerr(),r.seterr(1)}}}},checkUnknownSegments:function(){this.checkAllBlock(1,function(e,t,r){for(var n=[],s=0,o=new this.klass.CellList,i=new this.klass.CellList,l=0;l<e.nums.length;l++)-2===e.nums[l]?s++:n.push(e.nums[l]);e:for(var c in t){var h=+c;if(-1===n.indexOf(h))if(0<s)s--,n.push(h);else for(l=0;l<t[c].length;l++){var u=t[c][l];if((0===u.dir?o:i).extend(u.clist),r)break e}}return 0===o.length&&0===i.length?null:{2:o,4:i,single:!0}},"bkUnknown")},checkMissingSegments:function(){this.checkAllBlock(1,function(e,t,r){var n=0;for(i in t)n++;for(var s,o=0,i=0;i<e.nums.length;i++)-2!==e.nums[i]&&(e.nums[i]in t?n--:o|=8<<i);for(i=0;i<e.nums.length;i++)-2!==e.nums[i]||0<n--||(o|=8<<i);return o?((s={})[o+""]=new this.klass.CellList([e.clue]),s):null},"nmMissing")}}});
//# sourceMappingURL=lohkous.js.map