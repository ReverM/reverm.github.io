/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,i){"object"==typeof module&&module.exports?module.exports=[e,i]:pzpr.classmgr.makeCustom(e,i)}(["wblink","coffeemilk"],{MouseEvent:{inputModes:{edit:["circle-shade","circle-unshade","circle-gray","clear"],play:["line","peke"]},autoedit_func:"qnum",autoplay_func:"line",mouseinput_other:function(){"circle-gray"===this.inputMode&&this.inputFixedNumber(-2)},mouseinput_clear:function(){this.inputFixedNumber(-1)},inputLine:function(){var e,i,t,n=this.getpos(.1);this.prevPos.equals(n)||((e=this.prevPos.getlineobj(n)).isnull||(i=e.getlinesize(),t=this.board.borderinside(i.x1,i.y1,i.x2,i.y2),null===this.inputData&&(this.inputData=e.isLine()?0:1),1===this.inputData?t.setLine():0===this.inputData&&t.removeLine(),this.limitLine&&(this.inputData=2),this.puzzle.painter.paintRange(i.x1-1,i.y1-1,i.x2+1,i.y2+1)),this.prevPos=n)},inputpeke:function(){var e,i,t=this.getpos(.22);"right"===this.btn&&this.prevPos.equals(t)||((e=t.getb()).isnull||(null===this.inputData&&(this.inputData=2!==e.qsub?2:0),e.setQsub(this.inputData),i=e.getlinesize(),this.board.borderinside(i.x1,i.y1,i.x2,i.y2).setLineVal(0),this.prevPos=t,this.puzzle.painter.paintRange(i.x1-1,i.y1-1,i.x2+1,i.y2+1),e.draw()))}},"MouseEvent@wblink":{limitLine:!0},"MouseEvent@coffeemilk":{inputqnum_main:function(e){var i=[-1,1,-2,2],t=i.indexOf(e.qnum),i=-1===t?0:"left"===this.btn?i[t+1]:i[t-1];i?this.inputFixedNumber(i):this.common.inputqnum_main.call(this,e)}},KeyEvent:{enablemake:!0,keyinput:function(e){this.key_inputcircle(e)},key_inputcircle:function(e){var i=this.cursor.getc();if("1"===e)i.setQnum(1!==i.qnum?1:-1);else if("2"===e)i.setQnum(2!==i.qnum?2:-1);else if("-"===e)i.setQnum(-2!==i.qnum?-2:-1);else{if("3"!==e&&" "!==e)return;i.setQnum(-1)}i.draw()}},"KeyEvent@coffeemilk":{enablemake:!0,keyinput:function(e){this.key_inputcircle(e)},key_inputcircle:function(e){var i=this.cursor.getc();if("1"===e)i.setQnum(1!==i.qnum?1:-1);else if("3"===e)i.setQnum(2!==i.qnum?2:-1);else if("2"===e||"-"===e)i.setQnum(-2!==i.qnum?-2:-1);else{if("4"!==e&&" "!==e&&"BS"!==e)return;i.setQnum(-1)}i.draw()}},Cell:{numberAsObject:!0,maxnum:2},Border:{getlinesize:function(){var e=this.getaddr(),i=e.clone();if(this.isVert()){for(;e.move(-1,0).getc().noNum()&&(!this.isLine()||e.getc().adjborder.left.isLine());)e.move(-1,0);for(;i.move(1,0).getc().noNum()&&(!this.isLine()||i.getc().adjborder.right.isLine());)i.move(1,0)}else{for(;e.move(0,-1).getc().noNum()&&(!this.isLine()||e.getc().adjborder.top.isLine());)e.move(0,-1);for(;i.move(0,1).getc().noNum()&&(!this.isLine()||i.getc().adjborder.bottom.isLine());)i.move(0,1)}return e.getc().isnull||i.getc().isnull?{x1:-1,y1:-1,x2:-1,y2:-1}:{x1:e.bx,y1:e.by,x2:i.bx,y2:i.by}}},BorderList:{setLine:function(){this.each(function(e){e.setLine()})},removeLine:function(){this.each(function(e){e.removeLine()})},setLineVal:function(i){this.each(function(e){e.setLineVal(i)})}},Address:{getlineobj:function(e){return 1==(1&e.bx)&&this.bx===e.bx&&1===Math.abs(this.by-e.by)||1==(1&e.by)&&this.by===e.by&&1===Math.abs(this.bx-e.bx)?(this.onborder()?this:e).getb():this.board.nullobj}},Board:{cols:8,rows:8,hasborder:1},LineGraph:{enabled:!0,makeClist:!0},Graphic:{gridcolor_type:"THIN",circlefillcolor_func:"qnum2",circlestrokecolor_func:"qnum2",circleratio:[.35,.3],lwratio:8,paint:function(){this.drawBGCells(),this.drawGrid(!1,this.puzzle.editmode&&!this.outputImage),this.drawPekes(),this.drawLines(),this.drawCircles(),"wblink"===this.pid&&this.drawHatenas(),this.drawTarget()}},"Graphic@coffeemilk":{irowake:!0,errcolor2:"rgb(192, 64, 64)",getCircleFillColor:function(e){return 1===e.qnum?1===e.error?this.errbcolor1:"white":2===e.qnum?1===e.error?this.errcolor1:this.quescolor:-2===e.qnum?1===e.error?this.errcolor2:"gray":null},getCircleStrokeColor:function(e){return 1===e.qnum||-2===e.qnum?1===e.error?this.errcolor1:this.quescolor:null}},Encode:{decodePzpr:function(e){this.decodeCircle()},encodePzpr:function(e){this.encodeCircle()}},"Encode@coffeemilk":{decodePzpr:function(e){this.decodeNumber10or16()},encodePzpr:function(e){this.encodeNumber10or16()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeBorderLine()},encodeData:function(){this.encodeCellQnum(),this.encodeBorderLine()}},"AnsCheck@wblink":{checklist:["checkLineExist+","checkCrossLine","checkTripleObject","checkUnshadedCircle","checkShadedCircle","checkNoLineObject+"],checkUnshadedCircle:function(){this.checkWBcircle(1,"lcInvWhite")},checkShadedCircle:function(){this.checkWBcircle(2,"lcInvBlack")},checkWBcircle:function(e,i){for(var t=!0,n=this.board.linegraph.components,r=0;r<n.length;r++){var c=n[r].clist;if(!(c.length<=1)){var s=c[0],c=c[c.length-1];if(s.qnum===e&&c.qnum===e){if(t=!1,this.checkOnly)break;n[r].setedgeerr(1),n[r].clist.seterr(1),s.seterr(1),c.seterr(1)}}}t||(this.failcode.add(i),this.board.border.setnoerr())}},"AnsCheck@coffeemilk":{checklist:["checkLineExist","checkCrossLine","checkDirectLine","checkGreyCount","checkBalance","checkNoLineObject"],checkCrossLine:function(){this.checkAllCell(function(e){return!e.isNum()&&1<e.lcnt&&!e.isLineStraight()},"lnCross")},checkDirectLine:function(){var e=!0;e:for(var i=0;i<this.board.cell.length;i++){var t=this.board.cell[i];if(t.isNum()&&-2!==t.qnum)for(var n=0;n<2;n++){var r=["right","bottom"][n];if(t.adjborder[r].isLine()){var r=t.adjborder[r].getlinesize(),c=this.board.getc(r.x2,r.y2);if(-2!==c.qnum&&c.qnum!==t.qnum){if(e=!1,this.checkOnly)break e;this.board.borderinside(r.x1,r.y1,r.x2,r.y2).seterr(1),t.seterr(1),c.seterr(1)}}}}e||(this.failcode.add("lcInvalid"),this.board.border.setnoerr())},checkGreyCount:function(){for(var e=!0,i=this.board.linegraph.components,t=0;t<i.length;t++){var n=i[t].clist.filter(function(e){return-2===e.qnum});if(!(n.length<=1)){if(e=!1,this.checkOnly)break;i[t].setedgeerr(1),n.seterr(1)}}e||(this.failcode.add("lcGrayGt"),this.board.border.setnoerr())},checkNoLineObject:function(){this.checkAllCell(function(e){return 0===e.lcnt&&-2!==e.qnum&&e.isNum()},"nmNoLine")},checkBalance:function(){for(var e=!0,i=this.board.linegraph.components,t=0;t<i.length;t++){for(var n=i[t].clist,r=0,c=0,s=0;s<n.length;s++)1===n[s].qnum?r++:2===n[s].qnum&&c++;if(r!==c){if(e=!1,this.checkOnly)break;i[t].setedgeerr(1),i[t].clist.seterr(1)}}e||(this.failcode.add("lcBalance"),this.board.border.setnoerr())}}});
//# sourceMappingURL=wblink.js.map