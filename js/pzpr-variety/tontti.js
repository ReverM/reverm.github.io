/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,e){"object"==typeof module&&module.exports?module.exports=[t,e]:pzpr.classmgr.makeCustom(t,e)}(["tontti","tjunction"],{"MouseEvent@tontti":{inputModes:{edit:["number","clear"],play:["line","peke","subcircle","subcross","clear"]},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart||this.mousemove?"left"===this.btn?this.inputLine():"right"===this.btn&&this.inputpeke():this.mouseend&&this.notInputted()&&(this.inputpeke_ifborder()||this.inputMB()):this.puzzle.editmode&&this.mousestart&&this.inputqnum()}},"MouseEvent@tjunction":{inputModes:{edit:["number","clear"],play:["line","clear"]},autoedit_func:"qnum",mouseinputAutoPlay:function(){this.inputLine()}},KeyEvent:{enablemake:!0},TargetCursor:{setminmax_customize:function(){this.minx+=2,this.miny+=2,this.maxx-=2,this.maxy-=2}},Cell:{maxnum:function(){return this.board.cols*this.board.rows},noLP:function(t){return-1!==this.getNum()}},"Cell@tjunction":{minnum:0,maxnum:4,posthook:{qnum:function(){for(var t in this.adjborder){t=this.adjborder[t];t.isLine()&&t.checkStableLine(1)&&t.removeLine()}}}},CellList:{singleQnumCell:!0},ExCell:{noLP:function(t){return!1},isNum:function(){return!1}},"ExCell@tjunction":{isNum:function(){return!0}},Board:{hasborder:2,hasexcell:2,hascross:2,rows:6,cols:6},"Board@tontti":{addExtraInfo:function(){this.tonttigraph=this.addInfoList(this.klass.AreaTonttiGraph)},setposCrosses:function(){this.common.setposCrosses.call(this);for(var t=0;t<this.cross.length;t++){var e=this.cross[t];e.initAdjacent(),e.cell=this.getc(e.bx+1,e.by+1)}}},"Board@tjunction":{disable_subclear:!0},"Border@tontti":{posthook:{line:function(t){t||this.sidecross[0].tontti===this.sidecross[1].tontti||this.board.tonttigraph.rebuild()}},enableLineNG:!0},"Border@tjunction":{checkStableLine:function(t){if(!t)return!1;var t=this.sidecell[0],e=this.sidecell[1];return t.isNum()&&e.isNum()}},"LineGraph@tjunction":{enabled:!0,rebuild2:function(){for(var t=this.board.excell,e=0;e<t.length;e++)this.setComponentRefs(t[e],null),this.resetObjNodeList(t[e]);this.common.rebuild2.call(this)}},"AreaRoomGraph@tjunction":{countprop:"l2cnt",enabled:!0,relation:{"cell.ques":"node","border.line":"separator"},isedgevalidbylinkobj:function(t){return t.isLine()},isnodevalid:function(t){return!t.isNum()}},"AreaTonttiGraph:AreaRoomGraph@tontti":{enabled:!0,pointgroup:"cross",relation:{"border.line":"separator"},isedgevalidbylinkobj:function(t){return!t.line},seterr:function(t,e){t.getnodeobjs().seterr(e)},setExtraData:function(t){for(var e=t.getnodeobjs(),n=[],i=0;i<e.length;i++){var o=e[i];o.cell.isnull||n.push(o.cell)}t.clist=new this.klass.CellList(n)},setComponentRefs:function(t,e){t.tontti=e},getObjNodeList:function(t){return t.tonttinodes},resetObjNodeList:function(t){t.tonttinodes=[]},getSideObjByLinkObj:function(t){return t.sidecross},getSideObjByNodeObj:function(t){var e,n=[];for(e in t.adjacent){var i=t.adjacent[e];i.isnull||n.push(i)}return n},getSideNodesByLinkObj:function(t){for(var e=[],n=t.sidecross,i=0;i<n.length;i++){var o=this.getObjNodeList(n[i]);o&&o[0]&&e.push(o[0])}return e},getSideNodesBySeparator:function(t){t=this.getSideNodesByLinkObj(t);return 2<=t.length?t:null},resetBorderCount:function(){for(var t=this.board,e=t.border,n=0;n<t.cell.length;n++)t.cell[n].lcnt=0;for(n=0;n<t.excell.length;n++)t.excell[n].lcnt=0;for(var i=0;i<e.length;i++)this.isedgevalidbylinkobj(e[i])||this.incdecBorderCount(e[i],!0)},incdecBorderCount:function(t,e){for(var n=0;n<2;n++){var i=t.sidecell[n];i.isnull||(e?i.lcnt++:i.lcnt--)}}},Graphic:{gridcolor_type:"LIGHT",paint:function(){this.drawBGCells(),this.drawBGCrosses(),this.drawGrid(),this.drawBorders(),"tontti"===this.pid&&this.drawDotCells(),this.drawLines(),"tjunction"===this.pid&&this.drawQuesCells(),this.drawQuesNumbers(),this.drawPekes(),this.drawChassis(),this.drawMBs(),this.drawTarget()},drawDotCells:function(){for(var t=this.vinc("cell_dot","auto",!0),e=Math.max(.06*this.cw,2),n=this.range.cells,i=0;i<n.length;i++){var o=n[i];t.vid="c_dot_"+o.id,0===o.lcnt&&-1===o.qnum?(t.fillStyle="gray",t.fillCircle(o.bx*this.bw,o.by*this.bh,e)):t.vhide()}},drawLines:function(){for(var t=this.vinc("line","crispEdges"),e=this.range.borders,n=0;n<e.length;n++){var i,o,r,s,c,l=e[n],u=this.getLineColor(l);t.vid="b_line_"+l.id,u?(i=l.bx*this.bw,o=l.by*this.bh,r=this.bh,s=this.bw,c=this.lm+this.addlw/2,0!==l.bx&&l.bx!==this.board.maxbx-2||(s/=2,i+=this.bw*(0===l.bx?.5:-.5)),0!==l.by&&l.by!==this.board.maxby-2||(r/=2,o+=this.bh*(0===l.by?.5:-.5)),t.fillStyle=u,l.isVert()?t.fillRectCenter(i,o,s+c,c):t.fillRectCenter(i,o,c,r+c)):t.vhide()}this.addlw=0},drawBGCrosses:function(){for(var t=this.context,e=this.range.crosses,n=0;n<e.length;n++){var i,o,r,s=e[n],c=1===s.error?this.errbcolor1:null;t.vid="c_cross_"+s.id,c?(t.fillStyle=c,c=s.bx*this.bw,i=s.by*this.bh,o=this.bw,r=this.bh,0!==s.bx&&s.bx!==this.board.maxbx-2||(o/=2,c+=this.bw*(0===s.bx?.5:-.5)),0!==s.by&&s.by!==this.board.maxby-2||(r/=2,i+=this.bh*(0===s.by?.5:-.5)),t.fillRectCenter(c,i,o+.5,r+.5)):t.vhide()}},getBoardCols:function(){var t=this.board,e=this.outputImage?2:1;return(t.maxbx-t.minbx)/2-e},getBoardRows:function(){var t=this.board,e=this.outputImage?2:1;return(t.maxby-t.minby)/2-e},getOffsetCols:function(){return this.outputImage?0:.5},getOffsetRows:function(){return this.outputImage?0:.5}},"Graphic@tjunction":{hideHatena:!0,fgcellcolor_func:"qnum",numbercolor_func:"fixed_shaded"},Encode:{decodePzpr:function(t){this.decodeNumber16()},encodePzpr:function(t){this.encodeNumber16()}},"Encode@tjunction":{decodePzpr:function(t){this.decode4Cell()},encodePzpr:function(t){this.encode4Cell()}},FileIO:{decodeData:function(){this.decodeCellQnum(),this.decodeBorderLine(),this.decodeCellQsub()},encodeData:function(){this.encodeCellQnum(),this.encodeBorderLine(),this.encodeCellQsub()}},"AnsCheck@tontti":{checklist:["checkCrossLine","checkLineOverlap","checkNoNumber","checkNumberAndEmptyCellSize","checkSameConnected","checkDoubleNumber","checkDeadendLine+"],checkLineCount:function(e,t){this.checkAllCell(function(t){return t.lcnt===e},t)},checkLineOverlap:function(){this.checkAllCell(function(t){return 0<t.lcnt&&-1!==t.qnum},"lnOverlap")},checkSameConnected:function(){this.checkSideCell(function(t,e){return"cell"===t.group&&"cell"===e.group&&(!(t.by===e.by&&!t.adjborder.right.line)&&(!(t.bx===e.bx&&!t.adjborder.bottom.line)&&(3===t.lcnt?3===e.lcnt:t.isLineStraight()?e.isLineStraight():!!t.isLineCurve()&&e.isLineCurve())))},"lnAdjacent")},checkNoNumber:function(){this.checkAllBlock(this.board.tonttigraph,function(t){return t.isNum()},function(t,e,n,i){return 0!==n},"bkNoNum")},checkDoubleNumber:function(){this.checkAllBlock(this.board.tonttigraph,function(t){return t.isNum()},function(t,e,n,i){return n<2},"bkNumGe2")},checkNumberAndEmptyCellSize:function(){this.checkAllBlock(this.board.tonttigraph,function(t){return 0===t.lcnt},function(t,e,n,i){return i<=0||i===n},"bkSizeNe")}},"AnsCheck@tjunction":{checklist:["checkSameAdjacent","checkSameShadedConnected","checkOutgoingLine","checkNotBranch","checkConnectAllJunction"],checkNotBranch:function(){this.checkAllCell(function(t){return!t.isNum()&&3!==t.lcnt},"lnNoBranch")},checkOutgoingLine:function(){this.checkAllCell(function(t){return t.isValidNum()&&t.qnum!==t.lcnt},"nmConnBarWrong")},checkConnectAllJunction:function(){for(var t=this.board.roommgr.components,e=null,n=0;n<t.length;n++){var i=t[n];if(i.clist.some(function(t){return 3===t.lcnt})){if(e)return this.failcode.add("lcDivided"),void e.clist.seterr(1);e=i}}},getJunctionShapes:function(){if(this._info.junctions)return this._info.junctions;for(var t={},e=this.board,n=0;n<e.cell.length;n++){var i=e.cell[n];if(!i.isNum()&&3===i.lcnt){for(var o=1;o<=4;o++){var r=i.getaddr();if(r.movedir(o,1),!r.getb().isLine())break}t[n]=o}}return this._info.junctions=t},checkSameAdjacent:function(){var n=this.getJunctionShapes();this.checkSideCell(function(t,e){if("cell"!==t.group||"cell"!==e.group)return!1;t=n[t.id],e=n[e.id];return t&&t===e},"lnAdjacent")},checkSameShadedConnected:function(){var s=this.getJunctionShapes();this.checkAllCell(function(t){if(!t.isNum())return!1;for(var e=["left","right","top","bottom"],n={},i=0;i<4;i++){var o=e[i];if(t.adjborder[o].isLine()){var o=t.adjacent[o],r=s[o.id];if(r&&n[r])return n[r].seterr(1),o.seterr(1),!0;n[r]=o}}return!1},"csSameJunction")}}});
//# sourceMappingURL=tontti.js.map