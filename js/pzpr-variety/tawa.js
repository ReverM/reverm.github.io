/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(s,e){"object"==typeof module&&module.exports?module.exports=[s,e]:pzpr.classmgr.makeCustom(s,e)}(["tawa"],{MouseEvent:{use:!0,inputModes:{edit:["number","clear"],play:["shade","unshade"]},autoedit_func:"qnum",autoplay_func:"cell",getcell:function(){var s=this.getpos(0),e=s.getc();return e.isnull?s.move(1,0).getc():e},getpos:function(s){return new this.klass.Address(0|this.inputPoint.bx,1+(-2&this.inputPoint.by))}},KeyEvent:{enablemake:!0},TargetCursor:{adjust_init:function(){this.getc().isnull&&this.bx++},movedir:function(s,e){this.common.movedir.call(this,s,e),s===this.UP?this.bx===this.maxx||this.bx>this.minx&&0==(2&this.by)?this.bx--:this.bx++:s===this.DN&&(this.bx===this.minx||this.bx<this.maxx&&2==(2&this.by)?this.bx++:this.bx--)}},Cell:{numberRemainsUnshaded:!0,maxnum:6,minnum:0},Board:{cols:6,rows:7,shape:3,hascross:0,setShape:function(s){this.shape=s,this.setminmax()},estimateSize:function(s,e,i){var t=0;return t="cell"===s?0===this.shape?(i>>1)*(2*e-1)+(i%2==1?e:0):3===this.shape||void 0===this.shape?(i>>1)*(2*e+1)+(i%2==1?e:0):e*i:t},setposCells:function(){for(var s=0;s<this.cell.length;s++){var e,i=this.cell[s];i.id=s,i.isnull=!1,0===this.shape?(e=2*s/(2*this.cols-1)|0,i.bx=1+(2*s%(2*this.cols-1)|0),i.by=2*e+1):1===this.shape?(e=s/this.cols|0,i.bx=2*(s%this.cols|0)+(1&e?1:0)+1,i.by=2*e+1):2===this.shape?(e=s/this.cols|0,i.bx=2*(s%this.cols|0)+(1&e?0:1)+1,i.by=2*e+1):3===this.shape&&(e=(2*s+1)/(2*this.cols+1)|0,i.bx=1+((2*s+1)%(2*this.cols+1)|0),i.by=2*e+1)}},setminmax:function(){this.minbx=0,this.minby=0,this.maxbx=2*this.cols+[0,1,1,2][this.shape],this.maxby=2*this.rows,this.puzzle.cursor.setminmax()},getc:function(s,e){var i=null,t=this.cols;return s>=this.minbx+1&&s<=this.maxbx-1&&e>=this.minby+1&&e<=this.maxby-1&&(e=e>>1,0===this.shape?s+e&1&&(i=s-1+e*(2*t-1)>>1):1===this.shape?s+e&1&&(i=s-1+2*t*e>>1):2===this.shape?s+e&1||(i=s-1+2*t*e>>1):3!==this.shape||s+e&1||(i=s-1+e*(2*t+1)>>1)),null!==i?this.cell[i]:this.emptycell},getobj:function(s,e){return this.getc(s,e)},cellinside:function(s,e,i,t){for(var a=new this.klass.CellList,h=1|e;h<=t;h+=2)for(var r=s;r<=i;r++){var n=this.getc(r,h);n.isnull||a.add(n)}return a}},BoardExec:{allowedOperations:function(s){return this.FLIPX|(s?0:this.FLIPY)},execadjust:function(s){var e=this.board;if(0===s.indexOf("reduce"))if("reduceup"===s||"reducedn"===s){if(e.rows<=1)return}else if(("reducelt"===s||"reducert"===s)&&e.cols<=1&&3!==e.shape)return;this.common.execadjust.call(this,s)},execadjust_main:function(s,e){var i=this.board;if(s&this.TURNFLIP)if(e={x1:i.minbx,y1:i.minby,x2:i.maxbx,y2:i.maxby},s===this.FLIPY)1&i.rows||(i.cols-=[1,0,0,-1][i.shape],i.shape={0:3,1:2,2:1,3:0}[i.shape]);else{if(s!==this.FLIPX)throw Error("Tawamurenga can't accept turning operation!");i.shape={0:0,1:2,2:1,3:3}[i.shape]}else if(s&this.EXPAND){switch(15&s){case this.LT:i.cols+=[0,0,1,1][i.shape],i.shape=[2,3,0,1][i.shape];break;case this.RT:i.cols+=[0,1,0,1][i.shape],i.shape=[1,0,3,2][i.shape];break;case this.UP:i.cols+=[-1,0,0,1][i.shape],i.shape=[3,2,1,0][i.shape],i.rows++;break;case this.DN:i.rows++}i.setminmax()}if(s&this.EXPAND?this.expandGroup("cell",s):s&this.REDUCE?this.reduceGroup("cell",s):this.turnflipGroup("cell",s,e),s&this.REDUCE)switch(15&s){case this.LT:i.cols-=[1,1,0,0][i.shape],i.shape=[2,3,0,1][i.shape];break;case this.RT:i.cols-=[1,0,1,0][i.shape],i.shape=[1,0,3,2][i.shape];break;case this.UP:i.cols-=[1,0,0,-1][i.shape],i.shape=[3,2,1,0][i.shape],i.rows--;break;case this.DN:i.rows--}i.setposAll()},distObj:function(s,e){var i=this.board;return(s&=15)===this.UP?e.by:s===this.DN?i.maxby-e.by:s===this.LT?e.bx:s===this.RT?i.maxbx-e.bx:-1}},Graphic:{shadecolor:"#444444",qanscolor:"black",numbercolor_func:"qnum",paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawDotCells(),this.drawGrid_tawa(),this.drawQuesNumbers(),this.drawTarget()},flushCanvas:function(){var s,e,i,t,a=this.vinc("background","crispEdges",!0),h=this.bw,r=this.bh;t=a.use.canvas?(s=(t=this.range).x1,e=t.y1,i=t.x2-s,t.y2-e):(s=(t=this.board).minbx,e=t.minby,i=t.maxbx-s,t.maxby-e),a.vid="BG",a.fillStyle=this.bgcolor,a.fillRect(s*h-.5,e*r-.5,i*h+1,t*r+1)},drawGrid_tawa:function(){for(var s=this.vinc("grid","crispEdges",!0),e=this.board,i=this.range.x1,t=this.range.y1,a=this.range.x2,h=this.range.y2,r=(i<e.minbx&&(i=e.minbx),a>e.maxbx&&(a=e.maxbx),t<e.minby&&(t=e.minby),h>e.maxby&&(h=e.maxby),Math.max(this.cw/36,1)),n=(r-1)/2,l=(s.fillStyle=this.gridcolor,Math.max(i,e.minbx)),c=Math.min(a,e.maxbx),t=Math.max(t,e.minby),o=Math.min(h,e.maxby),d=t-=1&t;d<=o;d+=2){var b=d>>1,u=0,m=0;if(3===e.shape&&(d===e.minby||d===e.maxby&&1&b)||0===e.shape&&d===e.maxby&&!(1&b)?(u=1,m=2):2===e.shape&&(d===e.minby||d===e.maxby&&1&b)||1===e.shape&&d===e.maxby&&!(1&b)?m=u=1:(1===e.shape&&(d===e.minby||d===e.maxby&&1&b)||2===e.shape&&d===e.maxby&&!(1&b))&&(u=0,m=1),s.vid="bdx_"+d,s.fillRect((i+u)*this.bw-n-.5,d*this.bh-n-.5,(a-i-m)*this.bw+1,r),d<e.maxby){u=l;(2===e.shape||3===e.shape)!=((1&b)!=(1&u))&&u++;for(var x=u;x<=c;x+=2)s.vid=["bdy_",x,d].join("_"),s.fillRect(x*this.bw-n-.5,d*this.bh-n-.5,r,this.ch+1)}}}},Encode:{decodePzpr:function(s){this.decodeTawamurenga()},encodePzpr:function(s){this.encodeTawamurenga()},decodeTawamurenga:function(){var s=this.outbstr.split("/"),e=this.board;e.setShape(+s[0]),e.initBoardSize(e.cols,e.rows),s[1]&&(this.outbstr=s[1],this.decodeNumber10())},encodeTawamurenga:function(){this.outbstr=this.board.shape+"/",this.encodeNumber10()}},FileIO:{decodeData:function(){var s=this.board;s.setShape(+this.readLine()),s.initBoardSize(s.cols,s.rows),this.decodeCellQnumAns()},encodeData:function(){var s=this.board;this.writeLine(s.shape),this.encodeCellQnumAns()},decodeCell:function(s){for(var e=this.board,i=0,t=this.getItemList(e.rows),a=e.minby+1;a<e.maxby;a+=2)for(var h=0;h<=e.maxbx;h++){var r=e.getc(h,a);r.isnull||s(r,t[i++])}},encodeCell:function(s){for(var e=this.board,i=e.minby+1;i<e.maxby;i+=2){for(var t="",a=0;a<=e.maxbx;a++){var h=e.getc(a,i);h.isnull||(t+=s(h))}this.writeLine(t)}}},AnsCheck:{checklist:["checkShadeCellExist","checkThreeShadeCells","checkUnderCells","checkNumbers"],checkThreeShadeCells:function(){for(var s=this.board,e=this.klass.CellList,i=s.minby+1;i<s.maxby;i+=2){for(var t=new e,a=0;a<=s.maxbx;a++){var h=s.getc(a,i);if(!h.isnull)if(h.isUnshade()||h.isNum()){if(3<=t.length)break;t=new e}else t.add(h)}if(!(t.length<3)){if(this.failcode.add("csConsecGt3"),this.checkOnly)break;t.seterr(1)}}},checkNumbers:function(){for(var s=this.board,e=0;e<s.cell.length;e++){var i=s.cell[e];if(i.isValidNum()){var t=new this.klass.CellList;if(t.add(i.relcell(-1,-2)),t.add(i.relcell(1,-2)),t.add(i.relcell(-2,0)),t.add(i.relcell(2,0)),t.add(i.relcell(-1,2)),t.add(i.relcell(1,2)),i.qnum!==t.filter(function(s){return s.isShade()}).length){if(this.failcode.add("nmShadeNe"),this.checkOnly)break;i.seterr(1),t.seterr(1)}}}},checkUnderCells:function(){for(var s=this.board,e=0;e<s.cell.length;e++){var i=s.cell[e];if(!i.isUnshade()&&i.by!==s.maxby-1&&(!i.relcell(-1,2).isShade()&&!i.relcell(1,2).isShade())){if(this.failcode.add("csNotOnShade"),this.checkOnly)break;i.seterr(1)}}}}});
//# sourceMappingURL=tawa.js.map