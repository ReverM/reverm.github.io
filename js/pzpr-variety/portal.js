/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["portal"],{MouseEvent:{inputModes:{edit:["number","undef","empty","clear","info-line"],play:["line","peke","info-line"]},autoedit_func:"qnum",autoplay_func:"line"},KeyEvent:{enablemake:!0,keyinput:function(e){var t;"w"===e?(t=this.cursor.getc()).isnull||t.setValid(7!==t.ques?7:0):this.key_inputqnum(e)}},Board:{hasborder:1,createExtraObject:function(){this.subspace=new this.klass.SubspaceList},rebuildInfo:function(){var t=this,i=(this.subspace.allclear(),new Set);this.cell.each(function(e){e.subspace=null,0<e.qnum&&i.add(e.qnum)}),i.forEach(function(e){t.subspace.add(new t.klass.Subspace(e))}),this.common.rebuildInfo.call(this)}},Subspace:{group:"subspace",value:null,isnull:!0,miscount:!1,initialize:function(e){this.setpos(e)},isLine:function(){return!this.isnull},seterr:function(){},setinfo:function(){},setpos:function(t){this.value=t;var e=this.board.cell.filter(function(e){return e.qnum===t});2===e.length?(this.sideobj=e,this.isnull=!1,((this.sideobj[0].subspace=this).sideobj[1].subspace=this).miscount=!1):(this.sideobj=[null,null],this.isnull=!0,this.miscount=0!==e.length)}},"SubspaceList:PieceList":{allclear:function(){Array.prototype.splice.call(this,0)}},Border:{isQuesBorder:function(){return this.sidecell[0].isEmpty()||this.sidecell[1].isEmpty()},checkStableLine:function(e){if(!e)return!1;var e=this.sidecell[0],t=this.sidecell[1];return!(!e.subspace||e.qnum!==t.qnum)||this.isLineNG()}},Cell:{maxnum:function(){return this.board.cols*this.board.rows>>1},noLP:function(e){return this.isEmpty()},posthook:{qnum:function(){if(-1!==this.qnum&&this.setQues(0),this.isValidNum())for(var e in this.adjacent)this.adjacent[e].qnum===this.qnum&&this.adjborder[e].removeLine();for(var t=[],i=this.board.linegraph.components,n=0;n<i.length;n++){var s=i[n];t.push({len:s.nodes.length,color:s.color,bx:s.clist[0].bx,by:s.clist[0].by})}this.board.rebuildInfo();for(var o=!0,n=0;n<t.length;n++){var r=t[n],c=this.board.getc(r.bx,r.by);!c.isnull&&c.path&&(c.path.nodes.length===r.len?c.path.color=r.color:o&&(c.path.color=r.color,o=!1))}this.puzzle.redraw()}}},LineGraph:{enabled:!0,makeClist:!0,rebuild2:function(){this.common.rebuild2.call(this);for(var e=this.board.subspace,t=0;t<e.length;t++)this.setComponentRefs(e[t],null),this.isedgevalidbylinkobj(e[t])&&this.addEdgeByLinkObj(e[t])},incdecLineCount:function(e,t){if(e.group===this.linkgroup||"subspace"===e.group)for(var i=0;i<2;i++){var n=e.sideobj[i];n.isnull||(this.ltotal[n[this.countprop]]--,t?n[this.countprop]++:n[this.countprop]--,this.ltotal[n[this.countprop]]=(this.ltotal[n[this.countprop]]||0)+1)}},resetLineCount:function(){this.common.resetLineCount.call(this);for(var e=this.board.subspace,t=0;t<e.length;t++)this.isedgevalidbylinkobj(e[t])&&this.incdecLineCount(e[t],!0)},repaintNodes:function(e){for(var t=new this.klass.BorderList,i=0;i<e.length;i++){var n=e[i].getedgeobjs();t.extend(n.filter(function(e){return"border"===e.group}))}this.puzzle.painter.repaintLines(t)}},GraphComponent:{getLinkObjByNodes:function(e,t){return e.obj.subspace&&e.obj.subspace===t.obj.subspace?e.obj.subspace:this.common.getLinkObjByNodes.call(this,e,t)}},Graphic:{irowake:!0,hideHatena:!0,gridcolor_type:"LIGHT",paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawCircledNumbers(),this.drawPekes(),this.drawLines(),this.drawBorders(),this.drawChassis(),this.drawTarget()},getBorderColor:function(e){return e.isQuesBorder()?"black":null},getBGCellColor:function(e){return e.isValid()?this.getBGCellColor_error1(e):"black"}},Encode:{decodePzpr:function(e){this.decodeNumber16(),this.decodeEmpty()},encodePzpr:function(e){this.encodeNumber16(),this.encodeEmpty()}},FileIO:{decodeData:function(){this.decodeCell(function(e,t){"#"===t?e.ques=7:"-"===t?e.qnum=-2:"."!==t&&(e.qnum=+t)}),this.decodeBorderLine()},encodeData:function(){this.encodeCell(function(e){return 7===e.ques?"# ":-2===e.qnum?"- ":0<=e.qnum?e.qnum+" ":". "}),this.encodeBorderLine()}},AnsCheck:{checklist:["checkStraightUnmarked","checkOverlapPortal","checkPortalExit","checkBranchLine","checkCrossLine","checkNoLine++","checkEditorPortal","checkDeadendLine+","checkOneLoop"],checkStraightUnmarked:function(){this.checkAllCell(function(e){return e.isNum()&&!e.subspace&&e.isLineCurve()},"lnCurveOnCir")},checkPortalExit:function(){for(var e=this.board.subspace,t=0;t<e.length;t++){var i=e[t];if(!i.isnull){var n=i.sideobj[0],i=i.sideobj[1];if(2===n.lcnt&&2===i.lcnt&&!(n.adjborder.left.isLine()&&i.adjborder.right.isLine()||n.adjborder.top.isLine()&&i.adjborder.bottom.isLine()||i.adjborder.left.isLine()&&n.adjborder.right.isLine()||i.adjborder.top.isLine()&&n.adjborder.bottom.isLine())){if(this.failcode.add("lnPortalCurve"),this.checkOnly)return;n.seterr(1),i.seterr(1)}}}},checkEditorPortal:function(){for(var e=this.board.subspace,t=0;t<e.length;t++){var i=e[t];i.miscount&&(this.failcode.add("cePortalMiscount"),this.board.cell.filter(function(e){return e.qnum===i.value}).seterr(1))}},checkNoLine:function(){this.checkAllCell(function(e){return e.lcnt===(e.subspace?1:0)},"ceNoLine")},checkLineCount:function(t,e){this.checkAllCell(function(e){return!e.subspace&&e.lcnt===t},e)},checkOverlapPortal:function(){this.checkAllCell(function(e){return e.subspace&&2<e.lcnt},"lnPortalCross")}}});
//# sourceMappingURL=portal.js.map