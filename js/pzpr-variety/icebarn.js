/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,r){"object"==typeof module&&module.exports?module.exports=[t,r]:pzpr.classmgr.makeCustom(t,r)}(["icebarn","icelom","icelom2"],{"MouseEvent@icebarn":{inputModes:{edit:["ice","arrow","info-line"],play:["line","peke","diraux","info-line"]}},"MouseEvent@icelom,icelom2":{inputModes:{edit:["ice","arrow","number","clear","info-line"],play:["line","peke","diraux","info-line"]}},MouseEvent:{mouseinput:function(){"arrow"===this.inputMode?this.inputarrow_line():this.common.mouseinput.call(this)},mouseinput_other:function(){"diraux"===this.inputMode&&(this.mousestart||this.mousemove?this.inputdiraux_mousemove():this.mouseend&&this.notInputted()&&this.clickdiraux())},mouseinput_auto:function(){var t;this.puzzle.playmode?"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.clickdiraux():"right"===this.btn&&(this.mousestart?this.inputdiraux_mousedown():2===this.inputData||3===this.inputData?this.inputpeke():this.mousemove&&this.inputdiraux_mousemove()):this.puzzle.editmode&&(this.mousestart||this.mousemove?"left"===this.btn?this.inputarrow_line():"right"===this.btn&&(t=this.getcell(),"icebarn"!==this.pid&&t.isNum()?this.inputqnum():this.inputIcebarn()):"icebarn"!==this.pid&&this.mouseend&&this.notInputted()&&this.inputqnum())},inputarrow_line:function(){var t,r,e=this.getpos(0);this.prevPos.equals(e)||((t=this.prevPos.getnb(e)).isnull||this.mousestart||(r=this.prevPos.getdir(e,2),t.inside?"icebarn"===this.pid&&(null===this.inputData&&(this.inputData=t.getArrow()!==r?1:0),t.setArrow(1===this.inputData?r:0)):null===this.inputData&&this.inputarrow_inout(t,r),t.draw()),this.prevPos=e)},inputarrow_inout:function(t,r){var r=this.checkinout(t,r),e=this.board;0<r&&(1===r?e.arrowin.input(t):2===r&&e.arrowout.input(t),this.mousereset())},checkinout:function(t,r){if(t.isnull)return 0;var e=this.board,i=t.bx,o=t.by;return i===e.minbx+2&&r===t.RT||i===e.maxbx-2&&r===t.LT||o===e.minby+2&&r===t.DN||o===e.maxby-2&&r===t.UP?1:i===e.minbx+2&&r===t.LT||i===e.maxbx-2&&r===t.RT||o===e.minby+2&&r===t.UP||o===e.maxby-2&&r===t.DN?2:0}},"KeyEvent@icelom,icelom2":{enablemake:!0,keyinput:function(t){this.key_inputIcebarn(t)||this.key_inputqnum(t)},key_inputIcebarn:function(t){var r=this.cursor.getc();if("q"===t)r.setQues(r.ice()?0:6);else{if(" "!==t||!r.noNum())return!1;r.setQues(0)}return r.drawaround(),this.prev=r,!0}},Border:{getArrow:function(){return this.qdir},setArrow:function(t){this.setQdir(t)},isArrow:function(){return 0<this.qdir},setLine:function(t){this.setLineVal(1),2===this.qsub&&this.setQsub(0)},removeLine:function(t){this.setLineVal(0),2===this.qsub&&this.setQsub(0)},removePeke:function(t){this.setLineVal(0),this.setQsub(0)}},"CellList@icebarn":{join:function(t){for(var r=[],e=0;e<this.length;e++)r.push(this[e].id);return r.join(t)}},Board:{cols:8,rows:8,hasborder:2,hasexcell:2,addExtraInfo:function(){this.icegraph=this.addInfoList(this.klass.AreaIcebarnGraph)},arrowin:null,arrowout:null,createExtraObject:function(){var t=this.klass;this.arrowin=new t.InAddress(2,0),this.arrowout=new t.OutAddress(4,0),this.arrowin.partner=this.arrowout,this.arrowout.partner=this.arrowin},initExtraObject:function(t,r){this.disableInfo(),3<=t?(this.arrowin.init(1,0),this.arrowout.init(5,0)):(this.arrowin.init(1,0),this.arrowout.init(1,2*r)),this.enableInfo()},exchangeinout:function(){var t=this.arrowin.getb(),r=this.arrowout.getb();t.setArrow(0),r.setArrow(0),this.arrowin.set(r),this.arrowout.set(t),this.arrowin.draw(),this.arrowout.draw()}},BoardExec:{posinfo_in:{},posinfo_out:{},adjustBoardData:function(t,r){var e=this.board;this.adjustBorderArrow(t,r),this.posinfo_in=this.getAfterPos(t,r,e.arrowin.getb()),this.posinfo_out=this.getAfterPos(t,r,e.arrowout.getb())},adjustBoardData2:function(t,r){var e,i=this.puzzle,o=i.board,i=i.opemgr,s=this.posinfo_in,n=this.posinfo_out;o.disableInfo(),(e=t&this.REDUCE&&s.isdel&&!i.undoExec&&!i.redoExec)&&(i.forceRecord=!0),o.arrowin.set(s.pos),e&&(i.forceRecord=!1),(e=t&this.REDUCE&&n.isdel&&!i.undoExec&&!i.redoExec)&&(i.forceRecord=!0),o.arrowout.set(n.pos),e&&(i.forceRecord=!1),o.enableInfo()}},"InOutAddress:Address":{type:"",partner:null,init:function(t,r){return this.bx=t,this.by=r,this.board&&this.setarrow(this.getb()),this},getid:function(){return this.getb().id},setid:function(t){this.input(this.board.border[t])},input:function(t){this.partner.equals(t)?this.board.exchangeinout():this.equals(t)||(this.getb().setArrow(0),this.set(t))},set:function(t){var r=this.getaddr();this.addOpe(t.bx,t.by),this.bx=t.bx,this.by=t.by,this.setarrow(this.getb()),r.draw(),this.draw()},addOpe:function(t,r){this.bx===t&&this.by===r||this.puzzle.opemgr.add(new this.klass.InOutOperation(this.type,this.bx,this.by,t,r))}},"InAddress:InOutAddress":{type:"in",setarrow:function(t){var r=this.board;t.by===r.maxby-2?t.setArrow(t.UP):t.by===r.minby+2?t.setArrow(t.DN):t.bx===r.maxbx-2?t.setArrow(t.LT):t.bx===r.minbx+2&&t.setArrow(t.RT)}},"OutAddress:InOutAddress":{type:"out",setarrow:function(t){var r=this.board;t.by===r.minby+2?t.setArrow(t.UP):t.by===r.maxby-2?t.setArrow(t.DN):t.bx===r.minbx+2?t.setArrow(t.LT):t.bx===r.maxbx-2&&t.setArrow(t.RT)}},"InOutOperation:Operation":{property:"",setData:function(t,r,e,i,o){this.property=t,this.bx1=r,this.by1=e,this.bx2=i,this.by2=o},decode:function(t){return("PI"===t[0]||"PO"===t[0])&&(this.property="PI"===t[0]?"in":"out",this.bx1=+t[1],this.by1=+t[2],this.bx2=+t[3],this.by2=+t[4],!0)},toString:function(){return["in"===this.property?"PI":"PO",this.bx1,this.by1,this.bx2,this.by2].join(",")},undo:function(){this.exec(this.bx1,this.by1)},redo:function(){this.exec(this.bx2,this.by2)},exec:function(t,r){var e=this.board,t=e.getb(t,r);"in"===this.property?e.arrowin.set(t):"out"===this.property&&e.arrowout.set(t)}},OperationManager:{addExtraOperation:function(){this.operationlist.push(this.klass.InOutOperation)}},LineGraph:{enabled:!0,isLineCross:!0,rebuild2:function(){for(var t=this.board.excell,r=0;r<t.length;r++)this.setComponentRefs(t[r],null),this.resetObjNodeList(t[r]);this.common.rebuild2.call(this)}},"AreaIcebarnGraph:AreaGraphBase":{enabled:!0,relation:{"cell.ques":"node"},setComponentRefs:function(t,r){t.icebarn=r},getObjNodeList:function(t){return t.icebarnnodes},resetObjNodeList:function(t){t.icebarnnodes=[]},isnodevalid:function(t){return t.ice()}},Graphic:{irowake:!0,gridcolor_type:"LIGHT",bgcellcolor_func:"icebarn",bordercolor_func:"ice",numbercolor_func:"fixed",errcolor1:"red",maxYdeg:.7,paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawLines(),this.drawPekes(),this.drawBorderAuxDir(),"icebarn"!==this.pid&&this.drawQuesNumbers(),this.drawBorderArrows(),this.drawChassis(),"icebarn"!==this.pid&&this.drawTarget(),this.drawInOut()},getCanvasCols:function(){var t=this.board,r=this.getBoardCols()+2*this.margin;return this.puzzle.playeronly?(t.arrowin.bx!==t.minbx+2&&t.arrowout.bx!==t.minbx+2||(r+=1.2),t.arrowin.bx!==t.maxbx-2&&t.arrowout.bx!==t.maxbx-2||(r+=1.2)):r+=1.4,r},getCanvasRows:function(){var t=this.board,r=this.getBoardRows()+2*this.margin;return this.puzzle.playeronly?(t.arrowin.by!==t.minby+2&&t.arrowout.by!==t.minby+2||(r+=.7),t.arrowin.by!==t.maxby-2&&t.arrowout.by!==t.maxby-2||(r+=.7)):r+=1.4,r},getBoardCols:function(){var t=this.board;return(t.maxbx-t.minbx)/2-2},getBoardRows:function(){var t=this.board;return(t.maxby-t.minby)/2-2},getOffsetCols:function(){var t=this.board,r=0;return this.puzzle.playeronly&&(t.arrowin.bx!==t.minbx+2&&t.arrowout.bx!==t.minbx+2||(r+=.6),t.arrowin.bx!==t.maxbx-2&&t.arrowout.bx!==t.maxbx-2||(r-=.6)),r},getOffsetRows:function(){var t=this.board,r=0;return this.puzzle.playeronly&&(t.arrowin.by!==t.minby+2&&t.arrowout.by!==t.minby+2||(r+=.35),t.arrowin.by!==t.maxby-2&&t.arrowout.by!==t.maxby-2||(r-=.35)),r},drawBorderArrows:function(){for(var t=this.vinc("border_arrow","crispEdges",!0),r=.35*this.cw,e=Math.max(this.cw/36,1)/2,i=this.range.borders,o=0;o<i.length;o++){var s=i[o],n=s.getArrow(),a=s.bx*this.bw,h=s.by*this.bh;if(t.fillStyle=4===s.error?this.errcolor1:this.quescolor,t.vid="b_ar_"+s.id,n!==s.NDIR)switch(n){case s.UP:case s.DN:t.fillRectCenter(a,h,e,r);break;case s.LT:case s.RT:t.fillRectCenter(a,h,r,e)}else t.vhide();if(t.vid="b_tipa_"+s.id,n===s.UP||n===s.LT){switch(t.beginPath(),n){case s.UP:t.setOffsetLinePath(a,h,0,-r,-r/2,.4*-r,r/2,.4*-r,!0);break;case s.LT:t.setOffsetLinePath(a,h,-r,0,.4*-r,-r/2,.4*-r,r/2,!0)}t.fill()}else t.vhide();if(t.vid="b_tipb_"+s.id,n===s.DN||n===s.RT){switch(t.beginPath(),n){case s.DN:t.setOffsetLinePath(a,h,0,r,-r/2,.4*r,r/2,.4*r,!0);break;case s.RT:t.setOffsetLinePath(a,h,r,0,.4*r,-r/2,.4*r,r/2,!0)}t.fill()}else t.vhide()}},drawInOut:function(){var t,r,e,i,o,s=this.context,n=this.board;s.vid="string_in",!(t=n.arrowin.getb()).inside&&t.id<n.border.length?(r=t.bx,e=t.by,i=r*this.bw,o=e*this.bh,e===n.minby+2?o-=1.2*this.bh:e===n.maxby-2?o+=1.2*this.bh:r===n.minbx+2?(i-=this.bw,o-=.6*this.bh):r===n.maxbx-2&&(i+=this.bw,o-=.6*this.bh),s.fillStyle=4===t.error?this.errcolor1:this.quescolor,this.disptext("IN",i,o,{ratio:.55,width:[]})):s.vhide(),s.vid="string_out",!(t=n.arrowout.getb()).inside&&t.id<n.border.length?(r=t.bx,e=t.by,i=r*this.bw,o=e*this.bh,e===n.minby+2?o-=1.2*this.bh:e===n.maxby-2?o+=1.2*this.bh:r===n.minbx+2?(i-=1.4*this.bw,o-=.6*this.bh):r===n.maxbx-2&&(i+=1.4*this.bw,o-=.6*this.bh),s.fillStyle=4===t.error?this.errcolor1:this.quescolor,this.disptext("OUT",i,o,{ratio:.55,width:[]})):s.vhide()},repaintParts:function(t){this.range.borders=t,this.drawBorderArrows()}},"Encode@icebarn":{decodePzpr:function(t){var r,t=t===this.puzzle.pzpr.parser.URL_PZPRV3?3:this.checkpflag("c")?2:1;2==t&&(r=this.outbstr.split("/"),this.outbstr=[r[2],r[0],r[1]].join("/")),2<=t?this.decodeIce():this.decodeIce_old1(),3==t?this.decodeBorderArrow():2==t?this.decodeBorderArrow_old2():this.decodeBorderArrow_old1(),this.decodeInOut()},encodePzpr:function(t){t=t===this.puzzle.pzpr.parser.URL_PZPRV3?3:1;3==t?this.encodeIce():this.encodeIce_old1(),3==t?this.encodeBorderArrow():this.encodeBorderArrow_old1(),this.encodeInOut()},decodeIce_old1:function(){for(var t=this.outbstr,r=this.board,e=0,i=[8,4,2,1],o=0;o<t.length;o++){for(var s=parseInt(t.charAt(o),32),n=0;n<4;n++)r.cell[e]&&(r.cell[e].ques=s&i[n]?6:0,e++);if(!r.cell[e])break}this.outbstr=t.substr(o+1)},encodeIce_old1:function(){for(var t="",r=0,e=0,i=this.board,o=[8,4,2,1],s=0;s<i.cell.length;s++)6===i.cell[s].ques&&(e+=o[r]),4===++r&&(t+=e.toString(16),e=r=0);0<r&&(t+=e.toString(16)),this.outbstr+=t},decodeBorderArrow:function(){for(var t=this.outbstr,r=this.board,e=2*r.cols*r.rows-r.cols-r.rows,i=(r.disableInfo(),0),o=0,s=o;s<t.length;s++)if("z"!==(n=t.charAt(s))?((i+=parseInt(n,36))<e&&(a=r.border[i]).setArrow(a.isHorz()?a.UP:a.LT),i++):i+=35,e<=i){o=s+1;break}for(var n,a,i=0,s=o;s<t.length;s++)if("z"!==(n=t.charAt(s))?((i+=parseInt(n,36))<e&&(a=r.border[i]).setArrow(a.isHorz()?a.DN:a.RT),i++):i+=35,e<=i){o=s+1;break}r.enableInfo(),this.outbstr=t.substr(o)},encodeBorderArrow:function(){for(var t="",r=0,e=this.board,i=2*e.cols*e.rows-e.cols-e.rows,o=0;o<i;o++)(n=(s=e.border[o]).getArrow())===s.UP||n===s.LT?(t+=r.toString(36),r=0):35<=++r&&(t+="z",r=0);0<r&&(t+=r.toString(36));for(var s,n,r=0,o=0;o<i;o++)(n=(s=e.border[o]).getArrow())===s.DN||n===s.RT?(t+=r.toString(36),r=0):35<=++r&&(t+="z",r=0);0<r&&(t+=r.toString(36)),this.outbstr+=t},decodeBorderArrow_old2:function(){for(var t=this.outbstr,r=this.board,e=(r.disableInfo(),0),i=0,o=i;o<t.length;o++)if("0"<=(s=t.charAt(o))&&s<="9"?(a=parseInt(s,10),(n=r.border[e]).setArrow(1&a?n.RT:n.LT),e+=1+(a>>1)):"a"<=s&&s<="z"?e+=(a=parseInt(s,36))-9:e++,e>=(r.cols-1)*r.rows){i=o+1;break}for(var s,n,a,e=(r.cols-1)*r.rows,o=i;o<t.length;o++)if("0"<=(s=t.charAt(o))&&s<="9"?(a=parseInt(s,10),(n=r.border[e]).setArrow(1&a?n.DN:n.UP),e+=1+(a>>1)):"a"<=s&&s<="z"?e+=(a=parseInt(s,36))-9:e++,e>=2*r.cols*r.rows-r.cols-r.rows){i=o+1;break}r.enableInfo(),this.outbstr=t.substr(i)},decodeBorderArrow_old1:function(){var t,r=this.outbstr.substr(1).split("/"),e=this.board;if(e.disableInfo(),t=r.shift())for(var i=t.split("+"),o=0;o<i.length;o++)(s=e.cell[i[o]].adjborder.bottom).setArrow(s.UP);if(t=r.shift())for(i=t.split("+"),o=0;o<i.length;o++)(s=e.cell[i[o]].adjborder.bottom).setArrow(s.DN);if(t=r.shift())for(i=t.split("+"),o=0;o<i.length;o++)(s=e.cell[i[o]].adjborder.right).setArrow(s.LT);if(t=r.shift())for(var s,i=t.split("+"),o=0;o<i.length;o++)(s=e.cell[i[o]].adjborder.right).setArrow(s.RT);e.enableInfo(),this.outbstr="/"+r.join("/")},encodeBorderArrow_old1:function(){var t="",r=this.board,t=(t=(t=(t+="/"+r.cell.filter(function(t){t=t.adjborder.right;return t.inside&&t.getArrow()===t.RT}).join("+"))+("/"+r.cell.filter(function(t){t=t.adjborder.bottom;return t.inside&&t.getArrow()===t.UP}).join("+")))+("/"+r.cell.filter(function(t){t=t.adjborder.bottom;return t.inside&&t.getArrow()===t.DN}).join("+")))+("/"+r.cell.filter(function(t){t=t.adjborder.right;return t.inside&&t.getArrow()===t.LT}).join("+"));this.outbstr+=t}},"Encode@icelom,icelom2":{decodePzpr:function(t){this.decodeIce(),this.decodeNumber16(),this.decodeInOut()},encodePzpr:function(t){this.encodeIce(),this.encodeNumber16(),this.encodeInOut(),"icelom"===this.pid&&(this.outpflag="a")}},Encode:{decodeInOut:function(){var t=this.outbstr.split("/"),r=this.board,e=2*r.cols*r.rows-r.cols-r.rows;r.arrowin.setid((+t[1]||0)+e),r.arrowout.setid((+t[2]||0)+e),this.outbstr=""},encodeInOut:function(){var t=this.board,r=2*t.cols*t.rows-t.cols-t.rows;this.outbstr+="/"+(t.arrowin.getid()-r)+"/"+(t.arrowout.getid()-r)}},"FileIO@icebarn":{decodeData:function(){var t=this.board;t.arrowin.setid(+this.readLine()),t.arrowout.setid(+this.readLine()),this.decodeCell(function(t,r){"1"===r&&(t.ques=6)}),this.decodeBorderArrow(),this.decodeBorderArrowAns()},encodeData:function(){var t=this.board;this.writeLine(t.arrowin.getid()),this.writeLine(t.arrowout.getid()),this.encodeCell(function(t){return 6===t.ques?"1 ":"0 "}),this.encodeBorderArrow(),this.encodeBorderArrowAns()},decodeBorderArrow:function(){var t=this.board;t.disableInfo(),this.decodeBorder(function(t,r){var e;"0"!==r&&(r=+r,e=t.isVert(),1!=r||e||t.setArrow(t.UP),2!=r||e||t.setArrow(t.DN),1==r&&e&&t.setArrow(t.LT),2==r&&e&&t.setArrow(t.RT))}),t.enableInfo()},encodeBorderArrow:function(){this.encodeBorder(function(t){var r=t.getArrow();return r===t.UP||r===t.LT?"1 ":r===t.DN||r===t.RT?"2 ":"0 "})}},"FileIO@icelom,icelom2":{decodeData:function(){var t=this.board;t.arrowin.setid(+this.readLine()),t.arrowout.setid(+this.readLine()),this.readLine(),this.decodeCell(function(t,r){"i"===r.charAt(0)&&(t.ques=6,r=r.substr(1)),""!==r&&"."!==r&&(t.qnum="?"!==r?+r:-2)}),this.decodeBorderArrowAns()},encodeData:function(){var t=this.board;this.writeLine(t.arrowin.getid()),this.writeLine(t.arrowout.getid()),this.writeLine("icelom"===this.pid?"allwhite":"skipwhite"),this.encodeCell(function(t){var r=6===t.ques?"i":"";return r+(-1===t.qnum?r?" ":". ":-2===t.qnum?"? ":t.qnum+" ")}),this.encodeBorderArrowAns()}},AnsCheck:{checklist:["checkBranchLine","checkCrossOutOfIce","checkIceLines","checkValidStart","checkLineOnStart","checkDeadendRoad","checkKeepInside","checkFollowArrow@icebarn","checkNumberOrder@!icebarn","checkOneLine","checkUnreachedUnshadeCell@icelom","checkIgnoreIcebarn@!icelom","checkAllArrow@icebarn","checkNoLineNumber@!icebarn","checkDeadendLine+"],checkCrossOutOfIce:function(){this.checkAllCell(function(t){return 4===t.lcnt&&!t.ice()},"lnCrossExIce")},checkUnreachedUnshadeCell:function(){this.checkAllCell(function(t){return 0===t.ques&&0===t.lcnt},"cuNoLine")},checkIgnoreIcebarn:function(){this.checkLinesInArea(this.board.icegraph,function(t,r,e,i){return 0!==e},"bkNoLine")},checkNoLineNumber:function(){this.checkAllCell(function(t){return 0===t.lcnt&&t.isNum()},"nmUnpass")},checkAllArrow:function(){for(var t=this.board,r=0;r<t.border.length;r++){var e=t.border[r];if(e.isArrow()&&!e.isLine()){if(this.failcode.add("arNoLine"),this.checkOnly)break;e.seterr(4)}}},checkValidStart:function(){var t=this.board,r=t.arrowin.getb();r.by===t.minby+2&&r.by===t.maxby-2&&r.bx===t.minbx+2&&r.bx===t.maxbx-2&&this.failcode.add("stInvalid")},checkLineOnStart:function(){var t=this.board.arrowin.getb();t.isLine()||(t.seterr(4),this.failcode.add("stNoLine"))},checkDeadendRoad:function(){this.checkTrace(function(t){return t.lastborder.isLine()},"lrDeadEnd")},checkFollowArrow:function(){this.checkTrace(function(t){return t.lastborder.getArrow()===t.dir},"lrReverse")},checkKeepInside:function(){this.checkTrace(function(t){var t=t.lastborder,r=t.puzzle.board;return t.inside||t.id===r.arrowout.getid()},"lrOffField")},checkNumberOrder:function(){this.checkTrace(function(t){var r=t.lastcell;return r.qnum<0||r.qnum===t.count||(r.seterr(1),!1)},"lrOrder")},checkTrace:function(t,r){var e=this.getTraceInfo();t(e)||(this.failcode.add(r),this.board.border.setnoerr(),e.blist.seterr(1))},getTraceInfo:function(){var t=this.board.arrowin.getb(),r=t.qdir,e=t.getaddr(),i={lastcell:this.emptycell,lastborder:t,blist:new this.klass.BorderList,dir:r,count:1};for(i.blist.add(t);;)if(e.movedir(r,1),e.oncell()){var o=i.lastcell=e.getc();if(o.isnull)break;if(o.ice()||(s=o.adjborder,2===o.lcnt&&(1!==r&&s.bottom.isLine()?r=2:2!==r&&s.top.isLine()?r=1:3!==r&&s.right.isLine()?r=4:4!==r&&s.left.isLine()&&(r=3)),i.dir=r),"icebarn"!==this.pid){var s=o.getNum();if(-1!==s){if(-2!==s&&s!==i.count)break;i.count++}}}else{if(!(t=i.lastborder=e.getb()).isLine())break;i.blist.add(t);o=t.getArrow();if(o!==t.NDIR&&r!==o)break}return i}}});
//# sourceMappingURL=icebarn.js.map