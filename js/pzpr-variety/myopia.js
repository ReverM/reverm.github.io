/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,i){"object"==typeof module&&module.exports?module.exports=[e,i]:pzpr.classmgr.makeCustom(e,i)}(["myopia"],{MouseEvent:{inputModes:{edit:["arrow","undef","clear","info-line"],play:["line","peke","bgcolor","bgcolor1","bgcolor2","clear","info-line"]},mouseinput_auto:function(){var e=this.puzzle;e.playmode?this.checkInputBGcolor()?this.inputBGcolor():"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&(this.prevPos.reset(),this.inputpeke()):"right"===this.btn&&(this.mousestart||this.mousemove)&&this.inputpeke():e.editmode&&(this.mousestart&&this.setcursor(this.getcell()),this.inputarrow_cell())},inputarrow_cell_main:function(e,i){var t=Math.max(0,e.qnum);e.setNum(t=0===(t^=1<<i-1)?-1:t)},checkInputBGcolor:function(){var e=this.puzzle.execConfig("bgcolor");return e=e&&(this.mousestart?this.getpos(.25).oncell():!!this.mousemove&&10<=this.inputData)}},KeyEvent:{enablemake:!0,moveTarget:function(e){return!e.match(/shift/)&&this.moveTCell(e)},keyinput:function(e){var i=this.cursor.getc(),t=0;"1"===e||"w"===e||"shift+up"===e?t=1:"2"===e||"s"===e||"shift+right"===e?t=4:"3"===e||"z"===e||"shift+down"===e?t=2:"4"!==e&&"a"!==e&&"shift+left"!==e||(t=3),t?(this.puzzle.mouse.inputarrow_cell_main(i,t),i.draw()):"5"===e||"q"===e||"-"===e?this.key_inputqnum("s1"):"6"!==e&&"e"!==e&&" "!==e&&"BS"!==e||this.key_inputqnum(" ")}},Cell:{numberAsObject:!0,maxnum:15,seterr:function(e){this.board.isenableSetError()&&(this.error|=e)}},BoardExec:{adjustBoardData:function(e,i){this.adjustCellArrow(e,i)},getTranslateDir:function(e){var i={};switch(e){case this.FLIPY:i={1:2,2:1,5:6,6:5,9:10,10:9,13:14,14:13};break;case this.FLIPX:i={4:8,5:9,6:10,7:11,8:4,9:5,10:6,11:7};break;case this.TURNR:i={1:8,2:4,3:12,4:1,5:9,6:5,7:13,8:2,9:10,10:6,11:14,12:3,13:11,14:7};break;case this.TURNL:i={1:4,2:8,3:12,4:2,5:6,6:10,7:14,8:1,9:5,10:9,11:13,12:3,13:7,14:11}}return i}},Board:{hasborder:2,borderAsLine:!0,operate:function(e){"outlineshaded"===e?this.outlineShaded():this.common.operate.call(this,e)},outlineShaded:function(){this.border.each(function(e){e.updateShaded()})}},Border:{updateShaded:function(){var e=this.sidecell[0],i=this.sidecell[1],e=e.isnull?2:e.qsub,i=i.isnull?2:i.qsub;0!==e&&0!==i&&(e===i?this.setLineVal(0):this.setLine(),this.draw())}},LineGraph:{enabled:!0},Graphic:{irowake:!0,bgcellcolor_func:"qsub2",numbercolor_func:"qnum",margin:.5,paint:function(){this.drawBGCells(),this.drawLines(),this.drawBaseMarks(),this.drawCrossErrors(),this.drawArrowCombinations(),this.drawHatenas(),this.drawPekes(),this.drawTarget()},repaintParts:function(e){this.range.crosses=e.crossinside(),this.drawBaseMarks()},getQuesNumberColor:function(e,i){return 1&e.error||e.error&8<<i?this.errcolor1:this.quescolor},drawArrowCombinations:function(){for(var e=this.vinc("cell_arrow"),i=.25*this.cw,t=this.range.cells,r=0;r<t.length;r++)for(var s=t[r],o=Math.max(0,s.qnum),n=1;n<=4;n++)if(o&1<<n-1){var a=s.bx*this.bw,h=s.by*this.bh,c=a,l=h,u=[0,0,0,0];switch(n){case s.UP:u=[.5,.75,-.5,.75],h-=.8*this.bh;break;case s.DN:u=[.5,-.75,-.5,-.75],h+=.8*this.bh;break;case s.LT:u=[.75,-.5,.75,.5],a-=.8*this.bw;break;case s.RT:u=[-.75,-.5,-.75,.5],a+=.8*this.bw}e.vid="c_arrow_head_"+s.id+"_"+n,e.fillStyle=this.getQuesNumberColor(s,n-1),e.setOffsetLinePath(a,h,0,0,u[0]*i,u[1]*i,u[2]*i,u[3]*i,!0),e.fill(),e.vid="c_arrow_line_"+s.id+"_"+n,e.strokeStyle=this.getQuesNumberColor(s,n-1),e.lineWidth=this.lw/2,e.strokeLine((1.5*a+c)/2.5,(1.5*h+l)/2.5,c,l)}else e.vid="c_arrow_head_"+s.id+"_"+n,e.vhide(),e.vid="c_arrow_line_"+s.id+"_"+n,e.vhide()}},Encode:{decodePzpr:function(e){this.decodeNumber16(),this.puzzle.setConfig("slither_full",this.checkpflag("f"))},encodePzpr:function(e){this.outpflag=this.puzzle.getConfig("slither_full")?"f":null,this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeConfigFlag("f","slither_full"),this.decodeCellQnum(),this.decodeCellQsub(),this.decodeBorderLine()},encodeData:function(){this.encodeConfigFlag("f","slither_full"),this.encodeCellQnum(),this.encodeCellQsub(),this.encodeBorderLine()}},AnsCheck:{checklist:["checkBranchLine","checkCrossLine","checkLineDirExist","checkLineDirCloser","checkLineDirUnequal","checkDeadendLine+","checkOneLoop","checkNoLineIfVariant"],getLineDirs:function(){if(this._info.lineDirs)return this._info.lineDirs;for(var e=this.board,i=[],t=0;t<e.cell.length;t++){var r=e.cell[t];if(!(r.qnum<=0)){for(var s=[r,-1,-1,-1,-1],o=1;o<=4;o++){var n=r.getaddr();for(n.movedir(o,1);!n.getb().isnull&&!n.getb().isLine();)n.movedir(o,2);n.getb().isLine()&&(s[o]=(Math.abs(o===n.LT||o===n.RT?n.bx-r.bx:n.by-r.by)+1)/2)}i.push(s)}}return this._info.lineDirs=i},checkLineDirExist:function(){var e,i=this.getLineDirs();for(e in i)for(var t=1;t<=4;t++)if(i[e][0].qnum&1<<t-1&&-1===i[e][t]){if(this.failcode.add("arNoLineSeen"),this.checkOnly)return;i[e][0].seterr(4<<t)}},checkLineDirCloser:function(){var e,i=this.getLineDirs(),t=this.board.cols+this.board.rows;for(e in i){for(var r=t,s=1;s<=4;s++)-1!==i[e][s]&&i[e][0].qnum&1<<s-1&&(r=Math.min(r,i[e][s]));for(s=1;s<=4;s++){var o=i[e][s];if(!(i[e][0].qnum&1<<s-1)&&(!(r===t&&1<o)&&-1!==o&&o<=r)){if(this.failcode.add("arDistanceGt"),this.checkOnly)return;i[e][0].seterr(124);for(var n=i[e][0].getaddr(),a=0;a<o-1;a++)n.movedir(s,2),n.getc().seterr(1);n.movedir(s,1),n.getb().seterr(1),this.board.border.setnoerr()}}}},checkLineDirUnequal:function(){var e,i=this.getLineDirs(),t=this.board.cols+this.board.rows;for(e in i){for(var r=t,s=1;s<=4;s++)-1!==i[e][s]&&i[e][0].qnum&1<<s-1&&r!==i[e][s]&&(r=r===t?i[e][s]:-1);for(s=1;s<=4;s++){var o=i[e][s];if(i[e][0].qnum&1<<s-1&&(-1!==o&&o!==r)){if(this.failcode.add("arDistanceNe"),this.checkOnly)return;i[e][0].seterr(4<<s);for(var n=i[e][0].getaddr(),a=0;a<o-1;a++)n.movedir(s,2),n.getc().seterr(1);n.movedir(s,1),n.getb().seterr(1),this.board.border.setnoerr()}}}}}});
//# sourceMappingURL=myopia.js.map