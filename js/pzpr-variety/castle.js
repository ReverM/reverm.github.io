/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["castle"],{MouseEvent:{inputModes:{edit:["number","direc","shade","clear","info-line"],play:["line","peke","completion","info-line"]},mouseinput_auto:function(){this.puzzle.playmode?"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&(this.inputpeke_ifborder(),this.notInputted()&&this.inputqcmp()):"right"===this.btn&&(this.mousestart||this.mousemove)&&this.inputpeke():this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputdirec():this.mouseend&&this.notInputted()&&this.inputqnum())},inputqcmp:function(){var e=this.getcell();e.isnull||e.noNum()||(e.setQcmp(+!e.qcmp),e.draw(),this.mousereset())},inputShade:function(){var e=this.getcell();e.isnull||e===this.mouseCell||(null===this.inputData&&(-1===e.qnum?this.inputData=0:this.inputData=[2,0,1][e.ques]),e.setQues(this.inputData),-1===e.qnum&&e.setQnum(-2),e.drawaround(),this.mouseCell=e)}},KeyEvent:{enablemake:!0,moveTarget:function(e){return!e.match(/shift/)&&this.moveTCell(e)},keyinput:function(e){var t,i;if("q"===e||"g"===e||"w"===e||"b"===e)return t=this.cursor.getc(),i="q"===e?[2,0,1][t.ques]:"g"===e?0:"w"===e?1:2,-1===t.qnum?(t.setQnum(-2),"q"!==e&&t.setQues(i)):t.setQues(i),void(this.prev=t).draw();this.key_inputdirec(e)||this.key_inputqnum(e)}},Cell:{minnum:0,maxnum:function(){return Math.max(this.board.cols-2,this.board.rows-2)},noLP:function(e){return this.isNum()},isUndecided:function(){return!this.isNum()&&this.lcnt<2},posthook:{qnum:function(e){-1===e&&this.setQues(0)}},actual:null,undecided:!0,isCmp:function(){if(1===this.qcmp)return!0;if(!this.puzzle.execConfig("autocmp"))return!1;var e=this.qdir;return!(!this.isValidNum()||0===e)&&(this.recount(),!this.undecided&&this.actual===this.qnum)},recount:function(){if(null===this.actual){var e=this.qdir;if(this.isValidNum()&&0!==e){this.actual=0,this.undecided=!1;var t=this.getaddr();for(t.movedir(e,1);;){t.movedir(e,2);var i=t.getb();if(!i||i.isnull)break;i.isLine()?this.actual++:0===i.qsub&&i.sidecell[0].isUndecided()&&i.sidecell[1].isUndecided()&&(this.undecided=!0)}}}},invalidate:function(){this.actual=null,this.draw()}},Border:{enableLineNG:!0,isBorder:function(){return this.sidecell[0].ques!==this.sidecell[1].ques||-1===this.sidecell[0].qnum!=(-1===this.sidecell[1].qnum)},prehook:{qsub:function(){return-1!==this.sidecell[0].qnum||-1!==this.sidecell[1].qnum}},posthook:{line:function(){this.redrawAroundBorder()},qsub:function(){this.redrawAroundBorder()}},redrawAroundBorder:function(){this.board.scanResult=null;var e=this.sidecell[0],t=this.sidecell[1],i=this.board.cellinside(e.bx,1,e.bx,this.board.maxby),e=this.board.cellinside(1,e.by,this.board.maxbx,e.by);this.isvert?i.extend(this.board.cellinside(t.bx,1,t.bx,this.board.maxby)):e.extend(this.board.cellinside(1,t.by,this.board.maxbx,t.by)),e.each(function(e){e.qdir!==e.LT&&e.qdir!==e.RT||e.invalidate()}),i.each(function(e){e.qdir!==e.UP&&e.qdir!==e.DN||e.invalidate()})}},Board:{hasborder:1,scanResult:null,scanInside:function(){if(null!==this.scanResult)return this.scanResult;if(this.cell.some(function(e){return 0!==e.lcnt&&2!==e.lcnt}))return this.scanResult=!1;for(var e=2;e<this.maxby;e+=2)for(var t=!1,i=1;i<this.maxbx;i+=2)this.getb(i,e).isLine()&&(t^=!0),this.getx(i+1,e).inside=t;return this.scanResult=!0},rebuildInfo:function(){this.scanResult=null,this.cell.each(function(e){e.isValidNum()&&e.invalidate()}),this.common.rebuildInfo.call(this)}},BoardExec:{adjustBoardData:function(e,t){this.adjustNumberArrow(e,t)}},LineGraph:{enabled:!0},Graphic:{gridcolor_type:"DLIGHT",qcmpcolor:"rgb(127,127,127)",autocmp:"number",irowake:!0,hideHatena:!0,paint:function(){this.drawBGCells(),this.drawGrid(),this.drawGridGaps(),this.drawBorders(),this.drawArrowNumbers(),this.drawLines(),this.drawPekes(),this.drawChassis(),this.drawTarget()},drawGridGaps:function(){var e,t=this.vinc("gridgaps","crispEdges",!0),i=this.board,s=this.bw,n=this.bh;for(t.lineWidth=1,e=0;e<i.border.length;e++){var r=i.border[e];if(t.vid="bdgap_"+e,-1!==r.sidecell[0].qnum&&-1!==r.sidecell[1].qnum){var u=r.sidecross[0].bx,c=r.sidecross[0].by,o=r.sidecross[1].bx,d=r.sidecross[1].by;switch(r.sidecell[0].ques){case 0:t.strokeStyle="lightgray";break;case 1:t.strokeStyle="white";break;case 2:t.strokeStyle="black"}t.strokeLine(u*s,c*n,o*s,d*n)}else t.vhide()}},getBGCellColor:function(e){return 1===(e.error||e.qinfo)?2!==e.ques?this.errbcolor1:this.errcolor1:-1!==e.qnum?0===e.ques?"lightgray":1===e.ques?"white":"black":null},getQuesNumberColor:function(e){return e.isCmp()?this.qcmpcolor:2!==e.ques?this.quescolor:"white"}},Encode:{decodePzpr:function(){for(var e=0,t=0,i=this.outbstr,s=this.board,t=0;t<i.length&&s.cell[e];t++){var n,r=i.charAt(t),u=s.cell[e];"a"<=r&&r<="z"?e+=parseInt(r,36)-9:(u.ques=+i.charAt(t),t++,r=i.charAt(t),this.include(r,"0","4")?(n=i.charAt(t+1),u.qdir=parseInt(r,16),u.qnum="."!==n?parseInt(n,16):-2,t++):this.include(r,"5","9")?(u.qdir=parseInt(r,16)-5,u.qnum=parseInt(i.substr(t+1,2),16),t+=2):"-"===r&&(u.qdir=parseInt(i.substr(t+1,1),16),u.qnum=parseInt(i.substr(t+2,3),16),t+=4),e++)}this.outbstr=i.substr(t+1)},encodePzpr:function(){for(var e="",t=0,i=this.board,s=0;s<i.cell.length;s++){var n="",r=i.cell[s].qdir,u=i.cell[s].qnum,c=i.cell[s].ques;-2===u||0<=u&&u<4096?(n=c.toString(16),n+=-2===u?r+".":0<=u&&u<16?r+u.toString(16):16<=u&&u<256?r+5+u.toString(16):"-"+r+u.toString(16)):t++,0===t?e+=n:!n&&26!==t||(e+=(t+9).toString(36)+n,t=0)}0<t&&(e+=(t+9).toString(36)),this.outbstr+=e}},FileIO:{decodeData:function(){this.decodeCell(function(e,t){"."!==t&&(t=t.split(","),e.qdir="0"!==t[0]?+t[0]:0,e.qnum="-"!==t[1]?+t[1]:-2,t=+t[2],e.ques=3&t,e.qcmp=4&t?1:0)}),this.decodeBorderLine()},encodeData:function(){this.encodeCell(function(e){return[0!==e.qdir?""+e.qdir:"0",",",-2!==e.qnum?""+e.qnum:"-",",",3&e.ques|(1&e.qcmp)<<2," "].join("")}),this.encodeBorderLine()}},AnsCheck:{checklist:["checkLineExist+","checkBranchLine","checkCrossLine","checkArrowNumberGt","checkArrowNumberLt","checkDeadendLine+","checkOneLoop","checkShadedOutside","checkUnshadedInside","checkNumberHasArrow"],checkArrowNumberGt:function(){this.checkArrowNumber(1,"anLineGt")},checkArrowNumberLt:function(){this.checkArrowNumber(-1,"anLineLt")},checkArrowNumber:function(t,e){this.checkAllCell(function(e){return e.recount(),e.isValidNum()&&0!==e.qdir&&(t<0&&e.actual<e.qnum||0<t&&e.actual>e.qnum)},e)},checkShadedOutside:function(){var t=this.board;t.scanInside()&&this.checkAllCell(function(e){return-1!==e.qnum&&2===e.ques&&t.getx(e.bx-1,e.by-1).inside},"shInside")},checkUnshadedInside:function(){var t=this.board;t.scanInside()&&this.checkAllCell(function(e){return-1!==e.qnum&&1===e.ques&&!t.getx(e.bx-1,e.by-1).inside},"cuOutside")}}});
//# sourceMappingURL=castle.js.map