/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["kaidan","takoyaki","wittgen","zabajaba"],{MouseEvent:{use:!0,RBShadeCell:!0,inputModes:{edit:["number","shade","clear"],play:["line","mark-circle","peke","subcross","completion"]},mouseinput:function(){var e=this.inputMode;"shade"===e?this.inputFixedNumber(-2):"subcross"===e||"mark-circle"===e?this.inputShade():this.common.mouseinput.call(this)},decIC:function(e){"mark-circle"===this.inputMode?this.inputData=1!==e.qans?1:0:"subcross"===this.inputMode?this.inputData=1!==e.qsub?2:0:this.common.decIC.call(this,e)},mouseinput_auto:function(){this.puzzle.playmode?("right"===this.btn?this.inputdragcross():this.inputLine(),this.mouseend&&this.notInputted()&&this.inputEndOrCell()):this.puzzle.editmode&&this.mousestart&&this.inputqnum()},inputEndOrCell:function(){var e=this.getcell();e.isnull||e===this.mouseCell||("takoyaki"!==this.pid&&1===e.lcnt&&"left"===this.btn?(e.setLineVal(+!e.line),e.draw()):e.isNum()?this.inputqcmp():"right"===this.btn&&this.inputpeke_ifborder()||("wittgen"===this.pid||"zabajaba"===this.pid?this.inputShade():this.inputcell()))},inputdragcross:function(){var e;null===this.firstPoint.bx?this.firstPoint.set(this.inputPoint):(null!==this.inputData||.1<(e=this.inputPoint.bx-this.firstPoint.bx)*e+(e=this.inputPoint.by-this.firstPoint.by)*e)&&this.inputShade()},inputqcmp:function(){var e=this.getcell();e.isnull||e.noNum()||(e.setQcmp(+!e.qcmp),e.draw(),this.mousereset())},initialize:function(){this.edgeCell=new this.klass.Address,this.common.initialize.call(this)},mousereset:function(){this.edgeCell.reset(),this.edgeData={},this.common.mousereset.call(this)}},"MouseEvent@kaidan,wittgen":{inputLine:function(){var e,t,i=this.getcell(),n=!1,s=(i.isnull||i.equals(this.edgeCell)||(null!==this.edgeCell.bx&&(this.edgeData.top&&this.edgeData.bottom&&(this.edgeCell.bx-i.bx==2?n=this.edgeData.right:this.edgeCell.bx-i.bx==-2&&(n=this.edgeData.left)),this.edgeData.left&&this.edgeData.right&&(this.edgeCell.by-i.by==2?n=this.edgeData.bottom:this.edgeCell.by-i.by==-2&&(n=this.edgeData.top))),this.edgeData={},this.edgeCell.isnull&&this.edgeCell.set(i)),this.edgeCell.getc());s.isnull||(e=this.inputPoint.bx-s.bx,t=this.inputPoint.by-s.by,e<-.2?this.edgeData.left=!0:.2<e&&(this.edgeData.right=!0),t<-.2?this.edgeData.top=!0:.2<t&&(this.edgeData.bottom=!0)),this.edgeData.top&&this.edgeData.bottom&&(n=n||s.adjborder.left.isLine()||s.adjborder.right.isLine()),this.edgeData.left&&this.edgeData.right&&(n=n||s.adjborder.top.isLine()||s.adjborder.bottom.isLine()),this.common.inputLine.call(this),n&&1===s.lcnt&&(null===this.inputData&&(this.inputData=+!s.line),s.setLineVal(this.inputData),s.draw(),this.edgeData={}),i.isnull||this.edgeCell.set(i)}},"MouseEvent@wittgen#1":{inputModes:{edit:["number","undef","clear"],play:["line","peke","subcircle","objblank","completion"]}},"MouseEvent@zabajaba":{inputModes:{edit:["number","undef","clear","info-room"],play:["line","peke","subcircle","objblank","completion","info-room"]},dispInfoRoom:function(){this.dispInfoUblk()},inputLine:function(){var t,e,i=this.getcell(),n=(this.initFirstCell(i),this.getpos(0));this.prevPos.equals(n)||((t=this.prevPos.getnb(n)).isnull||(null===this.inputData&&(this.inputData=t.isLine()?0:1),1===this.inputData?t.setLine():0===this.inputData&&t.line&&(i.path&&3===i.path.shape?(e=i.path.clist.getRectSize(),this.board.borderinside(e.x1,e.y1,e.x2,e.y2).each(function(e){(e===t||e.bx!==i.bx&&e.by!==i.by)&&e.removeLine()}),this.puzzle.painter.paintRange(e.x1,e.y1,e.x2,e.y2)):t.removeLine()),t.draw()),this.prevPos=n)}},"MouseEvent@wittgen,zabajaba#2":{inputShade:function(){2===this.puzzle.getConfig("use")?this.inputBGcolor():this.inputFixedQsub("left"===this.btn?1:2)},inputDot:function(){this.inputFixedQsub(2)}},KeyEvent:{enablemake:!0},"Border@kaidan":{prehook:{line:function(e){return e&&this.isLineNG()||this.checkFormCurve(e)}},posthook:{line:function(){for(var e in this.sidecell){e=this.sidecell[e];e.line&&1!==e.lcnt&&(e.setLineVal(0),e.draw())}}}},"Border@takoyaki":{enableLineNG:!0},"Border@wittgen,zabajaba":{prehook:{line:function(e){if(!e)return!1;if(this.isLineNG()||"wittgen"===this.pid&&this.checkFormCurve(e))return!0;for(var t=new Set,i=0;i<2;i++){var n=this.sidecell[i];n.isnull||(t.add(n),(n=n.path)&&n.clist.each(function(e){t.add(e)}))}var s=new this.klass.CellList(t).getRectSize();return 2===s.rows&&2===s.cols?!!this.board.cellinside(s.x1,s.y1,s.x2,s.y2).some(function(e){return e.noLP()})||!!this.board.borderinside(s.x1-1,s.y1-1,s.x2+1,s.y2+1).some(function(e){return!(e.bx>=s.x1&&e.bx<=s.x2&&e.by>=s.y1&&e.by<=s.y2)&&e.line}):4<s.rows+s.cols}},posthook:{line:function(){for(var e in this.sidecell)(n=this.sidecell[e]).line&&1!==n.lcnt&&n.setLineVal(0),this.line&&n.qsub&&n.setQsub(0),n.draw();if(this.path&&3<=this.path.clist.length){var t;"zabajaba"!==this.pid||!this.line||2===(t=this.path.clist.getRectSize()).rows&&2===t.cols&&(this.board.borderinside(t.x1,t.y1,t.x2,t.y2).each(function(e){e.setLineVal(1)}),this.board.cellinside(t.x1,t.y1,t.x2,t.y2).each(function(e){e.setLineVal(0),e.draw()}),this.puzzle.painter.paintRange(t.x1,t.y1,t.x2,t.y2));for(var i=0;i<3;i++)1===(n=this.path.clist[i]).lcnt&&(n.setLineVal(1),n.draw())}var n;!this.line&&this.isVert()?(this.relbd(-2,0).line&&((n=this.relcell(-3,0)).setLineVal(0),n.draw()),this.relbd(2,0).line&&((n=this.relcell(3,0)).setLineVal(0),n.draw())):!this.line&&this.isHorz()&&(this.relbd(0,-2).line&&((n=this.relcell(0,-3)).setLineVal(0),n.draw()),this.relbd(0,2).line&&((n=this.relcell(0,3)).setLineVal(0),n.draw()))}}},Cell:{maxnum:4,minnum:0,numberRemainsUnshaded:!0,noLP:function(e){return this.isNum()||this.qans},allowShade:function(){return-1===this.qnum&&0===this.lcnt},posthook:{qnum:function(e){if(-1!==e)for(var t in this.setLineVal(0),this.setQans(0),this.adjborder)this.adjborder[t].setLineVal(0)}}},"Cell@takoyaki":{noLP:function(e){return this.isNum()},allowShade:function(){return-1===this.qnum}},"Cell@wittgen,zabajaba":{isUnshade:function(){return 0===this.lcnt},isDot:function(){return 2===this.qsub&&0===this.lcnt},prehook:{qsub:function(e){return e&&(this.isNum()||0<this.lcnt)}}},"Cell@zabajaba#1":{isUnshade:function(){return 0<this.lcnt},maxnum:8},Board:{cols:8,rows:8,hasborder:1},LineGraph:{enabled:!0,makeClist:!0},"LineGraph@zabajaba":{setExtraData:function(e){this.common.setExtraData.call(this,e);var t=e.clist.getRectSize();1===t.rows&&3===t.cols?e.shape=1:3===t.rows&&1===t.cols?e.shape=2:2===t.rows&&2===t.cols&&4===t.cnt?e.shape=3:e.shape=2===t.cnt?0:-1}},"AreaUnshadeGraph@kaidan":{enabled:!0,relation:{"cell.qnum":"node","cell.qans":"node"},isnodevalid:function(e){return!e.noLP()}},"AreaUnshadeGraph@wittgen,zabajaba":{enabled:!0,relation:{"border.line":"block"},modifyOtherInfo:function(e,t){this.setEdgeByNodeObj(e.sidecell[0]),this.setEdgeByNodeObj(e.sidecell[1])}},Graphic:{gridcolor_type:"LIGHT",fgcellcolor_func:"qnum",qcmpcolor:"rgb(127,127,127)",paint:function(){this.drawBGCells(),this.drawGrid(),"wittgen"!==this.pid&&"zabajaba"!==this.pid&&this.drawQuesCells(),this.drawQuesNumbers(),"wittgen"!==this.pid&&"zabajaba"!==this.pid?(this.drawCircles(),this.drawCrosses()):(this.drawDotCells(),this.drawMBs()),this.drawLines(),"kaidan"!==this.pid&&"wittgen"!==this.pid&&"zabajaba"!==this.pid||this.drawLineEnds(),this.drawPekes(),this.drawChassis(),this.drawTarget()}},"Graphic@kaidan,takoyaki#2":{hideHatena:!0,mbcolor:"rgb(127,127,255)",fontShadecolor:"white",getQuesNumberColor:function(e){return 1===e.qcmp?this.qcmpcolor:this.fontShadecolor},getCircleStrokeColor:function(e){return 1===e.qans?1===e.error?this.errcolor1:e.trial?this.trialcolor:this.quescolor:null},getCircleFillColor:function(e){return null},drawCrosses:function(){for(var e=this.vinc("cell_mb","auto"),t=(e.lineWidth=1,.25*this.cw),i=this.range.cells,n=0;n<i.length;n++){var s,r,h=i[n],l="kaidan"===this.pid&&h.lcnt;e.vid="c_MB2_"+h.id,0<h.qsub?(s=h.bx*this.bw,r=h.by*this.bh,e.lineWidth=1+this.cw/40|0,e.strokeStyle=h.trial?"rgb(192, 192, 192)":this.mbcolor,e.strokeCross(s,r,t*(l?.5:1))):e.vhide()}}},"Graphic@kaidan,wittgen,zabajaba":{drawLines:function(){for(var e=this.vinc("line","crispEdges"),t=this.bw/2,i=this.bh/2,n=this.range.borders,s=0;s<n.length;s++){var r,h=n[s],l=this.getLineColor(h),a=l,c=l,o=h.bx*this.bw,d=h.by*this.bh,u=this.board.borderAsLine===h.isVert(),b=this.lm+this.addlw/2;h.path&&3===h.path.shape&&((r=h.path.clist.getRectSize()).x1===h.bx||r.y1===h.by?c=null:a=null),e.fillStyle=l,e.vid="b_line1_"+h.id,a?u?e.fillRectCenter(o-t,d,b,this.bh+b+i):e.fillRectCenter(o,d-i,this.bw+b+t,b):e.vhide(),e.vid="b_line2_"+h.id,c?u?e.fillRectCenter(o+t,d,b,this.bh+b+i):e.fillRectCenter(o,d+i,this.bw+b+t,b):e.vhide()}this.addlw=0},drawLineEnds:function(){for(var e=this.vinc("lineends","auto"),t=this.bw/2,i=this.bh/2,n=this.range.cells,s=0;s<n.length;s++){var r,h,l,a,c=n[s];e.vid="c_end_"+c.id,0<c.line&&1===c.lcnt?(r=c.getdir4cblist().filter(function(e){return e[1].line})[0],h=c.bx*this.bw,l=c.by*this.bh,a=this.lm+this.addlw/2,e.fillStyle=c.trial?this.trialcolor:this.getLineColor(r[1]),r[1].isVert()?e.fillRectCenter(h+(1+t)*(r[2]===c.RT?-1:1),l,a,i+a):e.fillRectCenter(h,l+(1+i)*(r[2]===c.DN?-1:1),i+a,a)):e.vhide()}}},"Graphic@takoyaki":{irowake:!0},"Graphic@wittgen,zabajaba#1":{getQuesNumberColor:function(e){return 1===(e.error||e.qinfo)?this.errcolor1:e.qcmp?this.qcmpcolor:this.quescolor},drawMBs:function(){for(var e=this.vinc("cell_mb","auto",!0),t=(e.lineWidth=1,.35*this.cw),i=this.range.cells,n=0;n<i.length;n++){var s,r,h=i[n];e.vid="c_MB1_"+h.id,1===h.qsub?(s=h.bx*this.bw,r=h.by*this.bh,e.strokeStyle=h.trial?"rgb(192, 192, 192)":this.mbcolor,e.strokeCircle(s,r,t)):e.vhide()}}},"Graphic@wittgen#2":{qsubcolor1:"rgb(224, 224, 255)",getBGCellColor:function(e){if(1===e.error||1===e.qinfo)return this.errbcolor1;if(1===e.qsub)return this.qsubcolor1;if(0===e.lcnt)return null;var t,i=!!e.trial;for(t in e.adjborder){if(e.adjborder[t].error)return this.errbcolor1;e.adjborder[t].trial&&(i=!0)}return i?"rgb(222,222,222)":this.qsubcolor1}},Encode:{decodePzpr:function(e){this.decode4Cell()},encodePzpr:function(e){this.encode4Cell()}},"Encode@zabajaba":{decodePzpr:function(e){this.decodeNumber16()},encodePzpr:function(e){this.encodeNumber16()}},FileIO:{decodeData:function(){var i="wittgen"!==this.pid&&"zabajaba"!==this.pid;this.decodeCellQnum(),this.decodeCell(function(e,t){t=+t;1&t&&(i?e.qans=1:e.qsub=2),2&t&&(e.line=1),4&t&&(e.qsub=1),8&t&&(e.qcmp=1)}),this.decodeBorderLine()},encodeData:function(){var n="wittgen"!==this.pid&&"zabajaba"!==this.pid;this.encodeCellQnum(),this.encodeCell(function(e){var t=n?1===e.qans:2===e.qsub,i=1===e.qsub;return(+t|e.line<<1|+i<<2|e.qcmp<<3)+" "}),this.encodeBorderLine()}},AnsCheck:{checkDir4ShadeOver:function(){this.checkDir4Cell(function(e){return e.isShade()},2,"nmShadeGt")},checkDir4ShadeLess:function(){this.checkDir4Cell(function(e){return e.isShade()},1,"nmShadeLt")},checkLineOverlap:function(){this.checkAllCell(function(e){return 2<e.lcnt||e.isLineCurve()},"laCurve")},checkMissingEnd:function(){this.checkAllCell(function(e){return 1===e.lcnt&&!e.line},"ceNoEnd")}},"AnsCheck@kaidan#1":{checklist:["checkLineOverlap","checkLineOnShadeCell","checkAdjacentShadeCell","checkDir4ShadeOver","checkConnectUnshade","checkShortEnds","checkLengthConsecutive","checkDir4ShadeLess","checkMissingEnd","checkEmptyCell_kaidan+"],checkLengthConsecutive:function(){this.checkSideCell(function(e,t){return e.lcnt&&t.lcnt&&e.path!==t.path&&1!==Math.abs(e.path.clist.length-t.path.clist.length)},"lnConsecutive")},checkShortEnds:function(){this.checkSideCell(function(e,t){if(1!==e.lcnt||1!==t.lcnt||!e.line&&!t.line)return!1;var i=e.board.getb((e.bx+t.bx)/2,(e.by+t.by)/2);if(i.line)return!1;e=i.relbd(2*(e.bx-i.bx),2*(e.by-i.by)),t=i.relbd(2*(t.bx-i.bx),2*(t.by-i.by));return e.line&&t.line},"lnEnds")},checkEmptyCell_kaidan:function(){this.checkAllCell(function(e){return 0===e.lcnt&&!e.isShade()&&e.noNum()},"ceEmpty")}},"AnsCheck@takoyaki#1":{checklist:["checkBranchLine","checkCrossLine","checkLineOnShadeCell","checkAdjacentShadeCell","checkLoop","checkNumberOfMiddle","checkDir4ShadeOver","checkCirclesInUniqueRowsCols","checkEndpoints","checkNoMiddle","checkDir4ShadeLess","checkEmptyCell+"],checkLineOnShadeCell:function(){this.checkAllCell(function(e){return-1!==e.qnum&&(0<e.lcnt||1===e.qans)},"lnOnShade")},checkEmptyCell:function(){this.checkAllCell(function(e){return 0===e.lcnt&&e.noNum()},"ceEmpty")},checkCirclesInUniqueRowsCols:function(){for(var e=this.board.linegraph.components,t=0;t<e.length;t++)e[t].id=t+1;this.checkDifferentNumberInLine()},isDifferentNumberInClist:function(e){return this.isIndividualObject(e,function(e){return 1===e.qans&&e.path?e.path.id:-1})},checkNumberOfMiddle:function(){for(var e=this.board.linegraph.components,t=0;t<e.length;t++){var i=e[t],n=i.clist.filter(function(e){return 2<=e.lcnt&&1===e.qans});if(!(n.length<=1)){if(this.failcode.add("csGt1"),this.checkOnly)break;this.board.border.setnoerr(),i.setedgeerr(1),n.seterr(1)}}},checkLoop:function(){for(var e=this.board.linegraph.components,t=0;t<e.length;t++){var i=e[t];if(0!==i.circuits){if(this.failcode.add("laLoop"),this.checkOnly)break;this.board.border.setnoerr(),i.setedgeerr(1)}}},checkNoMiddle:function(){for(var e=this.board.linegraph.components,t=0;t<e.length;t++){var i=e[t],n=i.clist.filter(function(e){return 2<=e.lcnt&&1===e.qans});if(!n.length){if(this.failcode.add("csLt1"),this.checkOnly)break;this.board.border.setnoerr(),i.setedgeerr(1)}}},checkEndpoints:function(){this.checkAllCell(function(e){return 1!==e.qans&&1===e.lcnt},"cuEndpoint")}},"AnsCheck@wittgen#1":{checklist:["checkDir4BlockOver","checkConnectUnshade","checkLineOverlap","checkLineLength","checkDir4BlockLess","checkMissingEnd"],checkLineLength:function(){for(var e=this.board.linegraph.components,t=0;t<e.length;t++){var i=e[t];if(3!==i.clist.length&&(2!==i.clist.length||i.clist[0].line&&i.clist[1].line)){if(this.failcode.add("lnLengthNe3"),this.checkOnly)break;this.board.border.setnoerr(),i.setedgeerr(1)}}},checkDir4BlockOver:function(){this.checkDir4Cell(function(e){return e.lcnt},2,"nmLineGt")},checkDir4BlockLess:function(){this.checkDir4Cell(function(e){return e.lcnt},1,"nmLineLt")}},"AnsCheck@zabajaba#1":{checklist:["checkDir8BlockOver","checkShapeAdjacent","checkInvalidShape","checkConnectUnshade","checkDir8BlockLess"],checkInvalidShape:function(){for(var e=this.board.linegraph.components,t=0;t<e.length;t++)if(!(0<e[t].shape)){if(this.failcode.add("bkNotRect"),this.checkOnly)break;this.board.border.setnoerr(),e[t].setedgeerr(1)}},checkShapeAdjacent:function(){var i=this.board,n=!this.checkOnly;this.checkSideCell(function(e,t){return!!(e.path&&t.path&&e.path!==t.path&&0<e.path.shape&&e.path.shape===t.path.shape)&&(n&&(i.border.setnoerr(),n=!1),e.path.setedgeerr(1),t.path.setedgeerr(1),!0)},"bkSameTouch",!1)},checkDir8:function(n,e){this.checkAllCell(function(e){if(!e.isValidNum())return!1;var t=e.board.cellinside(e.bx-2,e.by-2,e.bx+2,e.by+2),i=new Set;return t.each(function(e){e.path&&i.add(e.path)}),0<(i.size-e.getNum())*n},e)},checkDir8BlockOver:function(){this.checkDir8(1,"nmLineGt")},checkDir8BlockLess:function(){this.checkDir8(-1,"nmLineLt")}},"FailCode@takoyaki":{lnOnShade:"lnOnShade"}});
//# sourceMappingURL=kaidan.js.map