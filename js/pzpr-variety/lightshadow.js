/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["lightshadow","nibunnogo"],{MouseEvent:{use:!0,inputModes:{edit:["number","clear","shade","unshade"],play:["shade","unshade"]},mouseinput_auto:function(){var e;this.puzzle.playmode?(this.mousestart||this.mousemove)&&this.inputcell():this.puzzle.editmode&&this.mousestart&&!(e=this.getcell()).isnull&&(e===this.cursor.getc()||"left"===this.btn?(-1===e.qnum&&e.setQues(1===e.qans?1:0),this.inputqnum()):-1!==e.qnum&&(e.ques=1-e.ques,e.draw()))},inputcell:function(){var e=this.getcell();e.isnull||e===this.mouseCell||(null===this.inputData&&this.decIC(e),this.mouseCell=e,this.initFirstCell(e),this.puzzle.playmode&&e.allowShade()?e.setQans(this.inputData):this.puzzle.editmode&&(0===this.inputData?e.setQnum(-1):(e.setQues(2-this.inputData),-1===e.qnum&&e.setQnum(-2))),e.draw())},decIC:function(e){e=this.puzzle.playmode?e.qans:-1===e.qnum?0:2-e.ques;"shade"===this.inputMode||"auto"===this.inputMode&&"left"===this.btn&&1===this.puzzle.getConfig("use")?this.inputData=1!==e?1:0:"unshade"===this.inputMode||"auto"===this.inputMode&&"right"===this.btn&&1===this.puzzle.getConfig("use")?this.inputData=2!==e?2:0:2===this.puzzle.getConfig("use")&&("left"===this.btn?this.inputData=1===e?2:2===e?0:1:"right"===this.btn&&(this.inputData=1===e?0:2===e?1:2))}},"MouseEvent@nibunnogo":{inputModes:{edit:["number","clear"],play:["shade","unshade"]},mouseinput_clear:function(){this.inputclean_cross()},mouseinput_number:function(){this.mousestart&&this.inputqnum_cross()},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&this.inputcell():this.puzzle.editmode&&this.mousestart&&this.inputqnum_cross()}},KeyEvent:{enablemake:!0,keyinput:function(e){var t;this.puzzle.editmode&&!(t=this.cursor.getc()).isnull&&("q"===e||"a"===e||"z"===e?(-1===t.qnum&&(t.qnum=-2),t.ques=0,t.draw()):"w"===e||"s"===e||"x"===e?(-1===t.qnum&&(t.qnum=-2),t.ques=1,t.draw()):"e"===e||"d"===e||"c"===e?(t.qnum=-1,t.ques=0,t.draw()):(t.qans&&t.setQues(1===t.qans?1:0),this.key_inputqnum(e)))}},"KeyEvent@nibunnogo":{moveTarget:function(e){return this.moveTCross(e)},keyinput:function(e){this.key_inputcross(e)}},"TargetCursor@nibunnogo":{crosstype:!0},"Cross@nibunnogo":{maxnum:4,minnum:0},Cell:{numberRemainsUnshaded:!0,maxnum:function(){return this.board.cols*this.board.rows},isDot:function(){return 2===this.qans&&(!this.puzzle.execConfig("undefcell")||this.trial)}},Board:{disable_subclear:!0},AreaShadeGraph:{relation:{"cell.qans":"node","cell.ques":"node","cell.qnum":"node"},enabled:!0,isnodevalid:function(e){return-1!==e.qnum||0!==e.qans},isedgevalidbynodeobj:function(e,t){return(1===e.qans||-1!==e.qnum&&1===e.ques)==(1===t.qans||-1!==t.qnum&&1===t.ques)}},Graphic:{gridcolor_type:"DARK",undefcolor:"silver",trialcolor:"rgb(80, 0, 80)",paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawGrid(),this.drawQuesNumbers(),this.drawDotCells(),this.drawChassis(),"nibunnogo"===this.pid&&this.drawCrosses(),this.drawTarget()},getBGCellColor:function(e){return 1===e.error||1===e.qinfo?this.errbcolor1:this.puzzle.execConfig("undefcell")&&0===e.qans&&-1===e.qnum?this.undefcolor:null},getShadedCellColor:function(e){return 1===e.ques&&-1!==e.qnum?1===e.error?this.errcolor1:e.trial?this.trialcolor:this.shadecolor:this.common.getShadedCellColor.call(this,e)},drawDotCells:function(){for(var e=this.vinc("cell_dot","auto"),t=Math.max(.06*this.cw,2),n=this.range.cells,s=0;s<n.length;s++){var i=n[s];e.vid="c_dot_"+i.id,-1===i.qnum&&0===i.qans&&i.error?(e.fillStyle=this.errcolor1,e.fillCircle(i.bx*this.bw,i.by*this.bh,2*t)):i.isDot()?(e.fillStyle=i.trial?this.trialcolor:this.qanscolor,e.fillCircle(i.bx*this.bw,i.by*this.bh,t)):e.vhide()}}},"Graphic@nibunnogo":{margin:.5,crosssize:.35},Encode:{decodePzpr:function(e){for(var t=0,n=0,s=this.outbstr,i=this.board;n<s.length&&i.cell[t];){var u=i.cell[t],o=s.charAt(n),r=this.readNumber16(s,n);-1!==r[0]?(0===r[0]?(u.ques=0,u.qnum=-2):1===r[0]?(u.ques=1,u.qnum=-2):r[0]%2==0?(u.ques=0,u.qnum=r[0]/2):(u.ques=1,u.qnum=(r[0]-1)/2),n+=r[1],t++):("g"<=o&&o<="z"&&(t+=parseInt(o,36)-15),n++)}this.outbstr=s.substr(n)},encodePzpr:function(e){for(var t=0,n="",s=this.board,i=0;i<s.cell.length;i++){var u=s.cell[i].qnum,u=-1===u?this.writeNumber16(-1):-2===u?this.writeNumber16(s.cell[i].ques):this.writeNumber16(2*u+s.cell[i].ques);""===u&&t++,0===t?n+=u:!u&&20!==t||(n+=(15+t).toString(36)+u,t=0)}0<t&&(n+=(15+t).toString(36)),this.outbstr+=n}},FileIO:{decodeData:function(){this.decodeCell(function(e,t){"."!==t&&(t=t.split(","),e.ques=+t[0],e.qnum=+t[1])}),this.decodeCell(function(e,t){e.qans=+t})},encodeData:function(){this.encodeCell(function(e){return-1!==e.qnum?e.ques+","+e.qnum+" ":". "}),this.encodeCell(function(e){return e.qans+" "})}},"Encode@nibunnogo":{decodePzpr:function(e){this.decode4Cross()},encodePzpr:function(e){this.encode4Cross()}},"FileIO@nibunnogo":{decodeData:function(){this.decodeCrossNum(),this.decodeCell(function(e,t){e.qans=+t})},encodeData:function(){this.encodeCrossNum(),this.encodeCell(function(e){return e.qans+" "})}},AnsCheck:{checklist:["checkDoubleNumberInShade","checkShadeSizeGt","checkShadeSizeLt","checkNoNumberInShade","checkEmptyCell+"],checkNoNumberInShade:function(){this.checkAllBlock(this.board.sblkmgr,function(e){return e.isNum()},function(e,t,n,s){return 0!==n},"bkNoNum")},checkDoubleNumberInShade:function(){this.checkAllBlock(this.board.sblkmgr,function(e){return e.isNum()},function(e,t,n,s){return n<2},"bkNumGe2")},checkShadeSizeGt:function(){this.checkAllArea(this.board.sblkmgr,function(e,t,n,s){return s<=0||n<=s},"bkSizeGt")},checkShadeSizeLt:function(){this.checkAllArea(this.board.sblkmgr,function(e,t,n,s){return s<=0||s<=n},"bkSizeLt")},checkEmptyCell:function(){this.checkAllCell(function(e){return e.noNum()&&0===e.qans},"ceEmpty")}},"AnsCheck@nibunnogo":{checklist:["checkShadeSizeGt","checkShadeOverNum","checkShadeLessNum","checkEmptyCell+"],checkShadeOverNum:function(){this.checkQnumCross(1,"crShadeGt")},checkShadeLessNum:function(){this.checkQnumCross(2,"crShadeLt")},checkShadeSizeGt:function(){this.checkAllArea(this.board.sblkmgr,function(e,t,n,s){return n<=5},"bkSizeGt5")},checkQnumCross:function(e,t){for(var n=this.board,s=0;s<n.cross.length;s++){var i=n.cross[s],u=i.qnum;if(!(u<0)){var o=i.bx,r=i.by,o=n.cellinside(o-1,r-1,o+1,r+1).filter(function(e){return e.isShade()}).length;if(!(1===e&&o<=u||2===e&&u<=o)){if(this.failcode.add(t),this.checkOnly)break;i.seterr(1)}}}}},"FailCode@nibunnogo":{crShadeGt:"crShadeGt.creek",crShadeLt:"crShadeLt.creek"}});
//# sourceMappingURL=lightshadow.js.map