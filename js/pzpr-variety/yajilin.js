/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(i,e){"object"==typeof module&&module.exports?module.exports=[i,e]:pzpr.classmgr.makeCustom(i,e)}(["yajilin","yajilin-regions","koburin","lixloop","retsurin"],{MouseEvent:{RBShadeCell:!0,use:!0,mouseinput_auto:function(){var i;this.puzzle.playmode?this.mousestart||this.mousemove?"left"===this.btn?this.inputLine():"right"!==this.btn||this.mousestart&&this.inputpeke_ifborder()||this.firstCell.isnull&&!this.notInputted()||this.inputcell():this.mouseend&&this.notInputted()&&(i=this.getcell(),!this.firstCell.isnull&&i!==this.firstCell||(!i.isnull&&i.isNum()&&"yajilin-regions"!==this.pid?this.inputqcmp():this.inputcell())):this.puzzle.editmode&&("koburin"===this.pid||"retsurin"===this.pid?this.mousestart&&this.inputqnum():this.mousestart||this.mousemove?"yajilin"===this.pid||"lixloop"===this.pid?this.inputdirec():"yajilin-regions"===this.pid&&this.inputborder():this.mouseend&&this.notInputted()&&this.inputqnum())},inputqcmp:function(){var i=this.getcell();i.isnull||i.noNum()||(i.setQcmp(+!i.qcmp),i.draw(),this.mousereset())}},"MouseEvent@yajilin,lixloop":{inputModes:{edit:["number","direc","clear","info-line"],play:["line","peke","shade","unshade","info-line","completion"]}},"MouseEvent@yajilin-regions":{inputModes:{edit:["number","border","clear","info-line"],play:["line","peke","shade","unshade","info-line"]}},"MouseEvent@koburin,retsurin":{inputModes:{edit:["number","clear","info-line"],play:["line","peke","shade","unshade","info-line","completion"]}},KeyEvent:{enablemake:!0,moveTarget:function(i){return!i.match(/shift/)&&this.moveTCell(i)},keyinput:function(i){this.key_inputdirec(i)||this.key_inputqnum(i)}},"KeyEvent@lixloop":{getNewNumber:function(i,e,n){return"l"===e?4^Math.max(0,n)||-1:"i"===e?2^Math.max(0,n)||-1:"x"===e?1^Math.max(0,n)||-1:"-"===e?-2:" "===e?-1:"BS"===e?!(n<=0)&&n&n-1||-1:null}},Cell:{isDot:function(){return 0===this.lcnt&&1===this.qsub},countShade:function(i){return i?i.filter(function(i){return i.isShade()}).length:-1},hasUndecided:function(i){return!!i&&i.some(function(i){return 0===i.qans&&!i.knowEmpty()})},posthook:{qsub:function(){this.board.redrawAffected([this])},qans:function(){for(var i=[this],e=this.adjacent,n=[e.top,e.bottom,e.left,e.right],t=0;t<n.length;t++){var o=n[t];o.isnull||0!==o.qans||0!==o.qsub||i.push(o)}this.board.redrawAffected(i)}}},"Cell@yajilin,koburin,lixloop,retsurin":{minnum:0,maxnum:function(){return Math.max(this.board.cols,this.board.rows)>>1},noLP:function(i){return this.isShade()||this.isNum()},allowShade:function(){return-1===this.qnum&&0===this.lcnt},allowUnshade:function(){return-1===this.qnum&&0===this.lcnt},knowEmpty:function(){return-1!==this.qnum||(0!==this.qsub||(0<this.lcnt||0<this.countDir4Cell(function(i){return 0<i.isShade()})))},isCmp:function(){if(1===this.qcmp)return!0;if(!this.puzzle.execConfig("autocmp"))return!1;var i=this.getClist();return!!i&&(!this.hasUndecided(i)&&this.qnum===this.countShade(i))},getClist:function(){if(!this.isValidNum()||0===this.qdir)return null;for(var i=this.getaddr(),e=this.qdir,n=new this.klass.CellList;;){i.movedir(e,2);var t=i.getc();if(t.isnull)break;n.add(t)}return n},prehook:{qnum:function(){this.setQsub(0),this.setQans(0);for(var i=this.adjborder,e=[i.top,i.bottom,i.left,i.right],n=0;n<e.length;n++)e[n].removeLine(),e[n].draw()}}},"Cell@koburin#2":{maxnum:4,getClist:function(){return this.isValidNum()?this.puzzle.getConfig("koburin_minesweeper")?this.board.cellinside(this.bx-2,this.by-2,this.bx+2,this.by+2):new this.klass.CellList(this.getdir4clist().map(function(i){return i[0]})):null}},"Cell@lixloop#2":{minnum:1,maxnum:7,hasUndecided:function(){return!1},countShade:function(i){if(!i)return-1;var e=0,n=0,t=0,o=!1;if(i.each(function(i){i.isShade()?t++:i.isLineCurve()?e++:i.isLineStraight()?n++:-1===i.qnum&&(o=!0)}),o)return-1;var i=Math.max(e,Math.max(n,t)),s=0;return i===e&&(s^=4),i===n&&(s^=2),i===t&&(s^=1),s}},"Cell@yajilin-regions":{minnum:0,maxnum:function(){return this.room.clist.length},noLP:function(i){return this.isShade()},allowShade:function(){return 0===this.lcnt},allowUnshade:function(){return 0===this.lcnt},knowEmpty:function(){return 0!==this.qsub||(0<this.lcnt||0<this.countDir4Cell(function(i){return 0<i.isShade()}))},isCmp:function(){if(!this.puzzle.execConfig("autocmp"))return!1;var i=this.room.clist;return!this.hasUndecided(i)&&this.qnum===this.countShade(i)}},"Cell@retsurin#2":{isCmp:function(){if(1===this.qcmp)return!0;if(!this.puzzle.execConfig("autocmp")||!this.isValidNum())return!1;var i=this.board,e=i.cellinside(i.minbx,this.by,i.maxbx,this.by),i=i.cellinside(this.bx,i.minby,this.bx,i.maxby),n=!this.hasUndecided(e),t=!this.hasUndecided(i),e=this.countShade(e),i=this.countShade(i);return n&&e===this.qnum?i>this.qnum||i<this.qnum&&t:t&&i===this.qnum&&(e>this.qnum||e<this.qnum&&n)}},Border:{enableLineNG:!0,posthook:{line:function(){this.board.scanResult=null;for(var i=[],e=0;e<this.sidecell.length;e++)i.push(this.sidecell[e]);this.board.redrawAffected(i)}}},"Border@yajilin,koburin,lixloop,retsurin":{isBorder:function(){return-1===this.sidecell[0].qnum!=(-1===this.sidecell[1].qnum)}},Board:{hasborder:1,scanInside:function(){if(null!==this.scanResult)return this.scanResult;if(this.cell.some(function(i){return 0!==i.lcnt&&2!==i.lcnt}))return this.scanResult=!1;for(var i=2;i<this.maxby;i+=2)for(var e=!1,n=1;n<this.maxbx;n+=2)this.getb(n,i).isLine()&&(e^=!0),this.getx(n+1,i).inside=e;return this.scanResult=!0},rebuildInfo:function(){this.scanResult=null,this.common.rebuildInfo.call(this)}},"Board@yajilin,lixloop,retsurin":{redrawAffected:function(i){for(var e=this.maxbx,n=this.minbx,t=this.maxby,o=this.minby,s=0;s<i.length;s++)var r=i[s],e=Math.min(e,r.bx),n=Math.max(n,r.bx),t=Math.min(t,r.by),o=Math.max(o,r.by);for(var l=e;l<=n;l+=2)for(var u=1;u<2*this.board.rows;u+=2)-1!==(r=this.board.getc(l,u)).qnum&&r.draw();for(l=1;l<2*this.cols;l+=2)if(!(e<=l&&l<=n))for(u=t;u<=o;u+=2)-1!==(r=this.board.getc(l,u)).qnum&&r.draw()}},"Board@yajilin-regions":{redrawAffected:function(i){for(var e=[],n=0;n<i.length;n++){var t=i[n].room.top;e[t.id]||(e[t.id]=!0,t.draw())}}},"Board@koburin":{redrawAffected:function(i){for(var e=0;e<i.length;e++)i[e].drawaround()}},"BoardExec@yajilin,lixloop":{adjustBoardData:function(i,e){this.adjustNumberArrow(i,e)}},"AreaRoomGraph@yajilin-regions":{enabled:!0,hastop:!0},LineGraph:{enabled:!0},Graphic:{qcmpcolor:"rgb(127,127,127)",autocmp:"number",irowake:!0,getQuesNumberColor:function(i){var e=this.getQuesNumberColor_mixed(i);return 1!==(i.error||i.qinfo)&&i.isCmp()?this.qcmpcolor:e},paint:function(){this.drawBGCells(),"yajilin-regions"===this.pid&&this.drawShadedCells(),this.drawDotCells(),this.drawGrid(),this.drawBorders(),"yajilin"!==this.pid&&"lixloop"!==this.pid||this.drawArrowNumbers(),this.drawLines(),"yajilin"!==this.pid&&"lixloop"!==this.pid&&this.drawQuesNumbers(),this.drawPekes(),this.drawChassis(),"yajilin-regions"===this.pid&&this.drawBoxBorders(!1),this.drawTarget()}},"Graphic@yajilin,koburin,lixloop,retsurin":{getBGCellColor:function(i){var e=i.error||i.qinfo;return 2===this.puzzle.getConfig("disptype_yajilin")&&-1!==i.qnum?"rgb(224,224,224)":1===i.qans||1===i.qansBySolver?1===e?this.errcolor1:i.trial?this.trialcolor:this.getColorSolverAware(1===i.qans,1===i.qansBySolver,this.shadecolor):1===e?this.errbcolor1:null},getBorderColor:function(i){return 2===this.puzzle.getConfig("disptype_yajilin")&&i.isBorder()?this.quescolor:null},getNumberTextCore:function(i){var e=2===this.puzzle.getConfig("disptype_yajilin");return 0<=i?""+i:e||-2!==i?"":"?"}},"Graphic@lixloop#2":{getNumberTextCore:function(i){if(i<=0)return-2===i&&2!==this.puzzle.getConfig("disptype_yajilin")?"?":"";var e="";return 4&i&&(e+="L"),2&i&&(e+="I"),1&i&&(e+="X"),e}},"Graphic@yajilin-regions":{textoption:{ratio:.4,position:5,hoffset:.8,voffset:.75}},"Encode@yajilin,lixloop":{decodePzpr:function(i){this.decodeArrowNumber16(),this.puzzle.setConfig("yajilin_out",this.checkpflag("o")),this.puzzle.setConfig("disptype_yajilin",this.checkpflag("b")?2:1)},encodePzpr:function(i){this.encodeArrowNumber16();var e="",e=(e+=this.puzzle.getConfig("yajilin_out")?"o":"")+(2===this.puzzle.getConfig("disptype_yajilin")?"b":"");this.outpflag=e.length?e:null},decodeKanpen:function(){this.fio.decodeCellDirecQnum_kanpen(!0)},encodeKanpen:function(){this.fio.encodeCellDirecQnum_kanpen(!0)}},"Encode@yajilin-regions":{decodePzpr:function(i){this.decodeBorder(),this.decodeRoomNumber16(),this.puzzle.setConfig("yajilin_out",this.checkpflag("o"))},encodePzpr:function(i){this.encodeBorder(),this.encodeRoomNumber16(),this.outpflag=this.puzzle.getConfig("yajilin_out")?"o":null}},"Encode@koburin":{decodePzpr:function(i){this.decode4Cell(),this.puzzle.setConfig("koburin_minesweeper",this.checkpflag("m")),this.puzzle.setConfig("disptype_yajilin",this.checkpflag("b")?2:1),this.puzzle.setConfig("yajilin_out",this.checkpflag("o"))},encodePzpr:function(i){this.encode4Cell();var e="";this.puzzle.getConfig("yajilin_out")&&(e+="o"),this.puzzle.getConfig("koburin_minesweeper")&&(e+="m"),2===this.puzzle.getConfig("disptype_yajilin")&&(e+="b"),this.outpflag=e.length?e:null}},"Encode@retsurin":{decodePzpr:function(i){this.decodeNumber16(),this.puzzle.setConfig("yajilin_out",this.checkpflag("o")),this.puzzle.setConfig("disptype_yajilin",this.checkpflag("b")?2:1)},encodePzpr:function(i){this.encodeNumber16();var e="",e=(e+=this.puzzle.getConfig("yajilin_out")?"o":"")+(2===this.puzzle.getConfig("disptype_yajilin")?"b":"");this.outpflag=e.length?e:null}},"FileIO@yajilin,lixloop":{decodeData:function(){this.decodeConfigFlag("o","yajilin_out"),this.decodeCellDirecQnum(),this.decodeCellAns(),this.decodeBorderLine()},encodeData:function(){this.encodeConfigFlag("o","yajilin_out"),this.encodeCellDirecQnum(),this.encodeCellAns(),this.encodeBorderLine()},kanpenOpen:function(){this.decodeCellDirecQnum_kanpen(!1),this.decodeBorderLine()},kanpenSave:function(){this.encodeCellDirecQnum_kanpen(!1),this.encodeBorderLine()},decodeCellDirecQnum_kanpen:function(t){this.decodeCell(function(i,e){var n;"#"!==e||t?"+"!==e||t?"-4"===e?i.qnum=-2:"."!==e&&(0==(n=(48&(e=+e))>>4)?i.qdir=i.UP:1==n?i.qdir=i.LT:2==n?i.qdir=i.DN:3==n&&(i.qdir=i.RT),i.qnum=15&e):i.qsub=1:i.qans=1})},encodeCellDirecQnum_kanpen:function(t){this.encodeCell(function(i){var e,n=0<=i.qnum&&i.qnum<16?i.qnum:-1;if(-1!==n&&i.qdir!==i.NDIR)return i.qdir===i.UP?e=0:i.qdir===i.LT?e=1:i.qdir===i.DN?e=2:i.qdir===i.RT&&(e=3),(e<<4)+(15&n)+" ";if(-2===i.qnum)return"-4 ";if(!t){if(1===i.qans)return"# ";if(1===i.qsub)return"+ "}return". "})},kanpenOpenXML:function(){this.decodeCellDirecQnum_XMLBoard(),this.decodeBorderLine_XMLAnswer()},kanpenSaveXML:function(){this.encodeCellDirecQnum_XMLBoard(),this.encodeBorderLine_XMLAnswer()},decodeCellDirecQnum_XMLBoard:function(){this.decodeCellXMLBoard(function(i,e){var n;0<=e?(0==(n=(48&e)>>4)?i.qdir=i.UP:1==n?i.qdir=i.LT:2==n?i.qdir=i.DN:3==n&&(i.qdir=i.RT),i.qnum=15&e):-1===e?i.qsub=1:-2===e?i.qans=1:-4===e&&(i.qnum=-2)})},encodeCellDirecQnum_XMLBoard:function(){this.encodeCellXMLBoard(function(i){var e=-3,n=0;return-1!==i.qnum&&i.qdir!==i.NDIR?(i.qdir===i.UP?n=0:i.qdir===i.LT?n=1:i.qdir===i.DN?n=2:i.qdir===i.RT&&(n=3),e=(n<<4)+(15&i.qnum)):-2===i.qnum?e=-4:1===i.qans?e=-2:1===i.qsub&&(e=-1),e})}},"FileIO@yajilin-regions":{decodeData:function(){this.decodeConfigFlag("o","yajilin_out"),this.decodeAreaRoom(),this.decodeCellQnum(),this.decodeCellAns(),this.decodeBorderLine()},encodeData:function(){this.encodeConfigFlag("o","yajilin_out"),this.encodeAreaRoom(),this.encodeCellQnum(),this.encodeCellAns(),this.encodeBorderLine()}},"FileIO@koburin,retsurin":{decodeData:function(){this.decodeConfig(),this.decodeCellQnum(),this.decodeCellAns(),this.decodeBorderLine()},encodeData:function(){this.encodeConfig(),this.encodeCellQnum(),this.encodeCellAns(),this.encodeBorderLine()},decodeConfig:function(){this.decodeConfigFlag("o","yajilin_out"),this.decodeConfigFlag("m","koburin_minesweeper"),this.decodeConfigFlag("b","disptype_yajilin",2,1)},encodeConfig:function(){this.encodeConfigFlag("o","yajilin_out"),this.encodeConfigFlag("m","koburin_minesweeper"),this.encodeConfigFlag("b","disptype_yajilin",2,1)}},AnsCheck:{checklist:["checkBranchLine","checkCrossLine","checkLineOnShadeCell","checkAdjacentShadeCell","checkDeadendLine+","checkArrowNumber@yajilin,koburin,lixloop","checkShadeCellCount@yajilin-regions","checkCountsEqual@retsurin","checkCountsDiffer@retsurin","checkOneLoop","checkEmptyCell_yajilin+@!yajilin-regions","checkEmptyCell_regions+@yajilin-regions","checkShadedOutside","checkNumberHasArrow@yajilin,lixloop"],checkEmptyCell_yajilin:function(){this.checkAllCell(function(i){return 0===i.lcnt&&!i.isShade()&&i.noNum()},"ceEmpty")},checkEmptyCell_regions:function(){this.checkAllCell(function(i){return 0===i.lcnt&&!i.isShade()},"ceEmpty")},checkArrowNumber:function(){for(var i=this.board,e=0;e<i.cell.length;e++){var n=i.cell[e],t=n.getClist(),o=n.countShade(t);if(!(o<0||n.qnum===o)){if(this.failcode.add("anShadeNe"),this.checkOnly)break;n.seterr(1),t.seterr(1)}}},checkShadedOutside:function(){var e;!this.puzzle.getConfig("yajilin_out")||(e=this.board).scanInside()&&this.checkAllCell(function(i){return i.isShade()&&e.getx(i.bx-1,i.by-1).inside},"shInside")}},"AnsCheck@retsurin":{checkCountsEqual:function(){var e=this.getRowColCounts();this.checkAllCell(function(i){return i.isValidNum()&&e.x[i.bx]===i.qnum&&e.y[i.by]===i.qnum},"nmShadeEq")},checkCountsDiffer:function(){var e=this.getRowColCounts();this.checkAllCell(function(i){return i.isValidNum()&&e.x[i.bx]!==i.qnum&&e.y[i.by]!==i.qnum},"nmShadeNe")},getRowColCounts:function(){if(this._info.counts)return this._info.counts;for(var e=[],n=[],i=this.board.minbx;i<=this.board.maxbx;i++)e[i]=0;for(i=this.board.minby;i<=this.board.maxby;i++)n[i]=0;return this.board.cell.each(function(i){i.isShade()&&(e[i.bx]++,n[i.by]++)}),this._info.counts={x:e,y:n}}},"FailCode@koburin":{anShadeNe:"nmShadeNe.tawa"}});
//# sourceMappingURL=yajilin.js.map