/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,i){"object"==typeof module&&module.exports?module.exports=[e,i]:pzpr.classmgr.makeCustom(e,i)}(["icewalk","waterwalk","firewalk","forestwalk"],{MouseEvent:{inputModes:{edit:["ice","number","clear","info-line"],play:["line","peke","info-line"]},mouseinput_auto:function(){var e;this.puzzle.playmode?("left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&(this.prevPos.reset(),this.inputpeke()):"right"===this.btn&&(this.mousestart||this.mousemove)&&this.inputpeke(),"firewalk"===this.pid&&this.mouseend&&this.notInputted()&&(this.prevPos.reset(),this.inputdot(),this.notInputted()&&this.toggleArcs())):this.puzzle.editmode&&(e=this.getcell(),"right"!==this.btn||e.isNum()||!this.mousestart&&!this.mousemove?this.mouseend&&this.notInputted()&&this.inputqnum():this.inputIcebarn())}},"MouseEvent@waterwalk":{inputModes:{edit:["water","number","clear","info-line"],play:["line","peke","info-line"]},mouseinput_other:function(){"water"===this.inputMode&&this.inputIcebarn()}},"MouseEvent@forestwalk":{inputModes:{edit:["forest","number","clear","info-line"],play:["line","peke","info-line"]},mouseinput_other:function(){"forest"===this.inputMode&&this.inputIcebarn()}},"MouseEvent@firewalk":{inputModes:{edit:["fire","number","clear","info-line"],play:["line","peke","dot","info-line"]},mouseinput_other:function(){"fire"===this.inputMode?this.inputIcebarn():"dot"===this.inputMode&&this.inputdot()},inputdot:function(){var e=this.getpos(.25);if(!this.prevPos.equals(e)){var i=e.getDot();if(this.prevPos=e,null!==i){if(null===this.inputData)if("left"===this.btn)this.inputData={0:2,1:0,2:1}[i.getDot()];else{if("right"!==this.btn)return;this.inputData={0:1,1:2,2:0}[i.getDot()]}i.setDot(this.inputData),i.draw()}}},toggleArcs:function(){var e=this.getcell();e.isnull||!e.ice()||e.lcnt<3&&!e.isLineCurve()||(2<e.lcnt?e.setQans(1!==e.qans?1:2):3===e.qans?e.updateFireQans():e.setQans(3),e.drawaround())},inputLine:function(){var e,i,t,s=this.getcell(),n=(this.initFirstCell(s),this.getpos(0));this.prevPos.equals(n)||((e=this.prevPos.getnb(n)).isnull||(null===this.inputData&&(this.inputData=e.isLine()?0:1),1===this.inputData?(e.setLine(),this.prevborder&&1===Math.abs(this.prevborder.bx-e.bx)&&1===Math.abs(this.prevborder.by-e.by)&&(t=e.isVert()?this.prevborder:e,i=e.isVert()?e:this.prevborder,(s=this.board.cellinside(Math.min(t.bx,i.bx),Math.min(t.by,i.by),Math.max(t.bx,i.bx),Math.max(t.by,i.by))[0])&&!s.isnull&&s.ice()&&(3<=s.lcnt||3===s.qans)&&(t=s.adjborder.top===t==(s.adjborder.left===i),s.setQans(t?1:2))),this.prevborder=e):0===this.inputData&&e.removeLine(),e.draw()),this.prevPos=n)},mousereset:function(){this.common.mousereset.call(this),this.prevborder=null}},KeyEvent:{enablemake:!0,keyinput:function(e){var i;"q"===e?((i=this.cursor.getc()).setQues(6!==i.ques?6:0),(this.prev=i).draw()):this.key_inputqnum(e)}},Border:{enableLineNG:!0,isLineNG:function(){return!this.inside},posthook:{line:function(e){this.board.scanResult=null,this.board.roommgr.isStale=!0;for(var i=0;i<=1;i++)this.sidecell[i].updateFireQans()}}},Cell:{updateFireQans:function(){},posthook:{qnum:function(e){-1!==e&&6===this.ques&&this.setQues(0)},ques:function(e){this.board.roommgr.isStale=!0,6===e&&this.setQnum(-1),this.updateFireQans()}},maxnum:function(){return this.board.cols*this.board.rows},ice:function(){return this.isnull||6===this.ques}},"Cell@firewalk":{updateFireQans:function(){var e;this.ice()&&this.isLineCurve()?(e=this.adjborder.top.isLine()===this.adjborder.left.isLine(),this.setQans(e?1:2)):(!this.ice()||this.lcnt<2||this.isLineStraight()||3===this.qans)&&this.setQans(0)}},Cross:{l2cnt:0},"Dot@firewalk":{getDot:function(){return"cross"===this.piece.group?this.piece.qsub:0},setDot:function(e){"cross"===this.piece.group&&(this.puzzle.opemgr.disCombine=!0,this.piece.setQsub(e),this.puzzle.opemgr.disCombine=!1)},getTrial:function(){return this.piece.trial}},Board:{hasborder:2,scanResult:null,scanInside:function(){if(null!==this.scanResult)return this.scanResult;if(this.cell.some(function(e){return 1===e.lcnt&&3===e.lcnt}))return this.scanResult=!1;for(var e=2;e<this.maxby;e+=2)for(var i=!1,t=1;t<this.maxbx;t+=2)this.getb(t,e).isLine()&&(i^=!0),this.getx(t+1,e).inside=i;return this.scanResult=!0},rebuildInfo:function(){this.scanResult=null,this.common.rebuildInfo.call(this)}},"Board@firewalk":{hasdots:1},"BoardExec@firewalk":{adjustBoardData:function(e,i){if(e&this.TURNFLIP)for(var t=this.board.cell,s=0;s<t.length;s++){var n=t[s];n.qans={0:0,1:2,2:1,3:3}[n.qans]}}},Graphic:{irowake:!0,bgcellcolor_func:"icebarn",paint:function(){this.drawBGCells(),this.drawDashedGrid(!1),this.drawBorders(),this.drawLines(),this.drawPekes(),this.drawQuesNumbers(),"firewalk"===this.pid&&this.drawDots(),this.drawTarget()},getBorderColor:function(e){var i=e.sidecell[0],e=e.sidecell[1];return i.ice()^e.ice()?this.quescolor:null}},"Graphic@waterwalk":{icecolor:"rgb(163, 216, 255)"},"Graphic@forestwalk":{icecolor:"rgb(195, 253, 186)"},"Graphic@firewalk":{icecolor:"rgb(255, 192, 192)",getDotFillColor:function(e){return 1===e.getDot()?e.getTrial()?this.trialcolor:this.pekecolor:2===e.getDot()?"white":null},getDotOutlineColor:function(e){return 2===e.getDot()?e.getTrial()?this.trialcolor:this.pekecolor:null},getDotRadius:function(e){return.15},drawLines:function(){this.common.drawLines.call(this),this.drawArcBackground(),this.drawArcCorners()},drawArcBackground:function(){for(var e=this.vinc("arc_back","crispEdges"),i=this.range.borders.cellinside(),t=this.lw,s=this.bw/2,n=0;n<i.length;n++){var r,o,l=i[n],a=l.qans?this.getBGCellColor(l):null;e.vid="c_arc_bg_"+l.id,a?(e.fillStyle=a,4===l.lcnt?e.fillRectCenter(l.bx*this.bw,l.by*this.bh,this.bw-t,this.bh-t):3===l.qans?e.fillRectCenter(l.bx*this.bw,l.by*this.bh,this.bw/2,this.bh/2):(a=l.adjborder,r=1===l.qans&&a.top.isLine()&&a.left.isLine()||2===l.qans&&a.bottom.isLine()&&a.left.isLine()?(l.bx-1)*this.bw-t+s:l.bx*this.bw+t-s,a=1===l.qans&&a.left.isLine()&&a.top.isLine()||2===l.qans&&a.right.isLine()&&a.top.isLine()?(l.by-1)*this.bh-t+s:l.by*this.bh+t-s,l=this.bw+s-2*t,o=this.bw+s-2*t,e.fillRect(r,a,l,o))):e.vhide()}this.drawArcBackgroundForSolver()},drawArcBackgroundForSolver:function(){for(var e=this.vinc("arc_back_solver","crispEdges"),i=this.range.borders.cellinside(),t=this.lw,s=this.bw/2,n=0;n<i.length;n++){var r,o,l=i[n],a=l.qansBySolver?this.getBGCellColor(l):null;e.vid="c_arc_bg_solver_"+l.id,a?(e.fillStyle=a,4===l.lcnt?e.fillRectCenter(l.bx*this.bw,l.by*this.bh,this.bw-t,this.bh-t):3===l.qansBySolver?e.fillRectCenter(l.bx*this.bw,l.by*this.bh,this.bw/2,this.bh/2):(a=l.adjborder,r=1===l.qansBySolver&&a.top.isLineBySolver()&&a.left.isLineBySolver()||2===l.qansBySolver&&a.bottom.isLineBySolver()&&a.left.isLineBySolver()?(l.bx-1)*this.bw-t+s:l.bx*this.bw+t-s,a=1===l.qansBySolver&&a.left.isLineBySolver()&&a.top.isLineBySolver()||2===l.qansBySolver&&a.right.isLineBySolver()&&a.top.isLineBySolver()?(l.by-1)*this.bh-t+s:l.by*this.bh+t-s,l=this.bw+s-2*t,o=this.bw+s-2*t,e.fillRect(r,a,l,o))):e.vhide()}},drawArcCorners:function(){for(var e=this.vinc("arcs","auto",!0),i=(e.lineWidth=2*this.lm,this.bw),t=this.range.borders.cellinside(),s=0;s<t.length;s++)for(var n=t[s],r=(n.bx-1)*this.bw,o=(n.by-1)*this.bh,l=(n.bx+1)*this.bw,a=(n.by+1)*this.bh,h=n.adjborder,c=0;c<4;c++){var u=null;switch(c){case 0:u=1===n.qans&&h.top.isLine()&&h.left.isLine()?this.getColorSolverAware(1===n.qans&&h.top.isLine()&&h.left.isLine(),1===n.qansBySolver&&h.top.isLineBySolver()&&h.left.isLineBySolver(),this.getLineColor(h.top)):null;break;case 1:u=2===n.qans&&h.top.isLine()&&h.right.isLine()?this.getColorSolverAware(2===n.qans&&h.top.isLine()&&h.right.isLine(),2===n.qansBySolver&&h.top.isLineBySolver()&&h.right.isLineBySolver(),this.getLineColor(h.top)):null;break;case 2:u=1===n.qans&&h.bottom.isLine()&&h.right.isLine()?this.getColorSolverAware(1===n.qans&&h.bottom.isLine()&&h.right.isLine(),1===n.qansBySolver&&h.bottom.isLineBySolver()&&h.right.isLineBySolver(),this.getLineColor(h.bottom)):null;break;case 3:u=2===n.qans&&h.bottom.isLine()&&h.left.isLine()?this.getColorSolverAware(2===n.qans&&h.bottom.isLine()&&h.left.isLine(),2===n.qansBySolver&&h.bottom.isLineBySolver()&&h.left.isLineBySolver(),this.getLineColor(h.bottom)):null}if(e.vid="c_arc_"+c+"_"+n.id,u){switch(e.beginPath(),e.strokeStyle=u,c){case 0:e.arc(r,o,i,0,Math.PI/2);break;case 1:e.arc(l,o,i,Math.PI/2,Math.PI);break;case 2:e.arc(l,a,i,Math.PI,1.5*Math.PI);break;case 3:e.arc(r,a,i,1.5*Math.PI,2*Math.PI)}e.stroke()}else e.vhide()}this.drawArcCornersForSolver()},drawArcCornersForSolver:function(){for(var e=this.vinc("arcs_solver","auto",!0),i=(e.lineWidth=2*this.lm,this.bw),t=this.range.borders.cellinside(),s=0;s<t.length;s++)for(var n=t[s],r=(n.bx-1)*this.bw,o=(n.by-1)*this.bh,l=(n.bx+1)*this.bw,a=(n.by+1)*this.bh,h=n.adjborder,c=0;c<4;c++){var u=null;switch(c){case 0:u=1===n.qansBySolver&&h.top.isLineBySolver()&&h.left.isLineBySolver()?this.getColorSolverAware(1===n.qans&&h.top.isLine()&&h.left.isLine(),1===n.qansBySolver&&h.top.isLineBySolver()&&h.left.isLineBySolver(),this.getLineColor(h.top)):null;break;case 1:u=2===n.qansBySolver&&h.top.isLineBySolver()&&h.right.isLineBySolver()?this.getColorSolverAware(2===n.qans&&h.top.isLine()&&h.right.isLine(),2===n.qansBySolver&&h.top.isLineBySolver()&&h.right.isLineBySolver(),this.getLineColor(h.top)):null;break;case 2:u=1===n.qansBySolver&&h.bottom.isLineBySolver()&&h.right.isLineBySolver()?this.getColorSolverAware(1===n.qans&&h.bottom.isLine()&&h.right.isLine(),1===n.qansBySolver&&h.bottom.isLineBySolver()&&h.right.isLineBySolver(),this.getLineColor(h.bottom)):null;break;case 3:u=2===n.qansBySolver&&h.bottom.isLineBySolver()&&h.left.isLineBySolver()?this.getColorSolverAware(2===n.qans&&h.bottom.isLine()&&h.left.isLine(),2===n.qansBySolver&&h.bottom.isLineBySolver()&&h.left.isLineBySolver(),this.getLineColor(h.bottom)):null}if(e.vid="c_arc_by_solver_"+c+"_"+n.id,u){switch(e.beginPath(),e.strokeStyle=u,c){case 0:e.arc(r,o,i,0,Math.PI/2);break;case 1:e.arc(l,o,i,Math.PI/2,Math.PI);break;case 2:e.arc(l,a,i,Math.PI,1.5*Math.PI);break;case 3:e.arc(r,a,i,1.5*Math.PI,2*Math.PI)}e.stroke()}else e.vhide()}}},LineGraph:{enabled:!0},"LineGraph@icewalk":{isLineCross:!0},"LineGraph@firewalk":{relation:{"border.line":"link","cell.qans":"arcs"},isLineCross:!0,modifyOtherInfo:function(e,i){var t=this.getObjNodeList(e);if(2===t.length){for(var s={},n=0;n<t.length;n++)for(;0<t[n].nodes.length;){var r=t[n].nodes[0];this.removeEdge(t[n],r),s[l=e.getdir(r.obj,2)]=r}for(var o=[e.DN,e.LT,e.RT,e.DN][e.qans],l=1;l<=4;l++)s[l]&&(l===e.UP||l===o?this.addEdge(t[0],s[l]):this.addEdge(t[1],s[l]))}},getSideNodesByLinkObj:function(e){for(var i=[],t=this.getSideObjByLinkObj(e),s=0;s<t.length;s++){var n=t[s],r=this.getObjNodeList(n),o=r[0];if(r[1]){var l=n.getdir(e,1);switch(n.qans){case 1:l!==e.DN&&l!==e.RT||(o=r[1]);break;case 2:l!==e.DN&&l!==e.LT||(o=r[1]);break;default:e.isvert&&(o=r[1])}}i.push(o)}return i},usesSecondNode:function(e,i){var t=[e.DN,e.LT,e.RT,e.DN][e.qans],i=e.getdir(i,2);return i===e.UP||i===t}},AreaRoomGraph:{countprop:"l2cnt",enabled:!0,relation:{"cell.ques":"node","border.line":"separator"},isedgevalidbylinkobj:function(e){return!!e.isLine()&&e.sidecell[0].ice()===e.sidecell[1].ice()}},Encode:{decodePzpr:function(){this.decodeIce(),this.decodeNumber16(),this.puzzle.setConfig("loop_full",this.checkpflag("f"))},encodePzpr:function(){this.outpflag=this.puzzle.getConfig("loop_full")?"f":null,this.encodeIce(),this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeConfigFlag("f","loop_full"),this.decodeCell(function(e,i){"A"===i?(e.ques=6,e.qans=1):"B"===i?(e.ques=6,e.qans=2):"C"===i?(e.ques=6,e.qans=3):"#"===i?e.ques=6:"-"===i?e.qnum=-2:"."!==i&&(e.qnum=+i)}),this.decodeBorderLine(),"firewalk"===this.pid&&this.decodeCross(function(e,i){e.qsub=+i})},encodeData:function(){this.encodeConfigFlag("f","loop_full"),this.encodeCell(function(e){return 0<e.qans?String.fromCharCode(64+e.qans)+" ":6===e.ques?"# ":-2===e.qnum?"- ":0<=e.qnum?e.qnum+" ":". "}),this.encodeBorderLine(),"firewalk"===this.pid&&this.board.cross.some(function(e){return e.qsub})&&this.encodeCross(function(e){return e.qsub+" "})}},AnsCheck:{checklist:["checkBranchLine","checkCrossLine@!icewalk","checkCrossOutOfIce@icewalk","checkIceLines@icewalk","checkWaterWalk@waterwalk","checkStraightOnFire@firewalk","checkLessWalk","checkOverWalk","checkForestCell@forestwalk","checkOneLoop","checkDoubleTurnOutside@firewalk","checkNoLineOnNum","checkNoLineIfVariant","checkDeadendLine+"],checkLessWalk:function(){this.checkWalkLength(-1,"bkSizeLt")},checkOverWalk:function(){this.checkWalkLength(1,"bkSizeGt")},checkWaterWalk:function(){this.checkWalkLength(2,"bkSizeGt2")},checkWalkLength:function(e,i){this.board.roommgr.isStale&&(this.board.roommgr.isStale=!1,this.board.roommgr.rebuild());for(var t=0;t<this.board.cell.length;t++){var s=this.board.cell[t],n=s.qnum;if(2===e){if(!s.ice())continue;n=2}if(!(n<=0)&&s.room&&!(e<0&&s.room.clist.some(function(e){return 2!==e.lcnt}))){var r=s.room.clist.length;if(0<e?n<r:r<n){if(this.failcode.add(i),this.checkOnly)return;s.room.clist.seterr(1)}}}},checkCrossOutOfIce:function(){this.checkAllCell(function(e){return 4===e.lcnt&&!e.ice()},"lnCrossExIce")},checkNoLineOnNum:function(){this.checkAllCell(function(e){return-1!==e.qnum&&0===e.lcnt},"lnIsolate")}},"AnsCheck@firewalk":{checkBranchLine:function(){this.checkAllCell(function(e){return 3===e.lcnt&&0===e.qans},"lnBranch")},checkCrossLine:function(){this.checkAllCell(function(e){return 4===e.lcnt&&0===e.qans},"lnCross")},checkDeadendLine:function(){this.checkAllCell(function(e){return 1===e.lcnt||3===e.qans||3===e.lcnt&&0<e.qans},"lnDeadEnd")},checkStraightOnFire:function(){this.checkAllCell(function(e){return 2<=e.lcnt&&e.ice()&&0===e.qans},"lnStraightOnIce")},checkDoubleTurnOutside:function(){this.board.scanInside()&&this.checkAllCell(function(e){return 4===e.lcnt&&(1===e.qans&&e.relcross(-1,-1).inside||2===e.qans&&e.relcross(1,-1).inside)},"lnDoubleTurn")}},"AnsCheck@forestwalk":{checkBranchLine:function(){this.checkAllCell(function(e){return 3===e.lcnt&&!e.ice()},"lnBranch")},checkForestCell:function(){this.checkAllCell(function(e){return 0<e.lcnt&&e.lcnt<3&&e.ice()},"lnNoBranch")}}});
//# sourceMappingURL=icewalk.js.map