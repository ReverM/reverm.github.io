/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["trainstations","turnrun"],{MouseEvent:{inputModes:{edit:["number","undef","empty","clear","info-line"],play:["line","peke","clear","diraux","info-line"]},mouseinput_other:function(){"diraux"===this.inputMode&&(this.mousestart||this.mousemove?this.inputdiraux_mousemove():this.mouseend&&this.notInputted()&&this.clickdiraux())},mouseinput_auto:function(){this.puzzle.playmode?"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.clickdiraux():"right"===this.btn&&(this.mousestart?this.inputdiraux_mousedown():2===this.inputData||3===this.inputData?this.inputpeke():this.mousemove&&this.inputdiraux_mousemove()):this.puzzle.editmode&&this.mousestart&&this.inputqnum()}},KeyEvent:{enablemake:!0,getNewNumber:function(e,t,n){return"q"===t?0===n?-1:0:this.common.getNewNumber.call(this,e,t,n)}},Border:{enableLineNG:!0},Cell:{minnum:0,maxnum:function(){var e=this.board;return e.cols*e.rows},isNum:function(){return!this.isnull&&0!==this.qnum&&-1!==this.qnum},posthook:{qnum:function(e){this.board.maxFoundNumber=-1}},noLP:function(e){return this.isEmpty()}},"Cell@turnrun":{maxnum:function(){var e=this.board;return Math.max(e.cols,e.rows)-1},getSegmentDir:function(e){for(var t=new this.klass.PieceList,n=this.getaddr().movedir(e,1);;){var i=n.getb();if(!i||i.isnull)break;if(!i.isLine())break;t.add(i),n.movedir(e,2)}return t}},Board:{hasborder:1,maxFoundNumber:-1,initBoardSize:function(e,t){this.common.initBoardSize.call(this,e,t),this.maxFoundNumber=-1},getMaxFoundNumber:function(){if(-1!==this.maxFoundNumber)return this.maxFoundNumber;for(var e=0,t=0;t<this.cell.length;t++)this.cell[t].isNum()&&e++;return this.maxFoundNumber=e}},LineGraph:{enabled:!0,isLineCross:!0},Graphic:{irowake:!0,numbercolor_func:"qnum",gridcolor_type:"SLIGHT",circleratio:[.38,.38],circlestrokecolor_func:"null",getCircleFillColor:function(e){return-1!==e.qnum&&0!==e.qnum?"white":null},getBorderColor:function(e){return e.sidecell[0].isEmpty()||e.sidecell[1].isEmpty()?this.quescolor:null},getBGCellColor:function(e){return 7===e.ques?"black":this.getBGCellColor_error1(e)},paint:function(){this.drawBGCells(),this.drawGrid(),this.drawLines(),this.drawCircledNumbers(),this.draw11s(),this.drawPekes(),this.drawBorderAuxDir(),this.drawBorders(),this.drawChassis(),this.drawTarget()},getQuesNumberText:function(e){return 0===e.qnum?null:this.getNumberTextCore(e.qnum)},draw11s:function(){for(var e=this.vinc("cell_ques","crispEdges",!0),t=this.range.cells,n=0;n<t.length;n++){var i,r,s,u=t[n];e.vid="c_lp11_"+u.id,0===u.qnum?(i=(this.lw+2-1)/2,r=.38*this.cw,s=u.bx*this.bw,u=u.by*this.bh,e.fillStyle=this.quescolor,e.beginPath(),e.setOffsetLinePath(s,u,-i,-i,-i,-r,i,-r,i,-i,r,-i,r,i,i,i,i,r,-i,r,-i,i,-r,i,-r,-i,!0),e.fill()):e.vhide()}}},Encode:{decodePzpr:function(e){this.decodeNumber16(),this.decodeEmpty(),this.puzzle.setConfig("loop_full",this.checkpflag("f"))},encodePzpr:function(e){this.outpflag=this.puzzle.getConfig("loop_full")?"f":null,this.encodeNumber16(),this.encodeEmpty()}},FileIO:{decodeData:function(){this.decodeConfigFlag("f","loop_full"),this.decodeCell(function(e,t){"#"===t?e.ques=7:"-"===t?e.qnum=-2:"."!==t&&(e.qnum=+t)}),this.decodeBorderArrowAns()},encodeData:function(){this.encodeConfigFlag("f","loop_full"),this.encodeCell(function(e){return 7===e.ques?"# ":0<=e.qnum?e.qnum+" ":-2===e.qnum?"- ":". "}),this.encodeBorderArrowAns()}},AnsCheck:{checklist:["checkNumberRange@trainstations","checkBranchLine","checkCrossOutOfMark","checkCurveOnNumber@trainstations","checkStraightOnNumber@turnrun","checkNumberConsecutive@trainstations","checkNotCrossOnMark","checkNoLineNumber@turnrun","checkDeadendLine+","checkOneLoop","checkNumberFullSequence@trainstations","checkTurnLengths@turnrun","checkNoLine@trainstations","checkNoLineIfVariant@turnrun"],checkNumberRange:function(){var t=this.board.getMaxFoundNumber();this.checkAllCell(function(e){return e.qnum>t},"nmRange")},checkCrossOutOfMark:function(){this.checkAllCell(function(e){return 4===e.lcnt&&0!==e.qnum},"lnCrossExMk")},checkNotCrossOnMark:function(){this.checkAllCell(function(e){return 4!==e.lcnt&&0===e.qnum},"lnNotCrossMk")},checkCurveOnNumber:function(){this.checkAllCell(function(e){return e.isLineCurve()&&-1!==e.qnum&&0!==e.qnum},"lnCurveOnNum")},checkStraightOnNumber:function(){this.checkAllCell(function(e){return e.isLineStraight()&&-1!==e.qnum&&0!==e.qnum},"lnStraightOnNum")},checkTurnLengths:function(){this.checkWalkGeneric(this.turnrun_walkLine,"ceDirection")},checkNoLineNumber:function(){this.checkAllCell(function(e){return e.isNum()&&0===e.lcnt},"numNoLine")},checkNumberConsecutive:function(){var n=this.board.getMaxFoundNumber();this.checkLineShape(function(e){var t=e.cells[0],e=e.cells[1];if(t.isnull||e.isnull||-2===t.qnum||-2===e.qnum)return null;t=Math.abs(t.qnum-e.qnum);return 1!==t&&t!==n-1},"nmNotConseq")},checkNumberFullSequence:function(){this.checkWalkGeneric(this.trainstations_walkLine,"nmNotConseqFull")},checkWalkGeneric:function(e,t){var n=this.board,i=n.linegraph.components,r=i[0];if(1===i.length&&1===r.circuits){for(var s=n.emptycell,u=0;u<n.cell.length;u++){var o=n.cell[u];if(o.isValid()&&1&o.lcnt)return;0<o.qnum&&(s.isnull||s.qnum>o.qnum)&&(s=o)}if(!s.isnull){for(var l=[],c=1;c<=4;c++)s.reldirbd(c,1).isLine()&&l.push(e.call(this,s,c));2===l.length&&0!==l[0].clist.length&&0!==l[1].clist.length&&(this.failcode.add(t),this.checkOnly||(n.border.setnoerr(),(i=l[0].clist.length+l[0].blist.length<l[1].clist.length+l[1].blist.length?l[0]:l[1]).clist.seterr(1),i.blist.seterr(1)))}}},trainstations_walkLine:function(e,t){var n=new this.klass.CellList,i=new this.klass.BorderList,r=new this.klass.BorderList,s=e.qnum,u=e,o=e.getaddr();do{var l=o.getc(),l=(o.equals(e)||(0<l.qnum?(l.qnum!==++s&&(n.add(u),n.add(l),i.extend(r)),u=l,r=new this.klass.BorderList):-2===l.qnum&&s++),o.movedir(t,1),r.add(o.getb()),o.movedir(t,1),o.getc()),c=l.adjborder}while(4!==l.lcnt&&(1!==t&&c.bottom.isLine()?t=2:2!==t&&c.top.isLine()?t=1:3!==t&&c.right.isLine()?t=4:4!==t&&c.left.isLine()&&(t=3)),!o.equals(e)&&1<o.getc().lcnt&&!o.getc().isEmpty());return{clist:n,blist:i}},turnrun_walkLine:function(e,t){var n=new this.klass.CellList,i=new this.klass.BorderList,r=e.getaddr();do{var s=r.getc(),u=s.isLineCurve()&&s.isValidNum()?s.getSegmentDir(t):null,s=(u&&u.length!==s.qnum&&(n.add(s),i.extend(u)),r.movedir(t,2),r.getc()),u=s.adjborder}while(4!==s.lcnt&&(1!==t&&u.bottom.isLine()?t=2:2!==t&&u.top.isLine()?t=1:3!==t&&u.right.isLine()?t=4:4!==t&&u.left.isLine()&&(t=3)),!r.equals(e)&&1<r.getc().lcnt&&!r.getc().isEmpty());return{clist:n,blist:i}}}});
//# sourceMappingURL=trainstations.js.map