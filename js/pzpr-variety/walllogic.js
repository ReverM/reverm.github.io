/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,e){"object"==typeof module&&module.exports?module.exports=[t,e]:pzpr.classmgr.makeCustom(t,e)}(["walllogic"],{MouseEvent:{inputModes:{edit:["number","shade","clear"]},mouseinput:function(){"shade"===this.inputMode?this.inputBlock():this.common.mouseinput.call(this)},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart||this.mousemove?this.inputWall():this.mouseend&&this.notInputted()&&this.inputqcmp():this.puzzle.editmode&&this.mousestart&&this.inputcell_walllogic()},inputWall:function(){var t,e,n,s=this.getcell();s.isnull||(1!==s.ques&&-1===s.qnum&&(this.mouseCell!==s?this.firstPoint.set(this.inputPoint):null!==this.firstPoint.bx&&(t=null,e=this.inputPoint.bx-this.firstPoint.bx,(n=this.inputPoint.by-this.firstPoint.by)<=-.5?t=1:.5<=n?t=2:e<=-.5?t=3:.5<=e&&(t=4),(n=null)!==(t=null!==t&&null===this.inputData&&s.anum===t?-1:t)&&(-1===t||-1===this.inputData?t=n=-1:0<s.anum||2===this.inputData?n=2:s.anum<0&&(n=1)),null===n||null!==this.inputData&&this.inputData!==n||(s.setAnum(t),this.inputData=n,this.firstPoint.reset()))),this.mouseCell=s)},inputqcmp:function(){var t=this.getcell();t.isnull||(t.setQcmp(+!t.qcmp),t.draw(),this.mousereset())},inputBlock:function(){var t=this.getcell();t.isnull||t===this.mouseCell||(t.setQues(1===t.ques?0:1),t.setQnum(-1),t.setAnum(-1),t.drawaround(),this.mouseCell=t)},inputcell_walllogic:function(t){var e,n,s;(t=this.getcell()).isnull||t===this.mouseCell||(t!==this.cursor.getc()?this.setcursor(t):(n=t.ques,e=-1!==(e=t.qnum)?0<=e?e:-1:0<n?-3:-2,n=t.getmaxnum(),s=-3,this.inputMode.match(/number/)&&(s=-2),"left"===this.btn?e++:"right"===this.btn&&e--,-1<=(e=(e=n<e?s:e)<s?n:e)?(t.setQues(0),t.setQnum(0<=e?e:-2)):(-2===e?t.setQues(0):t.setQues(1),t.setQnum(-1)),t.setAnum(-1),t.draw()))}},KeyEvent:{enablemake:!0,keyinput:function(t){this.key_inputqnum_tateyoko(t)||this.key_inputqnum(t)},key_inputqnum_tateyoko:function(t){var e=this.cursor.getc();return("q"===t||"q1"===t||"q2"===t)&&("q1"===(t="q"===t?1!==e.ques?"q1":"q2":t)?(e.setQues(1),e.setQnum(-1),e.setAnum(-1)):"q2"===t&&e.setQues(0),(this.prev=e).drawaround(),!0)}},Cell:{basecell:null,prevbasecell:null,maxnum:function(){var t=this.board;return t.cols+t.rows-2},minnum:0,revdircell:function(t){return this.getaddr().movedir(t,-2).getc()},isTip:function(){return this.getaddr().movedir(this.anum,2).getc().anum!==this.anum},isGap:function(){if(-1===this.anum)return!1;var t=this.anum,e=this.revdircell(this.anum).anum,t=1<<t|1<<(e=e<=0?0:e);return 24==t||6==t},getWallClist:function(){var t=this.adjacent,e=new this.klass.CellList,n=t.top;return n.anum===n.UP&&e.extend(n.wall.clist),(n=t.bottom).anum===n.DN&&e.extend(n.wall.clist),(n=t.left).anum===n.LT&&e.extend(n.wall.clist),(n=t.right).anum===n.RT&&e.extend(n.wall.clist),e},isCmp:function(){return 1===this.qcmp||!!this.puzzle.execConfig("autocmp")&&this.qnum===this.getWallClist().length},prehook:{anum:function(){return this.prevbasecell=this.basecell,!1}},posthook:{anum:function(){this.wall?this.basecell=this.wall.clist.getBaseCell():this.basecell=this.board.emptycell,this.drawaround(),this.puzzle.execConfig("autocmp")&&(this.prevbasecell&&this.prevbasecell.draw(),this.basecell&&this.basecell.draw())}}},CellList:{getBaseCell:function(){for(var t=0;t<this.length;++t){var e=this[t],n=e.revdircell(e.anum);if(e.wall!==n.wall)return n}return this.board.emptycell}},Board:{disable_subclear:!0,addExtraInfo:function(){this.wallgraph=this.addInfoList(this.klass.AreaWallGraph)}},BoardExec:{adjustBoardData:function(t,e){this.adjustCellAnumArrow(t,e)},adjustCellAnumArrow:function(t,e){for(var n=this.getTranslateDir(t),s=this.board.cellinside(e.x1,e.y1,e.x2,e.y2),l=0;l<s.length;l++){var i=s[l],a=n[i.anum];a&&(i.anum=a)}}},"AreaWallGraph:AreaGraphBase":{enabled:!0,relation:{"cell.anum":"node"},setComponentRefs:function(t,e){t.wall=e},getObjNodeList:function(t){return t.wallnodes},resetObjNodeList:function(t){t.wallnodes=[]},isnodevalid:function(t){return 0<t.anum},isedgevalidbynodeobj:function(t,e){if(t.anum!==e.anum)return!1;e=t.getdir(e,2);return e===t.UP||e===t.DN?t.anum===t.UP||t.anum===t.DN:(e===t.LT||e===t.RT)&&(t.anum===t.LT||t.anum===t.RT)}},Graphic:{autocmp:"number",gridcolor_type:"LIGHT",paint:function(){this.drawBGCells(),this.drawGrid(),this.drawQuesCells(),this.drawWalls(),this.drawQuesNumbers(),this.drawChassis(),this.drawTarget()},getBGCellColor:function(t){return-1===t.qnum||1!==t.error&&1!==t.qinfo?null:this.errbcolor1},getQuesNumberColor:function(t){return 1===t.error?this.errcolor1:t.isCmp()?this.qcmpcolor:this.quescolor},drawWalls:function(){var t=this.vinc("cell_wall","auto"),e=this.bw,n=Math.max(this.cw/6,3)/2,s=.16*this.cw,l=Math.max(this.cw/2,4)/2;n=1<=n?n:1,l=5<=l?l:5;for(var i=Math.max(.08*this.cw,2),a=this.range.cells,u=0;u<a.length;u++){var o,r=a[u],c=r.anum,h=null;if(1<=c&&c<=4&&(h=1===(o=r.error||r.qinfo)?this.errlinecolor:-1===o?this.noerrcolor:r.trial?this.trialcolor:this.linecolor),t.vid="c_wall_"+r.id,h){t.fillStyle=h,t.beginPath();var m=[r.bx*this.bw,r.by*this.bh];if(r.isTip())switch(c){case r.UP:m.push(n,-s,l,-s,0,-e,-l,-s,-n,-s);break;case r.DN:m.push(n,s,l,s,0,e,-l,s,-n,s);break;case r.LT:m.push(-s,n,-s,l,-e,0,-s,-l,-s,-n);break;case r.RT:m.push(s,n,s,l,e,0,s,-l,s,-n)}else switch(c){case r.UP:m.push(n,-e,-n,-e);break;case r.DN:m.push(n,e,-n,e);break;case r.LT:m.push(-e,n,-e,-n);break;case r.RT:m.push(e,n,e,-n)}var d=e-(r.isGap()?i:0);switch(c){case r.UP:m.push(-n,d,n,d);break;case r.DN:m.push(-n,-d,n,-d);break;case r.LT:m.push(d,-n,d,n);break;case r.RT:m.push(-d,-n,-d,n)}m.push(!0),t.setOffsetLinePath.apply(t,m),t.fill()}else t.vhide()}}},Encode:{decodePzpr:function(t){this.decodeWallLogic()},encodePzpr:function(t){this.encodeWallLogic()},decodeWallLogic:function(){for(var t=0,e=0,n=this.outbstr,s=this.board,e=0;e<n.length;e++){var l=n.charAt(e),i=s.cell[t];if("+"===l?i.ques=1:this.include(l,"0","9")||this.include(l,"a","f")?i.qnum=parseInt(l,16):"-"===l?(i.qnum=parseInt(n.substr(e+1,2),16),e+=2):"."===l?i.qnum=-2:"g"<=l&&l<="z"&&(t+=parseInt(l,36)-16),t++,!s.cell[t])break}this.outbstr=n.substr(e)},encodeWallLogic:function(t){for(var e="",n=0,s=this.board,l=0;l<s.cell.length;l++){var i="",a=s.cell[l].ques,u=s.cell[l].qnum;1===a?i="+":-1===u?n++:-2===u?i=".":u<16?i=""+u.toString(16):u<256?i="-"+u.toString(16):(i="",n++),0===n?e+=i:!i&&20!==n||(e+=(15+n).toString(36)+i,n=0)}0<n&&(e+=(15+n).toString(36)),this.outbstr+=e}},FileIO:{decodeData:function(){this.decodeQuesQnum(),this.decodeCellAnumcmp()},encodeData:function(){this.encodeQuesQnum(),this.encodeCellAnumcmp()},decodeQuesQnum:function(){this.decodeCell(function(t,e){"#"===e?t.ques=1:"-"===e?t.qnum=-2:"."!==e&&(t.qnum=+e)})},encodeQuesQnum:function(){this.encodeCell(function(t){return 1===t.ques?"# ":0<=t.qnum?t.qnum+" ":-2===t.qnum?"- ":". "})},decodeCellAnumcmp:function(){this.decodeCell(function(t,e){"-"===e?t.qcmp=1:"."!==e&&(t.anum=+e)})},encodeCellAnumcmp:function(){this.encodeCell(function(t){return-1!==t.anum?t.anum+" ":1===t.qcmp?"- ":". "})}},AnsCheck:{checklist:["checkWallExist+","checkLongWall","checkShortWall","checkNoWall","checkIsolateWall"],checkWallExist:function(){0<this.board.wallgraph.components.length||this.failcode.add("brNoLine")},checkLongWall:function(){this.checkWall(1,"nmConnWallGt")},checkShortWall:function(){this.checkWall(2,"nmConnWallLt")},checkNoWall:function(){this.checkWall(3,"nmConnNoWall")},checkWall:function(t,e){for(var n=this.board,s=!0,l=0;l<n.cell.length;l++){var i=n.cell[l],a=i.qnum;if(!(a<0)){var u=i.getWallClist();if(!(1===t&&u.length<=a||2===t&&(u.length>=a||0===u.length)||3===t&&0<u.length&&0<a)){if(s=!1,this.checkOnly)break;i.seterr(1),u.seterr(1)}}}s||(this.failcode.add(e),n.cell.setnoerr())},checkIsolateWall:function(){for(var t=this.board.wallgraph.components,e=!0,n=0;n<t.length;n++){var s=t[n].clist;if(-1===s.getBaseCell().qnum){if(e=!1,this.checkOnly)break;s.seterr(1)}}e||(this.failcode.add("lbIsolate"),this.board.cell.setnoerr())}}});
//# sourceMappingURL=walllogic.js.map