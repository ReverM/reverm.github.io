/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["chainedb","mrtile","archipelago"],{MouseEvent:{use:!0,inputModes:{edit:["number","undef","clear","info-blk"],play:["shade","unshade","info-blk"]},autoedit_func:"qnum",autoplay_func:"cell",dispInfoBlk:function(){var e=this.getcell();this.mousereset(),!e.isnull&&e.isShade()&&(e.blk8.clist.setinfo(1),this.board.hasinfo=!0,this.puzzle.redraw())},mouseinput_clear:function(){this.inputFixedNumber(-1)}},"MouseEvent@mrtile":{inputModes:{edit:["number","undef","clear"],play:["shade","unshade"]}},KeyEvent:{enablemake:!0},AreaShadeGraph:{relation:{"cell.qans":"node","cell.qnum":"node"},enabled:!0},"AreaShade8Graph:AreaShadeGraph@chainedb,archipelago":{enabled:!0,setComponentRefs:function(e,t){e.blk8=t},getObjNodeList:function(e){return e.blk8nodes},resetObjNodeList:function(e){e.blk8nodes=[]},getSideObjByNodeObj:function(e){for(var t=e.getdir8clist(),n=[],i=0;i<t.length;i++){var r=t[i][0];this.isnodevalid(r)&&n.push(r)}return n},setExtraData:function(e){this.common.setExtraData.call(this,e);var t=new Set;e.clist.each(function(e){t.add(e.sblk)}),e.blockset=Array.from(t)}},"Board@chainedb,archipelago":{addExtraInfo:function(){this.sblk8mgr=this.addInfoList(this.klass.AreaShade8Graph)}},Cell:{maxnum:function(){var e=this.board;return e.cols*e.rows-3},isShade:function(){return!this.isnull&&(1===this.qans||-1!==this.qnum)},prehook:{qans:function(e){return!e&&-1!==this.qnum}},setQnum:function(e){this.setdata("qnum",e),-1===e?this.setQans(0):this.setQans(1)}},"Cell@mrtile":{maxnum:function(){var e=this.board;return(e.cols*e.rows>>1)-1}},"Cell@archipelago":{maxnum:function(){var e=this.board.cols*this.board.rows;return Math.ceil(Math.sqrt(e))+1}},Graphic:{qanscolor:"#222222",shadecolor:"#222222",numbercolor_func:"fixed_shaded",fontShadecolor:"white",noerrcolor:"#666666",enablebcolor:!0,bgcellcolor_func:"qsub1",paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawGrid(),this.drawQuesNumbers(),this.drawChassis(),this.drawTarget()},getShadedCellColor:function(e){if(!e.isShade()&&1!==e.qansBySolver)return null;var t=e.error||e.qinfo;return 1===t?this.errcolor1:e.trial?this.trialcolor:-1===t?this.noerrcolor:-1!==e.qnum?this.shadecolor:this.getColorSolverAware(e.isShade(),1===e.qansBySolver)}},"Graphic@mrtile,archipelago":{hideHatena:!0,shadecolor:"#111111"},Encode:{decodePzpr:function(e){this.decodeNumber16()},encodePzpr:function(e){this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeCellQnumAns()},encodeData:function(){this.encodeCellQnumAns()}},AnsCheck:{checklist:["checkDoubleNumberInShade","checkUniqueShapes","checkNoNumberInShade","checkNumberAndShadeSize","checkNoChain"],checkNoNumberInShade:function(){this.checkAllBlock(this.board.sblkmgr,function(e){return e.isNum()},function(e,t,n,i){return 0!==n},"bkNoNum")},checkDoubleNumberInShade:function(){this.checkAllBlock(this.board.sblkmgr,function(e){return e.isNum()},function(e,t,n,i){return n<2},"bkNumGe2")},checkNumberAndShadeSize:function(){for(var e=0;e<this.board.cell.length;e++){var t=this.board.cell[e];if(t.isShade()&&!(t.qnum<0)){var n=t.sblk.clist;if(n.length!==t.qnum){if(this.failcode.add("bkSizeNe"),this.checkOnly)break;t.sblk.clist.seterr(1)}}}},checkNoChain:function(){for(var e=this.board.sblkmgr.components,t=0;t<e.length;t++){var n=e[t];if(n.clist.length===n.clist[0].blk8.clist.length){if(this.failcode.add("bkNoChain"),this.checkOnly)return;n.clist.seterr(1)}}},checkUniqueShapes:function(){for(var e=this.board.sblk8mgr.components,t=!0,n=0;n<e.length;n++)for(var i=e[n],r=i.blockset,s=0;s<r.length;s++)for(var l=s+1;l<r.length;l++){var c=r[s].clist.getQnumCell(),a=r[l].clist.getQnumCell();if(!c.isnull&&!a.isnull&&!(0<c.qnum&&c.qnum!==r[s].clist.length||0<a.qnum&&a.qnum!==r[l].clist.length||this.isDifferentShapeBlock(r[s],r[l]))){if(this.failcode.add("bsSameShape"),this.checkOnly)return;t&&(this.board.cell.setnoerr(),t=!1),i.clist.each(function(e){-1===e.error&&e.seterr(0)}),r[s].clist.seterr(1),r[l].clist.seterr(1)}}}},"AnsCheck@mrtile":{checklist:["checkNumberAndShadeSize","checkAdjacentExist","doneShadingDecided"],checkAdjacentExist:function(){for(var e=this.board,t=e.sblkmgr.components,n=0;n<t.length;n++)t[n].valid=!1;for(var i=0;i<e.cell.length;i++){var r,s=e.cell[i];s.bx>=e.maxbx-1||s.by>=e.maxby-1||(r=s.bx,s=s.by,2===(r=e.cellinside(r,s,r+2,s+2).filter(function(e){return e.isShade()})).length&&(s=r[0],r=r[1],s.bx===r.bx||s.by===r.by||s.sblk===r.sblk||this.isDifferentShapeBlock(s.sblk,r.sblk)||(s.sblk.valid=!0,r.sblk.valid=!0)))}for(n=0;n<t.length;n++)if(!t[n].valid){if(this.failcode.add("bkNoChain"),this.checkOnly)break;t[n].clist.seterr(1)}}},"AnsCheck@archipelago":{checklist:["checkNumberAndShadeSize","checkMaximumNumber","checkUniqueShapes","checkIsolated","doneShadingDecided"],checkMaximumNumber:function(){for(var e=this.board.sblk8mgr.components,t=0;t<e.length;t++){for(var n=e[t],i=n.blockset.length,r=0,s=0;0<=r&&s<n.clist.length;s++)var l=n.clist[s],r=l.isValidNum()&&l.sblk.clist.length!==l.getNum()?-1:Math.max(r,l.sblk.clist.length);if(-1!==r){for(s=0;s<n.blockset.length;s++)r=Math.max(r,n.blockset[s].clist.length);if(i<r){if(this.failcode.add("bsNoSequence"),this.checkOnly)return;n.clist.seterr(1)}}}},checkUniqueShapes:function(){for(var e=this.board.sblk8mgr.components,t=!0,n=0;n<e.length;n++)for(var i=e[n],r=i.blockset,s={},l=0;l<r.length;l++){var c=r[l].clist,a=c.getQnumCell().qnum;if(""+(a=a<0?c.length:a)in s){if(this.failcode.add("bsSameNum"),this.checkOnly)return;t&&(this.board.cell.setnoerr(),t=!1),i.clist.each(function(e){-1===e.error&&e.seterr(0)}),c.seterr(1),s[a].seterr(1)}else s[a]=c}},checkIsolated:function(){this.checkAllArea(this.board.sblk8mgr,function(e,t,n,i){return 1!==n||1<i},"bkNoChain")}}});
//# sourceMappingURL=chainedb.js.map