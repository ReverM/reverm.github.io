/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,n){"object"==typeof module&&module.exports?module.exports=[e,n]:pzpr.classmgr.makeCustom(e,n)}(["snakeegg","meidjuluk"],{MouseEvent:{mouseinput_auto:function(){this.puzzle.playmode?(this.mouseinputAutoPlay(),this.notInputted()&&this.mousestart&&this.inputqcmp()):this.puzzle.editmode&&(this.mousestart&&this.inputqnum(),this.mousestart&&this.getbank()&&("left"===this.btn?this.inputpiece():this.inputqcmp()))},inputpiece:function(){var e,n=this.getbank();n&&null!==n.index&&(e=this.cursor.getaddr(),this.cursor.bankpiece=n.index,e.draw())},inputqcmp:function(){var e=this.getbank();e&&(e.setQcmp(e.qcmp?0:1),e.draw())}},"MouseEvent@snakeegg":{use:!0,autoplay_func:"cell",inputModes:{edit:["number","circle-shade","info-blk"],play:["shade","unshade","number","info-blk"]},mouseinput:function(){"circle-shade"===this.inputMode?this.inputFixedNumber(0):this.common.mouseinput.call(this)}},"MouseEvent@meidjuluk":{autoplay_func:"border",inputModes:{edit:["number","empty","clear"],play:["number","border","subline"]}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(e){if(this.puzzle.playmode)return this.moveTCell(e);var n=this.cursor;if(null!==n.bankpiece){var t=this.cursor.getaddr(),i=!1,s=this.board.bank.pieces[n.bankpiece]||this.board.bank.addButton;switch(e){case"left":0<n.bankpiece&&(n.bankpiece--,i=!0);break;case"right":n.bankpiece<this.board.bank.pieces.length&&(n.bankpiece++,i=!0);break;case"up":var r,i=0===s.y?(n.bankpiece=null,r=(s.x+s.w/2)/(this.board.bank.width||1)*this.board.cols*2|1,n.bx=Math.max(n.minx,Math.min(r,n.maxx)),n.by=n.maxy,!0):this.moveBankVertical(-1);break;case"down":i=this.moveBankVertical(1)}return t.draw(),i}if("down"!==e||n.by!==n.maxy)return this.moveTCell(e);t=this.cursor.getaddr();if(n.bx===n.minx)n.bankpiece=0;else for(var c=n.bx/this.puzzle.painter.bankratio,u=0;;){if(!(s=this.board.bank.pieces[u])){n.bankpiece=this.board.bank.pieces.length;break}if(s.x<=c&&s.x+s.w>=c){n.bankpiece=u;break}if(0<s.y){n.bankpiece=u-1;break}u++}return t.draw(),!0},moveBankVertical:function(e){for(var n=this.cursor,t=this.board.bank.pieces[n.bankpiece]||this.board.bank.addButton,i=t.x+t.w/2,s=n.bankpiece+e;0<=s&&s<=this.board.bank.pieces.length;s+=e)if((t=this.board.bank.pieces[s]||this.board.bank.addButton).x<=i&&t.x+t.w>=i)return n.bankpiece=s,!0;return!1},keyinput:function(e){if(null!==this.cursor.bankpiece&&this.puzzle.editmode){var n=this.board.bank.pieces[this.cursor.bankpiece]||this.board.bank.addButton;if(("BS"===e||" "===e)&&-1===n.getNum())return n!==this.board.bank.addButton&&this.board.bank.setPiece(null,this.cursor.bankpiece),"BS"===e&&0<this.cursor.bankpiece&&this.cursor.bankpiece--,void n.draw();var t=this.getNewNumber(n,e,n.getNum());null!==t&&(n.setNum(t),(n=this.board.bank.pieces[this.cursor.bankpiece]).draw(),this.prev=n,this.cancelDefault=!0)}else this.key_inputqnum(e)}},Cell:{disableAnum:!0,minnum:function(){return this.puzzle.playmode?1:0},maxnum:function(){return this.puzzle.playmode?Math.max(1,this.board.bank.highestPiece):Math.min(999,this.board.rows*this.board.cols-("snakeegg"===this.pid?2:0))},enableSubNumberArray:!0,allowShade:function(){return 0===this.qnum||-1===this.qnum},allowUnshade:function(){return 0!==this.qnum}},"Cell@meidjuluk":{supportQnumAnum:!0,minnum:1,isNum:function(){return this.isEmpty()},noNum:function(){return this.isValid()}},Board:{getBankPiecesInGrid:function(){for(var e=[],n=(this.ublkmgr.enabled?this.ublkmgr:this.roommgr).components,t=0;t<n.length;t++){var i=n[t].clist;e.push([i.length+"",i])}return e}},"Board@meidjuluk":{hasborder:1},"Border@meidjuluk":{isQuesBorder:function(){return this.sidecell[0].isEmpty()||this.sidecell[1].isEmpty()},prehook:{qans:function(){return this.isQuesBorder()},qsub:function(){return this.isQuesBorder()}}},"AreaRoomGraph@meidjuluk":{enabled:!0},Bank:{enabled:!0,allowAdd:!0,defaultPreset:function(){return this.presets[0].constant},presets:[{name:"preset.nine",createOnly:!0,shortkey:"i",constant:["1","2","3","4","5","6","7","8","9"]},{name:"preset.range",func:"generateRange",field:{type:"number",value:9,min:0,max:999,size:4}},{name:"preset.copy_answer",func:"copyAnswer"},{name:"preset.zero",shortkey:"z",constant:[]}],generateRange:function(e){for(var n=Math.max(0,Math.min(+e,999)),t=(!isNaN(n)&&(0|n)===n||(n=0),new Array(n)),i=0;i<n;i++)t[i]=i+1+"";return t},copyAnswer:function(){var e=(this.board.ublkmgr.enabled?this.board.ublkmgr:this.board.roommgr).components.map(function(e){return e.clist.length+""});return e.sort(function(e,n){return e-n}),e},highestPiece:0,rebuildExtraData:function(){for(var e=0,n=0;n<this.pieces.length;n++)e=Math.max(e,this.pieces[n].getNum());this.highestPiece=e}},BankPiece:{num:null,deserialize:function(e){if(+e)this.num=+e;else{if(e)throw new Error("Invalid piece: "+typeof e+" "+e);this.num=-1}},serialize:function(){return 0<this.num?this.num+"":null},getmaxnum:function(){return 999},getminnum:function(){return 1},getNum:function(){return this.num},setNum:function(e){this.board.bank.setPiece(e,this.index)},disInputHatena:!0,w:10,h:10},BankEditOperation:{isBankEdit:!0,disInputHatena:!0,isModify:function(e){return!(!e.isBankEdit||e.index!==this.index||null!==this.old&&null!==this.num&&+e.num!=+this.old)&&(e.num=this.num,!0)}},BankAddButton:{w:10,h:10,getmaxnum:function(){return 999},getminnum:function(){return 1},getNum:function(){return-1},setNum:function(e){e<0||this.board.bank.setPiece(e,this.index)}},"AreaShadeGraph@snakeegg":{enabled:!0,coloring:!0},"AreaUnshadeGraph@snakeegg":{enabled:!0},Graphic:{bankratio:.1,bankVerticalOffset:.25,paint:function(){this.drawBGCells(),"meidjuluk"===this.pid?this.drawDashedGrid():(this.drawShadedCells(),this.drawGrid()),this.drawTargetSubNumber(!0),"meidjuluk"===this.pid&&(this.drawBorders(),this.drawBorderQsubs()),this.drawSubNumbers(),this.drawQuesNumbers(),"snakeegg"===this.pid&&this.drawCircles(),this.drawChassis(),this.drawBank(),this.drawTarget()},getNumberTextCore:function(e){return 0<e?""+e:-2===e?"?":""},drawBankPiece:function(e,n,t){if(!n)return e.vid="pb_c"+t,e.vhide(),e.vid="pb_n"+t,void e.vhide();var i=.1*this.cw*(n.x+5),s=.1*this.ch*n.y,t=(s+=(this.board.rows+.75)*this.ch,e.vid="pb_c"+t,e.strokeStyle=this.getBankPieceColor(n),e.fillStyle=null,e.shapeCircle(i,s,.4*this.cw),e.vid="pb_n"+t,e.strokeStyle=null,e.fillStyle=this.getBankPieceColor(n),0<=n.num?""+n.num:"");this.disptext(t,i,s,{ratio:.65})},drawTarget:function(){this.drawCursor(!0,this.puzzle.editmode||0<=this.puzzle.mouse.inputMode.indexOf("number"))}},"Graphic@meidjuluk":{getBGCellColor:function(e){return 1===(e.error||e.qinfo)?this.errbcolor1:e.isEmpty()?"black":null},getBorderColor:function(e){return e.isQuesBorder()?"black":this.getBorderColor_qans(e)}},"Graphic@snakeegg":{irowakeblk:!0,shadecolor:"rgb(80, 80, 80)",bgcellcolor_func:"qsub1",circlestrokecolor_func:"null",getCircleFillColor:function(e){return 0===e.qnum?this.quescolor:null}},Encode:{decodePzpr:function(e){"/"!==this.outbstr[0]&&this.decodeNumber10or16(),this.decodePieceBank()},encodePzpr:function(e){this.encodeNumber10or16(),this.encodePieceBank()},decodePieceBank:function(){"="===this.outbstr[this.outbstr.length-1]&&(this.outbstr=this.outbstr.substring(0,this.outbstr.length-1));var e,n=+this.outbstr.substr(2);"//"!==this.outbstr.substr(0,2)||isNaN(n)?this.common.decodePieceBank.call(this):((e=this.board.bank).initialize(e.generateRange(n)),this.outbstr="")},encodePieceBank:function(){var e=this.board.bank,n=e.pieces.length,t=!1;if(0<n&&n<=999&&9!==n)for(var t=!0,i=0;i<n&&t;i++)e.pieces[i].num!==i+1&&(t=!1);t?this.outbstr+="//"+n:this.common.encodePieceBank.call(this)}},"Encode@meidjuluk":{decodePzpr:function(){var t=this.board;"/"!==this.outbstr[0]&&this.genericDecodeNumber16(t.cell.length,function(e,n){0===n?t.cell[e].ques=7:t.cell[e].qnum=n}),this.decodePieceBank()},encodePzpr:function(e){var n=this.board;this.genericEncodeNumber16(n.cell.length,function(e){return n.cell[e].isEmpty()?0:n.cell[e].qnum}),this.encodePieceBank()}},FileIO:{decodeData:function(){this.decodeCellQnum(),"meidjuluk"===this.pid?this.decodeBorderAns():this.decodeCellAns(),this.decodePieceBank(),this.decodePieceBankQcmp(),this.decodeCellSnum()},encodeData:function(){this.encodeCellQnum(),"meidjuluk"===this.pid?this.encodeBorderAns():this.encodeCellAns(),this.encodePieceBank(),this.encodePieceBankQcmp(),this.encodeCellSnum()},decodeCellQnum:function(){this.decodeCell(function(e,n){e.ques=0,"*"===n?e.ques=7:"-"===n?e.qnum=-2:"."!==n&&(e.qnum=+n)})},encodeCellQnum:function(){this.encodeCell(function(e){return 7===e.ques?"* ":-2===e.qnum?"- ":0<=e.qnum?e.qnum+" ":". "})}},"AnsCheck@snakeegg":{checklist:["checkShadeCellExist+","check2x2ShadeSection","checkShadeLoop","checkShadeBranch","checkShadeOnCircle","checkNumberSize","checkCircleEndpoint","checkBankPiecesAvailable","checkBankPiecesInvalid","checkConnectShade","checkBankPiecesUsed","doneShadingDecided"],check2x2ShadeSection:function(){this.check2x2Block(function(e){return e.isShade()&&4!==e.sblk.clist.length},"cs2x2")},checkShadeBranch:function(){this.checkAllCell(function(e){return e.isShade()&&2<e.countDir4Cell(function(e){return e.isShade()})},"shBranch")},checkNumberSize:function(){this.checkAllCell(function(e){return 0<e.qnum&&(!e.ublk||e.ublk.clist.length!==e.qnum)},"bkSizeNe")},checkShadeOnCircle:function(){this.checkAllCell(function(e){return 0===e.qnum&&!e.isShade()},"circleUnshade")},checkCircleEndpoint:function(){this.checkAllCell(function(e){return!!e.isShade()&&(0===e.qnum&&1!==e.countDir4Cell(function(e){return e.isShade()}))},"shEndpoint")},checkShadeLoop:function(){var e=this.board.sblkmgr.components;1===e.length&&0<(e=e[0]).circuits&&(this.failcode.add("shLoop"),this.checkOnly||e.clist.seterr(1))}},"AnsCheck@meidjuluk":{checklist:["checkDifferentNumberInRoom","checkSmallArea","checkNumberDivisions","checkBankPiecesAvailable","checkBankPiecesInvalid","checkBankPiecesUsed"],isDifferentNumberInClist:function(e){return e.length>this.board.bank.highestPiece||this.isIndividualObject(e,function(e){return e.getNum()})},checkSmallArea:function(){this.checkAllCell(function(e){return 0<e.qnum&&e.qnum>e.room.clist.length},"bkSizeLt")},checkNumberDivisions:function(){var n=this.board.bank.highestPiece;this.checkAllCell(function(e){return 0<e.qnum&&e.room.clist.length<=n&&e.room.clist.length%e.qnum},"bkNumDivisor")}},FailCode:{shBranch:"shBranch.snake",shEndpoint:"shEndpoint.snake",shLoop:"shLoop.snake",bkSizeLt:"bkSizeLt.fillomino"}});
//# sourceMappingURL=snakeegg.js.map