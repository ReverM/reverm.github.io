/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,i){"object"==typeof module&&module.exports?module.exports=[t,i]:pzpr.classmgr.makeCustom(t,i)}(["crossstitch"],{MouseEvent:{use:!0,inputModes:{edit:["number","shade","undef","direc"],play:["line","completion","peke","dot","subcircle","info-line"]},mouseinput_auto:function(){var t,i=this.puzzle;i.playmode?this.mousestart||this.mousemove?this.inputslash("right"===this.btn):this.mouseend&&this.notInputted()&&(t=this.getcell(),!this.firstCell.isnull&&t!==this.firstCell||(this.getpos(.25).getx().isnull?-1!==t.qnum?this.inputqcmp():(this.mouseCell=this.board.emptycell,this.inputFixedQsub(1)):this.inputdot())):i.editmode&&(this.mousestart||this.mousemove?this.inputdirec():this.mouseend&&this.notInputted()&&this.inputqnum())},inputFixedQsub:function(t){var i=this.getcell();i.isnull||i===this.mouseCell||(null===this.inputData&&(this.inputData=!(i.qsub&t)),this.inputData?i.setQsub(i.qsub|t):i.setQsub(i.qsub&~t),i.draw(),this.mouseCell=i)},inputqnum_main:function(t){var i=[-1,-3,-2,0],e=i.indexOf(t.qnum),i=-1===e?0:"left"===this.btn?i[e+1]:i[e-1];i?this.inputFixedNumber(i):this.common.inputqnum_main.call(this,t)},inputLine:function(){this.mousestart||this.mousemove?this.inputslash():this.mouseend&&this.notInputted()&&this.clickslash()},inputShade:function(){this.inputFixedNumber(-3)},toggleslash:function(t){switch(t.qans){case 31:t.setQans("left"===this.btn?0:33);break;case 32:t.setQans("left"===this.btn?33:0);break;case 33:t.setQans("left"===this.btn?32:31);break;default:t.setQans("left"===this.btn?31:32)}},cycleslash:function(t){t.setQans(("left"===this.btn?{0:31,31:32,32:33,33:0}:{0:33,31:0,32:31,33:32})[t.qans])},inputslash:function(t){var i,e,s,n,r,o=this.getcell();o.isnull||(this.mouseCell!==o?this.firstPoint.set(this.inputPoint):null!==this.firstPoint.bx&&(i=null,(e=0)<(s=this.inputPoint.bx-this.firstPoint.bx)*(n=this.inputPoint.by-this.firstPoint.by)&&.5<=Math.abs(s)&&.5<=Math.abs(n)?(i=!0,e=o.parity()?2:1):s*n<0&&.5<=Math.abs(s)&&.5<=Math.abs(n)&&(i=!1,e=o.parity()?1:2),null!==(i=null!==this.inputData&&Math.abs(this.inputData)!==e?null:i)&&(t?(r=i?2:4,null===this.inputData&&(this.inputData=o.qsub&r?-e:e),0<this.inputData?o.setQsub(o.qsub|r):o.setQsub(o.qsub&~r)):(r=i?31:32,null===this.inputData&&(this.inputData=r===o.qans||33===o.qans?-e:e),this.inputData<0?r=r===o.qans?0:33===o.qans?31===r?32:31:null:0!==o.qans&&o.qans!==r&&(r=33),null!==r&&o.setQans(r)),o.draw(),this.firstPoint.reset())),this.mouseCell=o)},clickslash:function(){var t=this.getcell();if(t.isnull||-1!==t.qnum)return!1;var i=this.puzzle.getConfig("use");return 1===i?this.toggleslash(t):2===i&&this.cycleslash(t),t.drawaround(),!0},inputpeke:function(){this.inputslash(!0)},inputqcmp:function(){var t=this.getcell();t.isnull||-1===t.qnum||-3===t.qnum||(t.setQcmp(+!t.qcmp),t.draw(),this.mousereset())},mouseinput_other:function(){"dot"===this.inputMode&&this.inputdot()},inputdot:function(){var t,i=this.getpos(.25);this.prevPos.equals(i)||(t=i.getDot(),this.prevPos=i,null!==t&&(null===this.inputData&&("left"===this.btn?this.inputData={0:1,1:2,2:0}[t.getDot()]:this.inputData={0:2,1:0,2:1}[t.getDot()]),t.setDot(this.inputData),t.draw()))},dispInfoLine:function(){var t=this.getcell();this.mousereset(),t.isnull||0===t.qans||33===t.qans||null===t.path&&null===t.path2||(this.board.cell.setinfo(-1),t.path?t.path.setedgeinfo(101):t.path2.setedgeinfo(102),this.board.hasinfo=!0,this.puzzle.redraw())}},KeyEvent:{enablemake:!0,keyinput:function(t){var i;this.key_inputdirec(t)||(i=this.cursor.getc(),"q"===t||"q1"===t?(i.setQnum(-3!==i.qnum?-3:-1),(this.prev=i).draw()):"w2"===t?(i.setQdir(i.NDIR),(this.prev=i).draw()):this.key_inputqnum(t))}},Cell:{parity:function(){return 0==(this.bx+this.by&2)},getDirClist:function(){if(0===this.qdir)return null;for(var t=this.getaddr(),i=this.qdir,e=new this.klass.CellList;;){t.movedir(i,2);var s=t.getc();if(-1!==s.qnum||s.isnull)break;e.add(s)}return e},maxnum:function(){return Math.max(4,Math.max(this.board.cols,this.board.rows)>>1)},prehook:{qans:function(t){return t&&-1!==this.qnum},qsub:function(t){return t&&-1!==this.qnum}},posthook:{qnum:function(t){-1!==t&&(this.setQans(0),this.setQsub(0))},qdir:function(t){t!==this.NDIR&&-3===this.qnum&&this.setQnum(-2)}},minnum:0,setinfo:function(t){this.qinfo=this.calcInfo(t,this.qinfo,2)},seterr:function(t){this.board.isenableSetError()&&(this.error=this.calcInfo(t,this.error,1))},calcInfo:function(t,i,e){switch(t){case 31:return i===(8|e)||i===e?e:4|e;case 32:return i===(4|e)||i===e?e:8|e;case 101:case 102:return(i=i<=0?12|e:i)&~(31==(102===t===this.parity()?31:32)?8:4);default:return t}}},Cross:{l2cnt:0,counts:function(){return this.lcnt+this.l2cnt}},Dot:{getDot:function(){return"cross"===this.piece.group&&0===this.piece.counts()?this.piece.qsub:0},setDot:function(t){"cross"===this.piece.group&&(this.puzzle.opemgr.disCombine=!0,this.piece.setQsub(t),this.puzzle.opemgr.disCombine=!1)},getTrial:function(){return this.piece.trial}},Board:{hasdots:2,addExtraInfo:function(){this.line2graph=this.addInfoList(this.klass.Line2Graph)}},BoardExec:{adjustBoardData:function(t,i){if(t&this.TURNFLIP)for(var e=this.board.cell,s=0;s<e.length;s++){var n=e[s];n.qans={0:0,31:32,32:31,33:33}[n.qans]}this.adjustNumberArrow(t,i)}},LineGraph:{enabled:!0,relation:{"cell.qans":"link"},pointgroup:"cross",linkgroup:"cell",parity:!0,rebuild2:function(){for(var t=this.board.cell,i=0;i<t.length;i++)this.setSideObjFromParity(t[i]);this.common.rebuild2.call(this)},isedgevalidbylinkobj:function(t){switch(t.qans){case 31:return t.parity()!==this.parity;case 32:return t.parity()===this.parity;case 33:return!0;default:return!1}},getComponentRefs:function(t){return t.path},setEdgeByLinkObj:function(t){null!==this.getComponentRefs(t)&&(this.setSideObjFromParity(t),this.incdecLineCount(t,!1),this.removeEdgeByLinkObj(t)),this.isedgevalidbylinkobj(t)&&(this.setSideObjFromParity(t),this.incdecLineCount(t,!0),this.addEdgeByLinkObj(t))},setSideObjFromParity:function(t){t.parity()===this.parity?t.sideobj=[t.relcross(-1,1),t.relcross(1,-1)]:t.sideobj=[t.relcross(-1,-1),t.relcross(1,1)]}},"Line2Graph:LineGraph":{parity:!1,countprop:"l2cnt",getComponentRefs:function(t){return t.path2},setComponentRefs:function(t,i){t.path2=i},getObjNodeList:function(t){return t.path2nodes},resetObjNodeList:function(t){t.path2nodes=[]}},Graphic:{irowake:!0,margin:.5,gridcolor_type:"DLIGHT",qcmpcolor:"rgb(127,127,127)",mb2color:"rgb(127,127,255)",errcolor1:"red",fontsizeratio:.65,paint:function(){this.drawBGCells(),this.drawArrowNumbers(),this.drawCircles(),this.drawMBs(),this.drawSlashes(),this.drawBaseMarks(),this.drawDots(),this.drawTarget()},drawMBs:function(){for(var t=this.vinc("cell_mb","auto",!0),i=.35*this.cw,e=.8*i,s=this.range.cells,n=.5*Math.PI,r=Math.PI,o=1.5*Math.PI,c=0;c<s.length;c++){var a,h,u,l,d,b,f=s[c];1&f.qsub?(a=f.bx*this.bw,h=f.by*this.bh,t.vid="c_MB_"+f.id,t.lineWidth=1,t.strokeStyle=f.trial?"rgb(192, 192, 192)":this.mbcolor,t.strokeCircle(a,h,i)):(t.vid="c_MB_"+f.id,t.vhide()),2&f.qsub?(u=(f.bx-1)*this.bw,l=(f.by-1)*this.bh,d=(f.bx+1)*this.bw,b=(f.by+1)*this.bh,t.vid="c_ca_"+f.id,t.lineWidth=1.5,t.strokeStyle=f.trial?"rgb(192, 192, 192)":this.mb2color,t.beginPath(),t.arc(u,l,e,0,n,!1),t.stroke(),t.vid="c_cc_"+f.id,t.beginPath(),t.arc(d,b,e,o,r,!0),t.stroke()):(t.vid="c_ca_"+f.id,t.vhide(),t.vid="c_cc_"+f.id,t.vhide()),4&f.qsub?(u=(f.bx+1)*this.bw,l=(f.by-1)*this.bh,d=(f.bx-1)*this.bw,b=(f.by+1)*this.bh,t.vid="c_cb_"+f.id,t.lineWidth=1.5,t.strokeStyle=f.trial?"rgb(192, 192, 192)":this.mb2color,t.beginPath(),t.arc(u,l,e,r,n,!0),t.stroke(),t.vid="c_cd_"+f.id,t.beginPath(),t.arc(d,b,e,o,0,!1),t.stroke()):(t.vid="c_cb_"+f.id,t.vhide(),t.vid="c_cd_"+f.id,t.vhide())}},drawBaseMarks:function(){for(var t=this.vinc("cross_mark","auto",!0),i=(t.strokeStyle=this.quescolor,t.fillStyle=this.quescolor,t.lineWidth=1,this.cw/10),e=this.range.crosses,s=0;s<e.length;s++){var n=e[s],r=(t.vid="x_cm_"+n.id,n.bx*this.bw),o=n.by*this.bh;n.bx+n.by&2?(t.beginPath(),t.moveTo(r-i,o),t.lineTo(r+i,o),t.moveTo(r,o-i),t.lineTo(r,o+i),t.closePath(),t.stroke()):t.fillCircle(r,o,i/2)}},repaintLines:function(t){this.range.cells=t,this.drawSlashes()},getBGCellColor:function(t){return-1!==t.qnum?1===t.error?"rgb(192, 0, 0)":"black":-2===t.error||0===t.qans&&0<t.error?this.errbcolor1:null},getCircleStrokeColor:function(t){return-1===t.qnum||-3===t.qnum||4<t.qnum||t.qdir!==t.NDIR?null:this.getQuesNumberColor(t)},getCircleFillColor:function(t){return null},getQuesNumberColor:function(t){return 1===t.qcmp?this.qcmpcolor:this.fontShadecolor},getDotFillColor:function(t){return 1===t.getDot()?t.getTrial()?this.trialcolor:this.pekecolor:2===t.getDot()?"white":null},getDotOutlineColor:function(t){return 2===t.getDot()?t.getTrial()?this.trialcolor:this.pekecolor:null},getDotRadius:function(t){return.13}},Encode:{decodePzpr:function(t){this.decodeArrowNumber16()},encodePzpr:function(t){this.encodeArrowNumber16()}},FileIO:{decodeData:function(){this.decodeCellDirecQnum(),this.decodeCell(function(t,i){110<i.charCodeAt(0)&&i.charCodeAt(0)<=117&&(t.qsub=i.charCodeAt(0)-110,i=i.substr(1)),"c"===i?t.qcmp=1:+i&&(t.qans=+i+30)}),this.decodeCross(function(t,i){t.qsub=+i})},encodeData:function(){this.encodeCellDirecQnum(),this.encodeCell(function(t){var i="";return 0<t.qsub&&(i+=String.fromCharCode(110+t.qsub)),30<t.qans?i+=""+t.qans-30:t.qcmp?i+="c":""===i&&(i+="."),i+" "}),this.encodeCross(function(t){return t.qsub+" "})}},AnsCheck:{checklist:["checkLineOnShadeCell","checkNumberHasArrow","checkBranchLine","checkCrossLine","checkAdjacentCrossing","checkCircledNumber","checkCircledHatena","checkArrowNumber","checkArrowHatena","checkDeadendLine+","checkTwoLoops"],checkLineOnShadeCell:function(){this.checkAllCell(function(t){return-1!==t.qnum&&30<t.qans},"lnOnShade")},checkLineCount:function(t,i){for(var e=this.board,s=0;s<e.cross.length;s++){var n=e.cross[s];if(t===n.counts()){if(this.failcode.add(i),this.checkOnly)break;this.board.cell.setnoerr();for(var r=-1;r<=1;r+=2){var o=e.getc(n.bx+r,n.by+r),o=(31!==o.qans&&33!==o.qans||o.seterr(31),e.getc(n.bx-r,n.by+r));32!==o.qans&&33!==o.qans||o.seterr(32)}}}},checkNumberHasArrow:function(){this.checkAllCell(function(t){return 4<t.qnum&&t.qdir===t.NDIR},"anNoArrow")},checkAdjacentCrossing:function(){this.checkSideCell(function(t,i){return 33===t.qans&&33===i.qans},"cxAdjacent"),"cxAdjacent"===this.failcode.lastcode&&this.board.cell.setnoerr()},checkCircledNumber:function(){var i=this.board;this.checkAllCell(function(t){return!(t.qdir!==t.NDIR||t.qnum<0)&&i.crossinside(t.bx-1,t.by-1,t.bx+1,t.by+1).filter(function(t){return 0<t.counts()}).length!==t.qnum},"nmCircleNe")},checkCircledHatena:function(){var i=this.board;this.checkAllCell(function(t){return t.qdir===t.NDIR&&-2===t.qnum&&!i.crossinside(t.bx-1,t.by-1,t.bx+1,t.by+1).some(function(t){return 0<t.counts()})},"nmHatenaNe")},checkTwoLoops:function(){var t=this.board,i=t.linegraph.components,e=t.line2graph.components;i.length+e.length!==2&&(this.failcode.add("lnPlLoop"),t.cell.setnoerr(),1<i.length?i[0].setedgeerr(101):1<e.length&&e[0].setedgeerr(102))},checkArrowNumber:function(){for(var t=this.board,i=0;i<t.cell.length;i++){var e=t.cell[i];if(!(e.qnum<0)){var s=e.getDirClist(),n=this.countCrossing(s);if(!(n<0||e.qnum===n)){if(this.failcode.add("anNumberNe"),this.checkOnly)break;e.seterr(1),s.seterr(-2)}}}},checkArrowHatena:function(){for(var t=this.board,i=0;i<t.cell.length;i++){var e=t.cell[i];if(-2===e.qnum){var s=e.getDirClist(),n=this.countCrossing(s);if(0===n){if(this.failcode.add("anHatenaNe"),this.checkOnly)break;e.seterr(1),s.seterr(-2)}}}},countCrossing:function(t){return t?t.filter(function(t){return 33===t.qans}).length:-1}}});
//# sourceMappingURL=crossstitch.js.map