/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,i){"object"==typeof module&&module.exports?module.exports=[e,i]:pzpr.classmgr.makeCustom(e,i)}(["shimaguni","chocona","stostone","hinge","heyablock","cocktail","martini","nuritwin"],{MouseEvent:{use:!0,inputModes:{edit:["border","number","clear"],play:["shade","unshade"]},autoedit_func:"areanum",autoplay_func:"cell"},"MouseEvent@shimaguni":{inputModes:{edit:["border","number","clear"],play:["shade","unshade","number"]}},"MouseEvent@cocktail,nuritwin":{inputModes:{edit:["border","number","clear","info-blk"],play:["shade","unshade","info-blk"]}},"MouseEvent@cocktail,martini#2":{dispInfoBlk:function(){var e=this.getcell();this.mousereset(),!e.isnull&&e.isShade()&&(e.blk8.clist.setinfo(1),this.board.hasinfo=!0,this.puzzle.redraw())}},"MouseEvent@martini":{inputModes:{edit:["border","number","circle-shade","circle-unshade","clear","info-blk"],play:["shade","unshade","info-blk"]},mouseinput:function(){switch(this.inputMode){case"circle-unshade":return this.inputFixedNumber(-2);case"circle-shade":return this.inputFixedNumber(0);default:return this.common.mouseinput.call(this)}}},KeyEvent:{enablemake:!0},"KeyEvent@shimaguni":{enableplay:!0,keyinput:function(e){!this.puzzle.editmode&&-1===this.puzzle.mouse.inputMode.indexOf("number")||this.key_inputqnum(e)}},"KeyEvent@stostone":{keyDispInfo:function(e){return"x"!==e||(this.board.operate(this.keydown?"drop":"resetpos"),!1)}},Cell:{maxnum:function(){return Math.min(999,this.room.clist.length)}},"Cell@nuritwin":{maxnum:function(){var e=this.room.clist.length-1>>1;return Math.max(1,Math.min(999,e))}},"Cell@shimaguni":{enableSubNumberArray:!0,disableAnum:!0},"Cell@chocona,hinge,heyablock,cocktail":{minnum:0},"Cell@martini":{minnum:0,maxnum:function(){return this.board.rows*this.board.cols},allowShade:function(){return-1===this.qnum||0===this.qnum},allowUnshade:function(){return 0!==this.qnum}},"Cell@stostone":{getFallableLength:function(){if(!this.base.stone)return 0;for(var e=this,i=0;!e.isnull&&!((e=e.relcell(0,2)).isnull||e.base.stone&&this.base.stone!==e.base.stone);)i++;return i}},"Border@hinge":{isHinge:function(){return 1===this.ques&&this.sidecell[0].isShade()&&this.sidecell[1].isShade()},posthook:{ques:function(e){for(var i=0;i<=1;i++)this.sidecell[i].sblk&&(this.sidecell[i].sblk.hinge=null)}}},Board:{hasborder:1},"Board@shimaguni,stostone,heyablock,cocktail,martini,nuritwin":{addExtraInfo:function(){this.stonegraph=this.addInfoList(this.klass.AreaStoneGraph),"cocktail"!==this.pid&&"martini"!==this.pid||(this.sblk8mgr=this.addInfoList(this.klass.AreaShade8Graph))}},"Board@stostone":{cols:8,rows:8,falling:!1,fallstate:0,initBoardSize:function(e,i){this.common.initBoardSize.call(this,e,i),this.falling=!1,this.fallstate=0},errclear:function(){return this.falling=!1,this.common.errclear.call(this)},operate:function(e){switch(e){case"drop":this.drop(),this.falling=!0,this.hasinfo=!0,this.puzzle.redraw();break;case"resetpos":this.puzzle.errclear();break;default:this.common.operate.call(this,e)}},resetpos:function(){for(var e=0;e<this.cell.length;e++){var i=this.cell[e];i.base=i.destination=i.isShade()?i:this.emptycell}},drop:function(){if(1!==this.fallstate){this.resetpos();for(var e=!0,i=this.stonegraph.components;e;)for(var e=!1,t=i.length-1;0<=t;--t)0<i[t].clist.fall()&&(e=!0);this.fallstate=1}}},"BoardExec@stostone":{allowedOperations:function(e){return e?this.FLIPX|this.FLIPY:this.ALLOWALL}},"CellList@stostone":{fall:function(){for(var e=this.board.rows,i=0;i<this.length;i++)if(this[i].stone!==this[i].relcell(0,2).stone){var t=this[i].destination.getFallableLength();if(0===(e=t<e?t:e))return 0}for(var n=e+(Math.abs(this[0].destination.by-this[0].by)>>1),i=0;i<this.length;i++)this[i].destination.base=this.board.emptycell;for(i=0;i<this.length;i++){var o=this[i].relcell(0,2*n);(this[i].destination=o).base=this[i]}return e}},"BorderList@hinge":{applyTopLines:function(){for(var e=0;e<this.length;e++){var i,t=this[e];t.isHinge()?(i=t.isvert?this.board.getb(t.bx,t.by-2):this.board.getb(t.bx-2,t.by)).isHinge()?t.topline=i.topline:t.topline=t:t.topline=null}}},"AreaShadeGraph@chocona":{enabled:!0},"AreaShadeGraph@nuritwin":{enabled:!0,coloring:!0},"AreaShadeGraph@hinge":{enabled:!0,setExtraData:function(e){e.clist=new this.klass.CellList(e.getnodeobjs()),e.hinge=null}},"AreaStoneGraph:AreaShadeGraph@shimaguni,stostone,heyablock,cocktail,martini,nuritwin":{enabled:!0,relation:{"cell.qans":"node","border.ques":"separator"},setComponentRefs:function(e,i){e.stone=i},getObjNodeList:function(e){return e.stonenodes},resetObjNodeList:function(e){e.stonenodes=[]},isedgevalidbylinkobj:function(e){return!e.isBorder()}},"AreaStoneGraph@stostone":{coloring:!0},"AreaUnshadeGraph@heyablock,martini":{enabled:!0},"AreaUnshadeGraph@martini#1":{setExtraData:function(e){this.common.setExtraData.call(this,e),e.circlecount=e.clist.filter(function(e){return 0!==e.qnum&&-1!==e.qnum}).length}},AreaRoomGraph:{enabled:!0,hastop:!0},"AreaRoomGraph@martini":{hastop:!1},"AreaShade8Graph:AreaShadeGraph@cocktail,martini":{enabled:!0,setComponentRefs:function(e,i){e.blk8=i},getObjNodeList:function(e){return e.blk8nodes},resetObjNodeList:function(e){e.blk8nodes=[]},getSideObjByNodeObj:function(e){for(var i=e.getdir8clist(),t=[],n=0;n<i.length;n++){var o=i[n][0];this.isnodevalid(o)&&t.push(o)}return t}},Graphic:{gridcolor_type:"LIGHT",enablebcolor:!0,bgcellcolor_func:"qsub1",subcolor:"rgb(40, 40, 80)",paint:function(){this.drawBGCells(),"nuritwin"!==this.pid&&this.drawGrid(),"stostone"!==this.pid&&"nuritwin"!==this.pid||this.drawDotCells_stostone(),this.drawShadedCells(),"nuritwin"===this.pid&&this.drawGrid(),this.drawTargetSubNumber(!0),"martini"===this.pid&&this.drawCircles(),this.drawQuesNumbers(),this.puzzle.klass.Cell.prototype.enableSubNumberArray&&this.drawSubNumbers(!0),this.drawBorders(),"stostone"===this.pid&&this.drawNarrowBorders(),this.drawChassis(),this.drawBoxBorders(!1),this.drawTarget()}},"Graphic@shimaguni":{bcolor:"rgb(191, 191, 255)",drawTarget:function(){this.drawCursor(!0,this.puzzle.editmode||0<=this.puzzle.mouse.inputMode.indexOf("number"))}},"Graphic@stostone,nuritwin#1":{irowakeblk:!0,bgcellcolor_func:"error1",bcolor:"rgb(80, 204, 80)",minYdeg:.08,maxYdeg:.5,drawDotCells_stostone:function(){for(var e=this.vinc("cell_dot","auto",!0),i=.2*this.cw,t=this.range.cells,n=0;n<t.length;n++){var o=t[n];e.vid="c_dot_"+o.id,1===o.qsub||1===o.qsubBySolver?(e.fillStyle=o.trial?this.trialcolor:this.getColorSolverAware(1===o.qsub,1===o.qsubBySolver,this.bcolor),e.fillCircle(o.bx*this.bw,o.by*this.bh,i)):e.vhide()}}},"Graphic@stostone":{enablebcolor:!1,qanscolor:"black",drawNarrowBorders:function(){var e;this.vinc("border_narrow","crispEdges",!0),this.board.falling&&(e=this.getBorderColor,this.getBorderColor=this.getNarrowBorderColor,this.lw/=2,this.lm/=2,this.drawBorders_common("b_bd2_"),this.getBorderColor=e,this.lw*=2,this.lm*=2)},getShadedCellColor:function(e){var i=e;if(1!==(e=this.board.falling?e.base:e).qans&&1!==e.qansBySolver)return null;i=i.error||i.qinfo;return 1===i?this.errcolor1:2===i?this.errcolor2:e.trial?this.trialcolor:this.puzzle.execConfig("irowakeblk")?e.stone.color:this.getColorSolverAware(1===e.qans,1===e.qansBySolver,this.shadecolor)},getBorderColor:function(e){if(this.board.falling){var i=e.sidecell[0].base.stone,t=e.sidecell[1].base.stone;if(i||t)return null}return e.isBorder()?this.quescolor:null},getNarrowBorderColor:function(e){return e.sidecell[0].base.stone!==e.sidecell[1].base.stone?"white":null},getQuesNumberText:function(e){return this.board.falling&&e.base.stone?"":this.common.getQuesNumberText.call(this,e)},getQuesNumberColor:function(e){return this.board.falling&&(e=e.base),this.common.getQuesNumberColor_mixed.call(this,e)}},"Graphic@martini":{hideHatena:!0,circleratio:[.35,.3],textoption:{ratio:.5},getNumberText:function(e,i){return i<=0?"":this.getNumberTextCore(i)},getCircleFillColor:function(e){return 0===e.qnum?this.getCircleStrokeColor(e):this.getCircleFillColor_qnum(e)}},"Graphic@martini,nuritwin#2":{shadecolor:"#444444"},Encode:{decodePzpr:function(e){this.decodeBorder(),this.decodeRoomNumber16()},encodePzpr:function(e){this.encodeBorder(),this.encodeRoomNumber16()}},"Encode@martini":{decodePzpr:function(e){this.decodeBorder(),this.decodeNumber16()},encodePzpr:function(e){this.encodeBorder(),this.encodeNumber16()}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeCellQnum(),this.decodeCellAns(),this.puzzle.klass.Cell.prototype.enableSubNumberArray&&this.decodeCellSnum()},encodeData:function(){this.encodeAreaRoom(),this.encodeCellQnum(),this.encodeCellAns(),this.puzzle.klass.Cell.prototype.enableSubNumberArray&&this.encodeCellSnum()}},"AnsCheck@shimaguni,stostone,heyablock#1":{checklist:["checkSideAreaShadeCell","checkSeqBlocksInRoom","checkFallenBlock@stostone","checkConnectUnshade@heyablock","checkShadeCellCount","checkSideAreaLandSide@shimaguni","checkRemainingSpace@stostone","checkCountinuousUnshadeCell@heyablock","checkNoShadeCellInArea","doneShadingDecided@heyablock"]},"AnsCheck@cocktail,martini#1":{checklist:["checkUnshadeOnCircle@martini","checkSideAreaShadeCell","checkShadeOnCircle@martini","checkUnderCircleCount@martini","check2x2ShadeCell@cocktail","checkSeqBlocksInRoom","checkShadeCellCount@!martini","checkOverCircleCount@martini","checkConnect8Shade"]},"AnsCheck@chocona#1":{checklist:["checkShadeCellExist","checkShadeRect","checkShadeCellCount"]},"AnsCheck@hinge#1":{checklist:["checkShadeCellExist","checkCrossRegionGt","checkSplit","checkMirrorShape","checkCrossRegionLt","checkShadeCellCount"]},"AnsCheck@nuritwin#1":{checklist:["check2x2ShadeCell","checkShadeBlockSize","checkSizesEqual","checkTwoBlocks","checkConnectShade","checkNoShadeCellInArea","doneShadingDecided"]},"AnsCheck@shimaguni,stostone,heyablock,cocktail,martini":{checkSideAreaShadeCell:function(){this.checkSideAreaCell(function(e,i){return e.isShade()&&i.isShade()},!0,"cbShade")},checkSideAreaLandSide:function(){this.checkSideAreaSize(this.board.roommgr,function(e){return e.clist.filter(function(e){return e.isShade()}).length},"bsEqShade")},checkSeqBlocksInRoom:function(){for(var e=this.board.roommgr.components,i=0;i<e.length;i++){for(var t=e[i].clist,n=null,o=!0,r=0;r<t.length;r++)if(null!==t[r].stone&&t[r].stone!==n){if(null!==n){o=!1;break}n=t[r].stone}if(!o){if(this.failcode.add("bkShadeDivide"),this.checkOnly)break;t.seterr(1)}}}},"AnsCheck@stostone":{checkAns:function(e){this.board.drop(),this.common.checkAns.call(this,e)},resetCache:function(){this.common.resetCache.call(this),this.board.fallstate=0},checkFallenBlock:function(){for(var e=this.board,i=0;i<e.cell.length;i++){var t=e.cell[i];if(!(t.by>e.maxby/2||t.base.isnull)){if(this.failcode.add("csUpper"),this.checkOnly)break;e.falling=!0,t.seterr(1)}}},checkRemainingSpace:function(){for(var e=this.board,i=0;i<e.cell.length;i++){var t=e.cell[i];if(!(t.by<e.maxby/2)&&t.base.isnull){if(this.failcode.add("cuLower"),this.checkOnly)break;e.falling=!0,t.base.isnull&&t.seterr(1)}}}},"AnsCheck@chocona":{checkShadeRect:function(){this.checkAllArea(this.board.sblkmgr,function(e,i,t,n){return e*i===t},"csNotRect")}},"AnsCheck@hinge":{getHingeData:function(i){if(i.hinge)return i.hinge;this._info.topdata||(this.board.border.applyTopLines(),this._info.topdata=!0);for(var t=i.clist.getRectSize(),e=this.board.borderinside(t.x1,t.y1,t.x2,t.y2).filter(function(e){return e&&!e.isnull&&e.isHinge()&&e.sidecell[0].sblk===i}),n=null,o=0;o<e.length;o++){var r=e[o];if(n){if(r.isvert?n.x!==r.bx:n.y!==r.by)return i.hinge="bkHingeGt";n.top!==r.topline&&(n.top=null)}else n=r.isvert?{x:r.bx,top:r.topline}:{y:r.by,top:r.topline}}return n?n.top?n.x&&n.x!==(t.x1+t.x2)/2||n.y&&n.y!==(t.y1+t.y2)/2||i.clist.some(function(e){return!!(e.bx+1===n.x&&e.adjacent.right.isShade()&&1!==e.adjborder.right.ques||e.by+1===n.y&&e.adjacent.bottom.isShade()&&1!==e.adjborder.bottom.ques)||(n.x?e.board.getc(t.x2-(e.bx-t.x1),e.by):e.board.getc(e.bx,t.y2-(e.by-t.y1))).isUnshade()})?i.hinge="bkHingeMirror":i.hinge=!0:i.hinge="bkHingeSplit":i.hinge="bkHingeLt"},checkHinge:function(e){for(var i=this.board.sblkmgr.components,t=0;t<i.length;t++){var n=i[t];if(this.getHingeData(n)===e){if(this.failcode.add(e),this.checkOnly)break;n.clist.seterr(1)}}},checkCrossRegionGt:function(){this.checkHinge("bkHingeGt")},checkMirrorShape:function(){this.checkHinge("bkHingeMirror")},checkSplit:function(){this.checkHinge("bkHingeSplit")},checkCrossRegionLt:function(){this.checkHinge("bkHingeLt")}},"AnsCheck@heyablock":{checkCountinuousUnshadeCell:function(){var e=this.checkOnly;this.checkOnly=!0,this.checkRowsColsPartly(this.isBorderCount,function(e){return e.isShade()},"bkUnshadeConsecGt3"),this.checkOnly=e},isBorderCount:function(e){var i,t,n=e.getRectSize(),o=0,r=this.board;if(n.x1===n.x2)for(i=n.x1,t=n.y1+1;t<=n.y2-1;t+=2)r.getb(i,t).isBorder()&&o++;else if(n.y1===n.y2)for(t=n.y1,i=n.x1+1;i<=n.x2-1;i+=2)r.getb(i,t).isBorder()&&o++;var s=o<=1;return s||e.seterr(1),s}},"AnsCheck@cocktail,martini#2":{checkShadeOnCircle:function(){this.checkAllCell(function(e){return!e.isShade()&&0===e.qnum},"circleUnshade")},checkUnshadeOnCircle:function(){this.checkAllCell(function(e){return e.isShade()&&-1!==e.qnum&&0!==e.qnum},"circleShade")},checkOverCircleCount:function(){this.checkCircleCount(1,"bkSizeGt")},checkUnderCircleCount:function(){this.checkCircleCount(-1,"bkSizeLt")},checkCircleCount:function(e,i){for(var t=0;t<this.board.cell.length;t++){var n=this.board.cell[t],o=n.qnum;if(!(o<=0||n.isShade())){var r=n.ublk.circlecount;if(!(e<0&&o<=r||0<e&&r<=o)){if(this.failcode.add(i),this.checkOnly)return;n.ublk.clist.seterr(1)}}}},checkConnect8Shade:function(){this.checkOneArea(this.board.sblk8mgr,"csDivide")}},"AnsCheck@nuritwin":{checkShadeBlockSize:function(){for(var e=this.board.stonegraph.components,i=0;i<e.length;i++){var t=e[i],n=t.clist[0].room;if(n&&n.top.isValidNum()&&t.clist.length!==n.top.getNum()){if(this.failcode.add("bkSizeNe"),this.checkOnly)break;n.clist.seterr(1)}}},checkSizesEqual:function(){for(var e=this.board.roommgr.components,i=0;i<e.length;i++){var t=e[i];if(!t.top.isValidNum()){var n=this.getUnits(t);if(2===n.length&&n[0].clist.length!==n[1].clist.length){if(this.failcode.add("bkDifferentShape"),this.checkOnly)break;t.clist.seterr(1)}}}},checkTwoBlocks:function(){for(var e=this.board.roommgr.components,i=0;i<e.length;i++){var t=e[i],n=this.getUnits(t);if(0!==n.length&&2!==n.length){if(this.failcode.add("bkUnitNe2"),this.checkOnly)break;t.clist.seterr(1)}}},getUnits:function(e){var i=new Set;return e.clist.each(function(e){e.isShade()&&i.add(e.stone)}),Array.from(i)}},FailCode:{bkShadeDivide:"bkShadeDivide",bkNoShade:"bkNoShade",bkShadeNe:"bkShadeNe",cbShade:"cbShade"},"FailCode@shimaguni":{bkShadeDivide:"bkShadeDivide.shimaguni",bkNoShade:"bkNoShade.shimaguni",bkShadeNe:"bkShadeNe.shimaguni",cbShade:"cbShade.shimaguni"}});
//# sourceMappingURL=shimaguni.js.map