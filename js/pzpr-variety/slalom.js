/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,e){"object"==typeof module&&module.exports?module.exports=[t,e]:pzpr.classmgr.makeCustom(t,e)}(["slalom"],{MouseEvent:{inputModes:{edit:["number","direc","clear","info-line"],play:["line","peke","diraux","info-line"]},mouseinput_other:function(){"diraux"===this.inputMode&&(this.mousestart||this.mousemove?this.inputdiraux_mousemove():this.mouseend&&this.notInputted()&&this.clickdiraux())},mouseinput_auto:function(){this.puzzle.playmode?"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.clickdiraux():"right"===this.btn&&(this.mousestart?this.inputdiraux_mousedown():2===this.inputData||3===this.inputData?this.inputpeke():this.mousemove&&this.inputdiraux_mousemove()):this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputEdit():this.mouseend&&this.inputEdit_end())},inputEdit:function(){var t=this.getcell();t.isnull||(this.mouseCell.isnull&&this.inputEdit_first(t),10===this.inputData?this.board.startpos.input(t):2===this.inputData?this.inputdirec():this.inputGate(t),this.mouseCell=t)},inputEdit_first:function(t){t===this.board.startpos.getc()?this.inputData=10:1===t.ques&&t.isNum()?this.inputData=2:this.firstPoint.set(this.inputPoint)},inputGate:function(t){var e,s,i=t.getaddr(),n=!1;1!==t.ques&&(null===this.inputData?(t===this.mouseCell?(s=Math.abs(this.inputPoint.bx-this.firstPoint.bx),.25<=Math.abs(this.inputPoint.by-this.firstPoint.by)?(this.inputData=21,n=!0):.25<=s&&(this.inputData=22,n=!0)):void 0!==(e=this.prevPos.getvert(i,2))&&(this.inputData=e?21:22,n=!0),n&&(t.ques===this.inputData&&(this.inputData=0),this.firstPoint.reset())):t!==this.mouseCell&&(0===this.inputData?n=!(this.inputData=0):void 0!==(e=this.prevPos.getvert(i,2))&&(this.inputData=e?21:22,n=!0))),this.prevPos=i,n&&(s=this.board,t.setQues(this.inputData),s.gatemgr.rebuild(),t.draw(),s.startpos.draw())},inputEdit_end:function(){var t=this.getcell();t.isnull||(10===this.inputData?(this.inputData=null,t.draw()):this.notInputted()&&(t!==this.cursor.getc()?this.setcursor(t):this.inputGateNumber(t)))},inputGateNumber:function(t){var e=this.board;"left"===this.btn?t.setQues({0:1,1:21,21:22,22:0}[t.ques]):"right"===this.btn&&t.setQues({0:22,22:21,21:1,1:0}[t.ques]),t.setNum(-1),e.gatemgr.rebuild(),t.draw(),e.startpos.draw()}},KeyEvent:{enablemake:!0,moveTarget:function(t){return!t.match(/shift/)&&this.moveTCell(t)},keyDispInfo:function(t){return"x"!==t||(this.puzzle.painter.drawNumbersOnGate(!!this.keydown),!1)},keyinput:function(t){this.key_inputdirec(t)||this.key_inputqnum_slalom(t)},key_inputqnum_slalom:function(t){var e=this.cursor.getc(),s=this.board;if("q"===t||"w"===t||"e"===t||"r"===t||"s"===t||" "===t){var i=e.ques,n=-1;if("q"===t)n=1!==i?1:0;else if("w"===t)n=21;else if("e"===t)n=22;else if("r"===t||" "===t)n=0;else{if("s"!==t)return;s.startpos.input(e)}i!==n&&-1!==n&&(e.setQues(n),0===n&&e.setNum(-1),21!==i&&22!==i&&21!==n&&22!==n||s.gatemgr.rebuild(),e.draw(),s.startpos.draw())}else 1===e.ques&&this.key_inputqnum(t)}},Cell:{disInputHatena:!0,maxnum:function(){return Math.min(999,this.board.gatemgr.components.length)},posthook:{qnum:function(t){this.board.gatemgr.generateGateNumberAll()},qdir:function(t){this.board.gatemgr.generateGateNumberAll()}},gate:null,getConnectingGate:function(){var t=this.adjacent,e=[],s=t.top;return s.isnull||21!==s.ques||e.push(s.gate),(s=t.bottom).isnull||21!==s.ques||e.push(s.gate),(s=t.left).isnull||22!==s.ques||e.push(s.gate),(s=t.right).isnull||22!==s.ques||e.push(s.gate),e}},Border:{enableLineNG:!0},Board:{hasborder:1,startpos:null,gatemgr:null,gates:null,addExtraInfo:function(){this.gatemgr=this.addInfoList(this.klass.AreaHurdleGraph)},createExtraObject:function(){this.startpos=new this.klass.StartPosAddress(1,1)},initExtraObject:function(t,e){this.startpos.set(this.cell[0])}},BoardExec:{posinfo:{},adjustBoardData:function(t,e){var s=this.board;if(t&this.TURN)for(var i={21:22,22:21},n=s.cellinside(e.x1,e.y1,e.x2,e.y2),r=0;r<n.length;r++){var a=n[r],o=i[a.ques];o&&(a.ques=o)}this.posinfo=this.getAfterPos(t,e,s.startpos.getc()),this.adjustNumberArrow(t,e)},adjustBoardData2:function(t,e){var s=this.board,i=this.puzzle.opemgr,n=this.posinfo,t=t&this.REDUCE&&n.isdel&&!i.undoExec&&!i.redoExec;t&&(i.forceRecord=!0),s.startpos.set(n.pos.getc()),t&&(i.forceRecord=!1),s.gatemgr.rebuild()}},"StartPosAddress:Address":{input:function(t){var e=this.clone();this.equals(t)||(this.set(t),e.draw()),this.draw()},set:function(t){this.addOpe(t.bx,t.by),this.bx=t.bx,this.by=t.by},addOpe:function(t,e){!this.puzzle.ready||this.bx===t&&this.by===e||this.puzzle.opemgr.add(new this.klass.StartposOperation(this.bx,this.by,t,e))}},"StartposOperation:Operation":{setData:function(t,e,s,i){this.bx1=t,this.by1=e,this.bx2=s,this.by2=i},decode:function(t){return"PS"===t[0]&&(this.bx1=+t[1],this.by1=+t[2],this.bx2=+t[3],this.by2=+t[4],!0)},toString:function(){return["PS",this.bx1,this.by1,this.bx2,this.by2].join(",")},isModify:function(t){return!(!this.manager.changeflag||t.bx2!==this.bx1||t.by2!==this.by1)&&(t.bx2=this.bx2,t.by2=this.by2,!0)},undo:function(){this.exec(this.bx1,this.by1)},redo:function(){this.exec(this.bx2,this.by2)},exec:function(t,e){var s=this.board,t=s.getc(t,e);s.startpos.input(t)}},OperationManager:{addExtraOperation:function(){this.operationlist.push(this.klass.StartposOperation)}},LineGraph:{enabled:!0},"AreaHurdleGraph:AreaGraphBase":{enabled:!0,relation:{"cell.ques":"node"},setComponentRefs:function(t,e){t.gate=e},getObjNodeList:function(t){return t.gatenodes},resetObjNodeList:function(t){t.gatenodes=[]},isnodevalid:function(t){return 21===t.ques||22===t.ques},isedgevalidbynodeobj:function(t,e){var s=t.getdir(e,2);return s===t.UP||s===t.DN?21===t.ques&&21===e.ques:(s===t.LT||s===t.RT)&&(22===t.ques&&22===e.ques)},rebuild:function(){this.klass.AreaGraphBase.prototype.rebuild.call(this),this.generateGateNumberAll()},remakeComponent:function(){this.klass.AreaGraphBase.prototype.remakeComponent.call(this),this.generateGateNumberAll()},resetExtraData:function(t){t.gate=null},setExtraData:function(t){t.clist=new this.klass.CellList(t.getnodeobjs()),t.vert=21===t.clist[0].ques,t.number=-1},generateGateNumberAll:function(){for(var t=this.board,s=this.components,e=0;e<s.length;e++)s[e].number=-1;for(var i={nums:[],done:[],erase:function(){for(var e=this.done,t=0;t<s.length;t++)this.nums[t]=this.nums[t].filter(function(t){return!e[t]})}},e=0;e<s.length;e++)i.nums[e]=[];for(var n=0;n<s.length;n++)i.done[n]=!1;for(var r=0;r<t.cell.length;r++){var a,o,u,h=t.cell[r];1===h.ques&&(a=h.qnum,o=h.qdir,u=h.adjacent,a<=0||(o!==h.NDIR&&o!==h.UP||21!==u.top.ques||i.nums[s.indexOf(u.top.gate)].push(a),o!==h.NDIR&&o!==h.DN||21!==u.bottom.ques||i.nums[s.indexOf(u.bottom.gate)].push(a),o!==h.NDIR&&o!==h.LT||22!==u.left.ques||i.nums[s.indexOf(u.left.gate)].push(a),o!==h.NDIR&&o!==h.RT||22!==u.right.ques||i.nums[s.indexOf(u.right.gate)].push(a)))}for(e=0;e<s.length;e++)2===(p=i.nums[e]).length&&0<p[0]&&p[0]===p[1]&&(s[e].number=p[0],i.done[p[0]]=!0,i.nums[e]=[]);i.erase();for(var l=!0;l;){for(var l=!1,d=[],n=0;n<s.length;n++)d[n]=0;for(e=0;e<s.length;e++)1===(p=i.nums[e]).length&&d[p[0]]++;for(e=0;e<s.length;e++){var c=s[e];0<(f=0<(f=1===(p=i.nums[e]).length?p[0]:-1)&&1<d[f]?-1:f)&&(c.number=f,i.done[f]=!0,i.nums[e]=[],l=!0)}if(i.erase(),!l){for(n=0;n<s.length;n++)d[n]=0;for(e=0;e<s.length;e++)i.nums[e].forEach(function(t){d[t]++});for(e=0;e<s.length;e++){for(var c=s[e],p=i.nums[e],f=-1,g=0;g<p.length;g++)1===d[p[g]]&&(f=-1===f?p[g]:-1);0<f&&(c.number=f,i.done[f]=!0,i.nums[e]=[],l=!0)}i.erase()}}},setGateError:function(t,e){var s,i=this.board,n=new this.klass.CellList,r=t.clist.getRectSize(),t=t.vert?(s=i.getc(r.x1,r.y1-2),i.getc(r.x1,r.y2+2)):(s=i.getc(r.x1-2,r.y1),i.getc(r.x2+2,r.y1));s.isnull||1!==s.ques||n.add(s),t.isnull||1!==t.ques||n.add(t),n.seterr(e)}},Graphic:{irowake:!0,gridcolor_type:"LIGHT",fontShadecolor:"white",numbercolor_func:"fixed_shaded",linecolor:"rgb(32, 32, 255)",noerrcolor:"rgb(160, 150, 255)",paint:function(){this.drawBGCells(),this.drawGrid(),this.drawGates(),this.drawQuesCells(),this.drawArrowNumbers(),this.drawPekes(),this.drawLines(),this.drawBorderAuxDir(),this.drawStartpos(),this.drawChassis(),this.drawTarget()},drawGates:function(){for(var t=this.vinc("cell_gate","auto",!0),e=Math.max(this.cw/10,3),s=e/2,i=1.1*e,n=this.range.cells,r=0;r<n.length;r++){var a=n[r];if(t.fillStyle=4===a.error?this.errcolor1:this.quescolor,t.vid="c_dl21_"+a.id,21===a.ques){var o=a.bx*this.bw-s+1,u=(a.by-1)*this.bh,h=u+this.ch;for(t.beginPath(),l=u;l<h;l+=2*i)t.rect(o,l,e,i);t.fill()}else t.vhide();if(t.vid="c_dl22_"+a.id,22===a.ques){var l=a.by*this.bh-s+1,u=(a.bx-1)*this.bw,h=u+this.cw;for(t.beginPath(),o=u;o<h;o+=2*i)t.rect(o,l,i,e);t.fill()}else t.vhide()}},drawStartpos:function(){var t,e=this.vinc("cell_circle","auto"),s=this.board,i=s.startpos.getc(),n=this.range;i.bx<n.x1||n.x2<i.bx||i.by<n.y1||n.y2<i.by||(n=i.bx*this.bw,i=i.by*this.bh,t=.42*this.cw,e.vid="c_stpos",e.lineWidth=Math.max(.05*this.cw,1),e.strokeStyle=this.quescolor,e.fillStyle=10===this.puzzle.mouse.inputData?this.errbcolor1:"white",e.shapeCircle(n,i,t),e.vid="text_stpos",e.fillStyle=this.quescolor,this.disptext(""+s.gatemgr.components.length,n,i,{ratio:.75}))},repaintParts:function(t){for(var e=t.cellinside(),s=0;s<e.length;s++){var i=e[s];if(this.board.startpos.equals(i)){this.range={x1:i.bx,y1:i.by,x2:i.bx,y2:i.by},this.drawStartpos();break}}}},Encode:{decodePzpr:function(t){var e=this.checkpflag("d")?2:this.checkpflag("p")?1:0;this.decodeSlalom(e)},encodePzpr:function(t){var e=this.puzzle.pzpr.parser;return t===e.URL_PZPRV3&&(this.outpflag="d"),this.encodeSlalom(t===e.URL_PZPRV3?2:0)},decodeKanpen:function(){this.fio.decodeBoard_kanpen()},encodeKanpen:function(){this.fio.encodeBoard_kanpen()},decodeSlalom:function(t){var e=this.outbstr,s=e.split("/"),i=0,n=0,r=this.board;for(n=0;n<s[0].length;n++){var a=s[0].charAt(n),o=r.cell[i];if("1"===a?o.ques=1:"2"===a?o.ques=21:"3"===a?o.ques=22:(this.include(a,"4","9")||this.include(a,"a","z"))&&(i+=parseInt(a,36)-4),i++,!r.cell[i])break}if(r.gatemgr.rebuild(),0===t){var u=0;for(n+=1;n<s[0].length;n++){a=s[0].charAt(n);if(this.include(a,"0","9")||this.include(a,"a","f")?r.gatemgr.components[u].number=parseInt(a,16):"-"===a?(r.gatemgr.components[u].number=parseInt(e.substr(n+1,2),16),n+=2):this.include(a,"g","z")&&(u+=parseInt(a,36)-16),++u>r.gatemgr.components.length)break}for(i=0;i<r.cell.length;i++){for(var h=r.cell[i].getConnectingGate(),l=1e3,n=0;n<h.length;n++){var d=h[n].number;0<d&&(l=Math.min(l,d))}r.cell[i].qnum=l<1e3?l:-1}}else if(1===t||2===t){var i=0,c=0;for(n+=1;n<s[0].length;n++)if(1!==(o=r.cell[i]).ques?n--:0<c?(n--,c--):(a=s[0].charAt(n),1===t&&(this.include(a,"0","9")||this.include(a,"a","f"))?o.qnum=parseInt(a,16):1===t&&"-"===a?(o.qnum=parseInt(e.substr(n+1,2),16),n+=2):2===t&&this.include(a,"0","4")?(o.qdir=parseInt(a,16),o.qnum=parseInt(e.charAt(n+1),16),n++):2===t&&this.include(a,"5","9")?(o.qdir=parseInt(a,16)-5,o.qnum=parseInt(e.substr(n+1,2),16),n+=2):2===t&&"-"===a?(o.qdir=parseInt(e.substr(n+1,1),16),o.qnum=parseInt(e.substr(n+2,3),16),n+=4):"g"<=a&&a<="z"&&(c=parseInt(a,36)-15-1)),i++,!r.cell[i])break}r.startpos.set(r.cell[+s[1]||0]),this.outbstr=s[0].substr(n)},encodeSlalom:function(t){for(var e="",s=0,i=this.board,n=0;n<i.cell.length;n++){var r="";1===(o=i.cell[n]).ques?r="1":21===o.ques?r="2":22===o.ques?r="3":s++,0===s?e+=r:!r&&32!==s||(e+=(3+s).toString(36)+r,s=0)}if(0<s&&(e+=(3+s).toString(36)),(s=0)===t){for(var a=0;a<i.gatemgr.components.length;a++){r="";0<=(u=i.gatemgr.components[a].number)&&u<16?r=u.toString(16):16<=u&&u<256?r="-"+u.toString(16):s++,0===s?e+=r:!r&&20!==s||(e+=(15+s).toString(36)+r,s=0)}0<s&&(e+=(15+s).toString(36))}else if(1===t||2===t){for(var o,u,h,n=0;n<i.cell.length;n++)1===(o=i.cell[n]).ques&&(r="",u=o.qnum,h=o.qdir,1<=u&&u<16?r=(1===t?"":""+h)+u.toString(16):16<=u&&u<256?r=(1===t?"-":""+(h+5))+u.toString(16):256<=u&&u<4096?r="-"+h+u.toString(16):s++,0===s?e+=r:!r&&20!==s||(e+=(15+s).toString(36)+r,s=0));0<s&&(e+=(15+s).toString(36))}e+="/"+i.startpos.getc().id,this.outbstr+=e}},FileIO:{decodeData:function(){2<=this.filever?this.decodeBoard_pzpr2():1===this.filever?this.decodeBoard_pzpr1():0===this.filever&&this.decodeBoard_old(),3===this.filever?this.decodeBorderArrowAns():this.decodeBorderLine()},encodeData:function(){this.filever=3,this.encodeBoard_pzpr2(),this.encodeBorderArrowAns()},kanpenOpen:function(){this.decodeBoard_kanpen(),this.decodeBorderLine()},kanpenSave:function(){this.encodeBoard_kanpen(),this.encodeBorderLine()},decodeBoard_pzpr1:function(){var s=this.board;this.decodeCell(function(t,e){"o"===e?s.startpos.set(t):"i"===e?t.ques=21:"-"===e?t.ques=22:"#"===e?t.ques=1:"."!==e&&(t.ques=1,t.qnum=+e)}),s.gatemgr.rebuild()},decodeBoard_pzpr2:function(){var s=this.board;this.decodeCell(function(t,e){"o"===e?s.startpos.set(t):"i"===e?t.ques=21:"-"===e?t.ques=22:"#"===e?t.ques=1:"."!==e&&(e=e.split(","),t.ques=1,t.qdir="0"!==e[0]?+e[0]:0,t.qnum="-"!==e[1]?+e[1]:-2)}),s.gatemgr.rebuild()},encodeBoard_pzpr2:function(){var e=this.board;this.encodeCell(function(t){return e.startpos.equals(t)?"o ":21===t.ques?"i ":22===t.ques?"- ":1===t.ques&&t.qnum<=0?"# ":1===t.ques?[0!==t.qdir?""+t.qdir:"0",",",-2!==t.qnum?""+t.qnum:"-"," "].join(""):". "})},decodeBoard_kanpen:function(){var s=this.board;this.decodeCell(function(t,e){"+"===e?s.startpos.set(t):"|"===e?t.ques=21:"-"===e?t.ques=22:"0"===e?t.ques=1:"."!==e&&(t.ques=1,t.qnum=+e)}),s.gatemgr.rebuild()},encodeBoard_kanpen:function(){var e=this.board;this.encodeCell(function(t){return e.startpos.equals(t)?"+ ":21===t.ques?"| ":22===t.ques?"- ":1===t.ques?0<t.qnum?t.qnum+" ":"0 ":". "})},kanpenOpenXML:function(){this.decodeCellSlalom_XMLBoard(),this.decodeBorderLine_XMLAnswer()},kanpenSaveXML:function(){this.encodeCellSlalom_XMLBoard(),this.encodeBorderLine_XMLAnswer()},UNDECIDED_NUM_XML:-3,decodeCellSlalom_XMLBoard:function(){var s=this.board;this.decodeCellXMLBoard(function(t,e){0<=e?(t.ques=1,0<e&&(t.qnum=e)):-5===e?t.ques=21:-4===e?t.ques=22:-1===e&&s.startpos.set(t)}),s.gatemgr.rebuild()},encodeCellSlalom_XMLBoard:function(){var s=this.board;this.encodeCellXMLBoard(function(t){var e=-3;return 1===t.ques?e=0<t.qnum?t.qnum:0:21===t.ques?e=-5:22===t.ques?e=-4:s.startpos.equals(t)&&(e=-1),e})},decodeBoard_old:function(){var i=[],n=this.board;this.decodeCell(function(t,e){var s=t.id;i[s]=-1,"#"===e?t.ques=1:"o"===e?n.startpos.set(t):"."!==e&&("i"===e.charAt(0)?t.ques=21:"w"===e.charAt(0)&&(t.ques=22),1<e.length&&(i[s]=+e.substr(1)))}),n.gatemgr.rebuild();for(var t=0;t<n.cell.length;t++)-1!==i[t]&&(n.cell[t].gate.number=i[t]);for(t=0;t<n.cell.length;t++){for(var e=n.cell[t].getConnectingGate(),s=1e3,r=0;r<e.length;r++){var a=e[r].number;0<a&&(s=Math.min(s,a))}n.cell[t].qnum=s<1e3?s:-1}}},AnsCheck:{checklist:["checkLineOnShadeCell","checkCrossLine","checkBranchLine","checkPassGateOnce","checkStartid","checkGateNumber","checkDeadendLine+","checkOneLoop","checkPassAllGate"],checkStartid:function(){var t=this.board.startpos.getc();2!==t.lcnt&&(t.seterr(1),this.failcode.add("stLineNe2"))},checkPassGateOnce:function(){return this.checkGateLine(1,"gateRedup")},checkPassAllGate:function(){return this.checkGateLine(2,"gateUnpass")},checkGateLine:function(t,e){for(var s=this.board,i=s.gatemgr.components,n=0;n<i.length;n++){for(var r=0,a=i[n].clist,o=0;o<a.length;o++)0<a[o].lcnt&&r++;if(!(1===t&&r<=1||2===t&&0<r)){if(this.failcode.add(e),this.checkOnly)break;a.seterr(4),s.gatemgr.setGateError(i[n],1)}}},checkGateNumber:function(){var t=this.getTraceInfo();null!==t&&(this.failcode.add("lrOrder"),t.clist.seterr(4),this.board.gatemgr.setGateError(t,1))},getTraceInfo:function(){return this.searchTraceInfo(this.board.startpos.getc())},searchTraceInfo:function(t){if(0===t.lcnt)return null;for(var e=null,s=t.getdir(t.pathnodes[0].nodes[0].obj,2),i=t.getaddr(),n=0,r=-1,a=this.board.gatemgr.components.length;;)if(i.movedir(s,1),i.oncell()){var o=i.getc();if(t===o)break;if(21===o.ques||22===o.ques){var u=o.gate,h=(n++,u.number);if(!(h<=0))if(-1===r){var l=a+1-h;if(h===l){if(n!==h){e=u;break}}else{if(n!==h){if(n===l){if(t.lcnt<2)break;s=t.getdir(t.pathnodes[0].nodes[1].obj,2),i=t.getaddr(),n=0,r=1;continue}e=u;break}r=1}}else if(1===r&&n!==h){e=u;break}}l=o.adjborder;if(2!==o.lcnt)break;1!==s&&l.bottom.isLine()?s=2:2!==s&&l.top.isLine()?s=1:3!==s&&l.right.isLine()?s=4:4!==s&&l.left.isLine()&&(s=3)}else if(!i.getb().isLine())break;return e}}});
//# sourceMappingURL=slalom.js.map