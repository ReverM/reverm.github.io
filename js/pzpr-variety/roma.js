/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,e){"object"==typeof module&&module.exports?module.exports=[t,e]:pzpr.classmgr.makeCustom(t,e)}(["roma","arrowflow"],{MouseEvent:{inputModes:{edit:["border","arrow","clear","info-road"],play:["diraux","arrow","clear","info-road"]},mouseinput:function(){this.puzzle.key.isZ||"info-road"===this.inputMode?this.mousestart&&this.dispRoad():"diraux"===this.inputMode?this.inputarrow_cell():this.common.mouseinput.call(this)},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart||this.mousemove?this.inputarrow_cell():this.mouseend&&this.notInputted()&&this.inputqnum():this.puzzle.editmode&&"arrowflow"===this.pid?this.inputqnum():this.mousestart||this.mousemove?this.isBorderMode()?this.inputborder():this.inputarrow_cell():this.mouseend&&this.notInputted()&&this.inputqnum()},inputarrow_cell_main:function(t,e){"left"===this.btn&&"diraux"!==this.inputMode?t.setNum(e):t.setQsub(t.qsub^1<<e+1)},dispRoad:function(){var t=this.getcell();if(!t.isnull&&("arrowflow"!==this.pid||0!==t.qnum)){var e=this.puzzle,i={},r=e.board;r.trackBall1(t.id,i);for(var o=0;o<r.cell.length;o++)1===i[o]?r.cell[o].setinfo(2):2===i[o]&&r.cell[o].setinfo(3);r.hasinfo=!0,e.redraw(),this.mousereset()}}},"MouseEvent@arrowflow":{inputModes:{edit:["number","clear","empty","info-road"],play:["diraux","arrow","clear","info-road"]},inputempty:function(){this.inputFixedNumber(0)}},KeyEvent:{enablemake:!0,enableplay:!0,moveTarget:function(t){return!(t.match(/shift/)||t.match(/ctrl/)||t.match(/meta/))&&this.moveTCell(t)},keyinput:function(t){this.key_roma(t)},key_roma:function(t){if(this.puzzle.playmode&&(t.startsWith("ctrl+")||t.startsWith("meta+"))){var e=this.cursor.getc();switch(t.split("+")[1]){case"up":e.setQsub(4^e.qsub);break;case"down":e.setQsub(8^e.qsub);break;case"left":e.setQsub(16^e.qsub);break;case"right":e.setQsub(32^e.qsub)}e.draw()}else"1"===t||"shift+up"===t?t="1":"2"===t||"shift+right"===t?t="4":"3"===t||"shift+down"===t?t="2":"4"===t||"shift+left"===t?t="3":"q"===t?t="5":!this.puzzle.editmode||"5"!==t&&"-"!==t?"6"!==t&&" "!==t||(t=" "):t="s1",this.key_inputqnum(t)}},"KeyEvent@arrowflow":{keyinput:function(t){this.puzzle.editmode?this.key_inputqnum(t):this.key_roma(t)}},Cell:{numberAsObject:!0,maxnum:function(){return this.puzzle.editmode?5:4},getArrow:function(){return this.getNum()},isGoal:function(){return 5===this.getNum()}},"Cell@roma":{prehook:{qsub:function(){return-1!==this.qnum}}},"Cell@arrowflow":{minnum:function(){return this.puzzle.editmode?0:1},maxnum:function(){return this.puzzle.editmode?this.board.rows*this.board.cols-1:4},getArrow:function(){return this.anum},sameNumber:function(t){return 0<this.anum&&this.anum===t.anum},isGoal:function(){return-2===this.qnum||0<this.qnum}},Board:{cols:8,rows:8,trackBall1:function(t,e){var i=this.cell[t],r=i.getaddr(),o=i.getArrow(),s=i.isGoal();for(e[i.id]=0;1<=o&&o<=4;){r.movedir(o,2);var n=r.getc();if(n.isnull)break;if(void 0!==e[n.id]){s=2===e[n.id];break}e[n.id]=0,o=n.getArrow(),s|=n.isGoal()}for(var l=[i];0<l.length;){var u,a=l.pop();a!==i&&void 0!==e[a.id]||(e[a.id]=0,u=a.adjacent,o=a.getArrow(),a=u.top,1===o||a.isnull||void 0!==e[a.id]||2!==a.getArrow()||l.push(a),a=u.bottom,2===o||a.isnull||void 0!==e[a.id]||1!==a.getArrow()||l.push(a),a=u.left,3===o||a.isnull||void 0!==e[a.id]||4!==a.getArrow()||l.push(a),a=u.right,4===o||a.isnull||void 0!==e[a.id]||3!==a.getArrow()||l.push(a))}for(var c=0;c<this.cell.length;c++)0===e[c]&&(e[c]=s?2:1);return s}},"Board@roma":{hasborder:1},BoardExec:{adjustBoardData:function(t,e){this.adjustCellArrow(t,e)}},"BoardExec@arrowflow":{adjustBoardData:function(t,e){this.adjustCellArrowField(t,e,"anum")}},"AreaRoomGraph@roma":{enabled:!0},Graphic:{gridcolor_type:"LIGHT",errbcolor2:"rgb(255, 224, 192)",errbcolor3:"rgb(192, 192, 255)",paint:function(){this.drawBGCells(),this.drawGrid(),"roma"===this.pid&&this.drawBorders(),this.drawCellArrows(),"roma"===this.pid?(this.drawGoals(),this.drawHatenas()):this.drawQuesNumbers(),this.drawArrowAuxMarks(),this.drawChassis(),this.drawCursor()},getBGCellColor:function(t){return"arrowflow"===this.pid&&0===t.qnum?this.quescolor:1===t.error?this.errbcolor1:2===t.qinfo?this.errbcolor2:3===t.qinfo?this.errbcolor3:null},drawGoals:function(){for(var t=this.vinc("cell_circle","auto",!0),e=this.cw*this.circleratio[0],i=this.range.cells,r=0;r<i.length;r++){var o=i[r];t.vid="c_cir_"+o.id,5===o.qnum?(t.fillStyle=1===o.error?this.errcolor1:this.quescolor,t.fillCircle(o.bx*this.bw,o.by*this.bh,e)):t.vhide()}},drawArrowAuxMarks:function(){var t=this.vinc("cell_ticks","auto"),e=(t.lineWidth=1+this.cw/40|0,.15*this.cw);e<3&&(e=3);for(var i=0;i<this.board.cell.length;i++)for(var r,o,s,n,l,u,a=this.board.cell[i],c=a.bx,h=a.by,d=c*this.bw,m=h*this.bh,f=(t.strokeStyle="rgb(127,127,255)",[[-1,1],[1,1],[-1,0],[1,0]]),b=0;b<f.length;b++)t.vid="ut_cell"+b+"_"+a.id,a.qsub&1<<b+2?(r=f[b][0],n=[(u=(o=f[b][1])?m:d)+r*this.bw-+r*e,(s=o?d:m)+e],l=[u+r*this.bw-.5*r*e,s],u=[u+r*this.bw-+r*e,s-e],t.beginPath(),t.moveTo(n[+!!o],n[+!o]),t.lineTo(l[+!!o],l[+!o]),t.lineTo(u[+!!o],u[+!o]),t.moveTo(l[+!!o],l[+!o]),t.closePath(),t.stroke()):t.vhide()}},"Graphic@arrowflow":{numbercolor_func:"qnum"},Encode:{decodePzpr:function(t){this.decodeBorder(),this.decodeNumber10()},encodePzpr:function(t){this.encodeBorder(),this.encodeNumber10()}},"Encode@arrowflow":{decodePzpr:function(t){this.decodeNumber16()},encodePzpr:function(t){this.encodeNumber16()}},FileIO:{decodeData:function(){"roma"===this.pid&&this.decodeAreaRoom(),this.decodeCellQnum(),this.decodeCellAnumsub()},encodeData:function(){"roma"===this.pid&&this.encodeAreaRoom(),this.encodeCellQnum(),this.encodeCellAnumsub()},decodeCellAnumsub:function(){this.decodeCell(function(t,e){"+"===e[0]?t.qsub=+e.substr(1):"."!==e&&(t.anum=+e)})},encodeCellAnumsub:function(){this.encodeCell(function(t){return(-1!==t.anum?""+t.anum:0!==t.qsub?"+"+t.qsub:".")+" "})}},AnsCheck:{checklist:["checkSingleArrowInArea","checkBalls"],checkSingleArrowInArea:function(){this.checkDifferentNumberInRoom_main(this.board.roommgr,this.isDifferentNumber_roma)},isDifferentNumber_roma:function(t){return this.isIndividualObject(t,function(t){t=t.getArrow();return 1<=t&&t<=4?t:-1})},checkBalls:function(){for(var e={},t=this.board,i=0;i<t.cell.length;i++){var r=t.cell[i];r.isGoal()?e[i]=2:"arrowflow"===this.pid&&0===r.qnum&&(e[i]=-3)}for(var o=!0,i=0;i<t.cell.length;i++)if(void 0===e[i]&&!t.trackBall1(i,e)&&(this.failcode.add("stopHalfway"),o=!1,this.checkOnly))return;o||t.cell.filter(function(t){return 1===e[t.id]}).seterr(1)}},"AnsCheck@arrowflow":{checklist:["checkAdjacentDiffNumber","checkGoalGt","checkGoalLt","checkBalls"],getGoalCounts:function(){if(this._info.state)return this._info.state;for(var t,e={},i=this.board,r=0;r<i.cell.length;r++)i.cell[r].qnum<=0||(i.trackBall1(r,t={}),e[r]=Object.keys(t).map(function(t){return i.cell[+t]}));return this._info.state=e},checkGoalLt:function(){var t,e=this.board,i=this.getGoalCounts();for(t in i){var r=e.cell[+t];if(!(i[t].length>=r.qnum+1)){if(this.failcode.add("arCountLt"),this.checkOnly)return;e.cell[+t].seterr(1)}}},checkGoalGt:function(){var t,e=this.board,i=this.getGoalCounts();for(t in i){var r=e.cell[+t];if(!(i[t].length<=r.qnum+1)){if(this.failcode.add("arCountGt"),this.checkOnly)return;new this.klass.CellList(i[t]).seterr(1)}}}}});
//# sourceMappingURL=roma.js.map