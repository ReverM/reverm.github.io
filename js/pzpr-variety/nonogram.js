/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["nonogram","coral","cts"],{MouseEvent:{use:!0,inputModes:{edit:["number"],play:["shade","unshade","completion"]},mouseinput:function(){"shade"===this.inputMode||"unshade"===this.inputMode?this.inputcell():this.common.mouseinput.call(this)},mouseinput_number:function(){this.mousestart&&this.inputqnum_excell()},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&(this.mousestart&&this.inputqcmp(),this.inputcell()):this.puzzle.editmode&&this.mousestart&&this.inputqnum_excell()},inputqnum_excell:function(){var e=this.getcell_excell();e.isnull||"excell"!==e.group||(e!==this.cursor.getex()?this.setcursor(e):this.inputqnum_main(e))},inputqcmp:function(){var e=this.getcell_excell();e.isnull||e.noNum()||"excell"!==e.group||(e.setQcmp(+!e.qcmp),e.draw(),this.mousereset())}},"MouseEvent@coral,cts":{inputModes:{edit:["number","clear","info-blk"],play:["shade","unshade","info-blk","completion"]}},KeyEvent:{enablemake:!0,moveTarget:function(e){var t=this.cursor,s=t.getex(),n=s.NDIR;switch(e){case"up":t.miny<t.by&&(n=s.UP);break;case"down":(t.bx<0&&t.maxy>t.by||0<t.bx&&t.by<-1)&&(n=s.DN);break;case"left":t.minx<t.bx&&(n=s.LT);break;case"right":(t.by<0&&t.maxx>t.bx||0<t.by&&t.bx<-1)&&(n=s.RT)}return n!==s.NDIR&&(t.movedir(n,2),s.draw(),t.draw(),!0)},keyinput:function(e){this.key_inputexcell(e)},key_inputexcell:function(e){var t=this.cursor.getex(),e=this.getNewNumber(t,e,t.qnum);null!==e&&(t.setQnum(e),this.prev=t,this.cursor.draw())}},TargetCursor:{initCursor:function(){this.init(-1,-1)}},ExCell:{disInputHatena:!0,maxnum:function(){var e=this.bx,t=this.by;return e<0&&t<0?0:t<0?this.board.rows:this.board.cols},posthook:{qnum:function(e){this.puzzle.board.excellOffsets=null}}},"KeyEvent@cts":{getNewNumber:function(e,t,s){return"w"===t||"shift+8"===t||"*"===t?0:this.common.getNewNumber.call(this,e,t,s)}},"ExCell@cts":{disInputHatena:!1,minnum:0},Board:{hasborder:1,hasexcell:1,hasflush:1,cols:10,rows:10,excellRows:function(e,t){return t+1>>1},excellCols:function(e,t){return e+1>>1},excellOffsets:null,getOffsets:function(){if(null!==this.excellOffsets)return this.excellOffsets;this.excellOffsets=[this.minbx/-2,this.minby/-2];for(var e=this.minbx+1;e<0;e+=2)for(var t=1;t<this.maxby;t+=2)-1!==this.getex(e,t).qnum&&(this.excellOffsets[0]=(this.minbx+1-e)/-2,e=0);for(t=this.minby+1;t<0;t+=2)for(e=1;e<this.maxbx;e+=2)-1!==this.getex(e,t).qnum&&(this.excellOffsets[1]=(this.minby+1-t)/-2,t=0);return this.excellOffsets}},BoardExec:{adjustBoardData:function(e,t){this.adjustExCellTopLeft_1(e,t)},adjustBoardData2:function(e,t){this.adjustExCellTopLeft_2(e,t)}},"BoardExec@coral":{adjustBoardData2:function(e,t){this.adjustExCellTopLeft_2(e,t,!0)}},"AreaUnshadeGraph@coral":{enabled:!0},"AreaShadeGraph@coral,cts":{enabled:!0},Graphic:{enablebcolor:!0,shadecolor:"#444444",paint:function(){this.drawBGCells(),this.drawDotCells(),this.drawShadedCells(),this.drawGrid(),this.drawNumbersExCell(),this.drawChassis(!0),this.drawBorders(),this.drawTarget()},getQuesNumberColor:function(e){return 1===e.error?this.errcolor1:e.qcmp?this.qcmpcolor:this.quescolor},getBorderColor:function(e){return!(this.board.maxbx%10||this.board.maxby%10||e.bx%10!=0&&e.by%10!=0)?this.quescolor:null},getBoardCols:function(){return this.getOffsetCols()+this.board.maxbx/2},getBoardRows:function(){return this.getOffsetRows()+this.board.maxby/2},getOffsetCols:function(){var e=this.board,t=this.puzzle.playeronly||this.outputImage?e.getOffsets()[0]:0;return(0-e.minbx)/2-t},getOffsetRows:function(){var e=this.board,t=this.puzzle.playeronly||this.outputImage?e.getOffsets()[1]:0;return(0-e.minby)/2-t}},"Graphic@cts":{getQuesNumberText:function(e){return 0===e.qnum?"*":this.getNumberTextCore(e.qnum)}},Encode:{decodePzpr:function(e){this.decodeNumber16ExCell()},encodePzpr:function(e){this.encodeNumber16ExCellFlushed()}},FileIO:{decodeData:function(){this.decodeCellExCell(function(e,t){"."!==t&&("excell"!==e.group||e.isnull?"cell"===e.group&&("#"===t?e.qans=1:"+"===t&&(e.qsub=1)):("c"===t[0]&&(e.qcmp=1,t=t.substring(1)),e.qnum=+t))})},encodeData:function(){this.encodeCellExCell(function(e){if("excell"===e.group&&!e.isnull&&-1!==e.qnum)return(e.qcmp?"c":"")+e.qnum+" ";if("cell"===e.group){if(1===e.qans)return"# ";if(1===e.qsub)return"+ "}return". "})}},AnsCheck:{checklist:["checkNonogram"],excellsInUnknownOrder:!1,checkNonogram:function(){this.checkRowsCols(this.isExCellCount,"exNoMatch")},isExCellCount:function(e){for(var t=e.getRectSize(),s=this.board,n=t.x1===t.x2?s.excellinside(t.x1,s.minby,t.x1,-1):s.excellinside(s.minbx,t.y1,-1,t.y1),i=[],r=0;r<n.length;r++){var o=n[r].qnum;-1!==o&&i.push(o)}s=this.getLines(e);if(this.excellsInUnknownOrder){if(0===i.length)return!0;i.sort(),s.sort()}return!!this.puzzle.pzpr.util.sameArray(i,s)||(e.seterr(1),n.seterr(1),!1)},getLines:function(e){for(var t=[],s=0,n=0;n<e.length;n++)0!==e[n].qans?s++:0<s&&(t.push(s),s=0);return 0<s&&t.push(s),t}},"AnsCheck@coral":{checklist:["check2x2ShadeCell","checkConnectUnshadeOutside","checkNonogram","checkConnectShade"],excellsInUnknownOrder:!0,checkConnectUnshadeOutside:function(){for(var e=this.board,t=0;t<e.ublkmgr.components.length;t++){var s=e.ublkmgr.components[t].clist,n=s.getRectSize();if(1!==n.x1&&n.x2!==e.maxbx-1&&1!==n.y1&&n.y2!==e.maxby-1){if(this.failcode.add("cuConnOut"),this.checkOnly)break;s.seterr(1)}}}},"AnsCheck@cts":{checklist:["check2x2ShadeCell","checkNonogram","checkConnectShade"],isExCellCount:function(e){for(var t=e.getRectSize(),s=this.board,n=t.x1===t.x2?s.excellinside(t.x1,s.minby,t.x1,-1):s.excellinside(s.minbx,t.y1,-1,t.y1),i=[],r=!1,o=0;o<n.length;o++){var l=n[o].qnum;-1===l||r&&0===l||i.push(l),r=0===l}if(0===i.length||1===i.length&&0===i[0])return!0;s=this.getLines(e);if(0===s.length)return e.seterr(1),n.seterr(1),!1;var u="",c=(s.forEach(function(e){u+="a".repeat(e)+" "}),"^");return i.forEach(function(e){c+=-2===e?"a* ":0===e?"(|.* )":1===e?"a ":"a{"+e+"} "}),c+="$",!!u.match(new RegExp(c))||(e.seterr(1),n.seterr(1),!1)}}});
//# sourceMappingURL=nonogram.js.map