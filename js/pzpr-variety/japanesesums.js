/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,i){"object"==typeof module&&module.exports?module.exports=[t,i]:pzpr.classmgr.makeCustom(t,i)}(["japanesesums"],{MouseEvent:{inputModes:{edit:["number"],play:["number","objblank","shade"]},mouseinput_number:function(){!this.mousestart||this.puzzle.editmode&&this.inputqnum_excell()||this.inputqnum()},mouseinput_auto:function(){var t;this.puzzle.playmode?this.mousestart&&!(t=this.getcell_excell()).isnull&&"cell"===t.group&&this.inputqnum():this.puzzle.editmode&&this.mouseinput_number()},inputqnum_excell:function(){var t,i=this.getpos(0).getex();i.isnull||(i!==this.cursor.getex()?this.setcursor(this.getpos(0)):"excell"===i.group?this.inputqnum_main(i):(i=this.board.indicator,null!==(t=this.getNewNumber(i,i.count))&&(t<=0&&(t="left"===this.btn?i.getminnum():i.getmaxnum()),i.set(t))))},getNewNumber:function(t,i){var e,n=-3;return this.puzzle.editmode&&(n="excell"===t.group?-2:-1),"left"===this.btn?(i+=1)>t.getmaxnum()?n:(e=t.getminnum(),0<=i&&i<e?e:i):"right"===this.btn?(i-=1)<n?t.getmaxnum():0<=i&&i<t.getminnum()?-1:i:i+1},inputDot:function(){this.inputFixedNumber(-2)},inputShade:function(){this.inputFixedNumber(-3)},inputFixedNumber:function(t){var i=this.getcell();i.isnull||(null===this.inputData&&(this.inputData=i.getNum()===t?-1:t),i.setNum(this.inputData),(this.mouseCell=i).draw())}},KeyEvent:{enablemake:!0,enableplay:!0,keyinput:function(t){var i;this.puzzle.playmode?((i=0!==this.cursor.targetdir)||("q"===t||"a"===t||"z"===t?t="s1":"w"===t||"s"===t||"x"===t?t="s2":"e"!==t&&"d"!==t&&"c"!==t&&"-"!==t||(t=" ")),this.key_inputqnum(t),i||" "!==t||this.cursor.getc().clrSnum()):this.cursor.by<=this.board.maxby?(i=this.cursor.getex()).isnull?this.key_inputqnum(t):this.key_inputqnum_main(i,t):this.key_inputqnum_indicator(t)},key_inputqnum_indicator:function(t){var i=this.puzzle.board,t=this.getNewNumber(i.indicator,t,i.indicator.count);null!==t&&(i.indicator.set(t),this.prev=i.indicator)}},TargetCursor:{initCursor:function(){this.init(-1,-1),this.adjust_init()},setminmax_customize:function(){this.puzzle.editmode?this.maxy+=2:(this.minx=1,this.miny=1)}},Cell:{disInputHatena:!0,enableSubNumberArray:!0,numberWithMB:!0,maxnum:function(){return this.board.indicator.count},noNum:function(){return this.qnum<0&&this.anum<0&&1!==this.qans},getNum:function(){return-1!==this.qnum?this.qnum:0<this.anum?this.anum:0<this.qans?-3:0<this.qsub?-2:-1},setNum:function(t){if(this.puzzle.editmode)return this.setQnum(t),this.setAnum(-1),this.setQsub(0),this.setQans(0),void this.clrSnum();if(-1===this.qnum){if(0<t)this.setAnum(t),this.setQsub(0),this.setQans(0);else switch(this.setAnum(-1),t){case-1:this.setQsub(0),this.setQans(0);break;case-2:this.setQsub(1),this.setQans(0);break;case-3:this.setQsub(0),this.setQans(1)}this.clrSnum()}}},ExCell:{disInputHatena:!1,maxnum:function(){var t=this.bx,i=this.by;if(t<0&&i<0)return 0;var t=this.board.indicator.count,e=0;return(t*(t+1)-(t-(e=i<0?Math.min(this.board.rows,t):Math.min(this.board.cols,t)))*(t-e+1))/2}},Board:{cols:5,rows:5,hasexcell:1,hasflush:1,indicator:null,excellRows:function(t,i){return i+1>>1},excellCols:function(t,i){return t+1>>1},createExtraObject:function(){this.indicator=new this.klass.Indicator},initExtraObject:function(t,i){this.indicator.init(),this.indicator.count=this.klass.Indicator.prototype.count},getex:function(t,i){return i<=this.maxby?this.common.getex.call(this,t,i):this.indicator},excellOffsets:null,getOffsets:function(){if(null!==this.excellOffsets)return this.excellOffsets;this.excellOffsets=[this.minbx/-2,this.minby/-2];for(var t=this.minbx+1;t<0;t+=2)for(var i=1;i<this.maxby;i+=2)-1!==this.getex(t,i).qnum&&(this.excellOffsets[0]=(this.minbx+1-t)/-2,t=0);for(i=this.minby+1;i<0;i+=2)for(t=1;t<this.maxbx;t+=2)-1!==this.getex(t,i).qnum&&(this.excellOffsets[1]=(this.minby+1-i)/-2,i=0);return this.excellOffsets}},BoardExec:{adjustBoardData:function(t,i){this.adjustExCellTopLeft_1(t,i)},adjustBoardData2:function(t,i){this.adjustExCellTopLeft_2(t,i),this.board.indicator.init()}},Indicator:{count:4,rect:null,qnum:-1,initialize:function(t){t&&(this.count=t),this.rect={bx1:-1,by1:-1,bx2:-1,by2:-1}},init:function(){var t=this.puzzle.board;this.rect={bx1:t.maxbx-3.5,by1:t.maxby+.2,bx2:t.maxbx+.1,by2:t.maxby+1.9}},set:function(t){this.count!==(t=t<=0?1:t)&&(this.addOpe(this.count,t),this.count=t,this.draw())},getmaxnum:function(){return 9},getminnum:function(){return 1},addOpe:function(t,i){this.puzzle.opemgr.add(new this.klass.IndicatorOperation(t,i))},draw:function(){this.puzzle.painter.paintRange(this.puzzle.board.maxbx-3.5,this.puzzle.board.maxby+.2,this.puzzle.board.maxbx+.1,this.puzzle.board.maxby+1.9)}},"IndicatorOperation:Operation":{type:"indicator",setData:function(t,i){this.old=t,this.num=i},decode:function(t){return"AS"===t[0]&&(this.old=+t[1],this.num=+t[2],!0)},toString:function(){return["AS",this.old,this.num].join(",")},undo:function(){this.exec(this.old)},redo:function(){this.exec(this.num)},exec:function(t){this.board.indicator.set(t)}},OperationManager:{addExtraOperation:function(){this.operationlist.push(this.klass.IndicatorOperation)}},Graphic:{gridcolor_type:"LIGHT",paint:function(){this.drawBGCells(),this.drawBGExCells(),this.drawShadedCells(),this.drawDotCells(),this.drawTargetSubNumber(),this.drawGrid(),this.drawBorders(),this.drawSubNumbers(),this.drawAnsNumbers(),this.drawQuesNumbers(),this.drawNumbersExCell(),this.drawChassis(),this.drawIndicator(),this.drawCursor_japanesesums()},drawIndicator:function(){var t=this.vinc("indicator","auto",!0),i=this.board;t.use.canvas&&t.context.clearRect(0,i.maxby*this.bh+5,t.child.width,i.maxby*this.bh+10),t.fillStyle=this.quescolor,t.vid="bd_indicator",t.font=(.66*this.ch|0)+"px "+this.fontfamily,t.textAlign="right",t.textBaseline="middle",t.fillText("[1-"+i.indicator.count+"]",i.maxbx*this.bw,(2*i.rows+1)*this.bh)},drawCursor_japanesesums:function(){var t=this.puzzle.board.maxby>=this.puzzle.cursor.by,i=!t;this.drawCursor(!0,t),this.drawCursorOnIndicator(i)},drawCursorOnIndicator:function(t){var i=this.vinc("target_cursor_indicator","crispEdges",!0),e=this.board,t=t&&this.puzzle.editmode&&this.puzzle.getConfig("cursor")&&!this.outputImage;i.vid="ti",t?(t=e.indicator.rect,i.strokeStyle=this.targetColorEdit,i.lineWidth=0|Math.max(this.cw/16,2),i.strokeRect(t.bx1*this.bw,t.by1*this.bh,(t.bx2-t.bx1)*this.bw,(t.by2-t.by1)*this.bh)):i.vhide()},getBoardCols:function(){return this.getOffsetCols()+this.board.maxbx/2},getBoardRows:function(){return this.getOffsetRows()+this.board.maxby/2+1},getOffsetCols:function(){var t=this.board,i=this.puzzle.playeronly||this.outputImage?t.getOffsets()[0]:0;return(0-t.minbx)/2-i},getOffsetRows:function(){var t=this.board,i=this.puzzle.playeronly||this.outputImage?t.getOffsets()[1]:0;return(0-t.minby)/2-i}},Encode:{decodePzpr:function(t){this.decodeIndicator(),this.decodeNumber16ExCell(),this.decodeNumber16()},encodePzpr:function(t){this.encodeIndicator(),this.encodeNumber16ExCellFlushed(),this.board.cell.some(function(t){return-1!==t.qnum})&&this.encodeNumber16()},decodeIndicator:function(){var t=this.outbstr.split("/");this.board.indicator.count=+t[0],this.outbstr=t[1]||""},encodeIndicator:function(){this.outbstr=this.board.indicator.count+"/"}},FileIO:{decodeData:function(){this.decodeIndicator(),this.decodeCellExCellQnumAnumsub()},encodeData:function(){this.encodeIndicator(),this.encodeCellExCellQnumAnumsub()},decodeIndicator:function(){this.board.indicator.count=+this.readLine()},encodeIndicator:function(){this.writeLine(this.board.indicator.count)},decodeCellExCellQnumAnumsub:function(){this.decodeCellExCell(function(t,i){"."!==i&&("excell"===t.group?t.qnum=+i:"cell"===t.group&&("q"===i[0]?t.qnum=+i.substr(1):"+"===(i=0<=i.indexOf("[")?this.setCellSnum(t,i):i)?t.qsub=1:"-"===i?t.qans=1:"."!==i&&(t.anum=+i)))})},encodeCellExCellQnumAnumsub:function(){this.encodeCellExCell(function(t){if("excell"===t.group){if(-1!==t.qnum)return t.qnum+" "}else if("cell"===t.group){if(-1!==t.qnum)return"q"+t.qnum+" ";var i=".";return-1!==t.anum?i=""+t.anum:1===t.qsub?i="+":1===t.qans&&(i="-"),-1===t.anum&&(i+=this.getCellSnum(t)),i+" "}return". "})}},AnsCheck:{checklist:["checkDifferentNumberInLine","checkRowColSum","checkNoNumCell+"],checkRowColSum:function(){this.checkRowsCols(this.isSumOrder,"nmSumOrderRowNe")},isSumOrder:function(t){if(0!==t.filter(function(t){return t.noNum()}).length)return!0;for(var i=t.getRectSize(),e=this.board,n=(n=i.x1===i.x2?e.excellinside(i.x1,e.minby,i.x1,-1):e.excellinside(e.minbx,i.y1,-1,i.y1)).filter(function(t){return-1!==t.qnum}),s=[],u=0;u<n.length;u++)s.push(n[u].qnum);if(0===s.length)return!0;for(var r=0,o=[],u=0;u<t.length;u++){var a=t[u],a=(a.isShade()&&0<r&&(o.push(r),r=0),a.getNum());r+=0<a?a:0}if(0<r&&o.push(r),s.length!==o.length)return t.seterr(1),n.seterr(1),!1;for(u=0;u<s.length;u++)if(-2!==s[u]&&s[u]!==o[u])return t.seterr(1),n.seterr(1),!1;return!0}}});
//# sourceMappingURL=japanesesums.js.map