/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(){var t,i;t=["starbattle"],i={MouseEvent:{use:!0,RBShadeCell:!0,inputModes:{play:["star","unshade","dot"]},mouseinput_other:function(){"star"===this.inputMode&&this.mousestart&&this.inputcell_starbattle(),"dot"===this.inputMode&&this.mousestart&&this.inputdot()},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart&&"right"===this.btn&&this.inputdot(),(this.mousestart||this.mousemove)&&3!==this.inputData&&this.inputcell_starbattle()):this.puzzle.editmode&&(this.mousestart||this.mousemove)&&this.inputEdit()},inputcell_starbattle:function(){var t=this.getcell();t.isnull||t===this.mouseCell||(null===this.inputData&&this.decIC(t),t.setQans(1===this.inputData?1:0),t.setQsub(2===this.inputData?1:0),t.draw(),this.mouseCell=t,1===this.inputData&&this.mousereset())},inputEdit:function(){null===this.inputData?this.inputEdit_first():this.inputborder()},inputEdit_first:function(){var t=this.board,i=this.inputPoint.bx,s=this.inputPoint.by,n=t.starCount.rect;i>=n.bx1&&i<=n.bx2&&s>=n.by1&&s<=n.by2?null!==(i=this.getNewNumber(t.starCount,t.starCount.count))&&(t.starCount.set(i),this.mousereset()):this.inputborder()},inputdot:function(){var t=this.getpos(.15);if(!this.prevPos.equals(t)){var i=t.getDot();if(null!==i&&"cell"!==i.piece.group){if(null===this.inputData)this.inputData=3;else if(3!==this.inputData)return;i.setDot(1!==i.getDot()?1:0),i.draw(),this.prevPos=t}}}},KeyEvent:{enablemake:!0,moveTarget:function(){return!1},keyinput:function(t){this.keydown&&this.puzzle.editmode&&this.key_inputqnum_starbattle(t)},key_inputqnum_starbattle:function(t){var i=this.puzzle.board,t=this.getNewNumber(i.starCount,t,i.starCount.count);null!==t&&(i.starCount.set(t),this.prev=i.starCount)}},Dot:{getDot:function(){return this.piece.qsub},setDot:function(t){this.puzzle.opemgr.disCombine=!0,this.piece.setQsub(t),this.puzzle.opemgr.disCombine=!1},getTrial:function(){return this.piece.trial}},Board:{hasborder:1,hasdots:1,starCount:null,createExtraObject:function(){this.starCount=new this.klass.StarCount(1)},initExtraObject:function(t,i){this.starCount.init(1)},isDot:function(t,i){t=this.getDot(t,i);return null!==t&&1===t.getDot()},isStar:function(t,i){return 1===this.getc(t,i).qans},dotIsRedundant:function(t,i){var s=this.getDot(t,i);if(null===s||s.isnull)return!1;s=s.piece;return"cross"===s.group?this.isStar(t-1,i-1)||this.isStar(t-1,i+1)||this.isStar(t+1,i-1)||this.isStar(t+1,i+1):"border"===s.group&&(s.isvert?this.isStar(t-1,i)||this.isStar(t+1,i):this.isStar(t,i-1)||this.isStar(t,i+1))}},StarCount:{count:1,rect:null,initialize:function(t){this.count=t,this.rect={bx1:-1,by1:-1,bx2:-1,by2:-1}},init:function(t){this.count=t;t=this.puzzle.board;this.rect={bx1:t.maxbx-3.15,by1:-1.8,bx2:t.maxbx-.15,by2:-.2}},set:function(t){this.count!==(t=t<=0?1:t)&&(this.addOpe(this.count,t),this.count=t,this.draw())},getmaxnum:function(){var t=this.board;return Math.max(Math.floor(t.cols/4),1)},getminnum:function(){return 1},addOpe:function(t,i){this.puzzle.opemgr.add(new this.klass.StarCountOperation(t,i))},draw:function(){this.puzzle.painter.paintRange(this.board.minbx,-1,this.board.maxbx,-1)}},"StarCountOperation:Operation":{type:"starCount",setData:function(t,i){this.old=t,this.num=i},decode:function(t){return"AS"===t[0]&&(this.old=+t[1],this.num=+t[2],!0)},toString:function(){return["AS",this.old,this.num].join(",")},undo:function(){this.exec(this.old)},redo:function(){this.exec(this.num)},exec:function(t){this.board.starCount.set(t)}},OperationManager:{addExtraOperation:function(){this.operationlist.push(this.klass.StarCountOperation)}},AreaRoomGraph:{enabled:!0},Graphic:{paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawDots(),this.drawDashes(),this.drawStars(),this.drawChassis(),this.drawStarCount(),this.drawCursor_starbattle()},getCanvasRows:function(){return this.getBoardRows()+2*this.margin+.8},getOffsetRows:function(){return.4},setRangeObject:function(t,i,s,n){this.common.setRangeObject.call(this,t,i,s,n),this.range.starCount=i<0},copyBufferData:function(t,i,s,n,e,o){this.common.copyBufferData.call(this,t,i,s,n,e,o),t.use.canvas&&this.range.starCount&&(s=this.board,n=i.child.width,e=(s.minby-.1)*this.bh+this.y0,t.context.clearRect(0,0-this.y0,n,e),t.drawImage(i.child,0,0,+n,+e,0-this.x0,0-this.y0,+n,+e))},getDotFillColor:function(t){return 1!==t.getDot()||"cell"===t.piece.group||this.board.dotIsRedundant(t.bx,t.by)?null:t.getTrial()?this.trialcolor:this.pekecolor},getDotOutlineColor:function(t){return null},getDotRadius:function(t){return.15},drawDashes:function(){for(var t=this.vinc("cell_dash","auto",!0),i=(t.lineWidth=2,this.range.cells),s=0;s<i.length;s++){var n,e,o=i[s];t.vid="c_dash_"+o.id,1===o.qsub?(n=o.bx*this.bw,e=o.by*this.bh,t.strokeStyle=o.trial?"rgb(192, 192, 192)":this.mbcolor,t.strokeLine(n-.2*this.bw,e,n+.2*this.bw,e)):t.vhide()}},drawStars:function(){for(var t=this.vinc("cell_star","auto",!0),i=this.range.cells,s=0;s<i.length;s++){var n=i[s];t.vid="c_star_"+n.id,1===n.qans?(t.fillStyle=n.trial?this.trialcolor:this.qanscolor,this.fillStar(t,n.bx*this.bw,n.by*this.bh,.8*this.bw,.8*this.bh)):t.vhide()}},drawStarCount:function(){var t=this.vinc("starcount","auto",!0),i=this.board;this.range.starCount&&(t.use.canvas&&t.context.clearRect(0,-this.y0,t.child.width,(i.minby-.1)*this.bh+this.y0),t.fillStyle=this.quescolor,t.vid="bd_starCount",t.font=(.66*this.ch|0)+"px "+this.fontfamily,t.textAlign="right",t.textBaseline="middle",t.fillText(""+i.starCount.count,(i.maxbx-1.8)*this.bw,-this.bh),t.vid="bd_star",this.fillStar(t,(i.maxby-1)*this.bw,-this.bh,.7*this.bw,.7*this.bh))},drawCursor_starbattle:function(){var t,i=this.vinc("target_cursor","crispEdges",!0),s=this.board;this.range.starCount&&(t=this.puzzle.editmode&&this.puzzle.getConfig("cursor")&&!this.outputImage,i.vid="ti",t?(t=s.starCount.rect,i.strokeStyle=this.targetColorEdit,i.lineWidth=0|Math.max(this.cw/16,2),i.strokeRect(t.bx1*this.bw,t.by1*this.bh,(t.bx2-t.bx1)*this.bw,(t.by2-t.by1)*this.bh)):i.vhide())}},Encode:{decodePzpr:function(t){this.decodeStarCount(),this.decodeBorder()},encodePzpr:function(t){this.encodeStarCount(),this.encodeBorder()},decodeStarCount:function(){var t=this.outbstr.split("/");this.board.starCount.count=+t[0],this.outbstr=t[1]||""},encodeStarCount:function(){this.outbstr=this.board.starCount.count+"/"}},FileIO:{decodeData:function(){this.board.starCount.count=+this.readLine(),this.decodeAreaRoom(),this.decodeCellAns()},encodeData:function(){this.writeLine(this.board.starCount.count),this.encodeAreaRoom(),this.encodeCellAns()}},AnsCheck:{checklist:["checkAroundStars","checkOverSaturatedStars","checkInsufficientStars","checkStarCountInLine"],checkAroundStars:function(){this.checkAroundCell(function(t,i){return 1===t.qans&&1===i.qans},"starAround")},checkInsufficientStars:function(){var e=this.board;this.checkAllBlock(e.roommgr,function(t){return 1===t.qans},function(t,i,s,n){return s>=e.starCount.count},"bkStarLt")},checkOverSaturatedStars:function(){var e=this.board;this.checkAllBlock(e.roommgr,function(t){return 1===t.qans},function(t,i,s,n){return s<=e.starCount.count},"bkStarGt")},checkStarCountInLine:function(){this.checkRowsCols(this.isStarCountInClist,"lnStarNe")},isStarCountInClist:function(t){var i=t.filter(function(t){return 1===t.qans}).length===this.board.starCount.count;return i||t.seterr(1),i}}},"object"==typeof module&&module.exports?module.exports=[t,i]:pzpr.classmgr.makeCustom(t,i)}();
//# sourceMappingURL=starbattle.js.map