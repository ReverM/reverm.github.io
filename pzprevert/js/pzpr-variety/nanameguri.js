/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["nanameguri"],{MouseEvent:{inputModes:{edit:["info-line"],play:["line","peke","info-line"]},mouseinput_auto:function(){var e=this.puzzle;e.playmode?"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&(this.prevPos.reset(),this.inputpeke()):"right"===this.btn&&this.inputpeke():e.editmode&&this.input8dirs()},mousereset:function(){this.mouseCross=null,this.common.mousereset.call(this)},input8dirs:function(){var e,t,i,s,r,o,n,a;this.mouseCross?(o=this.mouseCross,(n=this.inputPoint.bx-o.bx)*n+(a=this.inputPoint.by-o.by)*a<1.44||(s=Math.atan2(a,n)/Math.PI,Math.abs(s)<.125?t=o.relcross(2,0):.125<s&&s<.375?t=o.relcross(2,2):.375<s&&s<.625?t=o.relcross(0,2):.625<s&&s<.875?t=o.relcross(-2,2):.875<Math.abs(s)?t=o.relcross(-2,0):s<-.125&&-.375<s?t=o.relcross(2,-2):s<-.375&&-.625<s?t=o.relcross(0,-2):s<-.625&&-.875<s&&(t=o.relcross(-2,-2)),t&&!t.isnull&&(this.mouseCross=t,s=Math.min(o.bx,t.bx),e=Math.max(o.bx,t.bx),r=Math.min(o.by,t.by),t=Math.max(o.by,t.by),s===e||r===t?(i=this.board.borderinside(s,r,e,t)[0])&&!i.isnull&&i.inside&&(null===this.inputData&&(this.inputData=i.isBorder()?0:1),1===this.inputData?i.setBorder():0===this.inputData&&i.removeBorder(),i.draw()):(i=this.board.cellinside(s,r,e,t)[0])&&!i.isnull&&(s=0<n*a?31:32,r=i.ques,null===this.inputData&&(this.inputData=r===s?0:1),r===s&&0===this.inputData?(i.setQues(0),i.draw()):r!==s&&1===this.inputData&&(i.setQues(s),i.draw()))))):(o=this.getcross()).isnull||(n=this.inputPoint.bx-o.bx)*n+(a=this.inputPoint.by-o.by)*a<.64&&(this.mouseCross=o)}},Board:{hasborder:2,initBoardSize:function(e,t){this.common.initBoardSize.call(this,e,t),this.diagonalRegions=null},addExtraInfo:function(){this.bordergraph=this.addInfoList(this.klass.BorderGraph)},diagonalRegions:null,getDiagonalRegions:function(){if(this.diagonalRegions)return this.diagonalRegions;for(var e=[],t=0;t<this.bordergraph.components.length;t++){for(var i=this.bordergraph.components[t],s=new Set,r={top:new Set,bottom:new Set,left:new Set,right:new Set},o=new Set,n=new Set,a={},d=1;d<=5;d++)a["form"+d]=new this.klass.CellList;for(var h=0;h<i.nodes.length;h++){var l=i.nodes[h].obj;o.add(l),l.isvert?(r.right.add(l.sidecell[0]),r.left.add(l.sidecell[1])):(r.bottom.add(l.sidecell[0]),r.top.add(l.sidecell[1])),s.add(l.sidecell[0]),s.add(l.sidecell[1])}for(var c=Array.from(s),u=0;u<c.length;u++){d=0;switch((b=c[u]).ques){case 31:(r.left.has(b)||r.bottom.has(b))&&(d=2),(r.right.has(b)||r.top.has(b))&&(d=2===d?1:4);break;case 32:(r.left.has(b)||r.top.has(b))&&(d=5),(r.right.has(b)||r.bottom.has(b))&&(d=5===d?1:3);break;default:d=1}!b.adjborder.top.isBorder()||1!==d&&4!==d&&5!==d||n.add(b.adjborder.top),!b.adjborder.bottom.isBorder()||1!==d&&2!==d&&3!==d||n.add(b.adjborder.bottom),!b.adjborder.left.isBorder()||1!==d&&2!==d&&5!==d||n.add(b.adjborder.left),!b.adjborder.right.isBorder()||1!==d&&3!==d&&4!==d||n.add(b.adjborder.right),a["form"+d].add(b)}a.edges=new this.klass.BorderList(n),a.inner=new this.klass.BorderList(o),e.push(a)}for(u=0;u<this.cell.length;u++){var b=this.cell[u],f={};["top","bottom","left","right"].forEach(function(e){f[e]=!b.adjborder[e].inside||b.adjborder[e].isBorder()}),0===b.ques&&f.top&&f.bottom&&f.left&&f.right&&e.push({edges:this.borderinside(b.bx-1,b.by-1,b.bx+1,b.by+1),form1:new this.klass.CellList([b])}),31===b.ques&&f.bottom&&f.left&&e.push({edges:this.borderinside(b.bx-1,b.by,b.bx,b.by+1),form2:new this.klass.CellList([b])}),32===b.ques&&f.bottom&&f.right&&e.push({edges:this.borderinside(b.bx,b.by,b.bx+1,b.by+1),form3:new this.klass.CellList([b])}),31===b.ques&&f.top&&f.right&&e.push({edges:this.borderinside(b.bx,b.by-1,b.bx+1,b.by),form4:new this.klass.CellList([b])}),32===b.ques&&f.top&&f.left&&e.push({edges:this.borderinside(b.bx-1,b.by-1,b.bx,b.by),form5:new this.klass.CellList([b])})}return this.diagonalRegions=e}},BoardExec:{adjustBoardData:function(e,t){if(e&this.TURNFLIP)for(var i=this.board.cell,s=0;s<i.length;s++){var r=i[s];r.ques={0:0,31:32,32:31}[r.ques]}this.board.diagonalRegions=null}},Border:{enableLineNG:!0,isLineNG:function(){return!this.inside}},Cell:{seterr:function(e){this.board.isenableSetError()&&(0<e&&this.error&&this.error!==e?this.error=1:this.error=e)}},CellList:{seterr:function(e){for(var t=0;t<this.length;t++)this[t].seterr(e)}},LineGraph:{enabled:!0},"BorderGraph:AreaGraphBase":{enabled:!0,pointgroup:"border",relation:{"cell.ques":"link","border.ques":"node"},setComponentRefs:function(e,t){e.bdarea=t},getObjNodeList:function(e){return e.bdareanodes},resetObjNodeList:function(e){e.bdareanodes=[]},isnodevalid:function(e){return e.inside&&!e.isBorder()},isedgevalidbynodeobj:function(e,t){var i=Math.min(e.bx,t.bx),s=Math.max(e.bx,t.bx),r=Math.min(e.by,t.by),e=Math.max(e.by,t.by),t=this.board.cellinside(i,r,s,e)[0];if(!t||t.isnull||!t.ques)return!0;var o=s-t.bx,n=e-t.by;return i!==s&&r!==e&&(o==n?31!==t.ques:32!==t.ques)},setEdgeByLinkObj:function(e){var t=this;this.getSideObjByLinkObj(e).each(function(e){e.isnull||t.setEdgeByNodeObj(e)}),this.remakeComponent()},getSideObjByLinkObj:function(e){return this.board.borderinside(e.bx-1,e.by-1,e.bx+1,e.by+1)},getSideObjByNodeObj:function(e){var t=[e.relbd(-1,-1),e.relbd(-1,1),e.relbd(1,-1),e.relbd(1,1)];return e.isvert?t.push(e.relbd(-2,0),e.relbd(2,0)):t.push(e.relbd(0,-2),e.relbd(0,2)),t.filter(function(e){return!e.isnull})},setExtraData:function(e){this.board.diagonalRegions=null}},Graphic:{irowake:!0,paint:function(){this.drawBGCells_naname(),this.drawDashedGrid(),this.drawBorders(),this.drawSlashes(),this.drawLines(),this.drawPekes(),this.drawChassis()},getBorderColor:function(e){return this.addlw=-this.lw/3,e.isBorder()?this.quescolor:null},drawBGCells_naname:function(){for(var e=this.vinc("cell_back","crispEdges"),t=(e.fillStyle=this.errbcolor1,this.range.cells),i=0;i<t.length;i++){var s=t[i],r=s.error,o=s.bx*this.bw,n=s.by*this.bh;e.vid="c_bglight_"+s.id,1===r?e.fillRectCenter(o,n,this.bw+.5,this.bh+.5):0!==r?this.drawTriangle1(o,n,r):e.vhide()}}},Encode:{decodePzpr:function(e){this.decodeBorder(),this.genericDecodeThree(function(e,t){t&&(e.ques=t+30)})},encodePzpr:function(e){this.encodeBorder(),this.genericEncodeThree(function(e){return Math.max(0,e.ques-30)})}},FileIO:{decodeData:function(){this.decodeBorderQues(),this.decodeCell(function(e,t){"1"===t?e.ques=31:"2"===t&&(e.ques=32)}),this.decodeBorderLine()},encodeData:function(){this.encodeBorderQues(),this.encodeCell(function(e){return 31===e.ques?"1 ":32===e.ques?"2 ":". "}),this.encodeBorderLine()}},AnsCheck:{checklist:["checkDiagonalCrossed","checkBranchLine","checkCrossLine","checkRoomPassOnce","checkDiagonalVisited+","checkNoRoadCountry","checkDeadendLine++","checkOneLoop"],checkRoomPassOnce:function(){this.checkAllRooms(1,"bkPassTwice")},checkNoRoadCountry:function(){this.checkAllRooms(-1,"bkNoLine")},checkAllRooms:function(e,t){for(var i=this.board.getDiagonalRegions(),s=0;s<i.length;s++){var r=i[s].edges.filter(function(e){return e.isLine()}).length;if(!(0<e&&r<=2)&&!(e<0&&0<r||e<0&&i[s].inner&&i[s].inner.some(function(e){return e.isLine()}))){if(this.failcode.add(t),this.checkOnly)break;for(var o=1;o<=5;o++)i[s]["form"+o]&&i[s]["form"+o].seterr(o)}}},checkDiagonalVisited:function(){this.checkAllCell(function(e){return 0===e.lcnt&&e.ques},"lnIsolate")},checkDiagonalCrossed:function(){this.checkAllCell(function(e){var t=e.adjborder;switch(e.ques){case 31:return(t.left.isLine()||t.bottom.isLine())&&(t.top.isLine()||t.right.isLine());case 32:return(t.left.isLine()||t.top.isLine())&&(t.bottom.isLine()||t.right.isLine());default:return!1}},"ceIntersect")}},FailCode:{bkPassTwice:"bkPassTwice.country",bkNoLine:"bkNoLine.country"}});
//# sourceMappingURL=nanameguri.js.map