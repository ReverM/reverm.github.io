/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["parquet"],{MouseEvent:{use:!0,inputModes:{edit:["border","sub-border","clear","info-blk"],play:["shade","unshade","info-blk"]},mouseinput:function(){"shade"===this.inputMode||"unshade"===this.inputMode?this.inputtile():this.common.mouseinput.call(this)},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&this.inputtile():this.puzzle.editmode&&(this.mousestart||this.mousemove)&&(1===this.puzzle.getConfig("use")?this.inputborder_parquet("left"===this.btn?1:2):this.inputborder_parquet())},inputtile:function(){var e=this.getcell();if(!e.isnull&&e!==this.mouseCell){null===this.inputData&&(this.lastRegion=null,this.decIC(e));var t=(this.mouseCell=e).room.clist;if(this.board.spblockgraph.suppresscmp=!0,this.puzzle.execConfig("singleregion")&&1===this.inputData&&!e.isShade()){this.lastRegion&&this.lastRegion===e.spblock?this.puzzle.opemgr.chainflag=!0:this.lastRegion=e.spblock;for(var s=e.spblock.clist.filter(function(e){return-1===t.indexOf(e)}),o=0;o<s.length;o++)(i=s[o]).clrShade()}for(o=0;o<t.length;o++){var i=t[o];1!==this.inputData&&3===i.qsub||((1===this.inputData?i.setShade:i.clrShade).call(i),i.setQsub(2===this.inputData?1:0))}this.board.spblockgraph.suppresscmp=!1,e.spblock.checkAutoCmp(),e.spblock.clist.draw()}},inputborder:function(){this.inputborder_parquet(1)},mouseinput_clear:function(){this.puzzle.editmode&&this.inputborder_parquet(0)},mouseinput_other:function(){"sub-border"===this.inputMode&&this.inputborder_parquet(2)},inputborder_parquet:function(e){var t=this.getpos(.35);if(!this.prevPos.equals(t)){var s=this.prevPos.getborderobj(t);if(!s.isnull){if(null===this.inputData&&(this.inputData=void 0===e?(s.ques+("left"===this.btn?4:2))%3:s.ques===e?0:e),0===this.inputData&&s.sidecell[0].isShade()!==s.sidecell[1].isShade())for(var o=0;o<=1;o++)for(var i=s.sidecell[o].room,r=0;i&&r<i.clist.length;r++){var n=i.clist[r];n.clrShade(),n.draw()}s.setQues(this.inputData),s.draw()}this.prevPos=t}}},Board:{hasborder:1,addExtraInfo:function(){this.spblockgraph=this.addInfoList(this.klass.AreaSuperRoomGraph)}},Cell:{posthook:{qans:function(e){this.spblock.checkAutoCmp()}}},CellList:{checkCmp:function(){if(this.length<=0)return!1;var e=this[0].spblock.tiles;return!e||this.board.spblockgraph.suppresscmp?!!this[0].spblock.iscmp:1===e.filter(function(e){return e.clist&&e.clist.length&&e.clist[0].isShade()}).length}},AreaShadeGraph:{enabled:!0},AreaRoomGraph:{enabled:!0,setExtraData:function(e){e.clist=new this.klass.CellList(e.getnodeobjs()),this.rebuildmode||0===e.clist.length||(e=e.clist[0].spblock)&&this.board.spblockgraph.setComponentInfo(e)}},"AreaSuperRoomGraph:AreaRoomGraph":{enabled:!0,suppresscmp:!1,countprop:"lcnt2",getComponentRefs:function(e){return e.spblock},setComponentRefs:function(e,t){e.spblock=t},getObjNodeList:function(e){return e.spnodes},resetObjNodeList:function(e){e.spnodes=[]},isedgevalidbylinkobj:function(e){return 1!==e.ques},setExtraData:function(e){for(var t=[],s=e.clist=new this.klass.CellList(e.getnodeobjs()),o=(e.size=s.length,this.board.roommgr.components),i=0;i<o.length;i++)o[i].count=0;for(i=0;i<s.length;i++){if(!s[i].room)return void(e.tiles=[]);s[i].room.count++}for(i=0;i<o.length;i++)0<o[i].count&&t.push(o[i]);e.tiles=t,e.checkAutoCmp()}},Graphic:{autocmp:"room",enablebcolor:!0,bbcolor:"rgb(96, 96, 96)",qcmpbgcolor:"rgb(96, 255, 160)",paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawDotCells(),this.drawQuesNumbers(),this.drawBorders(),this.drawChassis(),this.drawBaseMarks(this.puzzle.editmode&&!this.outputImage),this.drawBoxBorders(!0)},drawBorders:function(){this.vinc("border","crispEdges"),this.drawBorders_common("b_bd_")},getBorderColor:function(e){return this.addlw=2===e.ques?1-this.lw:0,2===e.ques&&e.sidecell[0].isShade()&&e.sidecell[1].isShade()?this.bbcolor:e.ques?this.quescolor:null},getBGCellColor:function(e){return 1===e.error||1===e.qinfo?this.errbcolor1:this.puzzle.execConfig("autocmp")&&e.spblock&&e.spblock.cmp?this.qcmpbgcolor:null}},Encode:{decodePzpr:function(e){var s=this.board;this.genericDecodeNumber16(s.cell.length,function(e,t){e=s.cell[e];e.adjborder.right.isnull||(e.adjborder.right.ques=t/3|0),e.adjborder.bottom.isnull||(e.adjborder.bottom.ques=t%3)})},encodePzpr:function(e){var t=this.board;this.genericEncodeNumber16(t.cell.length,function(e){e=t.cell[e];return 3*e.adjborder.right.ques+e.adjborder.bottom.ques})}},FileIO:{decodeData:function(){this.decodeBorder(function(e,t){e.ques=+t}),this.decodeCellAns()},encodeData:function(){this.encodeBorder(function(e){return e.ques+" "}),this.encodeCellAns()}},AnsCheck:{checklist:["checkSameColorTile","checkPluralShadeTileInSuperGroup","check2x2ShadeCell","checkShadeLoop","checkConnectShade","checkNoShadeTileInSuperGroup"],checkShadeLoop:function(){for(var e=this.board,t=e.sblkmgr.components,s=0;s<t.length;s++)if(0!==t[s].circuits){if(this.failcode.add("csLoop"),this.checkOnly)return;this.searchloop(t[s],e.sblkmgr).seterr(1)}},checkNoShadeTileInSuperGroup:function(){this.checkSuperGroups(-1,"bkNoShade")},checkPluralShadeTileInSuperGroup:function(){this.checkSuperGroups(1,"bkPluralShade")},checkSuperGroups:function(e,t){for(var s=this.board.spblockgraph.components,o=0;o<s.length;o++){var i=s[o],r=i.tiles;if(r){r=r.filter(function(e){return e.clist[0].isShade()}).length;if(!(0<r&&e<0||r<2&&0<e)){if(this.failcode.add(t),this.checkOnly)break;i.clist.seterr(1)}}}}}});
//# sourceMappingURL=parquet.js.map