/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(i,e){"object"==typeof module&&module.exports?module.exports=[i,e]:pzpr.classmgr.makeCustom(i,e)}(["toichika","toichika2","news","yajirushi","yajirushi2"],{MouseEvent:{inputModes:{edit:["border","arrow","clear"],play:["arrow","objblank","clear"]},mouseinput_other:function(){"objblank"===this.inputMode&&this.inputDot()},mouseinputAutoEdit:function(){this.mousestart||this.mousemove?this.board.roommgr.enabled&&this.isBorderMode()?this.inputborder():this.inputarrow_cell():this.mouseend&&this.notInputted()&&this.inputqnum()},mouseinputAutoPlay:function(){this.mousestart||this.mousemove?"left"===this.btn?this.inputarrow_cell():"right"!==this.btn||"toichika"!==this.pid&&!this.mousemove||this.inputDot():this.mouseend&&this.notInputted()&&this.inputqnum()},inputDot:function(){var i,e=this.getcell();e.isnull||e===this.mouseCell||"toichika2"!==this.pid&&-1!==e.qnum||(i=e.numberWithMB?2:1,null===this.inputData&&(this.inputData=e.qsub===i?0:1),e.setAnum(-1),e.setQsub(1===this.inputData?i:0),(this.mouseCell=e).draw())},inputclean_cell:function(){this.common.inputclean_cell.call(this);var i=this.getcell();!i.isnull&&i.room&&i.room.checkAutoCmp()}},"MouseEvent@toichika2":{inputModes:{edit:["border","number","clear"],play:["number","objblank","clear"]},mouseinput_auto:function(){this.puzzle.playmode?"left"===this.btn?this.mousemove&&this.dragDots():"right"===this.btn&&this.mousemove&&this.inputDot():this.puzzle.editmode&&(this.mousestart||this.mousemove)&&this.inputborder(),this.mouseend&&this.notInputted()&&(this.mouseCell=null,this.inputqnum())},dragDots:function(){var i=this.getcell();if(!i.isnull&&i!==this.mouseCell){if(this.mouseCell.isnull)return-1!==i.anum?void 0:(this.inputData=1===i.qsub?-2:10,void(this.mouseCell=i));-2===this.inputData?(i.setAnum(-1),i.setQsub(1)):10===this.inputData&&(i.setAnum(-1),i.setQsub(0)),(this.mouseCell=i).draw()}}},"MouseEvent@yajirushi2":{inputModes:{edit:["number","empty","clear"],play:["arrow","objblank","numexist","completion","clear"]},mouseinputAutoEdit:function(){this.mousestart&&this.inputqnum()},inputqcmp:function(){var i=this.getcell();i.isnull||i.qnum<0||(i.setQcmp(+!i.qcmp),i.draw(),this.mousereset())}},"MouseEvent@news":{inputModes:{edit:["border","arrow","empty","clear"],play:["arrow","objblank","numexist","clear"]},inputempty:function(){this.inputFixedNumber(-2)}},"MouseEvent@yajirushi":{inputModes:{edit:["arrow","empty","clear"],play:["arrow","objblank","clear"]},inputempty:function(){this.inputFixedNumber(-2)}},KeyEvent:{enablemake:!0,enableplay:!0},"KeyEvent@toichika,yajirushi,yajirushi2":{moveTarget:function(i){return!i.match(/shift/)&&this.moveTCell(i)},keyinput:function(i){this.key_toichika(i)},key_toichika:function(i){"1"===i||"w"===i||"shift+up"===i?i="1":"2"===i||"s"===i||"shift+right"===i?i="4":"3"===i||"z"===i||"shift+down"===i?i="2":"4"===i||"a"===i||"shift+left"===i?i="3":"5"===i||"q"===i||"-"===i?i="s1":"6"!==i&&"e"!==i&&" "!==i||(i=" "),this.key_inputqnum(i)}},"KeyEvent@yajirushi2#1":{keyinput:function(i){this.puzzle.playmode?this.key_arrows(i):this.key_inputqnum(i)},key_arrows:function(i){0<="oaz+".indexOf(i)?i="s1":0<="6wsx-".indexOf(i)?i="s2":"7"===i&&(i=" "),this.key_toichika(i)}},"KeyEvent@toichika2":{keyinput:function(i){this.key_inputqnum(i="q"!==i&&"-"!==i?i:"s1")}},"KeyEvent@news#1":{keyinput:function(i){"n"===i?i="1":"s"===i?i="2":"w"===i?i="3":"e"===i?i="4":"6"===i||"o"===i||"z"===i?i="s1":"5"===i||"x"===i||"-"===i?i=this.puzzle.playmode?"s2":"s1":"7"===i&&(i=" "),this.key_inputqnum(i)}},Cell:{numberAsObject:!0,maxnum:4,posthook:{qnum:function(i){this.room&&this.room.checkAutoCmp()},anum:function(i){this.room&&this.room.checkAutoCmp()}}},"Cell@yajirushi2":{minnum:function(){return this.puzzle.editmode?0:1},numberWithMB:!0,isDot:function(){return 2===this.qsub}},"Cell@toichika2":{disInputHatena:!0,supportQnumAnum:!0,maxnum:function(){return Math.max(this.board.cols-2,this.board.rows-2)},setNum:function(i){0!==i&&(this.puzzle.editmode?this.setQnum(i):-2!==i?(this.setQsub(0),this.setAnum(i)):(this.setQsub(1),this.setAnum(-1)))},getNum:function(){return this.puzzle.editmode?this.qnum:this.anum},isNum:function(){return!this.isnull&&this.anum!==this.temp.anum},noNum:function(){return!this.isnull&&this.anum===this.temp.anum}},"Cell@news":{enableSubNumberArray:!0,numberWithMB:!0,isNum:function(){return 0<this.qnum||0<this.anum},isDot:function(){return 2===this.qsub},isEmpty:function(){return-2===this.qnum},isRelativeValid:function(i){switch(this.getNum()){case this.UP:return this.by<i.by;case this.DN:return this.by>i.by;case this.LT:return this.bx<i.bx;case this.RT:return this.bx>i.bx;default:return!0}}},Board:{hasborder:1},"Board@news":{rows:8,cols:8},"CellList@toichika,toichika2,news":{checkCmp:function(){var i="news"===this.pid?2:1;return this.filter(function(i){return i.isNum()}).length===i}},"BoardExec@toichika,news,yajirushi":{adjustBoardData:function(i,e){this.adjustCellArrow(i,e)}},"BoardExec@yajirushi2":{adjustBoardData:function(i,e){if(i&this.TURNFLIP)for(var t=this.getTranslateDir(i),n=this.board.cellinside(e.x1,e.y1,e.x2,e.y2),r=0;r<n.length;r++){var o=n[r],s=t[o.anum];s&&(o.anum=s)}}},"AreaRoomGraph@toichika,toichika2,news":{enabled:!0,getSideAreaKeys:function(){for(var i=this.components.length,e={len:i},t=this.board,n=0;n<i;n++)this.components[n].id=n;for(var r=0;r<t.border.length;r++){var o=t.border[r].sidecell[0],s=t.border[r].sidecell[1];o.isnull||s.isnull||((o=o.room)===(s=s.room)||null===o||null===s||e[s=o.id<s.id?o.id*i+s.id:s.id*i+o.id]||(e[s]=!0))}return e}},"AreaRoomGraph@toichika2#1":{hastop:!0},Graphic:{gridcolor_type:"LIGHT",autocmp:"room",bgcellcolor_func:"qcmp",paint:function(){this.drawBGCells(),this.drawTargetSubNumber(),this.drawGrid(),this.drawBorders(),this.drawDotCells(),"yajirushi2"===this.pid?(this.drawQuesCells(),this.drawQuesNumbers(),this.drawCellArrows(),this.drawMBs()):"yajirushi"===this.pid?(this.drawQuesCells(),this.drawCellArrows()):"toichika"===this.pid?(this.drawCellArrows(),this.drawHatenas()):(this.drawAnsNumbers(),this.drawQuesNumbers()),"news"===this.pid&&(this.drawXCells(),this.drawMBs(),this.drawSubNumbers()),this.drawChassis(),this.drawCursor()}},"Graphic@yajirushi":{autocmp:null,hideHatena:!0,getQuesCellColor:function(i){return-2===i.qnum?this.quescolor:null}},"Graphic@yajirushi2":{autocmp:null,fgcellcolor_func:"qnum",fontShadecolor:"white",hideHatena:!0,getQuesNumberColor:function(i){return i.qcmp?this.qcmpcolor:this.fontShadecolor},getCellArrowColor:function(i){var e=i.anum;return 1<=e&&e<=4?i.trial?this.trialcolor:this.qanscolor:null}},"Graphic@toichika2":{hideHatena:!0,textoption:{ratio:.45,position:5}},"Graphic@news":{getNumberTextCore:function(i){return 0<i?"NSWE"[i-1]:null},getBGCellColor:function(i){return 2===i.error?"rgb(255,255,127)":this.getBGCellColor_qcmp(i)},drawXCells:function(){for(var i=this.vinc("cell_x","auto",!0),e=.2*this.cw,t=this.range.cells,n=0;n<t.length;n++){var r=t[n],o=(i.vid="c_x_"+r.id,r.bx*this.bw),s=r.by*this.bh;r.isEmpty()?(i.strokeStyle=this.quescolor,i.lineWidth=2,i.strokeCross(o,s,e)):i.vhide()}}},"Graphic@news,yajirushi2#1":{drawMBs:function(){for(var i=this.vinc("cell_mb","auto",!0),e=(i.lineWidth=1,.35*this.cw),t=this.range.cells,n=0;n<t.length;n++){var r,o,s=t[n];0<s.qsub&&(r=s.bx*this.bw,o=s.by*this.bh,i.strokeStyle=s.trial?"rgb(192, 192, 192)":this.mbcolor),i.vid="c_MB1_"+s.id,1===s.qsub?i.strokeCircle(r,o,e):i.vhide()}}},"AreaNumberGraph@news":{enabled:!0,isnodevalid:function(i){return i.getNum()<0}},"AreaNumberGraph@yajirushi2":{enabled:!0,isnodevalid:function(i){return!i.isNum()}},Encode:{decodePzpr:function(i){this.decodeBorder(),this.decodeRoomNumber16()},encodePzpr:function(i){this.encodeBorder(),this.encodeRoomNumber16()}},"Encode@yajirushi,yajirushi2":{decodePzpr:function(i){this.decode4Cell()},encodePzpr:function(i){this.encode4Cell()}},"Encode@toichika,news":{decodePzpr:function(i){this.decodeBorder(),this.decode4Cell_toichika(),this.decodeConfig()},encodePzpr:function(i){this.encodeConfig(),this.encodeBorder(),this.encode4Cell_toichika()},decode4Cell_toichika:function(){for(var i=0,e=0,t=this.outbstr,n=this.board,e=0;e<t.length;e++){var r=n.cell[i],o=t.charAt(e);if(this.include(o,"1","4")?r.qnum=parseInt(t.substr(e,1),10):"."===o?r.qnum=-2:i+=parseInt(o,36)-5,i++,!n.cell[i])break}this.outbstr=t.substr(e)},encode4Cell_toichika:function(){for(var i="",e=0,t=this.board,n=0;n<t.cell.length;n++){var r="",o=t.cell[n].qnum;-2===o?r=".":1<=o&&o<=4?r=o.toString(10):e++,0===e?i+=r:!r&&31!==e||(i+=(4+e).toString(36)+r,e=0)}0<e&&(i+=(4+e).toString(36)),this.outbstr+=i},decodeConfig:function(){},encodeConfig:function(){}},"Encode@news#1":{decodeConfig:function(){this.puzzle.setConfig("tren_new",this.checkpflag("n"))},encodeConfig:function(){this.outpflag=this.puzzle.getConfig("tren_new")?"n":null}},FileIO:{decodeData:function(){this.decodeConfig(),this.board.roommgr.enabled&&this.decodeAreaRoom(),this.decodeCellQnum(),this.decodeCellAnumsub()},encodeData:function(){this.encodeConfig(),this.board.roommgr.enabled&&this.encodeAreaRoom(),this.encodeCellQnum(),this.encodeCellAnumsub()},decodeConfig:function(){},encodeConfig:function(){}},"FileIO@news":{decodeConfig:function(){this.decodeConfigFlag("n","tren_new")},encodeConfig:function(){this.encodeConfigFlag("n","tren_new")}},AnsCheck:{checklist:["checkDoubleNumber","checkAdjacentCountries","checkToichikaClue@toichika2","checkNumberDistance@toichika2","checkNumberBlocked@toichika2","checkTripleRow@toichika2","checkBothRowAndColumn@toichika2","checkDirectionOfArrow","checkNoNumber"],checkDirectionOfArrow:function(){for(var i=this.getPairArrowsInfo(),e=0;e<i.length;e++)if(1===i[e].length){if(this.failcode.add("arAlone"),this.checkOnly)break;i[e][0].seterr(1)}},checkAdjacentCountries:function(){for(var i=this.board.roommgr.getSideAreaKeys(),e=i.len,t=this.getPairArrowsInfo(),n=0;n<t.length;n++)if(2===t[n].length){var r=t[n][0].room,o=t[n][1].room;if(i[r.id<o.id?r.id*e+o.id:o.id*e+r.id]){if(this.failcode.add("arAdjPair"),this.checkOnly)break;r.clist.seterr(1),o.clist.seterr(1)}}},getPairArrowsInfo:function(){if(this._info.parrow)return this._info.parrow;for(var i=[],e=[],t=this.board,n=0;n<t.cell.length;n++)(o=t.cell[n]).isBetween=!1,e[n]="yajirushi"===this.pid?o.isValidNum():"yajirushi2"===this.pid?0<o.anum:o.isNum();for(n=0;n<t.cell.length;n++){var r=t.cell[n];if(e[r.id])for(var o,s=r.getaddr(),u=r.getNum();;){if(s.movedir(u,2),(o=s.getc()).isBetween=!0,o.isnull||-2===o.qnum||"yajirushi2"===this.pid&&-1!==o.qnum){i.push([r]);break}if(e[o.id]){o.getNum()!==[0,o.DN,o.UP,o.RT,o.LT][u]?i.push([r]):i.push([o,r]);break}}}return this._info.parrow=i}},"AnsCheck@toichika2":{checkToichikaClue:function(){this.checkAllCell(function(i){return i.isNum()&&0<i.room.top.qnum&&i.anum!==i.room.top.qnum},"bkClue")},checkNumberDistance:function(){for(var i=this.getPairArrowsInfo(),e=0;e<i.length;e++)if(2===i[e].length){var t=i[e][0],n=i[e][1],r=2*t.anum+2;if(Math.abs(t.bx-n.bx)!==r&&Math.abs(t.by-n.by)!==r){if(this.failcode.add("arDistance"),this.checkOnly)break;t.seterr(1),n.seterr(1)}}},checkNumberBlocked:function(){for(var i=this.getPairArrowsInfo(),e=0;e<i.length;e++)if(2===i[e].length){var t=this.board.cellinside(i[e][0].bx,i[e][0].by,i[e][1].bx,i[e][1].by);if(2!==t.filter(function(i){return i.isNum()}).length){if(this.failcode.add("arBlocked"),this.checkOnly)break;t.seterr(1)}}},checkTripleRow:function(){this.multipleCount(!0,"nmTripRow")},checkBothRowAndColumn:function(){this.multipleCount(!1,"nmDupRowCol")},multipleCount:function(i,e){for(var t=this.getPairArrowsInfo(),n=0;n<t.length;n++)if(!(t[n].length<=2)){var r=new this.klass.CellList(t[n]),o=r.getRectSize();if(1===o.rows||1===o.cols){if(!i)continue}else if(i)continue;if(this.failcode.add(e),this.checkOnly)break;r.seterr(1)}},getPairArrowsInfo:function(){if(this._info.parrow)return this._info.parrow;var s=[];this.checkRowsCols(function(i){for(var e=[],t=0;t<i.length;t++)if(!i[t].noNum()){var n=i[t].anum;if(!e[n]){for(var r=[i[t]],o=t+1;o<i.length;o++)i[o].anum===n&&r.push(i[o]);e[n]=!0,s.push(r)}}return!0});for(var i=0;i<s.length;i++)for(var e=i+1;e<s.length;e++)if(s[i].some(function(i){return-1!==s[e].indexOf(i)})){if(1===s[i].length){s.splice(i,1),i--;break}1<s[e].length&&(s[i]=s[i].concat(s[e])),s.splice(e,1),e--}return this._info.parrow=s}},"AnsCheck@yajirushi,yajirushi2#1":{checkArrowsAdjacent:function(){for(var i=this.getPairArrowsInfo(),e=0;e<i.length;e++)if(2===i[e].length&&!i[e][0].getnb(i[e][1]).isnull){if(this.failcode.add("arAdjPair"),this.checkOnly)break;i[e][0].seterr(1),i[e][1].seterr(1)}}},"AnsCheck@yajirushi":{checklist:["checkArrowsAdjacent","checkDirectionOfArrow","checkEmptyInsidePair"],checkEmptyInsidePair:function(){this.checkAllCell(function(i){return!i.isNum()&&!i.isBetween},"cuNotPointed")}},"AnsCheck@yajirushi2":{checklist:["checkOverArrows","checkConnectEmpty","checkArrowsAdjacent","checkDirectionOfArrow","checkLessArrows"],checkArrows4Cell:function(i,e){for(var t=0;t<this.board.cell.length;t++){var n=this.board.cell[t],r=n.qnum;if(!(r<0)){var o=n.countDir4Cell(function(i){return 0<i.anum});if(!(0===i&&r===o||1===i&&r<=o||2===i&&o<=r)){if(this.failcode.add(e),this.checkOnly)break;n.seterr(1)}}}},checkOverArrows:function(){this.checkArrows4Cell(2,"nmArrowGt")},checkLessArrows:function(){this.checkArrows4Cell(1,"nmArrowLt")},checkConnectEmpty:function(){this.checkOneArea(this.board.nblkmgr,"bkDivide")}},"AnsCheck@news":{checklist:["checkTripleNumber","checkDifferentNumberInLine","checkRelativePositions","checkConnectEmpty","checkDirectionOfArrow","checkNoNumber"],checkTripleNumber:function(){this.checkAllBlock(this.board.roommgr,function(i){return i.isNum()},function(i,e,t,n){return t<3},"bkNumGe3")},checkRelativePositions:function(){for(var i=this.getPairArrowsInfo(),e=0;e<i.length;e++)if(2===i[e].length)for(var t=0;t<=1;t++){var n=i[e][t],r=i[e][1-t];if(!n.isRelativeValid(r)){if(this.failcode.add("arNotRelative"),this.checkOnly)return;n.seterr(1),1!==r.error&&r.seterr(2)}}},checkConnectEmpty:function(){this.puzzle.getConfig("tren_new")&&this.checkOneArea(this.board.nblkmgr,"bkDivide")},getPairArrowsInfo:function(){if(this._info.parrow)return this._info.parrow;for(var i=[],e=this.board.roommgr.components,t=0;t<e.length;t++){var n=e[t].clist.filter(function(i){return i.isNum()});1<=n.length&&n.length<=2&&i.push(n)}return this._info.parrow=i}},"FailCode@toichika2":{bkNumGe2:"bkNumGe2",bkNoNum:"bkNoNum"},"FailCode@news":{arAlone:"bkNumLt2.news",bkNoNum:"bkNoNum.nikoji",nmDupRow:"nmDupRow.easyasabc"},"FailCode@yajirushi":{arAdjPair:"arAdjPair.yajirushi2"}});
//# sourceMappingURL=toichika.js.map