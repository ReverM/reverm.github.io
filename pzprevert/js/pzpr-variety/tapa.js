/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["tapa"],{MouseEvent:{use:!0,inputModes:{edit:["number","clear","info-blk"],play:["shade","unshade","peke","info-blk"]},autoedit_func:"qnum",autoplay_func:"cell",mouseinput_clear:function(){var e=this.getcell();e.isnull||e===this.mouseCell||(e.setQnums([]),e.setQans(0),e.setQsub(0),e.draw(),this.mouseCell=e)},inputqnum:function(){var e=this.getcell();e.isnull||e===this.mouseCell||(e!==this.cursor.getc()?this.setcursor(e):this.inputqnum_tapa_main(e),this.mouseCell=e)},inputqnum_tapa_main:function(e){for(var t=e.qnum_states,n=0,s=0;s<t.length;s++)if(this.puzzle.pzpr.util.sameArray(e.qnums,t[s])){n=s;break}"number"===this.inputMode||"auto"===this.inputMode&&"left"===this.btn?n<t.length-1?n++:n=0:0<n?n--:n=t.length-1,e.setQnums(t[n]),e.setQans(0),e.setQsub(0),e.draw()}},KeyEvent:{enablemake:!0,keyinput:function(e){this.key_inputqnums(e)}},Cell:{minnum:0,maxnum:8,qnum_states:function(){for(var e=[[],[-2],[0],[1],[2],[3],[4],[5],[6],[7],[8]],t=0;t<=5;t++)for(var n=0;n<=5;n++)(0<t?t:1)+(0<n?n:1)<=6&&e.push([0<t?t:-2,0<n?n:-2]);for(t=0;t<=3;t++)for(n=0;n<=3;n++)for(var s=0;s<=3;s++)(0<t?t:1)+(0<n?n:1)+(0<s?s:1)<=5&&e.push([0<t?t:-2,0<n?n:-2,0<s?s:-2]);return e.push([1,1,1,1]),e}(),isValidQnums:function(e){if(0===e.length)return!0;if(1===e.length)return e[0]<=8;for(var t=0,n=0;n<e.length;n++){if(0===e[n])return!1;t+=0<=e[n]?e[n]:1}return e.length+t<=8},allowUnshade:function(){return 0===this.qnums.length},allowShade:function(){return 0===this.qnums.length},getShadedLength:function(){for(var e=[],t="",n=[[-2,-2],[0,-2],[2,-2],[2,0],[2,2],[0,2],[-2,2],[-2,0]],s=0;s<n.length;s++){var r=this.relcell(n[s][0],n[s][1]);t+=""+(!r.isnull&&r.isShade()?1:0)}var l=t.split(/0+/);if(0<l.length){0===l[0].length&&l.shift(),0===l[l.length-1].length&&l.pop(),1<l.length&&"1"===t.charAt(0)&&"1"===t.charAt(7)&&(l[0]+=l.pop());for(var u=0;u<l.length;u++)e.push(l[u].length)}return e=0===e.length?[0]:e}},Board:{hasborder:1},AreaShadeGraph:{enabled:!0,coloring:!0},Graphic:{irowakeblk:!0,qanscolor:"black",paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawDotCells(),this.drawGrid(),this.drawTapaNumbers(),this.drawChassis(),this.drawPekes(),this.drawTarget()}},Encode:{decodePzpr:function(e){this.decodeNumber_tapa()},encodePzpr:function(e){this.encodeNumber_tapa()},decodeNumber_tapa:function(){for(var e=0,t=0,n=this.outbstr,s=this.board,t=0;t<n.length;t++){var r=s.cell[e],l=n.charAt(t);if(this.include(l,"0","8"))r.qnums=[parseInt(l,10)];else if("9"===l)r.qnums=[1,1,1,1];else if("."===l)r.qnums=[-2];else if(this.include(l,"a","f")){var u=parseInt(n.substr(t,2),36),i=[];360<=u&&u<396?((i=[0,0])[0]=(u-=360)/6|0,u-=6*i[0],i[1]=u):396<=u&&u<460?((i=[0,0,0])[0]=(u-=396)/16|0,u-=16*i[0],i[1]=u/4|0,u-=4*i[1],i[2]=u):460<=u&&u<476&&((i=[0,0,0,0])[0]=(u-=460)/8|0,u-=8*i[0],i[1]=u/4|0,u-=4*i[1],i[2]=u/2|0,u-=2*i[2],i[3]=u);for(var a=0;a<4;a++)0===i[a]&&(i[a]=-2);r.qnums=i,t++}else"g"<=l&&l<="z"&&(e+=parseInt(l,36)-16);if(e++,!s.cell[e])break}this.outbstr=n.substr(t+1)},encodeNumber_tapa:function(){for(var e=0,t="",n=this.board,s=0;s<n.cell.length;s++){var r="",l=n.cell[s].qnums;1===l.length?r=-2===l[0]?".":l[0].toString(10):2===l.length?r=(6*(0<l[0]?l[0]:0)+(0<l[1]?l[1]:0)+360).toString(36):3===l.length?r=(16*(0<l[0]?l[0]:0)+4*(0<l[1]?l[1]:0)+(0<l[2]?l[2]:0)+396).toString(36):4===l.length?r=this.puzzle.pzpr.util.sameArray(l,[1,1,1,1])?"9":(8*(0<l[0]?1:0)+4*(0<l[1]?1:0)+2*(0<l[2]?1:0)+(0<l[3]?1:0)+460).toString(36):e++,0===e?t+=r:!r&&20!==e||(t+=(15+e).toString(36)+r,e=0)}0<e&&(t+=(15+e).toString(36)),this.outbstr+=t}},FileIO:{decodeData:function(){this.decodeCellQnumAns_tapa(),this.decodeBorderLine()},encodeData:function(){this.encodeCellQnumAns_tapa(),this.encodeBorderLineIfPresent()},decodeCellQnumAns_tapa:function(){this.decodeCell(function(e,t){if("#"===t)e.qans=1;else if("+"===t)e.qsub=1;else if("."!==t){e.qnums=[];for(var n=t.split(/,/),s=0;s<n.length;s++)e.qnums.push("-"!==n[s]?+n[s]:-2)}})},encodeCellQnumAns_tapa:function(){this.encodeCell(function(e){if(0<e.qnums.length){for(var t=[],n=0;n<e.qnums.length;n++)t.push(0<=e.qnums[n]?""+e.qnums[n]:"-");return t.join(",")+" "}return 1===e.qans?"# ":1===e.qsub?"+ ":". "})}},AnsCheck:{checklist:["checkShadeCellExist+","check2x2ShadeCell","checkCountOfClueCell","checkConnectShade+"],checkCountOfClueCell:function(){this.checkAllCell(function(e){if(0===e.qnums.length)return!1;var t=e.getShadedLength();if(e.qnums.length!==t.length)return!0;for(var n=0;n<e.qnums.length;n++){var s=e.qnums[n];if(-2!==s){s=t.indexOf(s);if(s<0)return!0;t.splice(s,1)}}return!1},"ceTapaNe")}}});
//# sourceMappingURL=tapa.js.map