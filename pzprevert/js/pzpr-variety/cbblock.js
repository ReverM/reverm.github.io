/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,r){"object"==typeof module&&module.exports?module.exports=[e,r]:pzpr.classmgr.makeCustom(e,r)}(["cbblock","dbchoco","nikoji","mirrorbk"],{"MouseEvent@cbblock":{inputModes:{edit:["border"],play:["border","subline"]},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&("left"===this.btn&&this.isBorderMode()?this.inputborder():this.inputQsubLine()):this.puzzle.editmode&&(this.mousestart||this.mousemove)&&this.inputborder()}},"MouseEvent@dbchoco":{inputModes:{edit:["shade","number","clear"],play:["border","subline"]},mouseinput_auto:function(){var e;this.puzzle.playmode?(this.mousestart||this.mousemove)&&("left"===this.btn&&this.isBorderMode()?this.inputborder():this.inputQsubLine()):this.puzzle.editmode&&!(e=this.getcell()).isnull&&(!this.mousestart||"right"===this.btn&&e!==this.cursor.getc()||(this.inputData=-1),this.mousestart&&e!==this.cursor.getc()&&"right"===this.btn||this.mousemove&&0<=this.inputData?this.inputShade():this.mouseend&&this.notInputted()&&(e!==this.cursor.getc()&&"auto"===this.inputMode&&"left"===this.btn?this.setcursor(e):this.inputqnum(e)))},inputShade:function(){this.inputIcebarn()}},"MouseEvent@nikoji":{inputModes:{edit:["number","clear"],play:["border","subline"]},autoedit_func:"qnum",autoplay_func:"border"},"MouseEvent@mirrorbk":{inputModes:{edit:["number","border"],play:["border","subline"]},autoedit_func:"areanum",autoplay_func:"border"},"KeyEvent@dbchoco":{enablemake:!0,keyinput:function(e){var r;"q"===e?((r=this.cursor.getc()).setQues(6!==r.ques?6:0),(this.prev=r).draw()):this.key_inputqnum(e)}},"KeyEvent@nikoji,mirrorbk":{enablemake:!0},"Border@cbblock#1":{ques:1},"Border@cbblock,mirrorbk":{enableLineNG:!0,isLineNG:function(){return 1===this.ques},isGround:function(){return 0<this.ques}},Board:{cols:8,rows:8,hascross:1,hasborder:1,addExtraInfo:function(){this.tilegraph=this.addInfoList(this.klass.AreaTileGraph),this.blockgraph=this.addInfoList(this.klass.AreaBlockGraph)}},"Board@nikoji":{recountNumbers:function(){var r=new Set;this.cell.each(function(e){0<=e.qnum&&r.add(e.qnum)}),this.nums=Array.from(r)},addExtraInfo:function(){}},"Board@mirrorbk":{addExtraInfo:function(){}},"Board@dbchoco":{cols:10,rows:10},"Cell@dbchoco":{maxnum:function(){var e=this.board;return e.cols*e.rows>>1}},"Cell@mirrorbk":{maxnum:function(){var e=this.board;return e.cols*e.rows}},"Cell@nikoji":{maxnum:52,numberAsLetter:!0,disInputHatena:!0,posthook:{qnum:function(){this.board.roommgr.setExtraData(this.room),this.board.recountNumbers()}}},"AreaTileGraph:AreaGraphBase":{enabled:!0,setComponentRefs:function(e,r){e.tile=r},getObjNodeList:function(e){return e.tilenodes},resetObjNodeList:function(e){e.tilenodes=[]},isnodevalid:function(e){return!0},setExtraData:function(e){this.klass.AreaGraphBase.prototype.setExtraData.call(this,e),this.rebuildmode||0===e.clist.length||(e=e.clist[0].block)&&this.board.blockgraph.setComponentInfo(e)}},"AreaTileGraph@cbblock":{relation:{"border.ques":"separator"},isedgevalidbylinkobj:function(e){return e.isGround()}},"AreaTileGraph@dbchoco":{relation:{"border.qans":"separator","cell.ques":"node"},isedgevalidbylinkobj:function(e){return!e.sidecell[0].isnull&&!e.sidecell[1].isnull&&(0===e.qans&&e.sidecell[0].ques===e.sidecell[1].ques)}},"AreaBlockGraph:AreaRoomGraph":{enabled:!0,getComponentRefs:function(e){return e.block},setComponentRefs:function(e,r){e.block=r},getObjNodeList:function(e){return e.blocknodes},resetObjNodeList:function(e){e.blocknodes=[]},isedgevalidbylinkobj:function(e){return 0===e.qans},setExtraData:function(e){for(var r=0,t=e.clist=new this.klass.CellList(e.getnodeobjs()),i=(e.size=t.length,this.board.tilegraph.components),o=0;o<i.length;o++)i[o].count=0;for(o=0;o<t.length;o++){if(!t[o].tile)return void(e.dotcnt=0);t[o].tile.count++}for(o=0;o<i.length;o++)0<i[o].count&&r++;e.dotcnt=r}},"AreaRoomGraph@nikoji":{enabled:!0,setExtraData:function(e){var r=(e.clist=new this.klass.CellList(e.getnodeobjs())).filter(function(e){return-1!==e.qnum});e.numcell=1===r.length?r[0]:null,e.num=e.numcell?e.numcell.qnum:null}},"AreaRoomGraph@mirrorbk":{enabled:!0},Graphic:{gridcolor_type:"LIGHT",paint:function(){this.drawBGCells(),this.drawDashedGrid(),"mirrorbk"===this.pid&&(this.drawMirrorBase(),this.drawMirrorSplit()),this.drawBorders(),this.drawBorderQsubs(),"mirrorbk"!==this.pid&&this.drawBaseMarks(),this.drawChassis(),this.drawPekes(),"cbblock"!==this.pid&&(this.drawQuesNumbers(),this.drawTarget())}},"Graphic@cbblock":{getBorderColor:function(e){var r;return 1===e.ques?(r=e.sidecell[1]).isnull||0===r.error?"white":this.errbcolor1:1===e.qans?1===e.error?this.errcolor1:e.trial?this.trialcolor:this.qanscolor:null}},"Graphic@dbchoco":{bgcellcolor_func:"icebarn",icecolor:"rgb(204,204,204)",bordercolor_func:"qans"},"Graphic@nikoji":{bordercolor_func:"qans"},"Graphic@mirrorbk":{fontsizeratio:.75,drawMirrorBase:function(){for(var e=this.vinc("border_mirror","crispEdges",!0),r=this.range.borders,t=0;t<r.length;t++){var i,o,n,s,c=r[t];e.vid="b_mirror_"+c.id,1===c.ques?(i=c.bx*this.bw,o=c.by*this.bh,n=1.2*(this.lw+this.addlw),s=0,e.fillStyle="black",c.isVert()?(1===c.relbd(0,2).ques&&(o+=1,s+=1),e.fillRectCenter(i,o,n,this.bh+s)):(1===c.relbd(2,0).ques&&(i+=1,s+=1),e.fillRectCenter(i,o,this.bw+s,n))):e.vhide()}},drawMirrorSplit:function(){for(var e=this.vinc("border_mirror2","crispEdges",!0),r=this.range.borders,t=0;t<r.length;t++){var i,o,n,s,c=r[t];e.vid="b_mirror2_"+c.id,1===c.ques?(i=c.bx*this.bw,o=c.by*this.bh,n=.4*(this.lw+this.addlw),s=0,e.fillStyle="white",c.isVert()?(1===c.relbd(0,2).ques&&(o+=1,s+=1),e.fillRectCenter(i,o,n,this.bh+s)):(1===c.relbd(2,0).ques&&(i+=1,s+=1),e.fillRectCenter(i,o,this.bw+s,n))):e.vhide()}},getBorderColor:function(e){return e.qans?this.getBorderColor_qans(e):null}},"Encode@cbblock":{decodePzpr:function(e){this.decodeCBBlock()},encodePzpr:function(e){this.encodeCBBlock()},decodeCBBlock:function(){for(var e=this.outbstr,r=this.board,t=[16,8,4,2,1],i=e?Math.min((r.border.length+4)/5|0,e.length):0,o=0,n=0;n<i;n++)for(var s=parseInt(e.charAt(n),32),c=0;c<5;c++)r.border[o]&&(r.border[o].ques=s&t[c]?1:0,o++);this.outbstr=e.substr(i)},encodeCBBlock:function(){for(var e=0,r=0,t="",i=this.board,o=[16,8,4,2,1],n=0,s=i.border.length;n<s;n++)i.border[n].isGround()&&(r+=o[e]),5===++e&&(t+=r.toString(32),r=e=0);0<e&&(t+=r.toString(32)),this.outbstr+=t}},"Encode@dbchoco":{decodePzpr:function(e){this.decodeDBChoco()},encodePzpr:function(e){this.encodeDBChoco()},decodeDBChoco:function(){this.decodeIce(),this.decodeNumber16()},encodeDBChoco:function(){this.encodeIce(),this.encodeNumber16()}},"Encode@nikoji":{decodePzpr:function(e){this.decodeNumber16()},encodePzpr:function(e){this.encodeNumber16()}},"Encode@mirrorbk":{decodePzpr:function(e){this.decodeNumber16(),this.decodeBorder()},encodePzpr:function(e){this.encodeNumber16(),this.encodeBorder()}},"FileIO@cbblock,mirrorbk":{decodeData:function(){"mirrorbk"===this.pid&&this.decodeCellQnum(),this.decodeBorder(function(e,r){"3"===r?(e.ques=0,e.qans=1,e.qsub=1):"1"===r?(e.ques=0,e.qans=1):"-1"===r?(e.ques=1,e.qsub=1):"-2"===r?(e.ques=0,e.qsub=1):e.ques="2"===r?0:1})},encodeData:function(){"mirrorbk"===this.pid&&this.encodeCellQnum(),this.encodeBorder(function(e){return 1===e.qans&&1===e.qsub?"3 ":1===e.qans?"1 ":1===e.ques&&1===e.qsub?"-1 ":0===e.ques&&1===e.qsub?"-2 ":0===e.ques?"2 ":"0 "})}},"FileIO@dbchoco":{decodeData:function(){this.decodeCell(function(e,r){"-"===r.charAt(0)&&(e.ques=6,r=r.substr(1)),"0"===r?e.qnum=-2:"."!==r&&0<+r&&(e.qnum=+r)}),this.decodeBorderAns()},encodeData:function(){this.encodeCell(function(e){var r="";return 6===e.ques&&(r+="-"),-2===e.qnum?r+="0":-1!==e.qnum&&(r+=e.qnum.toString()),(r=""===r?".":r)+" "}),this.encodeBorderAns()}},"FileIO@nikoji":{decodeData:function(){this.decodeCellQnum(),this.decodeBorderAns()},encodeData:function(){this.encodeCellQnum(),this.encodeBorderAns()}},AnsCheck:{checklist:["checkSingleBlock","checkSmallNumberArea@dbchoco","checkBlockNotRect@cbblock","checkDifferentShapeBlock@cbblock","checkLargeBlock","checkEqualShapes@dbchoco","checkLargeNumberArea@dbchoco","checkBorderDeadend"],checkBlockNotRect:function(){this.checkAllArea(this.board.blockgraph,function(e,r,t,i){return e*r!==t},"bkRect")},checkSingleBlock:function(){this.checkMiniBlockCount(1,"bkSubLt2")},checkLargeBlock:function(){this.checkMiniBlockCount(3,"bkSubGt2")},checkMiniBlockCount:function(e,r){for(var t=this.board.blockgraph.components,i=0;i<t.length;i++){var o=t[i].dotcnt;if(!(1===e&&1<o||3===e&&o<=2)){if(this.failcode.add(r),this.checkOnly)break;t[i].clist.seterr(1)}}},checkDifferentShapeBlock:function(){for(var e=this.board.blockgraph.getSideAreaInfo(),r=0;r<e.length;r++){var t=e[r][0],i=e[r][1];if(2===t.dotcnt&&2===i.dotcnt&&!this.isDifferentShapeBlock(t,i)){if(this.failcode.add("bsSameShape"),this.checkOnly)break;t.clist.seterr(1),i.clist.seterr(1)}}},checkSmallNumberArea:function(){return this.checkNumberArea(-1,"bkSizeLt")},checkLargeNumberArea:function(){return this.checkNumberArea(1,"bkSizeGt")},checkNumberArea:function(e,r){for(var t=this.board.tilegraph.components,i=0;i<t.length;i++)for(var o=t[i].clist,n=o.length,s=0;s<o.length;s++){var c=o[s].qnum;if(!(c<=0)&&(e<0&&n<c||0<e&&c<n)){if(this.failcode.add(r),this.checkOnly)return;o.seterr(1)}}},checkEqualShapes:function(){for(var e=this.board.blockgraph.components,r=0;r<e.length;r++){var t=e[r];if(2===t.dotcnt&&!this.isEqualShapes(t.clist)){if(this.failcode.add("bkDifferentShape"),this.checkOnly)break;t.clist.seterr(1)}}},isEqualShapes:function(e){for(var r=0;r<e.length;r++)for(var t=e[r],i=[t.adjborder.right,t.adjborder.bottom],o=0;o<i.length;o++){var n=i[o];if(n&&!n.isnull){var s=n.sidecell[0],c=n.sidecell[1];if(0===n.qans&&!s.isnull&&!c.isnull&&s.ques!==c.ques)return!this.isDifferentShapeBlock(s.tile,c.tile)}}return!1}},"AnsCheck@nikoji":{checklist:["checkNoNumber","checkIdenticalShapes","checkIdenticalOrientation","checkIdenticalPositions","checkUniqueShapes","checkDoubleNumber","checkBorderDeadend"],checkIdenticalShapes:function(){this.board.nums||this.board.recountNumbers();for(var e=this.board.roommgr.components,r=0;r<this.board.nums.length;r++)for(var t=this.board.nums[r],i=null,o=0;o<e.length;o++){var n=e[o];if(n.num===t)if(i){if(this.isDifferentShapeBlock(i,n)){if(this.failcode.add("bkDifferentShape"),this.checkOnly)return;i.clist.seterr(1),n.clist.seterr(1)}}else i=n}},checkIdenticalOrientation:function(){this.board.nums||this.board.recountNumbers();for(var e=this.board.roommgr.components,r=0;r<this.board.nums.length;r++)for(var t=this.board.nums[r],i=null,o=null,n=0;n<e.length;n++){var s=e[n];if(s.num===t)if(i){var c=s.clist,l=s.clist.getBlockShapes();if(o.id!==l.id){if(this.failcode.add("bkDifferentOrientation"),this.checkOnly)return;i.seterr(1),c.seterr(1)}}else i=s.clist,o=s.clist.getBlockShapes()}},checkIdenticalPositions:function(){this.board.nums||this.board.recountNumbers();for(var e=this.board.roommgr.components,r=0;r<this.board.nums.length;r++)for(var t=this.board.nums[r],i=null,o=null,n=0;n<e.length;n++){var s=e[n];if(s.num===t)if(i){var c=s,l=s.clist.getRectSize();if(o.rows===l.rows&&o.cols===l.cols&&(i.numcell.bx-o.x1!=c.numcell.bx-l.x1||i.numcell.by-o.y1!=c.numcell.by-l.y1)){if(this.failcode.add("bkDifferentPosition"),this.checkOnly)return;i.clist.seterr(1),c.clist.seterr(1)}}else o=(i=s).clist.getRectSize()}},checkUniqueShapes:function(){this.board.nums||this.board.recountNumbers();for(var e=this.board.roommgr.components,r={},t=0;t<e.length;t++){var i,o=e[t];null!==o.num&&((i=o.num+"")in r||(r[i]=o))}for(var n=[],s=0;s<this.board.nums.length;s++){var c=this.board.nums[s];c in r&&n.push(r[c])}for(var l=0;l<n.length;l++)for(var a=l+1;a<n.length;a++)if(!this.isDifferentShapeBlock(n[l],n[a])){if(this.failcode.add("bkDifferentLetters"),this.checkOnly)return;n[l].clist.seterr(1),n[a].clist.seterr(1)}}},"AnsCheck@mirrorbk":{checklist:["checkDoubleNumber","checkNumberAndSize","checkMirrorShape","checkMirrorUnused"],checkMirrorShape:function(){for(var e=this.board.border,r=0;r<e.length;r++){var t=e[r];if(!t.isnull&&t.ques){var i=t.sidecell[0].room,o=t.sidecell[1].room;if(i!==o){if(i.clist.length===o.clist.length){for(var n=!1,s=0;s<i.clist.length&&!n;s++){var c=i.clist[s],c=t.isVert()?c.relcell(2*(t.bx-c.bx),0):c.relcell(0,2*(t.by-c.by));!c.isnull&&c.room===o||(n=!0)}if(!n)continue}if(this.failcode.add("bkMirror"),this.checkOnly)break;i.clist.seterr(1),o.clist.seterr(1)}}}},checkMirrorUnused:function(){for(var e=this.board.border,r=0;r<e.length;r++){var t=e[r];if(!t.isnull&&t.ques){var i=t.sidecell[0].room,o=t.sidecell[1].room;if(i===o){if(this.failcode.add("bdUnused"),this.checkOnly)break;new this.klass.CellList(t.sidecell).seterr(1)}}}}}});
//# sourceMappingURL=cbblock.js.map