/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["herugolf"],{MouseEvent:{inputModes:{edit:["number","water","clear"],play:["line","peke"]},mouseinput_other:function(){"water"===this.inputMode&&this.inputWater()},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&("left"===this.btn?this.inputLine():"right"===this.btn&&this.inputpeke()):this.puzzle.editmode&&(this.mousestart||this.mousemove?"right"===this.btn&&this.inputWater():this.mouseend&&this.notInputted()&&this.inputqnum())},inputLine:function(){this.common.inputLine.call(this),!this.puzzle.execConfig("autocmp")||this.puzzle.execConfig("dispmove")||this.notInputted()||this.inputautodark()},inputautodark:function(){var e,t=this.puzzle.opemgr.lastope;"border"===t.group&&"line"===t.property&&(t=this.board.getb(t.bx,t.by),e=new this.klass.CellList,Array.prototype.push.apply(e,t.sideobj),(e=e.notnull().filter(function(e){return null!==e.path||e.isNum()})).each(function(e){null===e.path?e.isNum()&&e.draw():e.path.clist.each(function(e){e.isNum()&&e.draw()})}))},inputMoveLine:function(){for(var e=!0,t=this.getcell();e;){var e=!1,i=this.mouseCell&&!this.mousestart?this.mouseCell.getOrthogonalCell(t):t;if(i.isnull)return;var n,s=this.mouseCell,r=i.getaddr();this.mousestart&&i.isDestination()?(this.mouseCell=i,this.prevPos=r,i.draw()):!this.mousemove||s.isnull||i.isDestination()||!(n=this.prevPos.getnb(r)).isnull&&(!n.isLine()&&0===i.lcnt||n.isLine()&&1===s.lcnt)&&(n.isLine()||0<n.sidecell[0].distance||0<n.sidecell[1].distance)&&((s=n.isLine())?n.removeLine():n.setLine(),s!==n.isLine()&&(this.mouseCell=i,this.prevPos=r,n.draw(),e=!0))}},inputWater:function(){var e=this.getcell();e.isnull||e===this.mouseCell||31===e.ques||-1!==e.qnum||(null===this.inputData&&(this.inputData=e.ice()?0:6),e.setQues(this.inputData),e.drawaround(),this.mouseCell=e)},inputqnum_main:function(e){e.ice()||this.inputcell_herugolf(e)||0===e.ques&&this.common.inputqnum_main.call(this,e)},inputcell_herugolf:function(e){var t=null;return 31===e.ques?"left"===this.btn?t=-2:"right"===this.btn&&(t=-1):0===e.ques&&-1===e.qnum?"left"===this.btn&&(t=-3):-2===e.qnum&&"right"===this.btn&&(t=-3),-3===t?(e.setQues(31),e.setQnum(-1),e.draw()):-1===t?(e.setQues(0),e.setQnum(-1),e.draw()):-2===t&&(e.setQues(0),e.setQnum(-2),e.draw()),null!==t}},KeyEvent:{enablemake:!0,keyinput:function(e){this.key_inputqnum_herugolf(e)},key_inputqnum_herugolf:function(e){var t=this.cursor.getc();if("q"===e||"w"===e)t.setQues(t.ice()?0:6),t.setQnum(-1);else if("h"===e)t.setQues(31===t.ques?0:31),t.setQnum(-1);else if(" "===e)t.setQues(0),t.setQnum(-1);else if(!t.ice())return void this.key_inputqnum(e);(this.prev=t).draw()}},Cell:{distance:null,isViaPoint:function(){if(null===this.distance)return!1;for(var e=this.distance,t=0;0<e;)e-=++t;return 0===e},isCmp:function(){if(this.puzzle.execConfig("autocmp")){if(this.puzzle.execConfig("dispmove"))return 31===this.ques&&-1!==this.base.qnum&&this.isViaPoint();if(-1!==this.qnum&&null!==this.path)for(var e=this.path.clist,t=0,i=e.length;t<i;t++)if(e[t].base===this&&31===e[t].ques&&e[t].isViaPoint())return!0}return!1},maxnum:function(){var e=this.board,t=this.bx>>1,i=this.by>>1;return Math.max(t,i,e.cols-1-t,e.rows-1-i)},getDestination:function(){var e=this.board,t=this.path;return null!==t?t.destination:e.emptycell},getDeparture:function(){var e=this.board,t=this.path;return null!==t?t.departure:e.emptycell}},Border:{prehook:{line:function(e){return this.puzzle.execConfig("dispmove")&&this.checkFormCurve(e)&&!this.sidecell[0].isViaPoint()&&!this.sidecell[1].isViaPoint()}}},Board:{hasborder:1},LineGraph:{enabled:!0,moveline:!0,resetExtraData:function(e){e.distance=0<=e.qnum?(e.qnum+1)*e.qnum/2:null,this.common.resetExtraData.call(this,e)},setExtraData:function(e){this.common.setExtraData.call(this,e),e.clist.each(function(e){0<=e.qnum||(e.distance=null)});var t=0<=(t=(r=e.departure).qnum)?t:this.board.cell.length;if(r.distance=(t+1)*t/2,0!==r.lcnt)for(var i=r.getdir(r.pathnodes[0].nodes[0].obj,2),n=r.getaddr(),s=r.distance;;){n.movedir(i,2);var r,o=(r=n.getc()).adjborder;if(r.isnull||3<=r.lcnt||0===r.lcnt)break;if(r.distance=--s,r===e.destination)break;1!==i&&o.bottom.isLine()?i=2:2!==i&&o.top.isLine()?i=1:3!==i&&o.right.isLine()?i=4:4!==i&&o.left.isLine()&&(i=3)}}},Graphic:{hideHatena:!0,autocmp:"number",gridcolor_type:"LIGHT",bgcellcolor_func:"icebarn",bordercolor_func:"ice",circlefillcolor_func:"qcmp",numbercolor_func:"move",invalidlinecolor:"silver",paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawBorders(),this.drawTip_herugolf(),this.drawViaPoints(),this.drawLines(),this.drawCircledNumbers(),this.drawHoles(),this.drawPekes(),this.drawChassis(),this.drawTarget()},getQuesNumberText:function(e){if(this.puzzle.execConfig("dispmove")){if(!e.isDestination()||e.base.qnum<0)return"";for(var t=e.distance,i=0;0<t;)t-=++i;return""+i}return this.getNumberTextCore(e.getNum())},getLineColor:function(e){if(this.addlw=0,e.isLine()||e.isLineBySolver()){var t=e.error||e.qinfo;if(e.trial&&this.puzzle.getConfig("irowake")?this.addlw=-this.lm:1===t&&(this.addlw=1),1===t)return this.errlinecolor;if(-1===t)return this.noerrcolor;if(e.trial)return this.puzzle.execConfig("dispmove")?this.movetrialcolor:this.trialcolor;t=[e.sidecell[0].distance,e.sidecell[1].distance],t=e.isLineBySolver()||null!==t[0]&&0<=t[0]&&null!==t[1]&&0<=t[1];return this.puzzle.execConfig("dispmove")?t?this.getColorSolverAware(e.isLine(),e.isLineBySolver(),this.movelinecolor):this.errlinecolor:t?this.getColorSolverAware(e.isLine(),e.isLineBySolver(),this.linecolor):this.invalidlinecolor}return null},drawTip_herugolf:function(){for(var e=this.vinc("cell_linetip","auto"),t=.3*this.cw,i=.05*this.cw,n=this.range.cells,s=0;s<n.length;s++){var r,o,l=n[s],u=0,c=null;-1!==l.qnum||this.puzzle.execConfig("dispmove")||(r=l.adjacent,(o=l.adjborder).top.isLine()&&(1===l.lcnt||l.isViaPoint()&&r.top.distance===l.distance+1)?(u=2,c=o.top):o.bottom.isLine()&&(1===l.lcnt||l.isViaPoint()&&r.bottom.distance===l.distance+1)?(u=1,c=o.bottom):o.left.isLine()&&(1===l.lcnt||l.isViaPoint()&&r.left.distance===l.distance+1)?(u=4,c=o.left):o.right.isLine()&&(1===l.lcnt||l.isViaPoint()&&r.right.distance===l.distance+1)&&(u=3,c=o.right)),e.vid="c_tip_"+l.id,0!==u?(e.strokeStyle=this.getLineColor(c),e.lineWidth=this.lw+this.addlw,e.beginPath(),r=l.bx*this.bw+1,o=l.by*this.bh+1,1===u?e.setOffsetLinePath(r,o,-t,t,0,-i,t,t,!1):2===u?e.setOffsetLinePath(r,o,-t,-t,0,i,t,-t,!1):3===u?e.setOffsetLinePath(r,o,t,-t,-i,0,t,t,!1):4===u&&e.setOffsetLinePath(r,o,-t,-t,i,0,-t,t,!1),e.stroke()):e.vhide()}},drawHoles:function(){for(var e=this.vinc("cell_hole","auto"),t=(e.fillStyle=this.quescolor,this.puzzle.execConfig("dispmove")),i=this.range.cells,n=0;n<i.length;n++){var s=i[n];e.vid="cell_hole_text_"+s.id,31!==s.ques||t&&s.isDestination()?e.vhide():this.disptext("H",s.bx*this.bw,s.by*this.bh)}},drawViaPoints:function(){for(var e=this.vinc("cell_via","auto",!0),t=(e.fillStyle=this.movelinecolor,.15*this.cw),i=this.puzzle.execConfig("dispmove"),n=this.range.cells,s=0;s<n.length;s++){var r=n[s];e.vid="c_dcir_"+r.id,i&&r.isViaPoint()?e.fillCircle(r.bx*this.bw,r.by*this.bh,t):e.vhide()}}},Encode:{decodePzpr:function(e){this.decodeIce(),this.decodeNumber16_herugolf()},encodePzpr:function(e){this.encodeIce(),this.encodeNumber16_herugolf()},decodeNumber16_herugolf:function(){for(var e=0,t=0,i=this.outbstr,n=this.board,t=0;t<i.length;t++){var s=n.cell[e],r=i.charAt(t);if(this.include(r,"0","9")||this.include(r,"a","f")?s.qnum=parseInt(r,16):"-"===r?(s.qnum=parseInt(i.substr(t+1,2),16),t+=2):"h"===r?s.ques=31:"i"<=r&&r<="z"&&(e+=parseInt(r,36)-18),e++,!n.cell[e])break}this.outbstr=i.substr(t+1)},encodeNumber16_herugolf:function(){for(var e=0,t="",i=this.board,n=0;n<i.cell.length;n++){var s="",r=i.cell[n],o=r.qnum,r=r.ques;-2===o?s=".":0<=o&&o<16?s=o.toString(16):16<=o&&o<256?s="-"+o.toString(16):31===r?s="h":e++,0===e?t+=s:!s&&18!==e||(t+=(17+e).toString(36)+s,e=0)}0<e&&(t+=(17+e).toString(36)),this.outbstr+=t}},FileIO:{decodeData:function(){this.decodeCell(function(e,t){"H"===t?e.ques=31:"i"===t?e.ques=6:"."!==t&&(e.qnum=+t)}),this.decodeBorderLine()},encodeData:function(){this.encodeCell(function(e){return 31===e.ques?"H ":6===e.ques?"i ":0<e.qnum?e.qnum+" ":". "}),this.encodeBorderLine()}},AnsCheck:{checklist:["checkLineExist+","checkBranchLine","checkCrossLine","checkConnectObject","checkLineOverLetter","checkLineOverHole","checkCurveHalfway","checkMoveOver","checkStopHalfway","checkWaterHazard","checkCupIn+","checkIgnoredHole+","checkDisconnectLine"],checkMoveOver:function(){for(var e=!0,t=this.board,i=0;i<t.border.length;i++){var n=t.border[i];if(n.isLine()){var s=n.sidecell[0],r=n.sidecell[1];if(!(0<=s.distance&&0<=r.distance)){if(e=!1,this.checkOnly)break;n.seterr(1),(this.puzzle.execConfig("dispmove")?s.getDestination():s.getDeparture()).seterr(1)}}}e||(this.failcode.add("laMoveOver"),t.border.setnoerr())},checkLineOverHole:function(){this.checkAllCell(function(e){return 31===e.ques&&2<=e.lcnt},"laOnHole")},checkStopHalfway:function(){this.checkAllCell(function(e){return 1===e.lcnt&&0<=e.distance&&!e.isViaPoint()},"laLenNe")},checkCurveHalfway:function(){this.checkAllCell(function(e){return e.isLineCurve()&&!e.isViaPoint()},"laCurve")},checkWaterHazard:function(){this.checkAllCell(function(e){return 6===e.ques&&e.isViaPoint()},"laWaterHazard")},checkCupIn:function(){this.puzzle.execConfig("dispmove")?this.checkAllCell(function(e){return 31!==e.ques&&e.isDestination()},"nmOutOfHole"):this.checkAllCell(function(e){return-1!==e.qnum&&31!==e.getDestination().ques},"nmOutOfHole")},checkIgnoredHole:function(){this.checkAllCell(function(e){return 31===e.ques&&!e.isDestination()},"nmIgnored")}}});
//# sourceMappingURL=herugolf.js.map