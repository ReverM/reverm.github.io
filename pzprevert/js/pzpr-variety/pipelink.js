/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,i){"object"==typeof module&&module.exports?module.exports=[e,i]:pzpr.classmgr.makeCustom(e,i)}(["pipelink","pipelinkr","loopsp"],{"MouseEvent@pipelink":{inputModes:{edit:["quesmark","quesmark-","info-line"],play:["line","peke","info-line"]}},"MouseEvent@pipelinkr":{inputModes:{edit:["quesmark","quesmark-","ice","info-line"],play:["line","peke","info-line"]}},"MouseEvent@loopsp":{inputModes:{edit:["quesmark","quesmark-","number","info-line"],play:["line","peke","info-line"]}},MouseEvent:{mouseinput_other:function(){this.inputMode.match(/quesmark/)&&this.mousestart&&this.inputQuesMark()},mouseinput_auto:function(){this.puzzle.playmode?"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.inputpeke():"right"===this.btn&&(this.mousestart||this.mousemove)&&this.inputpeke():this.puzzle.editmode&&this.mousestart&&this.inputQuesMark()},inputQuesMark:function(e){"loopsp"!==this.pid?this.inputQues([0,11,12,13,14,15,16,17,-2]):this.inputLoopsp()}},"MouseEvent@loopsp#1":{inputLoopsp:function(){var e=this.getcell();e.isnull||e===this.mouseCell||(e!==this.cursor.getc()?this.setcursor(e):this.inputcell_loopsp(e),this.mouseCell=e)},inputcell_loopsp:function(e){var i=e.ques,t=e.qnum,t=-1!==t?0<t?t:0:0<i?i-19:-1,i=e.getmaxnum(),s=-8;this.inputMode.match(/number/)&&(s=-1),this.inputMode.match(/quesmark/)&&(i=-1),"left"===this.btn?s<=t&&t<i?t++:t=s:"right"===this.btn&&(s<t&&t<=i?t--:t=i),0<=t?(e.setQues(0),e.setQnum(1<=t?t:-2)):(-1===t?e.setQues(0):e.setQues(t+19),e.setQnum(-1)),e.draw()}},KeyEvent:{enablemake:!0,keyinput:function(e){this.key_inputLineParts(e)},key_inputLineParts:function(e){var i=this.cursor.getc();if("q"===e)i.setQues(11),i.setQnum(-1);else if("w"===e)i.setQues(12),i.setQnum(-1);else if("e"===e)i.setQues(13),i.setQnum(-1);else if("r"===e)i.setQues(0),i.setQnum(-1);else if(" "===e)i.setQues(0),i.setQnum(-1);else if("a"===e)i.setQues(14),i.setQnum(-1);else if("s"===e)i.setQues(15),i.setQnum(-1);else if("d"===e)i.setQues(16),i.setQnum(-1);else if("f"===e)i.setQues(17),i.setQnum(-1);else if("loopsp"!==this.pid)if("-"===e)i.setQues(-2!==i.ques?-2:0);else{if("pipelinkr"!==this.pid||"1"!==e)return;i.setQues(6)}else{if(!("0"<=e&&e<="9"||"-"===e))return;this.key_inputqnum_main(i,e),-1!==i.qnum&&i.setQues(0)}(this.prev=i).drawaround()}},Cell:{maxnum:function(){return this.board.cell.length/4|0},prehook:{ques:function(e){return this.setCombinedLine(e),!1}},setCombinedLine:function(){for(var e=this.bx,i=this.by,t=this.board.borderinside(e-1,i-1,e+1,i+1),s=0;s<t.length;s++){var n=t[s];0===n.line&&n.isLineEX()&&n.setLineVal(1)}}},Border:{enableLineNG:!0,checkStableLine:function(e){return 0!==e&&this.isLineNG()||0===e&&this.isLineEX()},isLineEX:function(){var e=this.sidecell[0],i=this.sidecell[1];return this.isVert()?e.isLP(e.RT)&&i.isLP(i.LT):e.isLP(e.DN)&&i.isLP(i.UP)}},Board:{hasborder:1},BoardExec:{adjustBoardData:function(e,i){if(e&this.TURNFLIP){var t={};switch(e){case this.FLIPY:t={14:17,15:16,16:15,17:14};break;case this.FLIPX:t={14:15,15:14,16:17,17:16};break;case this.TURNR:t={12:13,13:12,14:17,15:14,16:15,17:16};break;case this.TURNL:t={12:13,13:12,14:15,15:16,16:17,17:14}}for(var s=this.board.cellinside(i.x1,i.y1,i.x2,i.y2),n=0;n<s.length;n++){var r=s[n],o=t[r.ques];o&&(r.ques=o)}}}},LineGraph:{enabled:!0,isLineCross:!0,relation:{"border.line":"link","cell.ques":"cell"},isedgevalidbylinkobj:function(e){return e.isLine()||e.isLineEX()},modifyOtherInfo:function(e,i){for(var t=e.getdir4cblist(),s=0;s<t.length;s++)this.setEdgeByLinkObj(t[s][1])}},Graphic:{hideHatena:!0,irowake:!0,gridcolor_type:"LIGHT",circleratio:[.42,.37],minYdeg:.42,paint:function(){this.drawBGCells(),this.drawDashedGrid(),"pipelinkr"===this.pid&&this.drawBorders(),"pipelink"===this.pid?this.drawHatenas():"pipelinkr"===this.pid&&(this.drawCircles(),this.drawHatenas()),this.drawLines(),"loopsp"===this.pid&&this.drawCircledNumbers(),this.drawPekes(),this.drawLineParts(),this.drawChassis(),this.drawTarget()},repaintParts:function(e){this.range.cells=e.cellinside(),"loopsp"===this.pid&&this.drawCircledNumbers(),this.drawLineParts()}},"Graphic@pipelinkr":{getBGCellColor:function(e){return 1===e.error?this.errbcolor1:null},getBorderColor:function(e){return null},getCircleStrokeColor:function(e){return 6===e.ques?this.quescolor:null},circlefillcolor_func:"null"},"Graphic@loopsp":{circleratio:[.4,.35],numbercolor_func:"qnum",getCircleFillColor:function(e){return-1!==e.qnum?"rgba(255,255,255,0.5)":null},minYdeg:.36,maxYdeg:.74},"Encode@pipelink,pipelinkr":{decodePzpr:function(e){this.decodePipelink()},encodePzpr:function(e){this.encodePipelink(e)},decodePipelink:function(){for(var e=0,i=this.outbstr,t=this.board,s=0;s<i.length;s++){var n=i.charAt(s);if("."===n)t.cell[e].ques=-2;else if("0"<=n&&n<="9"){for(var r=0,o=parseInt(n,10)+1;r<o;r++)t.cell[e]&&(t.cell[e].ques=6,e++);e--}else"a"<=n&&n<="g"?t.cell[e].ques=parseInt(n,36)+1:"h"<=n&&n<="z"&&(e+=parseInt(n,36)-17);if(e++,!t.cell[e])break}this.outbstr=i.substr(s)},encodePipelink:function(e){for(var i=this.puzzle.pzpr.parser,t="",s=this.board,n=0,r=0;r<s.cell.length;r++){var o="",l=s.cell[r].ques;if(-2===l)o=".";else if(6===l){if(e===i.URL_PZPRV3){for(var u=1;u<10&&(s.cell[r+u]&&6===s.cell[r+u].ques);u++);o=(u-1).toString(10),r=r+u-1}}else 11<=l&&l<=17?o=(l-1).toString(36):n++;0===n?t+=o:!o&&19!==n||(t+=(16+n).toString(36)+o,n=0)}0<n&&(t+=(16+n).toString(36)),this.outbstr+=t}},"Encode@loopsp":{decodePzpr:function(e){this.decodeLoopsp()},encodePzpr:function(e){this.encodeLoopsp()},decodeLoopsp:function(){for(var e=0,i=this.outbstr,t=this.board,s=0;s<i.length;s++){var n=i.charAt(s),r=t.cell[e];if("."===n&&(r.qnum=-2),this.include(n,"0","9")||this.include(n,"a","f")?r.qnum=parseInt(n,16):"-"===n?(r.qnum=parseInt(i.substr(s+1,2),16),s+=2):"+"===n?(r.qnum=parseInt(i.substr(s+1,3),16),s+=3):"g"<=n&&n<="m"?r.ques=parseInt(n,36)-5:"n"<=n&&n<="z"&&(e+=parseInt(n,36)-23),e++,!t.cell[e])break}this.outbstr=i.substr(s+1)},encodeLoopsp:function(){for(var e="",i="",t=0,s=this.board,n=0;n<s.cell.length;n++){var r=s.cell[n].qnum,o=s.cell[n].ques;-2===r?i=".":0<=r&&r<16?i=r.toString(16):16<=r&&r<256?i="-"+r.toString(16):256<=r&&r<4096?i="+"+r.toString(16):11<=o&&o<=17?i=(o+5).toString(36):(i="",t++),0===t?e+=i:!i&&13!==t||(e+=(22+t).toString(36)+i,t=0)}0<t&&(e+=(22+t).toString(36)),this.outbstr+=e}},FileIO:{decodeData:function(){"loopsp"!==this.pid&&this.decodeDispType(),this.decodePipelink(),this.decodeBorderLine()},encodeData:function(){"loopsp"!==this.pid&&this.encodeDispType(),this.encodePipelink(),this.encodeBorderLine()},decodeDispType:function(){this.readLine()},encodeDispType:function(){var e="pipe";"pipelinkr"===this.puzzle.pid&&(e="circle"),this.writeLine(e)},decodePipelink:function(){this.decodeCell(function(e,i){"o"===i?e.ques=6:"-"===i?e.ques=-2:"a"<=i&&i<="g"?e.ques=parseInt(i,36)+1:"."!==i&&(e.qnum=+i)})},encodePipelink:function(){this.encodeCell(function(e){return 6===e.ques?"o ":-2===e.ques?"- ":11<=e.ques&&e.ques<=17?(e.ques-1).toString(36)+" ":-1!==e.qnum?e.qnum+" ":". "})}},AnsCheck:{checklist:["checkenableLineParts","checkBranchLine","checkCrossOnNumber@loopsp","checkCrossOutOfMark@pipelinkr","checkIceLines@pipelinkr","checkOneLoop@!loopsp","checkLoopNumber@loopsp","checkNumberLoop@loopsp","checkNumberInLoop@loopsp","checkNotCrossOnMark","checkNoLine+","checkDeadendLine++"]},"AnsCheck@pipelinkr":{checkCrossOutOfMark:function(){this.checkAllCell(function(e){return 4===e.lcnt&&6!==e.ques&&11!==e.ques},"lnCrossExIce")}},"CheckInfo@pipelinkr":{text:function(e){var i=this.puzzle,t=[],s="ja"===(e||this.puzzle.pzpr.lang)?0:1;if(0===this.length)return i.faillist.complete[s];for(var n=0;n<this.length;n++){var r=this[n];"lnCrossExIce"===r?r="lnCrossExCir":"lnCurveOnIce"===r&&(r="lnCurveOnCir"),t.push(i.faillist[r][s])}return t.join("\n")}},"AnsCheck@loopsp":{checkCrossOnNumber:function(){this.checkAllCell(function(e){return 4===e.lcnt&&e.isNum()},"lnCrossOnNum")},checkLoopNumber:function(){this.checkAllLoops(function(e){for(var i=e.filter(function(e){return e.isValidNum()}),t=null,s=0;s<i.length;s++)if(null===t)t=i[s].getNum();else if(t!==i[s].getNum())return i.seterr(1),!1;return!0},"lpPlNum")},checkNumberLoop:function(){var r=this.board.cell;this.checkAllLoops(function(e){var i=e.filter(function(e){return e.isValidNum()});if(0===i.length)return!0;for(var t=i[0].getNum(),s=0;s<r.length;s++){var n=r[s];if(n.getNum()===t&&!i.include(n))return i.seterr(1),!1}return!0},"lpSepNum")},checkNumberInLoop:function(){this.checkAllLoops(function(e){return 0<e.filter(function(e){return e.isNum()}).length},"lpNoNum")},checkAllLoops:function(e,i){for(var t=!0,s=this.board.linegraph.components,n=0;n<s.length;n++){var r=new this.klass.BorderList(s[n].getedgeobjs());if(!e(r.cellinside())){if(t=!1,this.checkOnly)break;r.seterr(1)}}t||(this.failcode.add(i),this.checkOnly||this.board.border.setnoerr())}}});
//# sourceMappingURL=pipelink.js.map