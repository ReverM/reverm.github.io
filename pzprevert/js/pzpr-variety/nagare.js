/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,i){"object"==typeof module&&module.exports?module.exports=[e,i]:pzpr.classmgr.makeCustom(e,i)}(["nagare","fakearrow"],{MouseEvent:{mouseinput_other:function(){"diraux"===this.inputMode&&(this.mousestart||this.mousemove?this.inputdiraux_mousemove():this.mouseend&&this.notInputted()&&this.clickdiraux())},inputarrow_cell_main:function(e,i){e.setQdir(e.qdir!==i?i:0)},inputShadeCell:function(){var e=this.getcell();e.isnull||e===this.mouseCell||(e!==this.cursor.getc()&&this.puzzle.getConfig("cursor")&&"auto"===this.inputMode?this.setcursor(e):(e.setQues(1===e.ques?0:1),e.drawaround()))}},"MouseEvent@nagare":{inputModes:{edit:["shade","arrow","info-line"],play:["line","peke","diraux","info-line"]},mouseinput:function(){"shade"===this.inputMode?this.mousestart&&this.inputShadeCell():this.common.mouseinput.call(this)},mouseinput_auto:function(){this.puzzle.playmode&&"right"===this.btn?this.mousestart?this.inputdiraux_mousedown():2===this.inputData||3===this.inputData?this.inputpeke():this.mousemove&&this.inputdiraux_mousemove():this.puzzle.playmode&&"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&this.clickdiraux():this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputarrow_cell():this.mouseend&&this.notInputted()&&this.inputShadeCell())}},"MouseEvent@fakearrow":{inputModes:{edit:["border","arrow","empty","info-line"],play:["line","peke","diraux","shade","info-line"]},mouseinput_auto:function(){this.puzzle.playmode&&"right"===this.btn?this.mousestart?this.inputdiraux_mousedown():2===this.inputData||3===this.inputData?this.inputpeke():this.mousemove&&this.inputdiraux_mousemove():this.puzzle.playmode&&"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&(0<this.getcell().qdir?this.inputShade():this.clickdiraux()):this.puzzle.editmode&&(this.mousestart||this.mousemove?this.isBorderMode()?this.inputborder():this.inputarrow_cell():this.mouseend&&this.notInputted()&&this.inputqnum())}},KeyEvent:{enablemake:!0,moveTarget:function(e){return!e.match(/shift/)&&this.moveTCell(e)},keyinput:function(e){this.key_inputarrow(e)||this.key_inputques_nagare(e)},key_inputques_nagare:function(e){var i="nagare"===this.pid?1:7;"q"!==e&&"w"!==e||((e=this.cursor.getc()).setQues(e.ques!==i?i:0),e.drawaround())}},"Cell@fakearrow":{allowShade:function(){return 0<this.qdir},allowUnshade:function(){return!1},noLP:function(){return this.isEmpty()},posthook:{ques:function(e){e&&this.setQdir(this.NDIR)},qdir:function(e){e===this.NDIR?this.setQans(0):this.setQues(0)}}},"Cell@nagare":{windbase:0,wind:0,noLP:function(e){return 1===this.ques},posthook:{ques:function(e){this.setWindAround()},qdir:function(e){this.setWindAround()}},initWind:function(){var e,i,t;this.wind=0,1!==this.ques&&(e=this.board,i=new this.klass.ViewRange(this.bx,this.by,function(e){return 0!==e.ques}),1===(t=e.getc(i.x0,i.y2+2)).ques&&t.qdir===t.UP&&(this.wind|=1),1===(t=e.getc(i.x0,i.y1-2)).ques&&t.qdir===t.DN&&(this.wind|=2),1===(t=e.getc(i.x2+2,i.y0)).ques&&t.qdir===t.LT&&(this.wind|=4),1===(t=e.getc(i.x1-2,i.y0)).ques&&t.qdir===t.RT&&(this.wind|=8))},calcWindBase:function(){var e=this.windbase;return this.windbase=0,1===this.ques&&(this.windbase|=16|[0,1,2,4,8][this.qdir]),e^this.windbase},setWindAround:function(){if(0!==this.calcWindBase()){this.initWind();for(var e=new this.klass.ViewRange(this.bx,this.by,function(e){return 0!==e.ques}),i=0;i<4;i++){for(var t=i+1,r=e.getdirclist(t),n=e.getdirblist(t),s=1<<i,o=(this.windbase&(16|s))==(16|s)?s:0,h=0;h<r.length;h++)r[h].wind=r[h].wind&~s|o;for(h=0;h<n.length;h++)n[h].wind=n[h].wind&~s|o}}}},Range:{x1:-1,y1:-1,x2:-1,y2:-1},"RectRange:Range":{cellinside:function(){return this.board.cellinside(this.x1,this.y1,this.x2,this.y2)},borderinside:function(){return this.board.borderinside(this.x1,this.y1,this.x2,this.y2)}},"ViewRange:Range":{initialize:function(e,i,t){this.x0=e,this.y0=i,t&&this.search(t)},search:function(e){for(var i=this.board.getc(this.x0,this.y0),t=i.adjacent,r=i,n=t.left;!n.isnull&&!e(n);)n=(r=n).adjacent.left;for(this.x1=r.bx,r=i,n=t.right;!n.isnull&&!e(n);)n=(r=n).adjacent.right;for(this.x2=r.bx,r=i,n=t.top;!n.isnull&&!e(n);)n=(r=n).adjacent.top;for(this.y1=r.by,r=i,n=t.bottom;!n.isnull&&!e(n);)n=(r=n).adjacent.bottom;this.y2=r.by},getdirclist:function(e){return this.getdirrange(e).cellinside()},getdirblist:function(e){return this.getdirrange(e).borderinside()},getdirrange:function(e){var i=new this.klass.RectRange;return 1===e?(i.x1=i.x2=this.x0,i.y1=this.y1,i.y2=this.y0-2):2===e?(i.x1=i.x2=this.x0,i.y1=this.y0+2,i.y2=this.y2):3===e?(i.x1=this.x1,i.x2=this.x0-2,i.y1=i.y2=this.y0):4===e&&(i.x1=this.x0+2,i.x2=this.x2,i.y1=i.y2=this.y0),i}},Border:{wind:0,enableLineNG:!0},Board:{hasborder:1},"Board@nagare":{rebuildInfo:function(){this.initWind(),this.common.rebuildInfo.call(this)},initWind:function(){for(var e=0;e<this.border.length;e++)this.border[e].wind=0;for(var i=0;i<this.cell.length;i++)(t=this.cell[i]).wind=0,t.windbase=0;for(var t,i=0;i<this.cell.length;i++)1===(t=this.cell[i]).ques&&0!==t.qdir&&t.setWindAround()}},LineGraph:{enabled:!0},"AreaRoomGraph@fakearrow":{enabled:!0},BoardExec:{adjustBoardData:function(e,i){if(this.adjustCellArrow(e,i),e&this.TURNFLIP)for(var t=this.getTranslateDir(e),r=this.board.borderinside(i.x1,i.y1,i.x2,i.y2),n=0;n<r.length;n++){var s=r[n],o=t[s.qsub-10];o&&(s.qsub=o+10)}}},Graphic:{irowake:!0,gridcolor_type:"LIGHT",paint:function(){this.drawBGCells(),this.drawDashedGrid(),this.drawQuesCells(),"fakearrow"===this.pid&&this.drawBorders(),this.drawCellArrows("fakearrow"!==this.pid||.5),this.drawLines(),this.drawPekes(),this.drawBorderAuxDir(),this.drawChassis(),this.drawTarget()},getCellArrowColor:function(e){return 0===e.ques?this.quescolor:"white"}},"Graphic@fakearrow":{gridcolor_type:"SLIGHT",getBorderColor:function(e){var i=e.sidecell[0],t=e.sidecell[1];return i.isEmpty()&&t.isEmpty()?null:!e.inside||i.isnull||t.isnull||!i.isEmpty()&&!t.isEmpty()?this.getBorderColor_ques(e):"black"},getQuesCellColor:function(e){return 7===e.ques?"darkgray":null},getCellArrowOutline:function(e){return this.quescolor},getCellArrowColor:function(e){return e.isShade()?this.quescolor:null}},"Encode@nagare":{decodePzpr:function(e){this.decodeNagare()},encodePzpr:function(e){this.encodeNagare()},decodeNagare:function(){for(var e=0,i=0,t=this.outbstr,r=this.board,i=0;i<t.length;i++){var n,s=r.cell[e],o=t.charAt(i);if(this.include(o,"1","9")?(n=parseInt(o,10),s.ques=n/5|0,s.qdir=n%5):this.include(o,"a","z")&&(e+=parseInt(o,36)-10),e++,!r.cell[e])break}this.outbstr=t.substr(i+1)},encodeNagare:function(){for(var e="",i=0,t=this.board,r=0;r<t.cell.length;r++){var n="",s=t.cell[r],o=s.ques,s=s.qdir;1===o||1<=s&&s<=4?n=(5*o+s).toString(10):i++,0===i?e+=n:!n&&26!==i||(e+=(9+i).toString(36)+n,i=0)}0<i&&(e+=(9+i).toString(36)),this.outbstr+=e}},"Encode@fakearrow":{decodePzpr:function(){this.decodeBorder();var t=this.board;this.genericDecodeNumber16(t.cell.length,function(e,i){e=t.cell[e];5===i?e.setValid(7):0<=i&&(e.qdir=i)})},encodePzpr:function(){this.encodeBorder();var i=this.board;this.genericEncodeNumber16(i.cell.length,function(e){e=i.cell[e];return e.isEmpty()?5:e.qdir||-1})}},FileIO:{decodeData:function(){this.decodeCell(function(e,i){"."!==i&&(e.ques=(i={u:1,d:2,l:3,r:4,N:5,U:6,D:7,L:8,R:9}[i])/5|0,e.qdir=i%5)}),this.decodeBorderArrowAns()},encodeData:function(){this.encodeCell(function(e){return 1===e.ques||1<=e.qdir&&e.qdir<=4?["u ","d ","l ","r ","N ","U ","D ","L ","R "][5*e.ques+e.qdir-1]:". "}),this.encodeBorderArrowAns()}},"FileIO@fakearrow":{decodeData:function(){this.decodeBorderQues(),this.decodeCell(function(e,i){"#"===i?e.ques=7:0<+i&&(e.qdir=+i)}),this.decodeBorderArrowAns(),this.decodeCellQanssub()},encodeData:function(){this.encodeBorderQues(),this.encodeCell(function(e){return e.isEmpty()?"# ":e.qdir?e.qdir+" ":". "}),this.encodeBorderArrowAns(),this.encodeCellQanssub()}},AnsCheck:{checklist:["checkLineExist+","checkArrowAgainst","checkLineOnShadeCell","checkCrossLine+","checkBranchLine+","checkAcrossArrow","checkLineArrowDirection","checkLineWindDirection","checkAcrossWind","checkAllArrow","checkDeadendLine++","checkOneLoop"],checkArrowAgainst:function(){for(var e=this.board.cell,i=0;i<e.length;i++){var t=e[i],r=t.wind&(15^[0,1,2,4,8][t.qdir]);if(0!==t.qdir&&1!==t.ques&&!t.isShade()&&r){if(this.failcode.add("arAgainstWind"),this.checkOnly)break;this.setCellErrorToWindBase(t,r)}}},checkAcrossWind:function(){for(var e=this.board.cell,i=0;i<e.length;i++){var t=e[i],r=0!=(3&t.wind)&&2===t.isLineStraight(),n=0!=(12&t.wind)&&1===t.isLineStraight();if(r||n){if(this.failcode.add("lrAcrossWind"),this.checkOnly)break;this.setCellErrorToWindBase(t,t.wind&((r?3:0)|(n?12:0)))}}},checkAcrossArrow:function(){this.checkAllCell(function(e){var i=e.adjborder;return!e.isShade()&&((1===e.qdir||2===e.qdir)&&(i.left.isLine()||i.right.isLine())||(3===e.qdir||4===e.qdir)&&(i.top.isLine()||i.bottom.isLine()))},"lrAcrossArrow")},checkAllArrow:function(){this.checkAllCell(function(e){return!e.isShade()&&0===e.ques&&0<e.qdir&&0===e.lcnt},"arNoLine")},checkLineWindDirection:function(){for(var e=this.getTraceInfo(),i=0;i<e.length;i++){var t=e[i].blist;if(0!==t.length){if(this.failcode.add("lrAgainstWind"),this.checkOnly)break;this.board.border.setnoerr();for(var r=0;r<t.length;r++)this.setBorderErrorToWindBase(t[r],t[r].wind)}}},checkLineArrowDirection:function(){return this.checkLineArrowDirectionGeneric(null,"lrAgainstArrow")},checkLineArrowDirectionGeneric:function(e,i){for(var t=this.getTraceInfo(),r=0;r<t.length;r++){var n=t[r].clist;if(0!==(n=e?n.filter(e):n).length){if(this.failcode.add(i),this.checkOnly)break;n.seterr(1)}}},setCellErrorToWindBase:function(e,i){var t;if(e.seterr(1),1&i)for(t=e;!t.isnull;){if(1===t.ques){t.seterr(1);break}t=t.adjacent.bottom}if(2&i)for(t=e;!t.isnull;){if(1===t.ques){t.seterr(1);break}t=t.adjacent.top}if(4&i)for(t=e;!t.isnull;){if(1===t.ques){t.seterr(1);break}t=t.adjacent.right}if(8&i)for(t=e;!t.isnull;){if(1===t.ques){t.seterr(1);break}t=t.adjacent.left}},setBorderErrorToWindBase:function(e,i){var t;if(e.seterr(1),1&i)for(t=e.sidecell[1];!t.isnull;){if(1===t.ques){t.seterr(1);break}t=t.adjacent.bottom}if(2&i)for(t=e.sidecell[0];!t.isnull;){if(1===t.ques){t.seterr(1);break}t=t.adjacent.top}if(4&i)for(t=e.sidecell[1];!t.isnull;){if(1===t.ques){t.seterr(1);break}t=t.adjacent.right}if(8&i)for(t=e.sidecell[0];!t.isnull;){if(1===t.ques){t.seterr(1);break}t=t.adjacent.left}},getTraceInfo:function(){if(this._info.trace)return this._info.trace;for(var e=[],i=0;i<this.board.linegraph.components.length;i++)e.push(this.searchTraceInfo(this.board.linegraph.components[i]));return this._info.trace=e},searchTraceInfo:function(e){for(var e=new this.klass.BorderList(e.getedgeobjs()),i=e.cellinside().filter(function(e){return 2!==e.lcnt}),t=(0===i.length?e[0].sideobj:i)[0],r=t.getdir(t.pathnodes[0].nodes[0].obj,2),n=t.getaddr(),s=[],o=[],h=[],a=[],e={clist:new this.klass.CellList,blist:new this.klass.BorderList},c=0;;){if(n.oncell()){var d=n.getc();if(0<c&&d===t)break;var u,l=d.qdir,l=(d.isShade()&&(u=d.getaddr().movedir(l,1),l=d.isLineStraight()&&u.getb().isLine()?[0,d.DN,d.UP,d.RT,d.LT][l]:d.NDIR),l!==d.NDIR&&(l===r?s:o).push(d),d.adjborder);if(0<c&&2!==d.lcnt)break;1!==r&&l.bottom.isLine()?r=2:2!==r&&l.top.isLine()?r=1:3!==r&&l.right.isLine()?r=4:4!==r&&l.left.isLine()&&(r=3)}else{if(!(u=n.getb()).isLine())break;0!==u.wind&&(u.wind&[0,1,2,4,8][r]&&h.push(u),u.wind&[0,2,1,8,4][r]&&a.push(u))}n.movedir(r,1),c++}i=1,i=s.length<o.length||!(s.length>o.length)&&h.length<a.length?1:2;return e.clist.extend(1===i?s:o),e.blist.extend(1===i?h:a),e}},"AnsCheck@fakearrow":{checklist:["checkAdjacentShadeCell","checkOverShadeArrow","checkLineExist+","checkCrossLine+","checkBranchLine+","checkAcrossArrow","checkLineArrowDirectionUnshade","checkLineArrowDirectionShade","checkNoShadeArrow","checkAllArrow","checkDeadendLine++","checkOneLoop"],checkOverShadeArrow:function(){this.checkAllBlock(this.board.roommgr,function(e){return 1===e.qans},function(e,i,t,r){return t<=1},"bkShadeGe2")},checkNoShadeArrow:function(){this.checkAllBlock(this.board.roommgr,function(e){return 1===e.qans},function(e,i,t,r){return 1<=t},"bkNoShade")},checkLineArrowDirectionUnshade:function(){this.checkLineArrowDirectionGeneric(function(e){return!e.isShade()},"lrAgainstArrow")},checkLineArrowDirectionShade:function(){this.checkLineArrowDirectionGeneric(function(e){return e.isShade()},"lrFollowsFake")}}});
//# sourceMappingURL=nagare.js.map