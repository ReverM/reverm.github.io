/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["kinkonkan"],{MouseEvent:{inputModes:{edit:["border","letter","letter-","number","clear"]},mouseinput_clear:function(){this.inputclean_excell()},mouseinput_number:function(){this.mousestart&&this.inputqnum_excell()},mouseinput_other:function(){0===this.inputMode.indexOf("letter")&&this.mousestart&&this.inputqchar_excell()},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove&&null!==this.inputData)&&this.inputslash():this.puzzle.editmode&&(this.mousestart?this.inputedit_onstart():this.mousemove&&"left"===this.btn&&this.inputborder())},mouseevent:function(e){var t;this.isclearflash=!1,0!==e||(t=this.getpos(0).getex()).isnull||1!==t.qinfo||(this.isclearflash=!0),this.common.mouseevent.call(this,e)},inputslash:function(){var e=this.getcell();if(e.isnull)this.inputflash();else{var t=this.inputData;if(-1!==t&&0!==t){if(null!==t)return;var i=e.getState();"left"===this.btn?t=(i+6)%4-1:"right"===this.btn&&(t=(i+4)%4-1)}e.setState(t),e.drawaround(),this.inputData=t}},inputflash:function(){var e=this.getpos(0).getex(),t=this.puzzle.board;e.isnull||this.mouseCell===e||(this.isclearflash?(t.lightclear(),this.mousereset()):(t.flashlight(e),this.inputData=11,this.mouseCell=e))},inputedit_onstart:function(){var e=this.getcell_excell(),t=this.board;e.isnull||("excell"!==e.group?this.inputborder():(e!==this.cursor.getex()?this.setcursor(e):1!==e.qinfo?t.flashlight(e):t.lightclear(),this.mousereset()))},inputclean_excell:function(){var e,t=this.getcell_excell();t.isnull||"excell"!==t.group||(this.mouseCell=t,e=new this.klass.ExCellList([t]),this.puzzle.playmode?e.ansclear():e.allclear(),t.draw())},inputqnum_excell:function(){var e=this.getcell_excell();e.isnull||"excell"!==e.group||(e!==this.cursor.getex()?this.setcursor(e):this.inputqnum_main(e))},inputqchar_excell:function(){var e,t=this.getcell_excell();t.isnull||"excell"!==t.group||(t!==this.cursor.getex()?this.setcursor(t):(e=t.qchar,e="left"===this.btn?e<104?e+1:0:0<e?e-1:104,t.setQchar(e),t.draw()))}},KeyEvent:{enablemake:!0,moveTarget:function(e){return this.moveExCell(e)},keyinput:function(e){this.key_inputexcell(e)},key_inputexcell:function(e){var t=this.cursor.getex(),i=this.board;if(!t.isnull){var n=t.qnum;if("0"<=e&&e<="9"){var s=+e,r=t.getmaxnum();!(n<=0||this.prev!==t)&&10*n+s<=r?t.setQnum(10*n+s):s<=r&&t.setQnum(s)}else if(1===e.length&&"a"<=e&&e<="z"){s=parseInt(e,36)-10,r=t.qchar;(r-1)%26===s&&0<r&&r<79?t.setQchar(r+26):(r-1)%26===s?t.setQchar(0):t.setQchar(s+1)}else if("-"===e)-1!==n?t.setQnum(-1):(t.setQnum(-1),t.setQchar(0));else if("F4"===e)1!==t.qinfo?i.flashlight(t):i.lightclear();else{if(" "!==e)return;t.setQnum(-1),t.setQchar(0)}this.prev=t,this.cursor.draw()}}},TargetCursor:{initCursor:function(){this.init(-1,-1)}},Cell:{getState:function(){return 30<this.qans?this.qans-30:0!==this.qsub?-1:0},setState:function(e){e=[-1,0,31,32][e+1];-1!==e?(this.setQans(e),this.setQsub(0)):(this.setQans(0),this.setQsub(1))}},ExCell:{disInputHatena:!0,minnum:0},Board:{cols:8,rows:8,hasborder:1,hasexcell:2,haslight:!1,flashlight:function(e){this.lightclear(),this.searchLight(e,!0),this.puzzle.redraw()},lightclear:function(){if(this.haslight){for(var e=0;e<this.cell.length;e++)this.cell[e].qinfo=0;for(e=0;e<this.excell.length;e++)this.excell[e].qinfo=0;this.haslight=!1,this.puzzle.redraw()}},searchLight:function(e,t,i){var n=0;if(!i){i=[];for(var s=0;s<this.cell.length;s++)i[s]=0}var r=e.getaddr(),l=0;for(r.by===this.minby+1?l=2:r.by===this.maxby-1?l=1:r.bx===this.minbx+1?l=4:r.bx===this.maxbx-1&&(l=3);0!==l;){r.movedir(l,2);var o=r.getc();if(o.isnull)break;var h=o.qans,o=o.id;if(31===h)1===l?(i[o]=isNaN({4:1,1:1}[i[o]])?2:1,l=3):2===l?(i[o]=isNaN({2:1,1:1}[i[o]])?4:1,l=4):3===l?(i[o]=isNaN({2:1,1:1}[i[o]])?4:1,l=1):4===l&&(i[o]=isNaN({4:1,1:1}[i[o]])?2:1,l=2);else{if(32!==h){i[o]=1;continue}1===l?(i[o]=isNaN({5:1,1:1}[i[o]])?3:1,l=4):2===l?(i[o]=isNaN({3:1,1:1}[i[o]])?5:1,l=3):3===l?(i[o]=isNaN({5:1,1:1}[i[o]])?3:1,l=2):4===l&&(i[o]=isNaN({3:1,1:1}[i[o]])?5:1,l=1)}if(++n>2*this.cell.length)break}var a=r.getex().id;if(t){for(s=0;s<this.excell.length;s++)this.excell[s].qinfo=0;e.qinfo=1,this.excell[a].qinfo=1;for(s=0;s<this.cell.length;s++)this.cell[s].qinfo=i[s];this.hasinfo=!0}return{cnt:n,dest:a}}},BoardExec:{adjustBoardData:function(e,t){if(e&this.TURNFLIP)for(var i=this.board.cell,n=0;n<i.length;n++){var s=i[n];s.qans={0:0,31:32,32:31}[s.qans]}}},AreaRoomGraph:{enabled:!0},Graphic:{gridcolor_type:"LIGHT",errcolor1:"black",errcolor2:"black",lightcolor:"rgb(255, 255, 127)",linecolor:"black",paint:function(){this.drawBGCells_kinkonkan(),this.drawDotCells(),this.drawGrid(),this.drawBorders(),this.drawSlashes(),this.drawBGExCells(),this.drawNumbersExCell(),this.drawChassis(),this.drawTarget()},drawBGCells_kinkonkan:function(){for(var e=this.vinc("cell_back","crispEdges"),t=this.range.cells,i=0;i<t.length;i++){var n=t[i],s=n.error||n.qinfo,r=n.bx*this.bw,l=n.by*this.bh;e.fillStyle=0!==n.error?this.errbcolor1:this.lightcolor,e.vid="c_bglight_"+n.id,1===s?e.fillRectCenter(r,l,this.bw+.5,this.bh+.5):0!==s?this.drawTriangle1(r,l,n.qinfo):e.vhide()}},getBGExCellColor:function(e){return 1===e.qinfo?this.lightcolor:null},fontsizeratio:.6,fontwidth:[null,.5,.4],getQuesNumberText:function(e){var t="",i=e.qchar,e=e.qnum,t=0===i?"":this.getNumberTextCore_letter(i<=52?i:i-52);return 0<=e&&(t+=e.toString(10)),t},getQuesNumberColor:function(e){return 1===e.error?"rgb(192, 0, 0)":52<e.qchar?"blue":this.quescolor}},Encode:{decodePzpr:function(e){this.decodeBorder(),this.decodeKinkonkan()},encodePzpr:function(e){this.encodeBorder(),this.encodeKinkonkan()},decodeKinkonkan:function(){for(var e=[],t=0,i=0,n=this.outbstr,s=this.board,r=0;r<n.length;r++){var l=n.charAt(r),o=s.excell[t];if(this.include(l,"A","Z")?(e.push(t),o.qchar=parseInt(l,36)-9):this.include(l,"0","9")?(e.push(t),o.qchar=parseInt(l,36)-9+26*(parseInt(n.charAt(r+1),10)+1),r++):this.include(l,"a","z")&&(t+=parseInt(l,36)-10),++t>=s.excell.length){i=r+1;break}}for(t=0,r=i;r<n.length;r++){l=n.charAt(r),o=s.excell[e[t]];if("."===l?o.qnum=-2:"-"===l?(o.qnum=parseInt(n.substr(r+1,2),16),r+=2):o.qnum=parseInt(n.substr(r,1),16),++t>=e.length){i=r+1;break}}this.outbstr=n.substr(i)},encodeKinkonkan:function(){for(var e="",t="",i=this.board,n=0,s=0;s<i.excell.length;s++){var r="",l=i.excell[s].qchar,o=i.excell[s].qnum;0<l&&l<=104?(r=l<=26?(l+9).toString(36).toUpperCase():((l-1)/26-1|0).toString(10)+((l-1)%26+10).toString(16).toUpperCase(),t+=-2===o?".":o<16?""+o.toString(16):"-"+o.toString(16)):n++,0===n?e+=r:!r&&26!==n||(e+=(9+n).toString(36)+r,n=0)}0<n&&(e+=(9+n).toString(36)),this.outbstr+=e+t}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeKinkonkan(),0===this.filever&&this.decodeKinkonkanAns_old()},encodeData:function(){this.filever=1,this.encodeAreaRoom(),this.encodeKinkonkan()},decodeKinkonkan:function(){var n=this.filever;this.decodeCellExCell(function(e,t){var i;"."!==t&&("excell"===e.group?(""!==(i=t.split(","))[0]&&(e.qchar=+i[0]),""!==i[1]&&(e.qnum=+i[1])):"cell"===e.group&&1===n&&("+"===t?e.qsub=1:"1"===t?e.qans=31:"2"===t&&(e.qans=32)))})},encodeKinkonkan:function(){this.encodeCellExCell(function(e){if(!e.isnull)if("excell"===e.group){var t=e.qchar,i=e.qnum,t=0!==t?""+t:"",i=-1!==i?""+i:"";if(t||i)return t+","+i+" "}else if("cell"===e.group){if(31===e.qans)return"1 ";if(32===e.qans)return"2 ";if(1===e.qsub)return"+ "}return". "})},decodeKinkonkanAns_old:function(){this.decodeCell(function(e,t){"+"===t?e.qsub=1:"1"===t?e.qans=31:"2"===t&&(e.qans=32)})}},AnsCheck:{checklist:["checkSingleMirrorInRoom","checkPairMirror","checkReflectionCount","checkExistMirrorInRoom","checkMirrorUnused"],checkSingleMirrorInRoom:function(){this.checkAllBlock(this.board.roommgr,function(e){return 0!==e.qans},function(e,t,i,n){return i<=1},"bkObjGe2")},checkExistMirrorInRoom:function(){this.checkAllBlock(this.board.roommgr,function(e){return 0!==e.qans},function(e,t,i,n){return 0!==i},"bkNoObj")},checkPairMirror:function(){this.checkMirrors(1,"pairedLetterNe")},checkReflectionCount:function(){this.checkMirrors(2,"pairedNumberNe")},checkMirrors:function(e,t){for(var i=[],n=[],s=this.board,r=!0,l=null,o=0;o<s.excell.length;o++){var h=s.excell[o];if(isNaN(n[o])&&-1!==h.qnum&&0!==h.qchar){var a=s.searchLight(h,!1,i),c=s.excell[a.dest];if(1===e&&h.qchar!==c.qchar||2===e&&(h.qnum!==c.qnum||h.qnum!==a.cnt)){if(r=!1,this.checkOnly)break;h.seterr(1),c.seterr(1),l=l||h}n[o]=1,n[a.dest]=1}}!r&&this.checkOnly||(this._info.ldata=i),r||(this.failcode.add(t),l&&s.searchLight(l,!0))},checkMirrorUnused:function(){this._info.ldata||this.checkMirrors();var t=this._info.ldata;this.checkAllCell(function(e){return e.qans&&!t[e.id]},"ceUnused")}}});
//# sourceMappingURL=kinkonkan.js.map