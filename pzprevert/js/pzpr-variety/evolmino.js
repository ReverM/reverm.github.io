/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,e){"object"==typeof module&&module.exports?module.exports=[t,e]:pzpr.classmgr.makeCustom(t,e)}(["evolmino"],{MouseEvent:{use:!0,inputModes:{edit:["arrow","shade","mark-rect"],play:["mark-rect","objblank"]},mouseinput:function(){this.puzzle.editmode?"shade"===this.inputMode?this.inputcell("edit","shade"):"mark-rect"===this.inputMode?this.inputcell("edit","rect"):"arrow"===this.inputMode?this.inputevol():this.common.mouseinput.call(this):this.puzzle.playmode&&("mark-rect"===this.inputMode?this.inputcell("play","rect"):"objblank"===this.inputMode?this.inputcell("play","dot"):this.common.mouseinput.call(this))},mouseinput_auto:function(){this.puzzle.editmode?this.mousestart||this.mousemove?this.inputevol():this.mouseend&&this.notInputted()&&(1===this.puzzle.getConfig("use")?"left"===this.btn?this.inputcell("edit","rect"):this.inputcell("edit","shade"):2===this.puzzle.getConfig("use")&&this.inputcell("edit",this.btn)):this.puzzle.playmode&&(this.mousestart||this.mousemove)&&(1===this.puzzle.getConfig("use")?"left"===this.btn?this.inputcell("play","rect"):this.inputcell("play","dot"):2===this.puzzle.getConfig("use")&&this.inputcell("play",this.btn))},inputcell:function(t,e){var i=this.getcell();if(!i.isnull&&i!==this.mouseCell){var r=this.get_cell_state(i);if(null===this.inputData){t=this.trans_table[t+"_"+e][r];if(!t)return;this.inputData=t}0<=this.inputData&&(this.puzzle.editmode||2!==r&&3!==r)&&this.set_cell_state(i,this.inputData),i.draw(),this.mouseCell=i}},trans_table:{edit_left:{1:3,3:2,2:1,4:3,5:3},edit_right:{1:2,2:3,3:1,4:2,5:2},edit_shade:{1:2,2:1,3:2,4:2,5:2},edit_rect:{1:3,2:3,3:1,4:3,5:3},play_left:{1:4,2:4,3:4,4:5,5:1},play_right:{1:5,2:5,3:5,4:1,5:4},play_rect:{1:4,2:4,3:4,4:1,5:4},play_dot:{1:5,2:5,3:5,4:5,5:1}},get_cell_state:function(t){return 1===t.ques?2:1===t.qnum?3:1===t.anum?4:1===t.qsub?5:1},set_cell_state:function(t,e){"left"===this.btn?(t.setQues(2===e?1:0),t.setQnum(3===e?1:-1),t.setQsub(5===e?1:0),t.setAnum(4===e?1:-1)):"right"===this.btn&&(t.setQnum(3===e?1:-1),t.setQues(2===e?1:0),t.setAnum(4===e?1:-1),t.setQsub(5===e?1:0))},inputevol:function(){var t,e,i,r=this.getcell(),s=this.getpos(0);this.prevPos.equals(s)||(t=this.prevPos.getc(),e=this.prevPos.getnb(s),i=this.prevPos.getdir(s,2),e.isnull||this.mousestart||(null===this.inputData&&(0!==t.lcnt&&!t.isDestination()||0!==r.lcnt&&!r.isDeparture()&&r!==t.prevcell?t.isDeparture()&&(0===r.lcnt||r.isDestination()||r===t.nextcell)?(this.inputData=2,this.mouseCell=t):e.isLine()&&(this.inputData=3,this.mouseCell=t):(this.inputData=1,this.mouseCell=t)),1===this.inputData?e.isLine()||t!==this.mouseCell||0!==t.lcnt&&!t.isDestination()||!(0===r.lcnt||r.isDeparture()&&t.path!==r.path)?e.isLine()&&t===this.mouseCell&&t.path===r.path&&t.isDestination()&&(e.removeLine(),this.mouseCell=r):(e.setLine(i),this.mouseCell=r):2===this.inputData?!e.isLine()&&t===this.mouseCell&&t.isDeparture()&&(0===r.lcnt||r.isDestination()&&t.path!==r.path)?(e.setLine({0:0,1:2,2:1,3:4,4:3}[i]),this.mouseCell=r):e.isLine()&&t===this.mouseCell&&t.path===r.path&&t.isDeparture()&&(e.removeLine(),this.mouseCell=r):3===this.inputData&&e.isLine()&&e.removeLine(),e.draw()),this.prevPos=s)}},Cell:{numberAsObject:!0,disInputHatena:!0,isDeparture:function(){return!this.isnull&&!!this.path&&this===this.path.departure},isDestination:function(){return!this.isnull&&!!this.path&&this===this.path.destination},noLP:function(t){return 1===this.ques},posthook:{ques:function(){if(this.noLP())for(var t in this.adjborder)this.adjborder[t].removeLine()}}},Board:{hasborder:1,addExtraInfo:function(){this.evolgraph=this.addInfoList(this.klass.ArrowLineGraph),this.blockgraph=this.addInfoList(this.klass.AreaBlockGraph)}},Border:{enableLineNG:!0,isLine:function(){return!!this.qdir&&0!==this.qdir},getArrow:function(){return this.qdir},setLine:function(t){this.setQdir(t||0)},removeLine:function(){this.setQdir(0)},isFirstBorder:function(){return!!this.path&&this.path.firstborder===this},isLastBorder:function(){return!!this.path&&this.path.lastborder===this},prehook:{qdir:function(t){return this.checkStableLine(t)}}},BoardExec:{adjustBoardData:function(t,e){this.adjustBorderArrow(t,e)}},"ArrowLineGraph:LineGraph":{enabled:!0,relation:{"border.qdir":"link"},setExtraData:function(t){for(var e=0;e<t.nodes.length;e++)t.nodes[e].din=0,t.nodes[e].dout=0,this.resetExtraData(t.nodes[e].obj);for(var i=t.getedgeobjs(),e=0;e<i.length;e++){this.setComponentRefs(i[e],t);var r=this.getBeforeAndAfterNodes(i[e]),s=r[0],r=r[1];s.dout++,r.din++,s.obj.nextcell=r.obj,r.obj.prevcell=s.obj}t.validarrow=this.isValidArrow(t),!this.rebuildmode&&this.puzzle.painter.context&&this.puzzle.painter.repaintLines(i)},getBeforeAndAfterNodes:function(t){var e=t.sideobj,i=t.qdir,t=t.getaddr().movedir(i,1).getc();return[(t===e[0]?e[1]:e[0]).pathnodes[0],t.pathnodes[0]]},isValidArrow:function(t){for(var e=null,i=null,r=0;r<t.nodes.length;r++){var s=t.nodes[r];if(0===s.din){if(e)return!1;e=s.obj}else if(2<=s.din)return!1;if(0===s.dout){if(i)return!1;i=s.obj}else if(2<=s.dout)return!1}return null!==e&&null!==i&&(t.departure=e,t.destination=i,t.firstborder=e.getnb(e.nextcell),t.lastborder=i.getnb(i.prevcell),!0)},resetExtraData:function(t){t.nextcell=this.board.emptycell,t.prevcell=this.board.emptycell}},"AreaBlockGraph:AreaGraphBase":{enabled:!0,relation:{"cell.qnum":"node","cell.anum":"node"},setComponentRefs:function(t,e){t.block=e},getObjNodeList:function(t){return t.blocknodes},resetObjNodeList:function(t){t.blocknodes=[]},isnodevalid:function(t){return 1===t.getNum()}},Graphic:{gridcolor_type:"LIGHT",sq_qcolor:"black",sq_anscolor:"rgba(0, 160, 0, 0.8)",sq_errorcolor:"rgba(192, 0, 0, 0.8)",sq_trialcolor:"rgba(128, 128, 128, 0.8)",dot_anscolor:"rgba(0, 160, 0, 0.5)",dot_trialcolor:"rgba(128, 128, 128, 0.5)",paint:function(){this.drawBGCells(),this.drawGrid(),this.drawQuesCells(),this.drawLines(),this.drawDotCells(),this.drawSquare(),this.drawChassis()},getLineColor:function(t){return t.isLine()?t.error?this.errlinecolor:"black":null},drawLines:function(){for(var t=this.vinc("line","auto"),e=.6*this.cw,i=.4*this.cw,r=.2*this.cw,s=this.lw/3,o=this.range.borders,n=0;n<o.length;n++){var l=o[n],a=l.bx*this.bw,h=l.by*this.bh,c=this.board.borderAsLine===l.isVert(),u=this.getLineColor(l),d=l.isLastBorder()?l.qdir:0;t.vid="b_line_"+l.id,u?(t.fillStyle=u,c?t.fillRectCenter(a,h,s,this.bh+s):t.fillRectCenter(a,h,this.bw+s,s)):t.vhide(),t.vid="b_arrow_"+l.id,u&&0!==d?(d===l.UP?t.setOffsetLinePath(a,h-e,0,0,-r,i,r,i,!0):d===l.DN?t.setOffsetLinePath(a,h+e,0,0,-r,-i,r,-i,!0):d===l.LT?t.setOffsetLinePath(a-e,h,0,0,i,-r,i,r,!0):d===l.RT&&t.setOffsetLinePath(a+e,h,0,0,-i,-r,-i,r,!0),t.fill()):t.vhide()}this.addlw=0},drawSquare:function(){for(var t=this.vinc("cell_square","auto",!0),e=.7*this.bw-1,i=.7*this.bh-1,r=(t.lineWidth=2,this.range.cells),s=0;s<r.length;s++){var o=r[s];t.vid="c_sq_"+o.id,1===o.qnum||1===o.anum||3===o.qansBySolver?(t.strokeStyle=1===o.error?this.sq_errorcolor:1===o.qnum?this.sq_qcolor:o.trial?this.sq_trialcolor:this.getColorSolverAware(1===o.anum,3===o.qansBySolver,this.sq_anscolor),t.strokeRectCenter(o.bx*this.bw,o.by*this.bh,e,i)):t.vhide()}},drawDotCells:function(){for(var t=this.vinc("cell_dot","auto",!0),e=Math.max(.15*this.cw,3),i=this.range.cells,r=0;r<i.length;r++){var s=i[r];t.vid="c_dot_"+s.id,s.isDot()||s.isDotBySolver()?(t.fillStyle=s.trial?this.dot_trialcolor:this.getColorSolverAware(s.isDot(),s.isDotBySolver(),this.dot_anscolor),t.fillCircle(s.bx*this.bw,s.by*this.bh,e)):t.vhide()}}},Encode:{decodePzpr:function(t){this.genericDecodeThree(function(t,e){1===e?(t.ques=1,t.qnum=-1):2===e&&(t.ques=0,t.qnum=1)}),this.decodeBorderArrow()},encodePzpr:function(t){this.genericEncodeThree(function(t){return 1===t.ques?1:1===t.qnum?2:0}),this.encodeBorderArrow()},decodeBorderArrow:function(){for(var t=this.outbstr,e=this.board,i=2*e.cols*e.rows-e.cols-e.rows,r=0,s=0,o=s;o<t.length;o++)if("z"!==(n=t.charAt(o))?((r+=parseInt(n,36))<i&&((l=e.border[r]).qdir=l.isHorz()?l.UP:l.LT),r++):r+=35,i<=r){s=o+1;break}for(var n,l,r=0,o=s;o<t.length;o++)if("z"!==(n=t.charAt(o))?((r+=parseInt(n,36))<i&&((l=e.border[r]).qdir=l.isHorz()?l.DN:l.RT),r++):r+=35,i<=r){s=o+1;break}this.outbstr=t.substr(s)},encodeBorderArrow:function(){for(var t="",e=0,i=this.board,r=2*i.cols*i.rows-i.cols-i.rows,s=0;s<r;s++)(n=(o=i.border[s]).getArrow())===o.UP||n===o.LT?(t+=e.toString(36),e=0):35<=++e&&(t+="z",e=0);0<e&&(t+=e.toString(36));for(var o,n,e=0,s=0;s<r;s++)(n=(o=i.border[s]).getArrow())===o.DN||n===o.RT?(t+=e.toString(36),e=0):35<=++e&&(t+="z",e=0);0<e&&(t+=e.toString(36)),this.outbstr+=t}},FileIO:{decodeData:function(){this.decodeCell(function(t,e){"#"===e?t.ques=1:"0"===e&&(t.qnum=1)}),this.decodeBorder(function(t,e){var i;"0"!==e&&(e=+e,i=t.isVert(),1!=e||i||(t.qdir=t.UP),2!=e||i||(t.qdir=t.DN),1==e&&i&&(t.qdir=t.LT),2==e&&i&&(t.qdir=t.RT))}),this.decodeCell(function(t,e){"0"===e?t.anum=1:"+"===e&&(t.qsub=1)})},encodeData:function(){this.encodeCell(function(t){return 1===t.ques?"# ":1===t.qnum?"0 ":". "}),this.encodeBorder(function(t){var e=t.qdir;return e===t.UP||e===t.LT?"1 ":e===t.DN||e===t.RT?"2 ":"0 "}),this.encodeCell(function(t){return 1===t.anum?"0 ":1===t.qsub?"+ ":". "})}},AnsCheck:{checklist:["checkValidArrow","checkBlockOnlyOneArrow","checkBlockOnArrow","checkArrowThroughBlocks","checkEvolution"],checkValidArrow:function(){for(var t=this.board.evolgraph.components,e=0;e<t.length;e++)if(!t[e].validarrow){if(this.failcode.add("arInvalid"),this.checkOnly)break;t[e].setedgeerr(1)}},checkBlockOnArrow:function(){for(var t=this.board.blockgraph.components,e=0;e<t.length;e++){for(var i=t[e].clist,r=0,s=0;s<i.length;s++)i[s].path&&r++;if(0===r){if(this.failcode.add("bsNoArrow"),this.checkOnly)break;i.seterr(1)}}},checkBlockOnlyOneArrow:function(){for(var t=this.board.blockgraph.components,e=0;e<t.length;e++){for(var i=t[e].clist,r=0,s=0;s<i.length;s++)i[s].path&&r++;if(!(r<=1)){if(this.failcode.add("bsArrowGt2"),this.checkOnly)break;i.seterr(1)}}},checkArrowThroughBlocks:function(){for(var t=this.board.evolgraph.components,e=0;e<t.length;e++)if(t[e].validarrow&&!(2<=this.getBlocks(t[e]).length)){if(this.failcode.add("arBlockLt2"),this.checkOnly)break;t[e].setedgeerr(1)}},checkEvolution:function(){for(var t=this.board.evolgraph.components,e=0;e<t.length;e++)if(t[e].validarrow){var i=this.getBlocks(t[e]);if(!(i.length<=1))for(var r=0;r<i.length-1;r++)if(!this.isEvolution(i[r],i[r+1])){if(this.failcode.add("bsNotEvol"),this.checkOnly)return;i[r+1].clist.seterr(1)}}},getBlocks:function(t){for(var e=t.departure,i=[];!e.isnull;)e.block&&-1===i.indexOf(e.block)&&i.push(e.block),e=e.nextcell;return i},isEvolution:function(t,e){if(t.clist.length+1!==e.clist.length)return!1;for(var i=t.clist.getBlockShapes(),r=0;r<e.clist.length;r++){for(var s=new this.board.klass.CellList,o=0;o<e.clist.length;o++)o!==r&&s.add(e.clist[o]);var n=s.getBlockShapes();if(i.id===n.id)return!0}return!1}}});
//# sourceMappingURL=evolmino.js.map