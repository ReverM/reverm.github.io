/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,n){"object"==typeof module&&module.exports?module.exports=[e,n]:pzpr.classmgr.makeCustom(e,n)}(["goishi"],{MouseEvent:{mouseinput:function(){this.puzzle.playmode&&this.mousestart?"left"===this.btn&&this.inputqans():this.puzzle.editmode&&this.mousestart&&this.inputstone()},inputstone:function(){var e=this.getcell();e.isnull||(e!==this.cursor.getc()&&this.setcursor(e),e.setStone(),e.draw())},inputqans:function(){var e=this.getcell();if(!e.isnull&&e.isStone()&&-1===e.anum){for(var n=0,i=this.board,t=i.emptycell,o=0;o<i.cell.length;o++)(l=i.cell[o]).anum>n&&(n=l.anum,t=l);if(!t.isnull){var s,r={x1:e.bx,y1:e.by,x2:t.bx,y2:t.by};if(r.x1!==r.x2&&r.y1!==r.y2)return;r.x1===r.x2?(r.y1>r.y2&&(s=r.y2,r.y2=r.y1,r.y1=s),r.y1+=2,r.y2-=2):(r.x1>r.x2&&(s=r.x2,r.x2=r.x1,r.x1=s),r.x1+=2,r.x2-=2);for(var c=r.x1;c<=r.x2;c+=2)for(var a=r.y1;a<=r.y2;a+=2){var l=i.getc(c,a);if(!l.isnull&&l.isStone()&&(-1===l.anum||2<=n&&l.anum===n-1))return}}e.setAnum(n+1),e.draw()}}},KeyEvent:{enablemake:!0,keyinput:function(e){this.key_inputstone(e)},key_inputstone:function(e){"q"===e&&((e=this.cursor.getc()).setStone(),e.draw())}},Cell:{ques:7,isStone:function(){return 7!==this.ques},setStone:function(){7===this.ques?this.setQues(0):-1===this.anum&&this.setQues(7)}},Board:{disable_subclear:!0},Graphic:{errcolor1:"rgb(208, 0, 0)",errbcolor1:"rgb(255, 192, 192)",paint:function(){this.drawCenterLines(),this.drawCircles(),this.drawCellSquare(),this.drawAnsNumbers(),this.drawTarget()},drawCenterLines:function(){var e=this.vinc("centerline","crispEdges",!0),n=this.board,i=this.range.x1,t=this.range.y1,o=this.range.x2,s=this.range.y2;i<n.minbx+1&&(i=n.minbx+1),o>n.maxbx-1&&(o=n.maxbx-1),t<n.minby+1&&(t=n.minby+1),s>n.maxby-1&&(s=n.maxby-1),i-=1&~i,t-=1&~t,o+=1&~o,s+=1&~s,e.lineWidth=1,e.strokeStyle=this.gridcolor;for(var r=i;r<=o;r+=2){var c=r*this.bw,a=t*this.bh,l=s*this.bh;e.vid="cliney_"+r,e.strokeLine(c,a,c,l)}for(r=t;r<=s;r+=2){var u=r*this.bh,h=i*this.bw,d=o*this.bw;e.vid="clinex_"+r,e.strokeLine(h,u,d,u)}},getCircleStrokeColor:function(e){return e.isStone()&&-1===e.anum?1===e.error?this.errcolor1:this.quescolor:null},getCircleFillColor:function(e){return e.isStone()&&-1===e.anum?1===e.error?this.errbcolor1:"white":null},drawCellSquare:function(){for(var e=this.vinc("cell_number_base","crispEdges"),n=.8*this.bw-2,i=.8*this.bh-2,t=this.range.cells,o=0;o<t.length;o++){var s=t[o];e.vid="c_sq_"+s.id,s.isStone()&&-1!==s.anum?(e.fillStyle=1===s.error?this.errbcolor1:"white",e.fillRectCenter(s.bx*this.bw,s.by*this.bh,n,i)):e.vhide()}}},Encode:{decodePzpr:function(e){this.decodeGoishi()},encodePzpr:function(e){this.encodeGoishi()},decodeKanpen:function(){this.fio.decodeGoishi_kanpen()},encodeKanpen:function(){this.fio.encodeGoishi_kanpen()},decodeGoishi:function(){var e=this.outbstr,n=0,i=this.board,t=[16,8,4,2,1];i.disableInfo();for(var o=0;o<e.length;o++){for(var s=parseInt(e.charAt(o),32),r=0;r<5;r++)i.cell[n]&&(i.cell[n].setQues(s&t[r]?7:0),n++);if(!i.cell[n])break}i.enableInfo(),this.outbstr=e.substr(o+1)},encodeGoishi:function(){for(var e=this.board,n="",i=0,t=0,o=[16,8,4,2,1],s=0;s<e.cell.length;s++){var r=e.cell[s];!r.isnull&&r.isStone()||(t+=o[i]),5===++i&&(n+=t.toString(32),t=i=0)}0<i&&(n+=t.toString(32)),this.outbstr+=n}},FileIO:{decodeData:function(){this.decodeGoishiFile()},encodeData:function(){this.encodeGoishiFile()},kanpenOpen:function(){this.decodeGoishi_kanpen(),this.decodeQansPos_kanpen()},kanpenSave:function(){this.encodeGoishi_kanpen(),this.encodeQansPos_kanpen()},decodeGoishiFile:function(){this.decodeCell(function(e,n){"."!==n&&(e.ques=0,"0"!==n&&(e.anum=+n))})},encodeGoishiFile:function(){this.encodeCell(function(e){return 0===e.ques?-1!==e.anum?e.anum+" ":"0 ":". "})},decodeGoishi_kanpen:function(){this.decodeCell(function(e,n){"1"===n&&(e.ques=0)})},encodeGoishi_kanpen:function(){for(var e=this.board,n=e.minby+1;n<e.maxby;n+=2){for(var i="",t=e.minbx+1;t<e.maxbx;t+=2)i+=e.getc(t,n).isStone()?"1 ":". ";this.writeLine(i)}},decodeQansPos_kanpen:function(){for(;;){var e=this.readLine();if(!e)return;e=e.split(" ");if(e.length<=1)return;var n=this.board.getc(2*+e[2]+1,2*+e[1]+1);n.ques=0,n.anum=+e[0]}},encodeQansPos_kanpen:function(){for(var e=[],n=this.board,i=n.minby+1;i<n.maxby;i+=2)for(var t=n.minbx+1;t<n.maxbx;t+=2){var o=n.getc(t,i);0===o.ques&&-1!==o.anum&&(e[o.anum-1]=[t>>1,i>>1])}for(var s=0,r=e.length;s<r;s++){var c=[s+1,e[s][1],e[s][0]];this.writeLine(c.join(" "))}},kanpenOpenXML:function(){this.decodeCellQnum_goishi_XMLBoard(),this.decodeQansPos_XMLAnswer()},kanpenSaveXML:function(){this.encodeCellQnum_goishi_XMLBoard(),this.encodeQansPos_XMLAnswer()},decodeCellQnum_goishi_XMLBoard:function(){this.decodeCellXMLBoard(function(e,n){1===n&&(e.ques=0)})},encodeCellQnum_goishi_XMLBoard:function(){this.encodeCellXMLBoard(function(e){return 0===e.ques?"1":null})},decodeQansPos_XMLAnswer:function(){for(var e=this.xmldoc.querySelectorAll("answer picked"),n=0;n<e.length;n++){var i=e[n],t=2*+i.getAttribute("c")-1,o=2*+i.getAttribute("r")-1;this.board.getc(t,o).anum=+i.getAttribute("n")}},encodeQansPos_XMLAnswer:function(){for(var e=this.xmldoc.querySelector("answer"),n=this.board,i=1;;i++){for(var t=null,o=0;o<n.cell.length;o++)if(n.cell[o].anum===i){t=n.cell[o];break}if(!t)break;e.appendChild(this.createXMLNode("picked",{n:i,r:1+(t.by>>1),c:1+(t.bx>>1)}))}}},AnsCheck:{checklist:["checkStoneExist","checkPickedStone"],checkStoneExist:function(){this.board.cell.some(function(e){return e.isStone()})||this.failcode.add("brNoStone")},checkPickedStone:function(){this.checkAllCell(function(e){return e.isStone()&&-1===e.anum},"goishiRemains")}}});
//# sourceMappingURL=goishi.js.map