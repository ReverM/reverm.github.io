/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,i){"object"==typeof module&&module.exports?module.exports=[e,i]:pzpr.classmgr.makeCustom(e,i)}(["pmemory"],{MouseEvent:{draggingSG:!1,inputModes:{edit:["border","shade","clear","info-line","info-room"],play:["line","peke","clear","subcircle","subcross","info-line","info-room"]},mouseinput_clear:function(){if(this.puzzle.playmode)this.inputFixedQsub(0);else{var e=this.getcell();if(!e.isnull&&e.ice()){for(var i in e.setQues(0),e.adjborder){var t=e.adjborder[i],i=e.adjacent[i];t&&!t.isnull&&t.setQues(i.ice()?1:0)}e.drawaround()}}},mouseinputAutoEdit:function(){if("right"===this.btn)return this.mouseinput_clear();null===this.firstPoint.bx&&this.firstPoint.set(this.inputPoint),this.draggingSG||.5<(i=this.inputPoint.bx-this.firstPoint.bx)*i+(i=this.inputPoint.by-this.firstPoint.by)*i&&(this.inputData=!0);var e=this.getcell();if(this.draggingSG&&this.mouseend)return this.draggingSG=!1,void e.draw();if(!e.isnull&&this.mouseend&&!this.inputData)return this.mouseinput_clear();if(!e.isnull&&!this.prevPos.equals(e)){var i=this.prevPos.getc();if(this.draggingSG)1!==e.qnum&&(e.setQnum(1),i.setQnum(-1));else if(null===this.prevPos.bx){if(1===e.qnum)return this.draggingSG=!0,void e.draw();if(!e.ice())for(var t in this.inputData=!0,e.setQues(6),e.adjborder)(n=e.adjborder[t])&&!n.isnull&&n.setQues(1)}else{if(!e.ice()){this.inputData=!0;var r=this.prevPos.getnb(e);for(t in r.isnull||r.setQues(0),e.setQues(6),e.adjborder){var n=e.adjborder[t],s=e.adjacent[t];!n||n.isnull||s.ice()||n.setQues(1)}}this.board.mergeCells(this.prevPos.getc(),e)}this.prevPos.set(e),e.drawaround(),i.draw()}},inputShade:function(){var e=this.getcell();if(!e.isnull&&e!==this.mouseCell){null===this.inputData&&(this.inputData=e.ice()?0:6);for(var i=e.room.clist,t=0;t<i.length;t++)i[t].setQues(this.inputData);i.draw(),this.mouseCell=e}},dispInfoRoom:function(){var e=this.getcell();if(this.mousereset(),!e.isnull&&e.ice()){for(var i=e.room.clist.getBlockShapes().id,t=this.board.roommgr.components,r=0;r<t.length;r++){var n=t[r].clist;n[0].ice()&&n.getBlockShapes().id===i&&n.setinfo(1)}this.board.hasinfo=!0,this.puzzle.redraw()}},autoplay_func:"lineMB"},Cell:{invalidNeighbors:function(){if(2!==this.lcnt)return null;var e=this.board,i=this.bx,t=this.by;return this.isLineStraight()?this.adjborder.top.isLine()?e.cellinside(i-2,t,i+2,t):e.cellinside(i,t-2,i,t+2):this.adjborder.top.isLine()?this.adjborder.left.isLine()?e.cellinside(i,t,i+2,t+2):e.cellinside(i-2,t,i,t+2):this.adjborder.left.isLine()?e.cellinside(i,t-2,i+2,t):e.cellinside(i-2,t-2,i,t)}},BoardExec:{adjustBoardData:function(e,i){var t=this.board;this.moved=[];for(var r=0;r<t.cell.length;r++){var n=t.cell[r];1!==n.qnum||(n=this.getAfterPos(e,i,n)).isdel&&this.moved.push(n)}},adjustBoardData2:function(e,i){for(var t=this.board,r=0;r<this.moved.length;r++){var n=this.moved[r].pos;t.getc(n.bx,n.by).setQnum(1)}}},Board:{hasborder:1,mergeCells:function(e,i){var t=e.room,r=i.room;this.board.border.filter(function(e){var i=e.sidecell[0].room,e=e.sidecell[1].room;return t===i&&r===e||t===e&&r===i}).each(function(e){e.setQues(0),e.draw()})},rebuildInfo:function(){this.common.rebuildInfo.call(this),this.disableInfo();var e=this.cell.filter(function(e){return 1===e.qnum}),i=this.getc(1,1);e.length<2&&1!==i.qnum&&(i.qnum=1,e.add(i)),e.length<2&&(this.getc(this.maxbx-1,this.maxby-1).qnum=1),this.enableInfo()}},AreaRoomGraph:{enabled:!0},LineGraph:{enabled:!0},Graphic:{bgcellcolor_func:"icebarn",icecolor:"rgb(204,204,204)",irowake:!0,circleratio:[.33,.33],paint:function(){this.drawBGCells(),this.drawGrid(),this.drawPekes(),this.drawLines(),this.drawCircles(),this.drawMBs(),this.drawBorders(),this.drawChassis()},getCircleStrokeColor:function(e){return this.getCircleFillColor(e)},getCircleFillColor:function(e){if(1!==e.qnum)return null;if(this.puzzle.mouse.draggingSG){var i=this.puzzle.mouse.prevPos;if(i&&i.equals(e))return"red"}return 1===(e.error||e.qinfo)?this.errcolor1:this.quescolor}},Encode:{decodePzpr:function(e){this.board.cell.each(function(e){e.qnum=-1}),this.decodeBorder(),this.decode1Cell(1),this.board.roommgr.rebuild();var t=this.board.roommgr.components;this.genericDecodeBinary(t.length,function(e,i){i&&t[e].clist.each(function(e){e.ques=6})})},encodePzpr:function(e){this.encodeBorder(),this.encode1Cell(1),this.board.roommgr.rebuild();var i=this.board.roommgr.components;this.genericEncodeBinary(i.length,function(e){return i[e].clist[0].ice()})}},FileIO:{decodeData:function(){this.decodeBorderQues(),this.decodeCell(function(e,i){i=+i;e.ques=1&i?6:0,e.qnum=2&i?1:-1}),this.decodeBorderLine(),this.decodeCellQsub()},encodeData:function(){this.encodeBorderQues(),this.encodeCell(function(e){var i=0;return e.ice()&&(i|=1),1===e.qnum&&(i|=2),i+" "}),this.encodeBorderLine(),this.encodeCellQsub()}},AnsCheck:{checklist:["checkBranchLine","checkCrossLine","checkAdjacency","checkRegionCopies","checkCircleEndpoint","checkShadedRegions","checkOneLine"],checkAdjacency:function(){for(var e=0;e<this.board.cell.length;e++){var i=this.board.cell[e],t=i.invalidNeighbors();if(t){t=t.filter(function(e){return e!==i&&0<e.lcnt});if(0!==t.length){if(this.failcode.add("lnAdjacent"),this.checkOnly)break;i.seterr(1),t.seterr(1)}}}},checkRegionCopies:function(){for(var e=!this.puzzle.getConfig("multierr"),i=this.board.roommgr.components,t={},r=0;r<i.length;r++){var n,s=i[r];s.clist[0].ice()&&((n=s.clist.getBlockShapes().id)in t||(t[n]=[]),t[n].push(s))}for(n in t){for(var o=(i=t[n])[0].clist.length,l=!0,c=0;l&&c<i.length-1;c++)for(var a=0;l&&a<o;a++){var d,h=i[c].clist[a],u=i[c+1].clist[a];for(d in h.adjborder){var f=h.adjborder[d],g=u.adjborder[d];(f&&f.isLine())!==(g&&g.isLine())&&(l=!1)}}if(!l){if(this.failcode.add("bkDifferentLines"),this.checkOnly)return;for(c=0;c<i.length;c++)i[c].clist.seterr(1);if(e)return}}},checkCircleEndpoint:function(){this.checkAllCell(function(e){return 1===e.qnum&&1!==e.lcnt},"shEndpoint")},checkShadedRegions:function(){for(var e=this.board.roommgr.components,i=0;i<e.length;i++){var t=e[i];if(t.clist[0].ice()&&!t.clist.some(function(e){return 0<e.lcnt})){if(this.failcode.add("bkNoLine"),this.checkOnly)break;t.clist.seterr(1)}}}},FailCode:{shEndpoint:"shEndpoint.snake",bkNoLine:"bkNoLine.ovotovata"}});
//# sourceMappingURL=pmemory.js.map