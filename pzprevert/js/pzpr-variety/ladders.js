/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e,t){"object"==typeof module&&module.exports?module.exports=[e,t]:pzpr.classmgr.makeCustom(e,t)}(["ladders"],{MouseEvent:{inputModes:{edit:["border","number","clear","info-room"],play:["bar","peke","subcircle","subcross","info-room"]},mouseinput_auto:function(){this.puzzle.playmode?((this.mousestart||this.mousemove)&&("left"===this.btn?this.inputTateyoko():"right"===this.btn&&this.inputpeke()),this.mouseend&&this.notInputted()&&(this.inputpeke_ifborder()||this.inputMB())):this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputborder():this.mouseend&&this.notInputted()&&this.inputqnum())},dispInfoRoom:function(){var e=this.getcell();this.mousereset(),e.isnull||(this.board.rebuildIfStale(),e.room.top.roomitem.setinfo())}},KeyEvent:{enablemake:!0},Cell:{segment:null,minnum:0,maxnum:function(){return this.room.clist.length},isLine:function(){return this.qans},setinfo:function(e){0<e&&0<this.qinfo?this.qinfo|=e:this.qinfo=e},prehook:{qans:function(){this.isLine()&&!this.board.isStale&&(this.board.segment.removeSegmentByAddr(this.bx,this.by),this.board.linegraph.rebuild())}},posthook:{qans:function(e){e&&!this.board.isStale&&this.board.segment.addSegmentByAddr(this.bx,this.by,e)}}},CellList:{setinfo:function(e){for(var t=0;t<this.length;t++)this[t].setinfo(e)}},Board:{hasborder:1,isStale:!0,createExtraObject:function(){this.segment=new this.klass.SegmentList,this.room=new this.klass.RoomList},rebuildInfo:function(){var t=this;this.cell.each(function(e){e.roomitem=null}),this.roommgr.rebuild(),this.segment.allclear(),this.room.allclear(),this.room.rebuild(),this.linegraph.rebuild(),this.cell.each(function(e){e.isLine()&&t.segment.addSegmentByAddr(e.bx,e.by,e.qans)}),this.isStale=!1},rebuildIfStale:function(){this.isStale&&this.rebuildInfo()},getSegment:function(e,t){e=this.getc(e,t);return e.isnull?null:e.segment}},BoardExec:{adjustBoardData:function(e,t){if(this.board.isStale=!0,e&this.TURN)for(var i={0:0,12:13,13:12},s=this.board.cellinside(t.x1,t.y1,t.x2,t.y2),o=0;o<s.length;o++){var n=s[o];n.qans=i[n.qans]}}},Border:{posthook:{ques:function(){this.board.isStale=!0}}},AreaRoomGraph:{enabled:!0,hastop:!0},Room:{group:"room",top:null,path:null,setinfo:function(){this.board.cell.setinfo(-1);for(var e=this.path?this.path.getnodeobjs():[this],t=0;t<e.length;t++){var i=e[t];i.top.room.clist.setinfo(1);for(var s=0;s<i.seglist.length;s++)i.seglist[s].getc().setinfo(2)}this.board.hasinfo=!0,this.puzzle.redraw()}},"RoomList:PieceList":{name:"RoomList",rebuild:function(){for(var e=this.board.roommgr.components,t=0;t<e.length;t++){var i=new this.klass.Room;i.seglist=new this.klass.SegmentList,i.top=e[t].top,i.top.roomitem=i,this.add(i)}},allclear:function(){this.ansclear()},ansclear:function(){Array.prototype.splice.call(this,0)}},Segment:{group:"segment",path:null,initialize:function(e,t,i){this.isnull=!0,this.sideobj=[null,null],this.bx=null,this.by=null,this.error=0,this.setpos(e,t,i)},setpos:function(e,t,i){this.bx=e,this.by=t,i?(this.isVert=12===i,i=this.isVert?this.board.getc(e,t-2):this.board.getc(e-2,t),e=this.isVert?this.board.getc(e,t+2):this.board.getc(e+2,t),this.sideobj[0]=i.isnull?null:i.room.top.roomitem,this.sideobj[1]=e.isnull?null:e.room.top.roomitem):this.sideobj[0]=this.sideobj[1]=null,this.isvalid=this.sideobj[0]&&this.sideobj[1]},getc:function(){return this.board.getc(this.bx,this.by)}},"SegmentList:PieceList":{name:"SegmentList",add:function(e){var t=this.board;this.klass.PieceList.prototype.add.call(this,e),this===t.segment&&(e.isnull=!e.isvalid,e.isnull||((t.getc(e.bx,e.by).segment=e).sideobj[0].seglist.add(e),e.sideobj[1].seglist.add(e),t.isenableInfo()&&t.linegraph.modifyInfo(e,"segment")))},remove:function(e){var t;e&&(t=this.board,this.klass.PieceList.prototype.remove.call(this,e),this!==t.segment||e.isnull||(e.isnull=!0,t.getc(e.bx,e.by).segment=null,e.sideobj[0].seglist.remove(e),e.sideobj[1].seglist.remove(e),t.isenableInfo()&&t.linegraph.modifyInfo(e,"segment")))},allclear:function(){this.ansclear()},ansclear:function(){for(var e=this.length-1;0<=e;e--)this.remove(this[e])},addSegmentByAddr:function(e,t,i){this.add(new this.klass.Segment(e,t,i))},removeSegmentByAddr:function(e,t){this.remove(this.board.getSegment(e,t))}},LineGraph:{enabled:!0,coloring:!1,relation:{segment:"link"},pointgroup:"room",linkgroup:"segment",isedgevalidbylinkobj:function(e){return!e.isnull}},Graphic:{gridcolor_type:"DARK",paint:function(){this.drawBGCells(),this.drawGrid(),this.drawMBs(),this.drawTateyokos(),this.drawQuesNumbers(),this.drawBorders(),this.drawPekes(),this.drawChassis(),this.drawTarget()},getBGCellColor_error1:function(e){e=e.error||e.qinfo;return 0<e&&1&e?this.errbcolor1:null},drawTateyokos:function(){for(var e=this.vinc("cell_tateyoko","crispEdges"),t=Math.max(this.cw/9,2)/2,i=this.range.cells,s=0;s<i.length;s++){var o=i[s],n=o.bx*this.bw,r=o.by*this.bh,d=o.qans;12===d?(e.vid="c_bar1a_"+o.id,e.fillStyle=this.getBarColor(o,!0),e.fillRectCenter(n-this.bw/2,r,t+this.addlw/2,this.bh),e.vid="c_bar1b_"+o.id,e.fillRectCenter(n+this.bw/2,r,t+this.addlw/2,this.bh),e.vid="c_bar1c_"+o.id,e.fillRectCenter(n,r-this.bh/3,this.bw/2,t+this.addlw/2),e.vid="c_bar1d_"+o.id,e.fillRectCenter(n,r+this.bh/3,this.bw/2,t+this.addlw/2)):(e.vid="c_bar1a_"+o.id,e.vhide(),e.vid="c_bar1b_"+o.id,e.vhide(),e.vid="c_bar1c_"+o.id,e.vhide(),e.vid="c_bar1d_"+o.id,e.vhide()),13===d?(e.vid="c_bar2a_"+o.id,e.fillStyle=this.getBarColor(o,!1),e.fillRectCenter(n,r-this.bh/2,this.bw,t+this.addlw/2),e.vid="c_bar2b_"+o.id,e.fillRectCenter(n,r+this.bh/2,this.bw,t+this.addlw/2),e.vid="c_bar2c_"+o.id,e.fillRectCenter(n-this.bw/3,r,t+this.addlw/2,this.bh/2),e.vid="c_bar2d_"+o.id,e.fillRectCenter(n+this.bw/3,r,t+this.addlw/2,this.bh/2)):(e.vid="c_bar2a_"+o.id,e.vhide(),e.vid="c_bar2b_"+o.id,e.vhide(),e.vid="c_bar2c_"+o.id,e.vhide(),e.vid="c_bar2d_"+o.id,e.vhide())}this.addlw=0},getBarColor:function(e,t){var i="";return this.addlw=0,e.error||0<e.qinfo&&2&e.qinfo?(i=this.errlinecolor,this.addlw=1):i=-1===e.qinfo||1===e.qinfo?this.noerrcolor:e.trial?this.trialcolor:this.linecolor,i}},Encode:{decodePzpr:function(e){this.decodeBorder(),this.decodeRoomNumber16()},encodePzpr:function(e){this.encodeBorder(),this.encodeRoomNumber16()}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeCellQnum(),this.decodeCellBar(),this.decodeBorderLine(),this.decodeCellQsub()},encodeData:function(){this.encodeAreaRoom(),this.encodeCellQnum(),this.encodeCellBar(),this.encodeBorderLine(),this.encodeCellQsub()},decodeCellBar:function(){this.decodeCell(function(e,t){"1"===t?e.qans=12:"2"===t&&(e.qans=13)})},encodeCellBar:function(){this.encodeCell(function(e){switch(e.qans){case 12:return"1 ";case 13:return"2 ";default:return"0 "}})}},AnsCheck:{checklist:["checkBarExist","checkAdjacentLadder","checkInvalidLadder","checkLadderBorders","checkLadderCount+","checkConnectRoom"],checkBarExist:function(){this.board.cell.some(function(e){return e.isLine()})||this.failcode.add("brNoLine")},checkInvalidLadder:function(){var t=this.board;t.rebuildIfStale(),this.checkAllCell(function(e){if(!e.isLine())return!1;e=t.getSegment(e.bx,e.by);return!e||!e.isvalid||e.sideobj[0]===e.sideobj[1]},"ceInvalidLadder")},checkAdjacentLadder:function(){this.checkSideCell(function(e,t){var i=2===Math.abs(e.bx-t.bx)?13:12;return e.qans===i&&t.qans===i},"lnAdjacent")},checkLadderBorders:function(){this.board.rebuildIfStale(),this.checkAllCell(function(e){if(!e.isLine())return!1;var t=e.adjborder,i=12===e.qans?t.top:t.left,e=12===e.qans?t.bottom:t.right;return i.inside&&!i.isBorder()||e.inside&&!e.isBorder()},"lnNoBorder")},checkLadderCount:function(){this.checkAllBlock(this.board.roommgr,function(e){return e.isLine()},function(e,t,i,s){return s<0||s===i},"bkLadderNe")},checkConnectRoom:function(){var e=this.board,t=(e.rebuildIfStale(),e.linegraph.components);0!==t.length&&t[0].nodes.length===e.room.length||(this.failcode.add("lnPlLoop"),this.checkOnly||(0<t.length?t[0].nodes[0].obj.setinfo():0<e.room.length&&e.room[0].setinfo()))}}});
//# sourceMappingURL=ladders.js.map