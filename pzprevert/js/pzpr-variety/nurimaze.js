/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,e){"object"==typeof module&&module.exports?module.exports=[t,e]:pzpr.classmgr.makeCustom(t,e)}(["nurimaze"],{MouseEvent:{use:!0,inputModes:{edit:["border","mark-circle","mark-triangle"],play:["shade","unshade","line","info-line"]},mouseinput:function(){"shade"===this.inputMode||"unshade"===this.inputMode?this.inputtile_nurimaze():this.common.mouseinput.call(this)},mouseinput_other:function(){0===this.inputMode.indexOf("mark-")&&this.inputmarks()},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&this.inputtile_nurimaze():this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputEdit():this.mouseend&&this.inputEdit_end())},inputtile_nurimaze:function(){var t=this.getcell();if(!t.isnull&&t!==this.mouseCell){null===this.inputData&&this.decIC(t);var e=this.board,s=t.room.clist;if(1===this.inputData)for(var i=0;i<s.length;i++)if(0!==s[i].ques||e.startpos.equals(s[i])||e.goalpos.equals(s[i])){if(this.mousestart){this.inputData=1!==t.qsub?2:0;break}return}this.mouseCell=t;for(i=0;i<s.length;i++){var o=s[i];(1===this.inputData?o.setShade:o.clrShade).call(o),o.setQsub(2===this.inputData?1:0)}s.draw()}},inputEdit:function(){var t=this.getcell();t.isnull||(null===this.inputData&&this.inputEdit_first(),10===this.inputData?this.board.startpos.input(t):11===this.inputData?this.board.goalpos.input(t):null!==this.inputData&&this.inputborder())},inputEdit_first:function(){var t=this.getpos(.33),e=this.board;e.startpos.equals(t)?this.inputData=10:e.goalpos.equals(t)?this.inputData=11:this.inputborder()},inputEdit_end:function(){var t=this.getcell();t.isnull||(10===this.inputData||11===this.inputData?(this.inputData=null,t.draw()):this.notInputted()&&(t!==this.cursor.getc()?this.setcursor(t):this.inputQuesMark(t)))},inputmarks:function(){var t=this.getcell();t.isnull||t===this.mouseCell||(this.inputQuesMark(t),this.mouseCell=t)},inputQuesMark:function(t){var e=this.board,s=-1;if("mark-circle"===this.inputMode)s=41!==t.ques?41:0;else if("mark-triangle"===this.inputMode)s=42!==t.ques?42:0;else if("left"===this.btn)s={0:41,41:42,42:0}[t.ques];else{if("right"!==this.btn)return;s={0:42,42:41,41:0}[t.ques]}0!==s&&(e.startpos.equals(t)||e.goalpos.equals(t))||(t.setQues(s),t.draw())}},KeyEvent:{enablemake:!0,keyinput:function(t){this.keydown&&this.puzzle.editmode&&this.key_inputqnum_nurimaze(t)},key_inputqnum_nurimaze:function(t){var e=this.cursor.getc(),s=this.board,i=e.ques,o=-1;if("1"===t||"q"===t)o=41!==i?41:0;else if("2"===t||"w"===t)o=42!==i?42:0;else if("3"===t||"e"===t||" "===t||"BS"===t)o=0;else if("s"===t)s.startpos.input(e);else{if("g"!==t)return;s.goalpos.input(e)}o===i||0!==o&&(s.startpos.equals(e)||s.goalpos.equals(e))||(e.setQues(o),e.draw())}},Board:{hasborder:1,startpos:null,goalpos:null,createExtraObject:function(){var t=this.klass;this.startpos=new t.StartAddress(1,1),this.goalpos=new t.GoalAddress(2*this.cols-1,2*this.rows-1),this.startpos.partner=this.goalpos,this.goalpos.partner=this.startpos},initExtraObject:function(t,e){this.disableInfo(),this.startpos.init(1,1),this.goalpos.init(2*t-1,2*e-1),this.enableInfo()},exchangestartgoal:function(){var t=this.startpos.getc(),e=this.goalpos.getc();this.startpos.set(e),this.goalpos.set(t),this.startpos.draw(),this.goalpos.draw()}},BoardExec:{posinfo:{},adjustBoardData:function(t,e){var s=this.board;this.posinfo_start=this.getAfterPos(t,e,s.startpos.getc()),this.posinfo_goal=this.getAfterPos(t,e,s.goalpos.getc())},adjustBoardData2:function(t,e){var s=this.board,i=this.puzzle.opemgr,o=this.posinfo_start,a=this.posinfo_goal,t=t&this.REDUCE&&(o.isdel||a.isdel)&&!i.undoExec&&!i.redoExec;t&&(i.forceRecord=!0),s.startpos.set(o.pos.getc()),s.goalpos.set(a.pos.getc()),t&&(i.forceRecord=!1)}},OperationManager:{addExtraOperation:function(){this.operationlist.push(this.klass.StartGoalOperation)}},AreaUnshadeGraph:{enabled:!0},AreaRoomGraph:{enabled:!0},LineGraph:{enabled:!0},BorderList:{subclear:function(){this.propclear(["sub","info","ans"],!0)}},Graphic:{enablebcolor:!0,bgcellcolor_func:"qsub1",errbcolor2:"rgb(192, 192, 255)",bbcolor:"rgb(96, 96, 96)",irowake:!0,paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawGrid(),this.drawQuesMarks(),this.drawStartGoal(),this.drawBorders(),this.drawChassis(),this.drawBoxBorders(!0),this.drawTarget(),this.drawLines()},drawQuesMarks:function(){for(var t=this.vinc("cell_mark","auto",!0),e=.3*this.cw,s=.26*this.cw,i=(t.lineWidth=2,this.range.cells),o=0;o<i.length;o++){var a=i[o],n=a.ques,r=a.bx*this.bw,u=a.by*this.bh;t.strokeStyle=this.getQuesNumberColor(a),t.vid="c_mk1_"+a.id,41===n?t.strokeCircle(r,u,e):t.vhide(),t.vid="c_mk2_"+a.id,42===n?(t.beginPath(),t.setOffsetLinePath(r,u,0,-s,-e,s,e,s,!0),t.stroke()):t.vhide()}}},Encode:{decodePzpr:function(t){this.decodeBorder(),this.decodeCell_nurimaze()},encodePzpr:function(t){this.encodeBorder(),this.encodeCell_nurimaze()},decodeCell_nurimaze:function(){for(var t=0,e=0,s=this.outbstr,i=this.board,e=0;e<s.length;e++){var o=s.charAt(e),a=i.cell[t];if("1"===o?i.startpos.set(a):"2"===o?i.goalpos.set(a):"3"===o?a.ques=41:"4"===o?a.ques=42:(this.include(o,"5","9")||this.include(o,"a","z"))&&(t+=parseInt(o,36)-5),t++,!i.cell[t])break}this.outbstr=s.substr(e+1)},encodeCell_nurimaze:function(){for(var t="",e=0,s=this.board,i=0;i<s.cell.length;i++){var o="",a=s.cell[i];s.startpos.equals(a)?o="1":s.goalpos.equals(a)?o="2":41===a.ques?o="3":42===a.ques?o="4":e++,0===e?t+=o:!o&&31!==e||(t+=(4+e).toString(36)+o,e=0)}0<e&&(t+=(4+e).toString(36)),this.outbstr+=t}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeCellQues_nurimaze(),this.decodeCellAns(),this.decodeBorderLine()},encodeData:function(){this.encodeAreaRoom(),this.encodeCellQues_nurimaze(),this.encodeCellAns(),this.encodeBorderLineIfPresent()},decodeCellQues_nurimaze:function(){var s=this.board;this.decodeCell(function(t,e){"s"===e?s.startpos.set(t):"g"===e?s.goalpos.set(t):"o"===e?t.ques=41:"t"===e&&(t.ques=42)})},encodeCellQues_nurimaze:function(){var e=this.board;this.encodeCell(function(t){return e.startpos.equals(t)?"s ":e.goalpos.equals(t)?"g ":41===t.ques?"o ":42===t.ques?"t ":". "})}},AnsCheck:{checklist:["checkSameColorTile","checkShadedObject","checkConnectUnshade","check2x2ShadeCell+","check2x2UnshadeCell++","checkUnshadeLoop","checkRouteCheckPoint","checkRouteNoDeadEnd","doneShadingDecided"],checkShadedObject:function(){var e=this.board;this.checkAllCell(function(t){return 1===t.qans&&(0!==t.ques||e.startpos.equals(t)||e.goalpos.equals(t))},"objShaded")},check2x2UnshadeCell:function(){this.check2x2Block(function(t){return t.isUnshade()},"cu2x2")},checkUnshadeLoop:function(){for(var t=this.board,e=t.ublkmgr.components,s=0;s<e.length;s++)if(0!==e[s].circuits){if(this.failcode.add("cuLoop"),this.checkOnly)return;this.searchloop(e[s],t.ublkmgr).seterr(1)}},checkRouteCheckPoint:function(){var t=this.getMazeRouteInfo();0<t.outroute.filter(function(t){return 41===t.ques}).length&&(this.failcode.add("routeIgnoreCP"),this.checkOnly||t.onroute.seterr(1))},checkRouteNoDeadEnd:function(){var t=this.getMazeRouteInfo();0<t.onroute.filter(function(t){return 42===t.ques}).length&&(this.failcode.add("routePassDeadEnd"),this.checkOnly||t.onroute.seterr(1))},getMazeRouteInfo:function(){if(this._info.maze)return this._info.maze;for(var t=this.board,e=[t.startpos.getc()],s={},i={},o=t.maxbx-t.minbx;0<e.length;){var a=null;if(void 0===s[(l=e[e.length-1]).by*o+l.bx]&&(s[l.by*o+l.bx]=e.length-1),t.goalpos.equals(l))for(var n=e.length-1;0<=n;n--)i[e[n].by*o+e[n].bx]=!0;for(var r=l.ublknodes[0]?l.ublknodes[0].nodes:[],n=0;n<r.length;n++){var u=r[n].obj;if(void 0===s[u.by*o+u.bx]){a=u;break}}a?e.push(a):e.pop()}for(var l,h={onroute:new this.klass.CellList,outroute:new this.klass.CellList},d=0;d<t.cell.length;d++)(l=t.cell[d]).isUnshade()&&(i[l.by*o+l.bx]?h.onroute:h.outroute).add(l);return this._info.maze=h}}});
//# sourceMappingURL=nurimaze.js.map