/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(e){var t=["statuepark","statuepark-aux","pentopia","battleship","pentatouch","kissing","retroships","regional-poly"];"object"==typeof module&&module.exports?module.exports=[t,e]:pzpr.classmgr.makeCustom(t,e)}({MouseEvent:{use:!0,inputModes:{edit:["circle-shade","circle-unshade","clear","completion"],play:["shade","unshade","clear","completion"]},mouseinput_auto:function(){this.puzzle.playmode?((this.mousestart||this.mousemove)&&this.inputcell(),this.notInputted()&&this.mousestart&&this.inputqcmp()):this.puzzle.editmode&&("kissing"===this.pid||"regional-poly"===this.pid?this.mousestart||this.mousemove?this.inputborder():this.mouseend&&this.notInputted()&&this.inputempty():"pentatouch"===this.pid&&this.mousestart?this.inputcrossMark():this.mousestart&&this.inputqnum(),this.mousestart&&this.getbank()&&("left"===this.btn?this.inputpiece():this.inputqcmp()))},mouseinput_clear:function(){var e=this.getcell();e.isnull||e===this.mouseCell||(this.puzzle.editmode&&e.setQnum(-1),e.setQans(0),e.setQsub(0),e.draw())},inputqcmp:function(){var e=this.getbank();e&&(e.setQcmp(e.qcmp?0:1),e.draw())},inputpiece:function(){var t=this.getbank();if(!t)return!1;if(this.puzzle.emit("request-aux-editor"),null===t.index)return!1;var e=this.cursor.getaddr(),e=(this.cursor.bankpiece=t.index,e.draw(),Math.max(this.puzzle.board.cols,this.puzzle.board.rows)),e=[e,e,t.serialize()],i=this,e={pid:"statuepark-aux",key:t.index,url:e.join("/")};return this.puzzle.emit("request-aux-editor",e,function(e){e=e.board.getShape();e||(i.cursor.bankpiece=null),i.board.bank.setPiece(e,t.index)}),!0}},"MouseEvent@pentopia":{inputModes:{edit:["arrow","undef","clear","completion"],play:["shade","unshade","clear","completion"]},mouseinput_auto:function(){this.puzzle.playmode?((this.mousestart||this.mousemove)&&this.inputcell(),this.notInputted()&&this.mousestart&&this.inputqcmp()):this.puzzle.editmode&&(this.mousestart&&this.setcursor(this.getcell()),this.inputarrow_cell(),this.notInputted()&&this.mouseend&&("left"===this.btn?this.inputpiece():this.inputqcmp()))},inputarrow_cell_main:function(e,t){var i=Math.max(0,e.qnum);e.setNum(i=0===(i^=1<<t-1)?-1:i)}},"MouseEvent@battleship#1":{inputModes:{edit:["number","clear","water","completion"],play:["shade","unshade","clear","completion"]},mouseinput_auto:function(){this.puzzle.playmode?((this.mousestart||this.mousemove)&&this.inputcell(),this.notInputted()&&this.mousestart&&this.inputqcmp()):this.puzzle.editmode&&this.mousestart&&(this.inputqnum_excell()||this.inputqnum(),this.notInputted()&&("left"===this.btn?this.inputpiece():this.inputqcmp()))},mouseinput_number:function(){this.mousestart&&this.inputqnum_excell()},inputqnum_excell:function(){var e=this.getcell_excell();return!e.isnull&&"excell"===e.group&&(e!==this.cursor.getex()?this.setcursor(e):this.inputqnum_main(e),!0)},inputqcmp:function(){var e=this.getbank();if(e)return e.setQcmp(e.qcmp?0:1),void e.draw();e=this.getcell_excell();e.isnull||e.noNum()||"excell"!==e.group||(e.setQcmp(+!e.qcmp),e.draw(),this.mousereset())}},"MouseEvent@retroships#1":{inputModes:{edit:["clear","water","circle-unshade","completion"],play:["shade","unshade","clear","completion"]},dragSet:null,mousereset:function(){var e;this.common.mousereset.call(this),this.dragSet&&(e=this.dragSet,this.dragSet=null,e.forEach(function(e){e.draw()}))},mouseinput_auto:function(){var e,t,i,s,n;this.puzzle.playmode?((this.mousestart||this.mousemove)&&this.inputcell(),this.notInputted()&&this.mousestart&&this.inputqcmp()):"right"===this.btn?this.mousestart&&(this.inputqcmp(),!this.notInputted())?this.mousereset():(e=this.getcell()).isnull||(this.firstCell.isnull&&(this.firstCell=e,this.firstPoint.set(this.inputPoint)),this.inputData||(s=this.inputPoint.bx-this.firstPoint.bx,t=this.inputPoint.by-this.firstPoint.by,this.firstCell!==e||.5<s*s+t*t?this.inputData=-1:this.mouseend&&this.inputqnum()),this.inputData&&this.inputFixedNumber(-1)):this.mousestart&&this.inputpiece()?this.mousereset():(e=this.getcell()).isnull||(this.firstCell.isnull&&(this.firstCell=e,this.firstPoint.set(this.inputPoint)),this.dragSet||(s=this.inputPoint.bx-this.firstPoint.bx,t=this.inputPoint.by-this.firstPoint.by,(this.firstCell!==e||.5<s*s+t*t)&&(this.dragSet=new Set,this.dragSet.add(this.firstCell),this.firstCell.draw())),this.dragSet&&!this.dragSet.has(e)&&(this.dragSet.add(e),this.dragSet.forEach(function(e){e.draw()})),this.mouseend&&(this.dragSet?(i=this.dragSet,this.dragSet=null,s=new this.klass.CellList(i),n=this.board,s.each(function(e){e.setQnum(n.getShape(i.has(e.adjacent.top),i.has(e.adjacent.bottom),i.has(e.adjacent.left),i.has(e.adjacent.right))),e.draw()})):this.inputqnum()))}},"MouseEvent@battleship,retroships":{getNewNumber:function(e,t){return"cell"===e.group&&e.qans?e.getShape():this.common.getNewNumber.call(this,e,t)},mouseinput:function(){switch(this.inputMode){case"circle-unshade":return this.inputFixedNumber(6);case"water":return this.inputFixedNumber(0);default:return this.common.mouseinput.call(this)}}},"MouseEvent@pentatouch":{inputModes:{edit:["completion"],play:["shade","unshade","clear","completion"]}},"MouseEvent@kissing,regional-poly":{inputModes:{edit:["completion","border","empty"],play:["shade","unshade","clear","completion"]}},KeyEvent:{enablemake:!0},"KeyEvent@pentopia":{moveTarget:function(e){return!e.match(/shift/)&&this.moveTCell(e)},keyinput:function(e){var t=this.cursor.getc(),i=0;"1"===e||"w"===e||"shift+up"===e?i=1:"2"===e||"s"===e||"shift+right"===e?i=4:"3"===e||"z"===e||"shift+down"===e?i=2:"4"!==e&&"a"!==e&&"shift+left"!==e||(i=3),i?(this.puzzle.mouse.inputarrow_cell_main(t,i),t.draw()):"5"===e||"q"===e||"-"===e?this.key_inputqnum("s1"):"6"!==e&&"e"!==e&&" "!==e&&"BS"!==e||this.key_inputqnum(" ")}},"KeyEvent@battleship,retroships":{keyinput:function(e){this.cursor.getex().isnull?this.key_inputqnum(e="BS"===e?" ":e):this.key_inputexcell(e)},getNewNumber:function(e,t,i){if("cell"===e.group){if("a"===t&&10<=e.getmaxnum())return 10;if("0"===t||"w"===t)return 0}return this.common.getNewNumber.call(this,e,t,i)}},TargetCursor:{setaddr:function(e){null!==this.bankpiece&&this.puzzle.emit("request-aux-editor"),this.common.setaddr.call(this,e)}},"Board@statuepark,pentatouch,regional-poly":{rows:12,cols:12},Board:{getBankPiecesInGrid:function(){for(var e=[],t=this.board.sblkmgr.components,i=0;i<t.length;i++){var s=t[i];e.push([s.clist.getBlockShapes().canon,s.clist])}return e}},"Board@battleship#1":{hasexcell:1},"Board@battleship,retroships":{assumeAllUnshaded:!1,UP:1,DN:2,LT:3,RT:4,CENTER:5,SINGLE:6,UPLT:7,UPRT:8,DNLT:9,DNRT:10,rebuildInfo:function(){this.common.rebuildInfo.call(this),this.recountShaded()},recountShaded:function(){var e=this.cell.filter(function(e){return e.isShade()}),t=e.length===this.bank.totalcells;t!==this.assumeAllUnshaded&&(this.assumeAllUnshaded=t,e.each(function(e){e.draw()}))},getShape:function(e,t,i,s){return e&&t||i&&s?this.CENTER:e?i?this.DNRT:s?this.DNLT:this.DN:t?i?this.UPRT:s?this.UPLT:this.UP:i?this.RT:s?this.LT:this.SINGLE}},"Board@statuepark-aux":{setShape:function(e){if(e)for(var t=e.w,i=e.h,s=this.cols-t|1,n=this.rows-i|1,a=0;a<i;a++)for(var r=0;r<t;r++){var h=this.getc(2*r+s,2*a+n);h&&!h.isnull&&h.setQans(+e.str[a*t+r])}},getShape:function(){var e=this.cell.filter(function(e){return e.qans});if(0===e.length)return null;var t=new this.klass.BankPiece;return t.deserializeRaw(e.getBlockShapes().id),t.serialize()}},"Board@pentatouch":{hascross:1},"Board@kissing,regional-poly":{hasborder:1},Bank:{enabled:!0,allowAdd:!0,defaultPreset:function(){return this.presets[0].constant},presets:[{name:"preset.pentominoes",shortkey:"p",constant:["337k","15v","24as","24bo","23fg","337i","23rg","334u","335s","33bk","24bk","337o"]},{name:"preset.tetrominoes",shortkey:"t",constant:["14u","23bg","22u","23f","23eg"]},{name:"preset.double_tetrominoes",shortkey:"d",constant:["14u","14u","23bg","23bg","22u","22u","23f","23f","23eg","23eg"]},{name:"preset.copy_answer",func:"copyAnswer"},{name:"preset.zero",shortkey:"z",constant:[]}],copyAnswer:function(){var t=new this.klass.BankPiece,e=this.board.getBankPiecesInGrid().map(function(e){return t.deserialize(e[0]),t.serialize()});return e.sort(),e}},"Bank@statuepark-aux":{enabled:!1},"Bank@pentopia":{shouldDrawBank:function(){var e=this.pieces.map(function(e){return e.serialize()});return!this.puzzle.pzpr.util.sameArray(this.defaultPreset(),e)}},"Bank@kissing":{exceedPieceSize:-1,rebuildExtraData:function(){for(var e=this.puzzle.board,t=e.rows*e.cols+1,i=0,s=0;s<this.pieces.length;s++){for(var n=this.pieces[s],a=0,r=0;r<n.str.length;r++)"1"===n.str[r]&&a++;t=Math.min(a,t),i=Math.max(a,i)}this.exceedPieceSize=t+i}},"Bank@battleship,retroships":{defaultPreset:function(){return this.presets[1].constant},presets:[{name:"preset.fleet3",shortkey:"c",constant:["11g","11g","11g","21o","21o","31s"]},{name:"preset.fleet4",shortkey:"d",constant:["11g","11g","11g","11g","21o","21o","21o","31s","31s","41u"]},{name:"preset.fleet5",shortkey:"e",constant:["11g","11g","11g","11g","11g","21o","21o","21o","21o","31s","31s","31s","41u","41u","51v"]},{name:"preset.pentominoes",shortkey:"p",constant:["337k","15v","24as","24bo","23fg","337i","23rg","334u","335s","33bk","24bk","337o"]},{name:"preset.copy_answer",func:"copyAnswer"},{name:"preset.zero",shortkey:"z",constant:[]}],isSimpleBank:!0,totalcells:0,rebuildExtraData:function(){this.isSimpleBank=!0;for(var e=this.totalcells=0;e<this.pieces.length;e++){var t=this.pieces[e];1<t.w&&1<t.h&&(this.isSimpleBank=!1);for(var i=0;i<t.str.length;i++)"1"===t.str[i]&&this.totalcells++}this.board&&this.board.recountShaded()}},BankPiece:{canon:null,compressed:null,deserializeRaw:function(e){e=e.split(":");this.w=+e[0],this.str=e[1],this.h=this.str.length/this.w},deserialize:function(e){if(this.canon=null,this.compressed=null,!e)return this.w=this.h=1,void(this.str="0");if(-1!==e.indexOf(":"))this.deserializeRaw(e);else{if(e.length<3)throw new Error("Invalid piece");this.w=parseInt(e[0],36),this.h=parseInt(e[1],36);for(var t=this.w*this.h,i="",s=2;s<e.length;s++)i+=parseInt(e[s],32).toString(2).padStart(5,"0");this.str=i.substring(0,t).padEnd(t,"0")}},canonize:function(){if(this.canon)return this.canon;for(var e=[this.str,"","","","","","",""],t=0;t<this.h;t++)for(var i=0;i<this.w;i++)e[1]+=this.str[(this.h-t-1)*this.w+i];for(i=0;i<this.w;i++)for(t=0;t<this.h;t++)e[4]+=this.str[t*this.w+i],e[5]+=this.str[(this.h-t-1)*this.w+i];e[2]=e[1].split("").reverse().join(""),e[3]=e[0].split("").reverse().join(""),e[6]=e[5].split("").reverse().join(""),e[7]=e[4].split("").reverse().join("");for(var s=0;s<8;s++)e[s]=(s<4?this.w:this.h)+":"+e[s];return e.sort(),this.canon=e[0]},serialize:function(){if(this.compressed)return this.compressed;for(var e=this.w.toString(36)+this.h.toString(36),t=0;t<this.str.length;t+=5){var i=this.str.substr(t,5).padEnd(5,"0");e+=parseInt(i,2).toString(32)}for(;e.lastIndexOf("0")===e.length-1;)e=e.substring(0,e.length-1);return this.compressed=e}},"Cell@statuepark":{numberAsObject:!0,disInputHatena:!0,maxnum:2,allowShade:function(){return 1!==this.qnum},allowUnshade:function(){return 2!==this.qnum}},"Cell@pentopia":{numberAsObject:!0,maxnum:15,allowShade:function(){return this.puzzle.getConfig("pentopia_transparent")||-1===this.qnum},seterr:function(e){this.board.isenableSetError()&&(this.error|=e)}},"Cell@kissing,regional-poly":{allowShade:function(){return this.isValid()},allowUnshade:function(){return this.isValid()},posthook:{qans:function(){this.drawaround()}}},"Cell@battleship,retroships":{numberAsObject:!0,minnum:0,maxnum:function(){return this.board.bank.isSimpleBank?6:10},isShade:function(){return!this.isnull&&0!==this.qnum&&(this.isClue()||1===this.qans)},posthook:{qnum:function(){this.drawaround(),-1===this.qnum||!this.qans||"battleship"!==this.pid&&0!==this.qnum&&-2!==this.qnum||this.setQans(0),this.board.recountShaded()},qans:function(){this.drawaround(),this.board.recountShaded()},qsub:function(){this.drawaround()}},isUnshade:function(){return!this.isnull&&!this.isShade()},getShape:function(){return this.board.getShape(this.adjacent.top.isShade(),this.adjacent.bottom.isShade(),this.adjacent.left.isShade(),this.adjacent.right.isShade())},isAdjacentDecided:function(){if(this.board.bank.isSimpleBank){if(this.adjacent.top.isShade()||this.adjacent.bottom.isShade())return this.adjacent.top.isShadeDecided()&&this.adjacent.bottom.isShadeDecided();if(this.adjacent.left.isShade()||this.adjacent.right.isShade())return this.adjacent.left.isShadeDecided()&&this.adjacent.right.isShadeDecided()}return this.adjacent.top.isShadeDecided()&&this.adjacent.bottom.isShadeDecided()&&this.adjacent.left.isShadeDecided()&&this.adjacent.right.isShadeDecided()}},"Cell@battleship#1":{allowShade:function(){return-1===this.qnum},isClue:function(){return-1!==this.qnum&&0!==this.qnum}},"Cell@retroships#1":{allowShade:function(){return 0!==this.qnum&&-2!==this.qnum},isClue:function(){return!this.allowShade()}},"BoardExec@pentopia":{adjustBoardData:function(e,t){this.adjustCellArrow(e,t)},getTranslateDir:function(e){var t={};switch(e){case this.FLIPY:t={1:2,2:1,5:6,6:5,9:10,10:9,13:14,14:13};break;case this.FLIPX:t={4:8,5:9,6:10,7:11,8:4,9:5,10:6,11:7};break;case this.TURNR:t={1:8,2:4,3:12,4:1,5:9,6:5,7:13,8:2,9:10,10:6,11:14,12:3,13:11,14:7};break;case this.TURNL:t={1:4,2:8,3:12,4:2,5:6,6:10,7:14,8:1,9:5,10:9,11:13,12:3,13:7,14:11}}return t}},"ExCell@battleship":{disInputHatena:!0,maxnum:function(){var e=this.bx,t=this.by;return-1===e&&-1===t?0:-1===t?this.board.rows:this.board.cols},minnum:0,isShade:function(){return!1},isShadeDecided:function(){return!0}},"BoardExec@battleship,retroships":{adjustBoardData:function(e,t){this.adjustCellArrow(e,t),this.adjustExCellTopLeft_1(e,t)},adjustBoardData2:function(e,t){this.adjustExCellTopLeft_2(e,t)},getTranslateDir:function(e){var t={};switch(e){case this.FLIPY:t={1:2,2:1,7:9,8:10,9:7,10:8};break;case this.FLIPX:t={3:4,4:3,7:8,8:7,9:10,10:9};break;case this.TURNR:t={1:4,2:3,3:1,4:2,7:8,8:10,9:7,10:9};break;case this.TURNL:t={1:3,2:4,3:2,4:1,7:9,8:7,9:10,10:8}}return t}},AreaShadeGraph:{enabled:!0},"AreaRoomGraph@regional-poly":{enabled:!0},"AreaShadeGraph@battleship,retroships":{relation:{"cell.qnum":"node","cell.qans":"node"}},"AreaUnshadeGraph@statuepark":{enabled:!0},"AreaShadeGraph@kissing":{relation:{"cell.qans":"node","border.ques":"separator"},isedgevalidbylinkobj:function(e){return!e.isBorder()}},"Graphic@statuepark":{enablebcolor:!0,shadecolor:"rgb(80, 80, 80)",bgcellcolor_func:"qsub1",circlefillcolor_func:"qnum2",circleratio:[.3,.25]},"Graphic@pentatouch":{enablebcolor:!0,shadecolor:"rgb(80, 80, 80)",bgcellcolor_func:"qsub1",crosssize:.15},"Graphic@pentatouch,kissing,regional-poly#1":{drawTarget:function(){var e=this.puzzle.editmode&&null!==this.puzzle.cursor.bankpiece;this.drawCursor(!0,e)}},Graphic:{paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawGrid(),"pentatouch"===this.pid?this.drawCrossMarks():"statuepark"===this.pid?this.drawCircles():"pentopia"===this.pid?(this.drawArrowCombinations(),this.drawHatenas()):"kissing"!==this.pid&&"regional-poly"!==this.pid||(this.drawBorders(),this.drawXCells(),this.drawDotCells()),this.drawChassis(),this.drawBank(),this.drawTarget()},maxpiececount:0,drawBankPiece:function(e,t,i){var s=t?t.str:"",n=this.bankratio;this.maxpiececount=Math.max(s.length,this.maxpiececount);for(var a,r,h=0;h<this.maxpiececount;h++)e.vid="pb_piece_"+i+"_"+h,"1"===s[h]?(a=this.cw*n*(t.x+.25+h%t.w),r=this.ch*n*(t.y+.25+(h/t.w|0)),r+=(this.board.rows+.5)*this.ch,e.fillStyle=this.getBankPieceColor(t),e.fillRect(1+a,1+r,this.cw*n-2,this.ch*n-2)):e.vhide()}},"Graphic@pentopia":{enablebcolor:!0,shadecolor:"rgb(80, 80, 80)",bgcellcolor_func:"qsub1",getQuesNumberColor:function(e,t){return 1&e.error||e.error&8<<t?e.isShade()?this.errbcolor1:this.errcolor1:e.isShade()?"white":this.quescolor},drawArrowCombinations:function(){for(var e=this.vinc("cell_arrow"),t=.25*this.cw,i=this.range.cells,s=0;s<i.length;s++)for(var n=i[s],a=Math.max(0,n.qnum),r=1;r<=4;r++)if(a&1<<r-1){var h=n.bx*this.bw,o=n.by*this.bh,c=h,l=o,d=[0,0,0,0];switch(r){case n.UP:d=[.5,.75,-.5,.75],o-=.8*this.bh;break;case n.DN:d=[.5,-.75,-.5,-.75],o+=.8*this.bh;break;case n.LT:d=[.75,-.5,.75,.5],h-=.8*this.bw;break;case n.RT:d=[-.75,-.5,-.75,.5],h+=.8*this.bw}e.vid="c_arrow_head_"+n.id+"_"+r,e.fillStyle=this.getQuesNumberColor(n,r-1),e.setOffsetLinePath(h,o,0,0,d[0]*t,d[1]*t,d[2]*t,d[3]*t,!0),e.fill(),e.vid="c_arrow_line_"+n.id+"_"+r,e.strokeStyle=this.getQuesNumberColor(n,r-1),e.lineWidth=this.lw/2,e.strokeLine((1.5*h+c)/2.5,(1.5*o+l)/2.5,c,l)}else e.vid="c_arrow_head_"+n.id+"_"+r,e.vhide(),e.vid="c_arrow_line_"+n.id+"_"+r,e.vhide()}},"Graphic@kissing,regional-poly":{shadecolor:"#777",trialcolor:"rgb(255, 160, 0)",drawXCells:function(){for(var e=this.vinc("cell_x","auto",!0),t=.2*this.cw,i=this.range.cells,s=0;s<i.length;s++){var n=i[s],a=(e.vid="c_x_"+n.id,n.bx*this.bw),r=n.by*this.bh;n.isEmpty()?(e.strokeStyle=this.quescolor,e.lineWidth=2,e.strokeCross(a,r,t)):e.vhide()}}},"Graphic@kissing#2":{drawBorders:function(){this.vinc("border","auto",!0);for(var e=this.context,t=this.range.borders,i=0;i<t.length;i++){var s,n,a,r,h=t[i],o=this.getBorderColor(h);e.vid="b_bd_"+h.id,o?(s=h.bx*this.bw,n=h.by*this.bh,a=.2*this.bw,r=.2*this.bh,e.fillStyle=o,h.isVert()?this.fillCapsule(e,s,n,a,this.bh-r):this.fillCapsule(e,s,n,this.bw-a,r)):e.vhide()}},fillCapsule:function(e,t,i,s,n){var a,r;n<s?(a=90*Math.PI/180,r=270*Math.PI/180,e.beginPath(),e.moveTo(t+s-n,i-n),e.arc(t+s-n,i,n,r,a,!1),e.lineTo(t+n-s,i+n),e.arc(t+n-s,i,n,a,r,!1),e.lineTo(t+s-n,i-n)):(a=0*Math.PI/180,r=180*Math.PI/180,e.beginPath(),e.moveTo(t-s,i+s-n),e.arc(t,i+s-n,s,r,a,!1),e.lineTo(t+s,i+n-s),e.arc(t,i+n-s,s,a,r,!1),e.lineTo(t-s,i+s-n)),e.fill()},drawShadedCells:function(){this.vinc("cell_shaded","crispEdges");for(var e=this.context,t=this.range.cells,i=0;i<t.length;i++){var s,n,a,r,h,o=t[i],c=this.getShadedCellColor(o),l=o.bx,d=o.by,u={};for(s in o.adjacent)u[s]=!o.adjborder[s].isBorder()&&o.adjacent[s].isShade()?1:.75;e.vid="c_fulls_h_"+o.id,c?(e.fillStyle=c,h=1===u.left?0:1,n=l-u.left,a=l+u.right,e.fillRect(n*this.bw+h,(r=d-.75)*this.bh,(a-n)*this.bw-h,((h=d+.75)-r)*this.bh)):e.vhide(),e.vid="c_fulls_v_"+o.id,c?(e.fillStyle=c,n=(l=o.bx)-.75,r=(d=o.by)-u.top,h=d+u.bottom,e.fillRect(n*this.bw+1,r*this.bh,((a=l+.75)-n)*this.bw-1,(h-r)*this.bh)):e.vhide()}}},"Graphic@statuepark-aux":{paint:function(){this.drawShadedCells(),this.drawDashedGrid(),this.drawChassis()},drawCells_common:function(e,t){for(var i=this.context,s=this.range.cells,n=0;n<s.length;n++){var a=s[n],r=t.call(this,a);i.vid=e+a.id,r?(i.fillStyle=r,i.fillRectCenter(a.bx*this.bw,a.by*this.bh,this.bw-1.5,this.bh-1.5)):i.vhide()}}},"Graphic@battleship,retroships":{MODE_SHARP:0,MODE_ROUNDED:1,MODE_OUTLINE:2,bcolor:"rgb(191, 191, 255)",trialbcolor:"rgb(255, 191, 255)",qanscolor:"rgb(0, 80, 0)",hatenacolor:"rgb(100, 100, 100)",errcolor2:"rgb(192, 0, 0)",errcolor3:"rgb(96, 0, 0)",paint:function(){this.drawBGCells(),this.drawBoardPieces(),this.drawWaterClues(),"retroships"===this.pid?this.drawDashedGrid():this.drawGrid(),this.drawNumbersExCell(),this.drawChassis(),this.drawBank(),this.drawTarget()},getBGCellColor:function(e){return 1===(e.error||e.qinfo)?this.errbcolor1:1===e.qans||1===e.qsub?e.trial?this.trialbcolor:this.bcolor:null},getQuesNumberColor:function(e){return 1===e.error?this.errcolor1:e.qcmp?this.qcmpcolor:this.quescolor},getShadedCellColor:function(e){return-1!==e.qnum&&0!==e.qnum?1===(e.error||e.qinfo)?this.errcolor3:-2===e.qnum?this.hatenacolor:this.quescolor:e.qans?1===(e.error||e.qinfo)?this.errcolor2:this.qanscolor:null},drawWaterClues:function(){for(var e=this.vinc("cell_water","auto"),t=this.range.cells,i=210*Math.PI/180,s=315*Math.PI/180,n=135*Math.PI/180,a=30*Math.PI/180,r=0;r<t.length;r++)for(var h,o,c,l,d=t[r],u=d.bx*this.bw,p=this.bw/3,f=d.by*this.bh,b=0;b<3;b++)e.vid="c_water_"+d.id+"_"+b,0===d.qnum?(l=f+(b-1)*this.bh*.4,h=u-p*Math.cos(s),o=l-p*Math.sin(s),c=u-p*Math.cos(n),l=l-p*Math.sin(n),e.lineWidth=2+this.cw/30|0,e.strokeStyle=this.quescolor,e.beginPath(),e.arc(h,o,p,i,s,!1),e.arc(c,l,p,n,a,!0),e.stroke()):e.vhide()},drawBoardPieces:function(){for(var e=this.vinc("cell_bpiece","auto"),t=this.range.cells,i=this.puzzle.mouse.dragSet,s=0;s<t.length;s++){var n,a=t[s],r=a.bx*this.bw,h=a.by*this.bh,o=.9*this.bw,c=i&&i.has(a)?(n="red",this.board.getShape(i.has(a.adjacent.top),i.has(a.adjacent.bottom),i.has(a.adjacent.left),i.has(a.adjacent.right))):(n=this.getShadedCellColor(a),-2===a.qnum?this.board.CENTER:-1!==a.qnum?a.qnum:a.getShape()),l=-2!==a.qnum&&(this.board.assumeAllUnshaded||a.isAdjacentDecided()||0<a.qnum),l="battleship"===this.pid?l?this.MODE_ROUNDED:this.MODE_SHARP:a.isShade()?this.MODE_ROUNDED:this.MODE_OUTLINE,a="c_piece_"+a.id;this.drawSinglePiece(e,a,r,h,o,c,n,l)}},drawSinglePiece:function(e,t,i,s,n,a,r,h){var o=h!==this.MODE_SHARP;h===this.MODE_OUTLINE&&(e.lineWidth=1+this.cw/40|0,n-=e.lineWidth),e.vid=t+"_circle",r&&h===this.MODE_ROUNDED?(e.fillStyle=r,e.fillCircle(i,s,n)):e.vhide(),e.vid=t,r?(e.beginPath(),e.moveTo(i+n,s),a===this.board.DN||a===this.board.RT||a===this.board.DNRT||a===this.board.SINGLE?o&&e.arc(i,s,n,0,.5*Math.PI,!1):e.lineTo(i+n,s+n),e.lineTo(i,s+n),a===this.board.DN||a===this.board.LT||a===this.board.DNLT||a===this.board.SINGLE?o&&e.arc(i,s,n,.5*Math.PI,Math.PI,!1):e.lineTo(i-n,s+n),e.lineTo(i-n,s),a===this.board.UP||a===this.board.LT||a===this.board.UPLT||a===this.board.SINGLE?o&&e.arc(i,s,n,Math.PI,1.5*Math.PI,!1):e.lineTo(i-n,s-n),e.lineTo(i,s-n),a===this.board.UP||a===this.board.RT||a===this.board.UPRT||a===this.board.SINGLE?o&&e.arc(i,s,n,1.5*Math.PI,2*Math.PI,!1):e.lineTo(i+n,s-n),e.lineTo(i+n,s),h===this.MODE_OUTLINE?(e.strokeStyle=r,e.stroke()):(e.fillStyle=r,e.fill())):e.vhide()},drawBankPiece:function(e,t,i){var s=t?t.str:"",n=t?t.w:0,a=this.bankratio,r=this.cw*a*.5-1;this.maxpiececount=Math.max(s.length,this.maxpiececount);for(var h=0;h<this.maxpiececount;h++){var o,c,l,d,u,p,f="pb_piece_"+i+"_"+h;t?(c=h/n|0,l="1"===s[h-n],d="1"===s[h+n],u=0<(o=h%n)&&"1"===s[h-1],p=o<n-1&&"1"===s[h+1],l=this.board.getShape(l,d,u,p),d="1"===s[h]?this.getBankPieceColor(t):null,u=this.cw*a*(t.x+.25+o)+r,p=this.ch*a*(t.y+.25+c)+r,p+=(this.board.rows+.5)*this.ch+1,this.drawSinglePiece(e,f,u,p,r,l,d,this.MODE_ROUNDED)):this.drawSinglePiece(e,f,0,0,r,0,null)}}},Encode:{decodePzpr:function(e){"/"!==this.outbstr[0]&&this.decodeCircle(),this.decodePieceBank()},encodePzpr:function(e){this.encodeCircle(),this.encodePieceBank()}},"Encode@pentopia,retroships":{decodePzpr:function(e){this.puzzle.setConfig("pentopia_transparent",this.checkpflag("t")),"/"!==this.outbstr[0]&&this.decodeNumber16(),this.decodePieceBank()},encodePzpr:function(e){this.outpflag=this.puzzle.getConfig("pentopia_transparent")?"t":null,this.encodeNumber16(),this.encodePieceBank()}},"Encode@battleship":{decodePzpr:function(e){"/"!==this.outbstr[0]&&(this.decodeNumber16ExCell(),this.decodeNumber16()),this.decodePieceBank()},encodePzpr:function(e){this.encodeNumber16ExCell(),this.encodeNumber16(),this.encodePieceBank()}},"Encode@statuepark-aux":{decodePzpr:function(e){var t=new this.klass.BankPiece;t.deserialize(this.outbstr),this.board.setShape(t)},encodePzpr:function(e){this.outbstr=this.board.getShape()||"1:0"}},"Encode@pentatouch":{decodePzpr:function(e){"/"!==this.outbstr[0]&&this.decodeCrossMark(),this.decodePieceBank()},encodePzpr:function(e){this.encodeCrossMark(),this.encodePieceBank()}},"Encode@kissing,regional-poly":{decodePzpr:function(e){"/"!==this.outbstr[0]&&this.decodeBorder(),"/"!==this.outbstr[0]&&this.decodeEmpty(),this.decodePieceBank()},encodePzpr:function(e){this.encodeBorder(),this.encodeEmpty(),this.encodePieceBank()}},FileIO:{decodeData:function(){this.decodePieceBank(),this.decodeConfig(),"battleship"===this.pid?this.decodeCellExCell(function(e,t){"c"===t[0]&&(e.qcmp=1,t=t.substring(1)),"-"===t?e.qnum=-2:"."!==t&&(e.qnum=+t)}):"pentatouch"===this.pid?this.decodeCrossNum():this.decodeCellQnum(),this.decodeCellAns(),this.decodePieceBankQcmp()},encodeData:function(){this.encodePieceBank(),this.encodeConfig(),"battleship"===this.pid?this.encodeCellExCell(function(e){return 0<=e.qnum?(e.qcmp?"c":"")+e.qnum+" ":-2===e.qnum?"- ":". "}):"pentatouch"===this.pid?this.encodeCrossNum():this.encodeCellQnum(),this.encodeCellAns(),this.encodePieceBankQcmp()},decodeConfig:function(){},encodeConfig:function(){}},"FileIO@pentopia":{decodeConfig:function(){this.decodeConfigFlag("t","pentopia_transparent")},encodeConfig:function(){this.encodeConfigFlag("t","pentopia_transparent")}},"FileIO@statuepark-aux":{decodeData:function(){var e=new this.klass.BankPiece;e.deserialize(this.readLine()),this.board.setShape(e)},encodeData:function(){this.writeLine(this.board.getShape()||"1:0")}},"FileIO@kissing,regional-poly":{decodeData:function(){this.decodePieceBank(),this.decodeBorderQues(),this.decodeCell(function(e,t){"x"===t?e.ques=7:"#"===t?e.qans=1:"+"===t&&(e.qsub=1)}),this.decodePieceBankQcmp()},encodeData:function(){this.encodePieceBank(),this.encodeBorderQues(),this.encodeCell(function(e){return 7===e.ques?"x ":e.qans?"# ":e.qsub?"+ ":". "}),this.encodePieceBankQcmp()}},"AnsCheck@statuepark":{checklist:["checkUnshadeOnCircle","checkConnectUnshade","checkBankPiecesAvailable","checkBankPiecesInvalid","checkShadeOnCircle","checkBankPiecesUsed"],checkShadeOnCircle:function(){this.checkAllCell(function(e){return!e.isShade()&&2===e.qnum},"circleUnshade")},checkUnshadeOnCircle:function(){this.checkAllCell(function(e){return e.isShade()&&1===e.qnum},"circleShade")}},"AnsCheck@kissing,regional-poly":{checklist:["checkUnshadeOnCircle","checkSideAreaShadeCell@regional-poly","checkSeqBlocksInRoom@regional-poly","checkShadeDiagonal@regional-poly","checkPieceSize@kissing","checkSeparators@kissing","checkBankPiecesAvailable","checkBankPiecesInvalid","checkBankPiecesUsed"],checkSideAreaShadeCell:function(){this.checkSideAreaCell(function(e,t){return e.isShade()&&t.isShade()},!1,"cbShade")},checkSeqBlocksInRoom:function(){for(var e=this.board.roommgr.components,t=0;t<e.length;t++){for(var i=e[t].clist,s=null,n=!0,a=0;a<i.length;a++)if(null!==i[a].sblk&&i[a].sblk!==s){if(null!==s){n=!1;break}s=i[a].sblk}if(!n){if(this.failcode.add("bkShadeDivide"),this.checkOnly)break;i.seterr(1)}}},checkPieceSize:function(){var n=this.board.bank.exceedPieceSize;this.checkAllArea(this.board.sblkmgr,function(e,t,i,s){return i<n},"csGtLimit")},checkSeparators:function(){for(var e=0;e<this.board.border.length;e++){var t=this.board.border[e];if(t.isBorder()){var i=t.sidecell[0],t=t.sidecell[1];if(!(i.isnull||t.isnull||i.isShade()&&t.isShade()&&i.sblk!==t.sblk)){if(this.failcode.add("bdUnused"),this.checkOnly)break;(i.sblk?i.sblk.clist:i).seterr(1),(t.sblk?t.sblk.clist:t).seterr(1)}}}},checkUnshadeOnCircle:function(){this.checkAllCell(function(e){return e.isShade()&&!e.isValid()},"circleShade")}},"AnsCheck@pentopia,battleship,retroships,pentatouch,regional-poly#1":{checkShadeDiagonal:function(){for(var e=this.board,t=0;t<e.cell.length;t++){var i=e.cell[t],s=i.bx,n=i.by;if(!(s>=e.maxbx-1||n>=e.maxby-1)&&("pentatouch"!==this.pid||1!==i.relcross(1,1).qnum)){i=e.cellinside(s,n,s+2,n+2).filter(function(e){return e.isShade()});if(2===i.length){s=i[0],n=i[1];if(s.bx!==n.bx&&s.by!==n.by&&s.sblk!==n.sblk){if(this.failcode.add("shDiag"),this.checkOnly)break;i.seterr(1)}}}}}},"AnsCheck@pentopia":{checklist:["checkShadeOnArrow","checkBankPiecesAvailable","checkShadeDiagonal","checkShadeDirCloser","checkShadeDirUnequal","checkShadeDirExist","checkBankPiecesInvalid+"],checkShadeOnArrow:function(){this.puzzle.getConfig("pentopia_transparent")||this.checkAllCell(function(e){return e.isShade()&&-1!==e.qnum},"csOnArrow")},getShadeDirs:function(){if(this._info.shadeDirs)return this._info.shadeDirs;for(var e=this.board,t=[],i=0;i<e.cell.length;i++){var s=e.cell[i];if(!(s.qnum<=0)){for(var n=[s,-1,-1,-1,-1],a=1;a<=4;a++){for(var r=s.getaddr();r.movedir(a,2),!r.getc().isnull&&!r.getc().isShade(););r.getc().isShade()&&(n[a]=Math.abs(a===r.LT||a===r.RT?r.bx-s.bx:r.by-s.by)/2)}t.push(n)}}return this._info.shadeDirs=t},checkShadeDirExist:function(){var e,t=this.getShadeDirs();for(e in t)for(var i=1;i<=4;i++)if(t[e][0].qnum&1<<i-1&&-1===t[e][i]){if(this.failcode.add("arNoShade"),this.checkOnly)return;t[e][0].seterr(4<<i)}},checkShadeDirCloser:function(){var e,t=this.getShadeDirs(),i=this.board.cols+this.board.rows;for(e in t){for(var s=i,n=1;n<=4;n++)-1!==t[e][n]&&t[e][0].qnum&1<<n-1&&(s=Math.min(s,t[e][n]));for(n=1;n<=4;n++){var a=t[e][n];if(!(t[e][0].qnum&1<<n-1)&&(!(s===i&&1<a)&&-1!==a&&a<=s)){if(this.failcode.add("arDistanceGt"),this.checkOnly)return;t[e][0].seterr(124);for(var r=t[e][0].getaddr(),h=0;h<a;h++)r.movedir(n,2),r.getc().seterr(1)}}}},checkShadeDirUnequal:function(){var e,t=this.getShadeDirs(),i=this.board.cols+this.board.rows;for(e in t){for(var s=i,n=1;n<=4;n++)-1!==t[e][n]&&t[e][0].qnum&1<<n-1&&s!==t[e][n]&&(s=s===i?t[e][n]:-1);for(n=1;n<=4;n++){var a=t[e][n];if(t[e][0].qnum&1<<n-1&&(-1!==a&&a!==s)){if(this.failcode.add("arDistanceNe"),this.checkOnly)return;t[e][0].seterr(4<<n);for(var r=t[e][0].getaddr(),h=0;h<a;h++)r.movedir(n,2),r.getc().seterr(1)}}}}},"AnsCheck@battleship,retroships":{checklist:["checkShapeExtra","checkBankPiecesAvailable","checkBankPiecesInvalid","checkShadeDiagonal","checkShapeMissing","checkShadeCount@battleship","checkBankPiecesUsed"],checkShapeExtra:function(){this.checkAllCell(function(e){if(e.qnum<0)return!1;if(0===e.qnum)return e.isShade();if(!e.isShade())return!1;var t=e.getShape();return e.qnum!==e.board.CENTER&&t!==e.board.SINGLE&&e.qnum!==t},"csPieceExtra")},checkShapeMissing:function(){this.checkAllCell(function(e){return!(e.qnum<=0)&&(e.isShade()&&e.qnum!==e.getShape())},"csMismatch")}},"AnsCheck@pentatouch":{checklist:["checkBankPiecesAvailable","checkShadeDiagonal","checkBankPiecesInvalid+","checkCrossMissing","checkBankPiecesUsed"],checkCrossMissing:function(){for(var e=this.board,t=0;t<e.cell.length;t++){var i=e.cell[t],s=i.bx,n=i.by;if(!(s>=e.maxbx-1||n>=e.maxby-1)){i=i.relcross(1,1);if(1===i.qnum){s=e.cellinside(s,n,s+2,n+2).filter(function(e){return e.isShade()});if(2===s.length){n=s[0],s=s[1];if(n.sblk!==s.sblk)continue}if(this.failcode.add("shNoDiag"),this.checkOnly)break;i.seterr(1)}}}}},"FailCode@retroships":{bankGt:"bankGt.battleship",bankInvalid:"bankInvalid.battleship",bankLt:"bankLt.battleship",shDiag:"shDiag.battleship"}});
//# sourceMappingURL=statuepark.js.map