/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,i){"object"==typeof module&&module.exports?module.exports=[t,i]:pzpr.classmgr.makeCustom(t,i)}(["recoil"],{MouseEvent:{inputModes:{edit:[],play:["line","peke","diraux","subcross","info-line"]},mouseinput_auto:function(){this.puzzle.playmode&&"right"===this.btn?this.mousestart?this.inputdiraux_mousedown():2===this.inputData||3===this.inputData?this.inputpeke():this.mousemove?this.inputdiraux_mousemove():this.mouseend&&this.notInputted()&&this.inputMB():this.puzzle.playmode&&"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&(this.clickdiraux(),this.notInputted()&&this.inputMB()):this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputEdit():this.mouseend&&this.inputEdit_end())},inputEdit:function(){var t=this.getcell();t.isnull||(this.mousestart?this.inputEdit_first():this.draggingSG&&11===this.inputData?(this.board.startpos.input(t),this.board.isStale=!0):this.inputempty())},inputEdit_first:function(){var t=this.getcell();this.board.startpos.equals(t)?(this.inputData=11,this.draggingSG=!0):this.inputempty()},inputEdit_end:function(){var t=this.getcell();t.isnull||this.draggingSG&&(this.draggingSG=!1,t.setValid(0),t.draw())}},Board:{cols:8,rows:8,hasborder:2,startpos:null,createExtraObject:function(){var t=this.emptycell;((t.pairedblock=t).pairedline=t).entrydir=0,this.startpos=new this.klass.StartAddress(1,1)},initExtraObject:function(t,i){this.disableInfo(),this.startpos.init(1&t?t:t-1,1&i?i:i-1),this.enableInfo()},rebuildInfo:function(){this.infolist.forEach(function(t){t.rebuild()});var i=this.emptycell;this.cell.each(function(t){t.pairedblock=i,t.pairedline=i,t.entrydir=0}),this.retrace()},retrace:function(){var e=this.emptycell,t=new this.klass.Address;if(t.set(this.startpos),1!==t.getc().lcnt)return this.mainpath=null,void this.cell.each(function(t){t.pairedblock=e,t.pairedline=e,(t.entrydir=0)!==t.qcmp&&(t.setQcmp(0),t.draw())});this.mainpath=this.startpos.getc().path;var s=new Set,i=(s.add(t.getc()),e),r=new this.klass.Address,o=new this.klass.Address,n=new this.klass.Address;do{for(var a=0,a=1;a<=4;a++)if(o.set(t),o.movedir(a,2),o.getc()!==i&&(r.set(t),r.movedir(a,1),r.getb().isLine())){i=t.getc(),t.set(o),t.getc().entrydir=a;break}if(4<a)break;n.set(t);var h=n.getc();for(s.has(h)||(h.pairedline=e,s.add(h));!h.isnull&&(!h.isValid()||s.has(h));)n.movedir(a,-2),h=n.getc()}while(h.isnull?t.getc().pairedblock=e:((t.getc().pairedblock=h).pairedline=t.getc(),s.add(h)),2===t.getc().lcnt);this.cell.each(function(t){var i=s.has(t)?1:0;i||(t.pairedblock=e,t.pairedline=e,t.entrydir=0),t.qcmp!==i&&(t.setQcmp(i),t.draw())})}},BoardExec:{posinfo:{},adjustBoardData:function(t,i){this.posinfo_start=this.getAfterPos(t,i,this.board.startpos.getc())},adjustBoardData2:function(t,i){var e=this.board,s=this.posinfo_start;e.startpos.set(s.pos,!1)}},Border:{enableLineNG:!0,isGrid:function(){return this.sidecell[0].isValid()&&this.sidecell[1].isValid()},isQuesBorder:function(){return!!(this.sidecell[0].isEmpty()^this.sidecell[1].isEmpty())},prehook:{qsub:function(t){return 0!==t&&!this.isGrid()}},posthook:{line:function(){this.board.retrace()}}},Cell:{prehook:{ques:function(t){return 0!==t&&this.board.startpos.equals(this)},qsub:function(t){return 0!==t&&this.noLP()}},posthook:{ques:function(){this.board.retrace()}},noLP:function(t){return this.isEmpty()}},StartAddress:{set:function(t,i){this.common.set.call(this,t,i),this.board.retrace()}},OperationManager:{addExtraOperation:function(){this.operationlist.push(this.klass.StartGoalOperation)}},LineGraph:{enabled:!0},Graphic:{gridcolor_type:"LIGHT",qsubcolor2:"#c8c8c8",autocmp:"recoil",paint:function(){this.drawBGCells(),this.drawValidGrid(),this.drawQuesBorders(),this.drawLines(),this.drawStartPoint(),this.drawMBs(),this.drawPekes(),this.drawBorderAuxDir(),this.drawDirectionError()},drawMBs:function(){for(var t=this.vinc("cell_mb","auto"),i=.3*this.cw,e=this.range.cells,s=0;s<e.length;s++){var r,o,n=e[s];t.vid="c_MB_"+n.id,0<n.qsub?(r=n.bx*this.bw,o=n.by*this.bh,t.lineWidth=2===n.qsub?2:1,t.strokeStyle=n.trial?"rgb(192, 192, 192)":2===n.qsub?"rgb(40, 40, 40)":this.mbcolor,t.strokeCross(r,o,i)):t.vhide()}},getLineColor:function(t){var i=this.common.getLineColor.call(this,t),e=t.error||t.qinfo;return i=t.isLine()&&10<e?"rgb(100,0,0)":i},drawDirectionError:function(){for(var t=this.vinc("border_direrr","crispEdges"),i=.12*this.cw,e=(t.lineWidth=.12*this.cw,this.range.borders),s=0;s<e.length;s++){var r=e[s],o=r.bx*this.bw,n=r.by*this.bh,a=r.error-10;t.vid="b_derr_"+r.id,1<=a&&a<=8?(t.strokeStyle=this.errlinecolor,this.strokeSingleAuxDir(t,a,o,n,i)):t.vhide()}},getBGCellColor:function(t){if(1===t.error||1===t.qinfo)return this.errbcolor1;if(t.isEmpty())return null;if(this.puzzle.execConfig("autocmp")){if(!t.pairedline.isnull)return this.qsubcolor2;if(0<t.lcnt&&t.qcmp)return this.qsubcolor1}return"#f8f8f8"},getQuesBorderColor:function(t){return t.isQuesBorder()?this.quescolor:null},drawValidGrid:function(){for(var t=this.vinc("grid_waritai","crispEdges",!0),i=(t.lineWidth=1,t.strokeStyle=this.gridcolor,this.range.borders),e=0;e<i.length;e++){var s,r,o=i[e];t.vid="b_grid_wari_"+o.id,o.isGrid()?(s=o.bx*this.bw,r=o.by*this.bh,o.isVert()?t.strokeLine(s,r-this.bh,s,r+this.bh):t.strokeLine(s-this.bw,r,s+this.bw,r)):t.vhide()}},drawStartPoint:function(){var t=this.vinc("cell_sg","auto"),i=this.board,e=this.range,i=i.startpos.getc();i.bx>=e.x1&&e.x2>=i.bx&&i.by>=e.y1&&e.y2>=i.by&&(t.vid="text_glpos",i.isnull?t.vhide():(t.fillStyle=this.puzzle.mouse.draggingSG?"red":this.quescolor,this.fillDiamond(t,i.bx*this.bw,i.by*this.bh,.33*this.bw,.33*this.bh)))},fillDiamond:function(t,i,e,s,r){var o=[0,1,0,-1],n=[-1,0,1,0];t.beginPath(),t.moveTo(i,e-r);for(var a=1;a<4;a++)t.lineTo(i+s*o[a],e+r*n[a]);t.closePath(),t.fill()}},Encode:{decodePzpr:function(t){this.board.startpos.bx=2*this.decodeOneNumber16()-1,this.board.startpos.by=2*this.decodeOneNumber16()-1,this.decodeEmpty()},encodePzpr:function(t){this.outbstr+=this.writeNumber16((this.board.startpos.bx+1)/2),this.outbstr+=this.writeNumber16((this.board.startpos.by+1)/2),this.encodeEmpty()}},FileIO:{decodeData:function(){this.decodeS(),this.decodeCell(function(t,i){t.ques="#"===i?7:0}),this.decodeBorderArrowAns(),this.decodeCellQsub()},encodeData:function(){this.encodeS(),this.encodeCell(function(t){return t.isValid()?". ":"# "}),this.encodeBorderArrowAns(),this.encodeCellQsub()},decodeS:function(){var t=this.readLine().split(" ");this.board.startpos.bx=parseInt(t[0]),this.board.startpos.by=parseInt(t[1])},encodeS:function(){this.writeLine(this.board.startpos.bx+" "+this.board.startpos.by)}},AnsCheck:{checklist:["checkLineOverBorder","checkPassThroughS","checkBranchLine","checkCrossLine","checkInvalidMove","checkDoubleUsed","checkUnused","checkOneLine+"],checkUnused:function(){this.checkAllCell(function(t){return!t.qcmp&&0===t.lcnt},"unusedCell")},checkPassThroughS:function(){var t=this.board.startpos.getc();1<t.lcnt&&(this.failcode.add("haisuSG"),t.seterr(1))},checkDoubleUsed:function(){this.checkAllCell(function(t){return!t.pairedline.isnull&&0<t.lcnt},"lnOnShade")},checkInvalidMove:function(){for(var t=this.board.startpos.getc(),i=this.board.mainpath,e=0;e<this.board.cell.length;e++){var s=this.board.cell[e];if(s!==t&&s.path===i&&(s.pairedblock.isnull&&0<s.lcnt&&s.qcmp)){if(this.failcode.add("lnNotValid"),this.checkOnly)break;var r=new this.klass.Address;r.set(s),r.movedir(s.entrydir,-1),this.board.border.setnoerr(),r.getb().seterr(s.entrydir+10)}}},checkLineOverBorder:function(){for(var t=0;t<this.board.cell.length;t++){var i=this.board.cell[t];if(i.isEmpty()&&0!==i.lcnt){if(this.failcode.add("laOnBorder"),this.checkOnly)break;i.seterr(1)}}}}});
//# sourceMappingURL=recoil.js.map