/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(s,i){"object"==typeof module&&module.exports?module.exports=[s,i]:pzpr.classmgr.makeCustom(s,i)}(["gokigen","wagiri"],{MouseEvent:{use:!0,inputModes:{edit:["number","clear"],play:["info-line"]},mouseinput_clear:function(){this.inputclean_cross()},mouseinput_number:function(){this.mousestart&&this.inputqnum_cross()},mouseinput_auto:function(){var s=this.puzzle;s.playmode?this.mousestart||this.mousemove?this.inputslash():this.mouseend&&this.notInputted()&&this.clickslash():s.editmode&&this.mousestart&&("gokigen"===s.pid?this.inputqnum_cross():"wagiri"===s.pid&&this.inputquestion())},inputslash:function(){var s,i,e,t=this.getcell();t.isnull||(this.mouseCell!==t?this.firstPoint.set(this.inputPoint):null!==this.firstPoint.bx&&(s=null,0<(i=this.inputPoint.bx-this.firstPoint.bx)*(e=this.inputPoint.by-this.firstPoint.by)&&.5<=Math.abs(i)&&.5<=Math.abs(e)?s=31:i*e<0&&.5<=Math.abs(i)&&.5<=Math.abs(e)&&(s=32),null!==s&&(null===this.inputData?(s===t.qans&&(s=0),this.inputData=+(0<s)):0===this.inputData&&(s=s===t.qans?0:null),null!==s&&(t.setQans(s),t.draw()),this.firstPoint.reset())),this.mouseCell=t)},clickslash:function(){var s,i,e,t=this.getcell();t.isnull||(s=this.puzzle.getConfig("use"),i="left"===this.btn?31:32,e=t.qans,1===s?t.setQans(e!==i?i:0):2===s&&t.setQans(("left"===this.btn?{0:31,31:32,32:0}:{0:32,31:0,32:31})[e]),t.drawaround())},dispInfoLine:function(){var s=this.getcell();this.mousereset(),s.isnull||0===s.qans||null===s.path||(this.board.cell.setinfo(-1),s.path.setedgeinfo(2),this.board.hasinfo=!0,this.puzzle.redraw())}},"MouseEvent@wagiri":{inputquestion:function(){var s=this.getpos(.33);s.isinside()&&(this.cursor.equals(s)?s.oncross()?this.inputqnum_cross():s.oncell()&&this.inputwagiri(s):this.setcursor(s))},inputwagiri:function(s){var i,s=s.getc();s.isnull||(i="left"===this.btn?[-1,1,0,2,-2]:[2,-2,0,-1,1],s.setNum(i[s.qnum+2]),s.draw())}},"KeyEvent@gokigen":{enablemake:!0,moveTarget:function(s){return this.moveTCross(s)},keyinput:function(s){this.key_inputcross(s)}},"KeyEvent@wagiri":{enablemake:!0,moveTarget:function(s){return this.moveTBorder(s)},keyinput:function(s){this.key_wagiri(s)},key_wagiri:function(s){var i,e=this.cursor;e.oncross()?this.key_inputcross(s):e.oncell()&&(i=0,"1"===s?i=1:"2"===s?i=2:"-"===s?i=-2:" "===s&&(i=-1),(s=e.getc()).isnull||0===i||(s.setNum(i),s.draw()))}},TargetCursor:{crosstype:!0},Cell:{setSideObj:function(){this.sideobj=[null,null],31===this.qans?this.sideobj=[this.relcross(-1,-1),this.relcross(1,1)]:32===this.qans&&(this.sideobj=[this.relcross(-1,1),this.relcross(1,-1)])}},Cross:{maxnum:4,minnum:0},Board:{cols:7,rows:7,disable_subclear:!0},BoardExec:{adjustBoardData:function(s,i){if(s&this.TURNFLIP)for(var e=this.board.cell,t=0;t<e.length;t++){var n=e[t];n.qans={0:0,31:32,32:31}[n.qans]}}},LineGraph:{enabled:!0,relation:{"cell.qans":"link"},pointgroup:"cross",linkgroup:"cell",rebuild2:function(){for(var s=this.board.cell,i=0;i<s.length;i++)s[i].setSideObj(),s[i].isloop=!1;this.common.rebuild2.call(this)},isedgevalidbylinkobj:function(s){return 0<s.qans},setEdgeByLinkObj:function(s){null!==s.path&&(this.incdecLineCount(s,!1),this.removeEdgeByLinkObj(s)),0<s.qans&&(s.setSideObj(),this.incdecLineCount(s,!0),this.addEdgeByLinkObj(s))},setExtraData:function(s){this.common.setExtraData.call(this,s);for(var i=s.getedgeobjs(),e=0;e<i.length;e++)i[e].isloop=!1;if(!(s.circuits<=0))for(var t=this.board,n=[s.nodes[0].obj],o={},r=t.maxbx-t.minbx+1;0<n.length;){var a=n[n.length-1],l=null,h=o[a.by*r+a.bx];if(void 0===h)h=o[a.by*r+a.bx]=n.length-1;else if("cross"===a.group&&n.length-1>h)for(var c=n.length-2;0<=c&&n[c]!==a;c--)"cell"===n[c].group&&(n[c].isloop=!0);if("cross"===a.group)for(var u=a,c=0;c<a.pathnodes[0].nodes.length;c++){var d=a.pathnodes[0].nodes[c].obj,d=t.getc(a.bx+d.bx>>1,a.by+d.by>>1);if(void 0===o[d.by*r+d.bx]){l=d;break}}else for(c=0;c<a.sideobj.length;c++){var p=a.sideobj[c];if(p!==u&&p!==n[n.length-2]){l=p;break}}l?n.push(l):n.pop()}}},Graphic:{irowake:!0,margin:.5,gridcolor_type:"DLIGHT",numbercolor_func:"fixed",errcolor1:"red",linecolor:"black",crosssize:.33,paintRange:function(s,i,e,t){var n=this.board;n.haserror||n.hasinfo||!this.puzzle.getConfig("autoerr")?this.setRange(s,i,e,t):this.setRange(n.minbx-2,n.minby-2,n.maxbx+2,n.maxby+2),this.prepaint()},paint:function(){this.drawBGCells(),this.drawDashedGrid(!1),"wagiri"===this.pid&&this.drawQuesNumbers(),this.drawSlashes(),this.drawCrosses(),this.drawTarget()},getBGCellColor:function(s){return 0===s.qans&&1===s.error?this.errbcolor1:null},drawSlashes:function(){var i,s=this.puzzle,e=s.board;e.haserror||e.hasinfo||!s.getConfig("autoerr")?this.common.drawSlashes.call(this):(i=this.pid,e.cell.each(function(s){s.qinfo=s.isloop?"gokigen"===i?1:3:0}),this.common.drawSlashes.call(this),e.cell.setinfo(0))},repaintLines:function(s){this.range.cells=s,this.drawSlashes(),this.context.use.canvas&&this.drawCrosses()}},"Graphic@wagiri":{fontsizeratio:.7,getNumberTextCore:function(s){return{"-2":"?",1:"輪",2:"切"}[s]||""},drawTarget:function(){var s=!this.puzzle.cursor.onborder();this.drawCursor(s,this.puzzle.editmode)}},"Encode@gokigen":{decodePzpr:function(s){var i=this.puzzle.pzpr.parser;s===i.URL_PZPRAPP&&!this.checkpflag("c")||s===i.URL_PZPRV3&&this.checkpflag("d")?this.decodecross_old():this.decode4Cross()},encodePzpr:function(s){this.encode4Cross()}},"Encode@wagiri":{decodePzpr:function(s){this.decode4Cross(),this.decodeNumber10()},encodePzpr:function(s){this.encode4Cross(),this.encodeNumber10()}},FileIO:{decodeData:function(){this.decodeCrossNum(),"wagiri"===this.pid&&this.decodeCellQnum(),this.decodeCell(function(s,i){"1"===i?s.qans=31:"2"===i&&(s.qans=32)})},encodeData:function(){this.encodeCrossNum(),"wagiri"===this.pid&&this.encodeCellQnum(),this.encodeCell(function(s){return 31===s.qans?"1 ":32===s.qans?"2 ":". "})}},AnsCheck:{checklist:["checkSlashLoop","checkQnumCross","checkSlashNoLoop@wagiri","checkNoSlashCell+"],checkQnumCross:function(){for(var s=this.board,i=0;i<s.cross.length;i++){var e=s.cross[i],t=e.qnum;if(!(t<0||t===e.lcnt)){if(this.failcode.add("crConnSlNe"),this.checkOnly)break;e.seterr(1)}}},checkNoSlashCell:function(){this.checkAllCell(function(s){return 0===s.qans},"ceNoSlash")}},"AnsCheck@gokigen":{checkSlashLoop:function(){var s=this.board.cell.filter(function(s){return 0<s.qans&&s.isloop});0<s.length&&(this.failcode.add("slLoop"),this.board.cell.setnoerr(),s.seterr(1))}},"AnsCheck@wagiri":{checkSlashLoop:function(){this.checkLoops_wagiri(!1,"slLoopGiri")},checkSlashNoLoop:function(){this.checkLoops_wagiri(!0,"slNotLoopWa")},checkLoops_wagiri:function(s,i){s=this.board.cell.filter(s?function(s){return!s.isloop&&0<s.qans&&1===s.qnum}:function(s){return s.isloop&&0<s.qans&&2===s.qnum});0<s.length&&(this.failcode.add(i),this.board.cell.setnoerr(),s.seterr(1))}}});
//# sourceMappingURL=gokigen.js.map