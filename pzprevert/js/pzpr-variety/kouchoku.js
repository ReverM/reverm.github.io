/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,e){"object"==typeof module&&module.exports?module.exports=[t,e]:pzpr.classmgr.makeCustom(t,e)}(["kouchoku","angleloop","tajmahal"],{MouseEvent:{inputModes:{edit:["number","clear"]},mouseinput_number:function(){this.mousestart&&this.inputqnum_cross()},mouseinput_clear:function(){this.inputclean_cross()},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart||this.mousemove?this.inputsegment():this.mouseend&&this.inputsegment_up():this.puzzle.editmode&&this.mousestart&&this.inputqnum_cross()},targetPoint:[null,null],inputsegment:function(){var t,e=this.getcross();e.isnull||e===this.mouseCell||(this.mousestart?(this.inputData=1,(this.targetPoint[0]=e).draw()):this.mousemove&&1===this.inputData&&(t=this.targetPoint[1],(this.targetPoint[1]=e).draw(),t&&t.draw()),this.mouseCell=e)},inputsegment_up:function(){var t,e,i,s,n,r;1===this.inputData&&(t=this.puzzle,s=this.targetPoint[0],n=this.targetPoint[1],this.targetPoint=[null,null],s&&s.draw(),n&&n.draw(),s&&n&&(t.getConfig("enline")&&(-1===s.qnum||-1===n.qnum)||(e=s.bx,i=n.bx,s=s.by,n=n.by,t.getConfig("lattice")&&0!==t.board.getLatticePoint(e,s,i,n).length||(this.inputsegment_main(e,s,i,n),i<e&&(r=e,e=i,i=r),n<s&&(r=s,s=n,n=r),t.painter.paintRange(e-1,s-1,i+1,n+1)))))},inputsegment_main:function(t,e,i,s,n,r){if(i<t)o=t,t=i,i=o,o=e,e=s,s=o;else if(t===i&&s<e)o=e,e=s,s=o;else if(t===i&&e===s)return;isNaN(n)&&(r=n=null);var o=this.board,a=o.getSegment(t,e,i,s);!a||null===a.ox||a.ox===n&&a.oy===r||(o.segment.removeSegmentsByOrigin(a.ox,a.oy),a=null),null===a?o.segment.addSegmentByAddr(t,e,i,s,n,r):null===n&&o.segment.remove(a)},mousereset:function(t){var e;1===this.inputData&&(e=this.targetPoint,this.targetPoint=new Array(e.length),e.forEach(function(t){t&&t.draw()})),this.common.mousereset.call(this)}},"MouseEvent@tajmahal":{targetPoint:[null,null,null,null],sourcePoint:null,mouseinput_number:function(){this.mousestart&&this.inputqnum_tajmahal()},mouseinput_clear:function(){this.inputdot()},mouseinput_auto:function(){this.puzzle.playmode?this.mousestart||this.mousemove?this.inputsegment():this.mouseend&&this.inputsegment_up():this.puzzle.editmode&&this.mousestart&&this.inputqnum_tajmahal()},inputqnum_tajmahal:function(){var t=this.getcrossorcell().moveToNearbyClue();!t||t.isnull||t.onborder()||(t.equals(this.cursor)?this.inputdot():this.setcursor(t))},inputdot:function(){var t,e=this.getcrossorcell().moveToNearbyClue();this.prevPos.equals(e)||(null!==(t=e.getDot())&&"border"!==t.piece.group&&("clear"===this.inputMode?t.setDot(-1):t.setDot(this.getNewNumber(t.piece,t.getDot())),t.draw()),this.prevPos=e)},inputsegment:function(){var t=this.getcrossorcell(),e=t.clone(),i=this.getcross(),s=!1;if(!t.getobj().isnull&&!t.equals(this.mouseCell)){if(this.mousestart&&(0<i.lcnt?null!==(n=i.seglist[i.seglist.length-1]).ox&&(t.init(n.ox,n.oy),s=!0):t.moveToNearbyClue()),!this.mousestart||t.isnull||t.onborder()||this.puzzle.getConfig("ensquare")&&e.equals(t)&&-1===t.getobj().qnum||(this.inputData=1,this.sourcePoint=t,i.draw()),1===this.inputData){var n=this.targetPoint;if(this.targetPoint=new Array(4),n.forEach(function(t){t&&t.draw()}),!s&&(t.equals(this.sourcePoint)||i.equals(this.sourcePoint)))return this.sourcePoint.draw(),void(this.mouseCell=this.sourcePoint);this.targetPoint[0]=i,this.targetPoint[1]=this.sourcePoint.relcross(this.sourcePoint.by-i.by,i.bx-this.sourcePoint.bx),this.targetPoint[2]=this.sourcePoint.relcross(this.sourcePoint.bx-i.bx,this.sourcePoint.by-i.by),this.targetPoint[3]=this.sourcePoint.relcross(i.by-this.sourcePoint.by,this.sourcePoint.bx-i.bx),this.targetPoint.forEach(function(t){t&&t.draw()}),this.sourcePoint.draw()}this.mouseCell=t}},inputsegment_up:function(){if(1===this.inputData){for(var t=this.puzzle,e=this.targetPoint,i=(this.targetPoint=new Array(4),!0),s=0;s<4;s++){var n=e[s];n&&!n.isnull?n.draw():i=!1}i&&e[0].bx===e[1].bx&&e[0].by===e[1].by&&(i=!1);var r=this.sourcePoint.bx,o=this.sourcePoint.by;if(this.sourcePoint=null,i&&e[0].seglist.some(function(t){return t.ox===r&&t.oy===o})||this.board.segment.removeSegmentsByOrigin(r,o),i){for(s=0;s<4;s++)this.inputsegment_main(e[s].bx,e[s].by,e[(s+1)%4].bx,e[(s+1)%4].by,r,o);var a=Math.max(Math.abs(r-e[0].bx),Math.abs(o-e[0].by))+1;t.painter.paintRange(r-a,o-a,r+a,o+a)}else t.painter.paintRange(r,o,r,o)}}},KeyEvent:{enablemake:!0,moveTarget:function(t){return this.moveTCross(t)}},"KeyEvent@kouchoku":{keyinput:function(t){var e=this.cursor.getx();if(!(1<t.length&&"BS"!==t)){if("a"<=t&&t<="z"){var i=parseInt(t,36)-9;e.qnum===i?e.setQnum(-1):e.setQnum(i)}else if("-"===t)e.setQnum(-2!==e.qnum?-2:-1);else{if(" "!==t&&"BS"!==t)return;e.setQnum(-1)}(this.prev=e).draw()}}},"KeyEvent@angleloop":{keyinput:function(t){var e=this.cursor.getx();if(!(1<t.length&&"BS"!==t)){if("a"<=t&&t<="c"){var i=parseInt(t,36)-9;e.qnum===i?e.setQnum(-1):e.setQnum(i)}else{if(" "!==t&&"BS"!==t)return;e.setQnum(-1)}(this.prev=e).draw()}}},"KeyEvent@tajmahal":{moveTarget:function(t){return this.moveTBorder(t)},key_inputqnum:function(t){var e=this.cursor.getobj();"border"!==e.group&&this.key_inputqnum_main(e,t)}},"TargetCursor@kouchoku,angleloop":{crosstype:!0},"Cross@kouchoku":{maxnum:26},"Cross@angleloop":{disInputHatena:!0,maxnum:3,minnum:1},"Cross@tajmahal":{maxnum:8},"Cell@tajmahal":{maxnum:8},"Address@tajmahal":{moveToNearbyClue:function(){if(this.getDot()&&-1!==this.getDot().getDot())return this;for(var t=this.board.dotinside(this.bx-1,this.by-1,this.bx+1,this.by+1),e=0;e<t.length;e++)if(-1!==t[e].getDot())return this.set(t[e]),this;return this}},Segment:{group:"segment",initialize:function(t,e,i,s,n,r){this.path=null,this.isnull=!0,this.sideobj=[null,null],this.bx1=null,this.by1=null,this.bx2=null,this.by2=null,this.dx=0,this.dy=0,this.ox=null,this.oy=null,this.lattices=[],this.error=0,this.trial=0,this.setpos(t,e,i,s,n,r)},setpos:function(t,e,i,s,n,r){this.sideobj[0]=this.board.getx(t,e),this.sideobj[1]=this.board.getx(i,s),this.bx1=t,this.by1=e,this.bx2=i,this.by2=s,this.dx=i-t,this.dy=s-e,this.ox=isNaN(n)||null===n?null:n,this.oy=isNaN(n)||null===r?null:r,this.setLattices()},setLattices:function(){var t,e=this.dx,i=this.dy;for((e=e<0?-e:e)<(i=i<0?-i:i)&&(t=e,e=i,i=t);0<i;)t=e%i,e=i,i=t;this.lattices=[];for(var s=1;s<e;s++){var n=this.bx1+this.dx*(s/e),r=this.by1+this.dy*(s/e),o=this.board.getobj(n,r);this.lattices.push([n,r,o.id,o.group])}},seterr:function(t){this.board.isenableSetError()&&(this.error=t)},addOpe:function(t,e){this.puzzle.opemgr.add(new this.klass.SegmentOperation(this,t,e))},isRightAngle:function(t){return this.dx*t.dx+this.dy*t.dy==0},isParallel:function(t){var e=0===this.dx,i=0===t.dx,s=0===this.dy,n=0===t.dy;return e&&i||(s&&n||!(e||i||s||n)&&this.dx*t.dy==t.dx*this.dy)},isCrossing:function(t){if(this.isParallel(t))return!1;if(!this.isOverLapRect(t.bx1,t.by1,t.bx2,t.by2))return!1;var e=this.bx1,i=this.bx2,s=this.by1,n=this.by2,r=this.dx,o=this.dy,a=t.bx1,h=t.bx2,c=t.by1,l=t.by2,u=t.dx,t=t.dy;if(0===r){var g=t*(e-a)+c*u;if((d=u)<0&&(g*=-1,d*=-1),s*d<g&&g<n*d)return!0}else if(0===u){g=o*(a-e)+s*r;if((d=r)<0&&(g*=-1,d*=-1),c*r<g&&g<l*r)return!0}else{var d,n=(a*t-c*u)*r-(e*o-s*r)*u;if((d=t*r-o*u)<0&&(n*=-1,d*=-1),e*d<n&&n<i*d&&a*d<n&&n<h*d)return!0}return!1},isOverLapSegment:function(t){if(!this.isParallel(t))return!1;if(0===this.dx&&0===t.dx){if(this.bx1===t.bx1&&this.isOverLap(this.by1,this.by2,t.by1,t.by2))return!0}else if((this.dx*this.by1-this.bx1*this.dy)*t.dx==(t.dx*t.by1-t.bx1*t.dy)*this.dx&&this.isOverLap(this.bx1,this.bx2,t.bx1,t.bx2))return!0;return!1},isOverLapRect:function(t,e,i,s){return this.isOverLap(this.bx1,this.bx2,t,i)&&this.isOverLap(this.by1,this.by2,e,s)},isAreaInclude:function(t,e,i,s){if(this.isOverLapRect(t,e,i,s)){var n=0;if(this.ispositive(t,e)&&n++,this.ispositive(t,s)&&n++,this.ispositive(i,e)&&n++,this.ispositive(i,s)&&n++,0<n&&n<4)return!0}return!1},isOverLap:function(t,e,i,s){var n;return e<t&&(n=t,t=e,e=n),s<i&&(n=i,i=s,s=n),i<e&&t<s},ispositive:function(t,e){return 0<(t-this.bx1)*(this.by2-e)-(this.bx2-t)*(e-this.by1)}},"SegmentList:PieceList":{name:"SegmentList",add:function(t){var e=this.board;this===e.segment&&(t.isnull=!1),this.klass.PieceList.prototype.add.call(this,t),this===e.segment&&(e.getx(t.bx1,t.by1).seglist.add(t),e.getx(t.bx2,t.by2).seglist.add(t),e.isenableInfo()&&e.linegraph.modifyInfo(t,"segment"),t.addOpe(0,1),0<e.trialstage&&(t.trial=e.trialstage))},remove:function(t){var e=this.board;this===e.segment&&(t.isnull=!0),this.klass.PieceList.prototype.remove.call(this,t),this===e.segment&&(e.getx(t.bx1,t.by1).seglist.remove(t),e.getx(t.bx2,t.by2).seglist.remove(t),e.isenableInfo()&&e.linegraph.modifyInfo(t,"segment"),t.addOpe(1,0),this.puzzle.canvas&&this.puzzle.painter.eraseSegment1(t))},allclear:function(){this.ansclear()},ansclear:function(){for(var t=this.length-1;0<=t;t--)this.remove(this[t])},errclear:function(){for(var t=0;t<this.length;t++)this[t].error=0},trialclear:function(){for(var t=0;t<this.length;t++)this[t].trial=0},getRange:function(){if(0===this.length)return null;for(var t=this.board,e={x1:t.maxbx+1,x2:t.minbx-1,y1:t.maxby+1,y2:t.minby-1},i=0;i<this.length;i++){var s=this[i];e.x1>s.bx1&&(e.x1=s.bx1),e.x2<s.bx2&&(e.x2=s.bx2),e.y1>s.by1&&(e.y1=s.by1),e.y2<s.by2&&(e.y2=s.by2)}return e},addSegmentByAddr:function(t,e,i,s,n,r){this.add(new this.klass.Segment(t,e,i,s,n,r))},removeSegmentByAddr:function(t,e,i,s){this.remove(this.board.getSegment(t,e,i,s))},removeSegmentsByOrigin:function(e,i){var s=this;this.filter(function(t){return t.ox===e&&t.oy===i}).each(function(t){s.remove(t)})}},Board:{cols:7,rows:7,disable_subclear:!0,createExtraObject:function(){this.segment=new this.klass.SegmentList},setposCrosses:function(){this.common.setposCrosses.call(this);for(var t=0;t<this.cross.length;t++)this.cross[t].seglist||(this.cross[t].seglist=new this.klass.PieceList)},allclear:function(t){this.segment.allclear(),this.common.allclear.call(this,t)},ansclear:function(){this.puzzle.opemgr.newOperation(),this.segment.ansclear(),this.common.ansclear.call(this)},errclear:function(){return this.haserror&&this.segment.errclear(),this.common.errclear.call(this)},trialclear:function(){0<this.trialstage&&this.segment.trialclear(),this.common.trialclear.call(this)},getLatticePoint:function(t,e,i,s){for(var n=new this.klass.Segment(t,e,i,s),r=[],o=0;o<n.lattices.length;o++){var a=n.lattices[o][2],h=n.lattices[o][3];null===a||-1!==(h=this[h][a]).qnum&&r.push(h)}return r},segmentinside:function(e,i,s,n){return e<=this.minbx&&s>=this.maxbx&&i<=this.minby&&n>=this.maxby?this.segment:this.segment.filter(function(t){return t.isAreaInclude(e,i,s,n)})},getSegment:function(t,e,i,s){for(var n=this.getx(t,e),r=null,o=0,a=n.seglist.length;o<a;o++){var h=n.seglist[o];if(h.bx2===i&&h.by2===s){r=h;break}}return r}},"Board@tajmahal":{cols:10,rows:10,hasdots:1},BoardExec:{adjustBoardData:function(r,t){var o=this.board,a=this;if(r&this.REDUCE){var h=new this.klass.SegmentList,e=(o.segment.each(function(t){var e=t.bx1,i=t.by1,s=t.bx2,n=t.by2;switch(r){case a.REDUCEUP:(i<o.minby+2||n<o.minby+2)&&h.add(t);break;case a.REDUCEDN:(i>o.maxby-2||n>o.maxby-2)&&h.add(t);break;case a.REDUCELT:(e<o.minbx+2||s<o.minbx+2)&&h.add(t);break;case a.REDUCERT:(e>o.maxbx-2||s>o.maxbx-2)&&h.add(t)}}),this.puzzle.opemgr),i=!e.undoExec&&!e.redoExec;i&&(e.forceRecord=!0);for(var s=0;s<h.length;s++)o.segment.remove(h[s]);i&&(e.forceRecord=!1)}},adjustBoardData2:function(a,t){var h=this,c=t.x1+t.x2,l=t.y1+t.y2;this.board.segment.each(function(t){var e=t.bx1,i=t.by1,s=t.bx2,n=t.by2,r=t.ox,o=t.oy;switch(a){case h.FLIPY:t.setpos(e,l-i,s,l-n,r,l-o);break;case h.FLIPX:t.setpos(c-e,i,c-s,n,c-r,o);break;case h.TURNR:t.setpos(l-i,e,l-n,s,l-o,r);break;case h.TURNL:t.setpos(i,c-e,n,c-s,o,c-r);break;case h.EXPANDUP:t.setpos(e,i+2,s,n+2,r,o+2);break;case h.EXPANDDN:t.setpos(e,i,s,n,r,o);break;case h.EXPANDLT:t.setpos(e+2,i,s+2,n,r+2,o);break;case h.EXPANDRT:t.setpos(e,i,s,n,r,o);break;case h.REDUCEUP:t.setpos(e,i-2,s,n-2,r,o-2);break;case h.REDUCEDN:t.setpos(e,i,s,n,r,o);break;case h.REDUCELT:t.setpos(e-2,i,s-2,n,r-2,o);break;case h.REDUCERT:t.setpos(e,i,s,n,r,o)}null===r&&(t.ox=null,t.oy=null)})}},LineGraph:{enabled:!0,relation:{segment:"link"},pointgroup:"cross",linkgroup:"segment",isedgevalidbylinkobj:function(t){return!t.isnull},repaintNodes:function(t){for(var e=new this.klass.SegmentList,i=0;i<t.length;i++)e.extend(t[i].getedgeobjs());this.puzzle.painter.repaintLines(e)}},GraphComponent:{getLinkObjByNodes:function(t,e){var i=t.obj.bx,t=t.obj.by,s=e.obj.bx,e=e.obj.by;return this.board.getSegment(i,t,s,e)}},"SegmentOperation:Operation":{setData:function(t,e,i){this.bx1=t.bx1,this.by1=t.by1,this.bx2=t.bx2,this.by2=t.by2,this.old=e,this.num=i,this.ox=t.ox,this.oy=t.oy},decode:function(t){return"SG"===t[0]&&(this.bx1=+t[1],this.by1=+t[2],this.bx2=+t[3],this.by2=+t[4],this.old=+t[5],this.num=+t[6],isNaN(t[7])?(this.ox=null,this.oy=null):(this.ox=+t[7],this.oy=+t[8]),!0)},toString:function(){var t=["SG",this.bx1,this.by1,this.bx2,this.by2,this.old,this.num];return null!==this.ox&&(t.push(this.ox),t.push(this.oy)),t.join(",")},exec:function(t){var e,i=this.bx1,s=this.by1,n=this.bx2,r=this.by2,o=this.ox,a=this.oy,h=this.puzzle;1===t?h.board.segment.addSegmentByAddr(i,s,n,r,o,a):0===t&&h.board.segment.removeSegmentByAddr(i,s,n,r),n<i&&(e=i,i=n,n=e),r<s&&(e=s,s=r,r=e),h.painter.paintRange(i-1,s-1,n+1,r+1)}},OperationManager:{addExtraOperation:function(){this.operationlist.push(this.klass.SegmentOperation),this.enableNetwork=!1}},Graphic:{margin:.5,hideHatena:!0,irowake:!0,gridcolor_type:"DLIGHT",pointColor:"rgb(64,127,255)",repaintLines:function(t){if(this.context.use.canvas){var e=t.getRange();this.paintRange(e.x1-1,e.y1-1,e.x2+1,e.y2+1)}else{this.vinc("segment","auto");for(var i=0;i<t.length;i++)this.drawSegment1(t[i],!0)}},drawSegments:function(){var t=this.board,e=(this.vinc("segment","auto"),t.segment);(this.range.x2-this.range.x1)*(this.range.y2-this.range.y1)/((t.maxbx-t.minbx)*(t.maxby-t.minby))<.3&&(e=t.segmentinside(this.range.x1,this.range.y1,this.range.x2,this.range.y2));for(var i=0;i<e.length;i++)this.drawSegment1(e[i],!0);this.drawSolverSegments()},drawSolverSegments:function(){var t=this.vinc("segment_solver","auto",!0),e=this.range.crosses;t.strokeStyle=this.solvercolor,t.lineWidth=this.lw;for(var i=0;i<e.length;i++)for(var s=e[i],n=0;n<e.length;n++){var r,o,a,h=e[n];t.vid=["seg_solver",i,n].join("_"),1===s.qansBySolver&&h.destBySolver.includes(s.id)?(r=s.bx*this.bw,o=h.bx*this.bw,a=s.by*this.bh,h=h.by*this.bh,t.strokeLine(r,a,o,h)):t.vhide()}},eraseSegment1:function(t){this.vinc("segment","auto"),this.drawSegment1(t,!1)},drawSegment1:function(t,e){var i,s,n;void 0!==t.bx1&&((i=this.context).vid=["seg",t.bx1,t.by1,t.bx2,t.by2].join("_"),e?(t.trial&&this.puzzle.getConfig("irowake")?i.lineWidth=this.lw-this.lm:i.lineWidth=this.lw,1===t.error?i.strokeStyle=this.errlinecolor:-1===t.error?i.strokeStyle=this.noerrcolor:this.puzzle.execConfig("irowake")&&t.path.color?i.strokeStyle=t.path.color:t.trial?i.strokeStyle=this.trialcolor:i.strokeStyle=this.linecolor,e=t.bx1*this.bw,s=t.bx2*this.bw,n=t.by1*this.bh,t=t.by2*this.bh,i.strokeLine(e,n,s,t)):i.vhide())},drawSegmentTarget:function(){for(var t=this.vinc("cross_target_","auto",!0),e=.32*this.cw,i=(t.strokeStyle=this.pointColor,t.lineWidth=1.5*this.lw,this.range.crosses),s=0;s<i.length;s++){var n=i[s];t.vid="x_point_"+n.id,this.puzzle.mouse.targetPoint[0]===n||this.puzzle.mouse.targetPoint[1]===n||this.puzzle.mouse.targetPoint[2]===n||this.puzzle.mouse.targetPoint[3]===n?t.strokeCircle(n.bx*this.bw,n.by*this.bh,e):t.vhide()}}},"Graphic@kouchoku":{autocmp:"kouchoku",paint:function(){this.drawDashedGrid(!1),this.drawSegments(),this.drawCrosses_kouchoku(),this.drawSegmentTarget(),this.drawTarget()},drawCrosses_kouchoku:function(){for(var t=this.vinc("cross_base","auto",!0),e=this.puzzle.execConfig("autocmp"),i=.3*this.cw+1,s=.2*this.cw,n=(t.lineWidth=1,{ratio:.55}),r=this.range.crosses,o=0;o<r.length;o++){var a=r[o],h=e&&0===a.error&&2<=a.lcnt,c=a.bx*this.bw,l=a.by*this.bh;t.vid="x_cp_"+a.id,0<a.qnum?(t.fillStyle=1===a.error?this.errbcolor1:"white",t.strokeStyle=h?"gray":"black",t.shapeCircle(c,l,i)):t.vhide(),t.vid="cross_text_"+a.id,0<a.qnum?(t.fillStyle=h?"gray":this.quescolor,this.disptext((a.qnum+9).toString(36).toUpperCase(),c,l,n)):t.vhide(),t.vid="x_cm_"+a.id,-2===a.qnum?(t.fillStyle=1===a.error?this.errcolor1:this.quescolor,h&&(t.fillStyle="gray"),t.fillCircle(c,l,s)):t.vhide()}}},"Graphic@angleloop":{paint:function(){this.drawDashedGrid(!1),this.drawSegments(),this.drawCrosses_angleloop(),this.drawSegmentTarget(),this.drawTarget()},drawCrosses_angleloop:function(){for(var t=this.vinc("cross_base","auto",!0),e=(t.lineWidth=1,.25*this.cw),i=this.range.crosses,s=0;s<i.length;s++)for(var n=i[s],r=n.bx*this.bw,o=n.by*this.bh,a=1;a<=3;a++)if(t.vid="x_cp_"+a+"_"+n.id,n.qnum!==a)t.vhide();else{if(t.strokeStyle="black",1===n.error)t.fillStyle=this.errbcolor1;else switch(a){case 1:t.fillStyle="black";break;case 2:t.fillStyle="gray";break;case 3:t.fillStyle="white"}switch(a){case 1:var h=.85*e,c=.5*e;t.setOffsetLinePath(r,o,0,-e,-h,c,h,c,!0);break;case 2:h=.7*e;t.setOffsetLinePath(r,o,-h,-h,-h,h,h,h,h,-h,!0);break;case 3:var h=.31*e,c=.95*e,l=.81*e,a=.59*e;t.setOffsetLinePath(r,o,0,-e,-c,-h,-a,l,a,l,c,-h,!0)}t.shape()}}},"Graphic@tajmahal":{fontShadecolor:"white",numbercolor_func:"fixed_shaded",paint:function(){this.drawBaseMarks(),this.drawSegments(),this.drawDots(),this.drawNumbers_tajmahal(),this.drawSegmentTarget(),this.drawTarget()},getDotOutlineColor:function(){return null},getDotFillColor:function(t){return this.puzzle.mouse.sourcePoint&&!this.puzzle.mouse.targetPoint[0]&&t.equals(this.puzzle.mouse.sourcePoint)?this.pointColor:1===t.piece.error?this.errcolor1:-1!==t.getDot()?this.quescolor:null},getDotRadius:function(t){return-1!==t.getDot()?.4:.15},drawNumbers_tajmahal:function(){for(var t=this.context,e=this.range,i=this.board.dotinside(e.x1,e.y1,e.x2,e.y2),s=0;s<i.length;s++){var n,r=i[s],o=this.getQuesNumberText(r.piece);t.vid="dot_text_"+r.id,o?(t.fillStyle=this.getQuesNumberColor(r.piece),n=r.bx*this.bw,r=r.by*this.bh,this.disptext(o,n,r,{ratio:.65})):t.vhide()}}},Encode:{decodePzpr:function(t){this.decodeCrossABC()},encodePzpr:function(t){this.encodeCrossABC()},decodeCrossABC:function(){for(var t=0,e=0,i=this.outbstr,s=this.board,e=0;e<i.length;e++){var n=s.cross[t],r=i.charAt(e);if(this.include(r,"a","z")?n.qnum=parseInt(r,36)-9:this.include(r,"0","9")?t+=parseInt(r,36):"."===r&&(n.qnum=-2),t++,!s.cross[t])break}this.outbstr=i.substr(e+1)},encodeCrossABC:function(){for(var t=0,e="",i=this.board,s=0;s<i.cross.length;s++){var n="",r=i.cross[s].qnum;0<=r?n=(9+r).toString(36):-2===r?n=".":t++,0===t?e+=n:!n&&10!==t||(e+=(t-1).toString(36)+n,t=0)}0<t&&(e+=(t-1).toString(36)),this.outbstr+=e}},"Encode@tajmahal":{decodePzpr:function(t){this.decodeDot_tajmahal()},encodePzpr:function(t){this.encodeDot_tajmahal()},decodeDot_tajmahal:function(){for(var t=this.board,e=(t.disableInfo(),0),i=this.outbstr,s=0;s<i.length;s++){var n,r=t.dots[e],o=i.charAt(s);if(this.include(o,"0","8")?(n=parseInt(o,10),r.setDot(0===n?-2:n),e++):this.include(o,"a","z")&&(e+=parseInt(o,36)-9),e>=t.dotsmax)break}t.enableInfo(),this.outbstr=i.substr(s+1)},encodeDot_tajmahal:function(){for(var t=0,e="",i=this.board,s=0;s<i.dotsmax;s++){var n="",r=i.dots[s],r=-2===r.getDot()?0:r.getDot();-1!==r?n+=r:t++,0===t?e+=n:!n&&26!==t||(e+=(t+9).toString(36)+n,t=0)}0<t&&(e+=(t+9).toString(36)),this.outbstr+=e}},FileIO:{decodeData:function(){this.decodeCrossNum(),this.decodeSegment()},encodeData:function(){this.encodeCrossNum(),this.encodeSegment()},decodeSegment:function(){for(var t=+this.readLine(),e=0;e<t;e++){var i=this.readLine().split(" "),s=isNaN(i[4])?null:+i[4],n=isNaN(i[4])?null:+i[5];this.board.segment.addSegmentByAddr(+i[0],+i[1],+i[2],+i[3],s,n)}},encodeSegment:function(){var i=this,t=this.board.segment;this.writeLine(t.length),t.each(function(t){var e=[t.bx1,t.by1,t.bx2,t.by2];null!==t.ox&&(e.push(t.ox),e.push(t.oy)),i.writeLine(e.join(" "))})}},"FileIO@tajmahal":{decodeData:function(){this.decodeDotFile(),this.decodeSegment()},encodeData:function(){this.encodeDotFile(),this.encodeSegment()}},AnsCheck:{checkSegmentExist:function(){0===this.board.segment.length&&this.failcode.add("brNoLine")},checkAlonePoint:function(){this.checkSegment(function(t){return t.lcnt<2&&-1!==t.qnum},"nmLineLt2")},checkSegmentPoint:function(){this.checkSegment(function(t){return 0<t.lcnt&&-1===t.qnum},"lnIsolate")},checkSegmentBranch:function(){this.checkSegment(function(t){return 2<t.lcnt},"lnBranch")},checkSegmentDeadend:function(){this.checkSegment(function(t){return 1===t.lcnt},"lnDeadEnd")},checkSegment:function(t,e){for(var i=!0,s=this.board,n=0;n<s.cross.length;n++){var r=s.cross[n];if(t(r)){if(i=!1,this.checkOnly)break;r.seterr(1)}}i||(this.failcode.add(e),s.segment.setnoerr())},checkOneSegmentLoop:function(){for(var t=this.board,e=t.linegraph.components,i=0,s=0;s<e.length;s++)if(0!==e[s].length&&!(++i<=1)){this.failcode.add("lnPlLoop"),t.segment.setnoerr(),e[s].setedgeerr(1);break}},checkSegmentOverClue:function(){var s=!0,n=this.board,t=n.segment;t.each(function(t){for(var e=n.getLatticePoint(t.bx1,t.by1,t.bx2,t.by2),i=0;i<e.length;i++)t.seterr(1),e[i].seterr(1),s=!1}),s||(this.failcode.add("lnPassOver"),t.setnoerr())},checkDifferentLetter:function(){var s=!0,t=this.board.segment;t.each(function(t){var e=t.sideobj[0],i=t.sideobj[1];-2!==e.qnum&&-2!==i.qnum&&e.qnum!==i.qnum&&(t.seterr(1),e.seterr(1),i.seterr(1),s=!1)}),s||(this.failcode.add("nmConnDiff"),t.setnoerr())},checkConsequentLetter:function(){for(var s={},t=[],e=this.board,i=0;i<e.cross.length;i++)0<=(r=e.cross[i].qnum)&&(s[r]=[0,0,0]);for(i=0;i<e.cross.length;i++)0<=(r=e.cross[i].qnum)&&(0===s[r][0]&&t.push(r),s[r][0]++);e.segment.each(function(t){var e,i=t.sideobj[0],t=t.sideobj[1];0<=i.qnum&&0<=t.qnum&&i.qnum===t.qnum?0<=(e=i.qnum)&&s[e][1]++:(0<=i.qnum||0<=t.qnum)&&(0<=(e=i.qnum)&&s[e][2]++,0<=(e=t.qnum)&&s[e][2]++)});for(var n=0;n<t.length;n++){var r=t[n];if(2!==s[r][2]||s[r][1]!==s[r][0]-1){if(this.failcode.add("nmNotConseq"),this.checkOnly)break;e.cross.filter(function(t){return t.qnum===r}).seterr(1)}}},checkDuplicateSegment:function(){var t=!0,e=this.board.segment,i=e.length;t:for(var s=0;s<i;s++)for(var n=s+1;n<i;n++){var r=e[s],o=e[n];if(null!==r&&null!==o&&r.isOverLapSegment(o)){if(t=!1,this.checkOnly)break t;r.seterr(1),o.seterr(1)}}t||(this.failcode.add("lnOverlap"),e.setnoerr())},checkRightAngle:function(){var t=!0,e=this.board.segment,i=e.length;t:for(var s=0;s<i;s++)for(var n=s+1;n<i;n++){var r=e[s],o=e[n];if(null!==r&&null!==o&&r.isCrossing(o)&&!r.isRightAngle(o)){if(t=!1,this.checkOnly)break t;r.seterr(1),o.seterr(1)}}t||(this.failcode.add("lnRightAngle"),e.setnoerr())},checkCrossLine:function(){var t=!0,e=this.board.segment,i=e.length;t:for(var s=0;s<i;s++)for(var n=s+1;n<i;n++){var r=e[s],o=e[n];if(null!==r&&null!==o&&r.isCrossing(o)){if(t=!1,this.checkOnly)break t;r.seterr(1),o.seterr(1)}}t||(this.failcode.add("lnCross"),e.setnoerr())},checkAngle:function(){for(var t=!0,e=this.board,i=0;i<e.cross.length;i++){var s=e.cross[i];if(!(s.qnum<1||2!==s.lcnt)){var n=s.seglist[0],r=s.seglist[1];if(n.isParallel(r)){if(t=!1,this.checkOnly)break;s.seterr(1)}else if(n.isRightAngle(r)){if(2!==s.qnum){if(t=!1,this.checkOnly)break;s.seterr(1)}}else{function o(t){return s.bx===t.bx1&&s.by===t.by1?[t.dx,t.dy]:[-t.dx,-t.dy]}n=o(n),r=o(r),n=n[0]*r[0]+n[1]*r[1];if(0<n&&1!==s.qnum||n<0&&3!==s.qnum){if(t=!1,this.checkOnly)break;s.seterr(1)}}}}t||this.failcode.add("lnWrongAngle")}},"AnsCheck@kouchoku":{checklist:["checkSegmentExist","checkSegmentPoint","checkSegmentBranch","checkSegmentOverClue","checkDuplicateSegment","checkDifferentLetter","checkRightAngle","checkOneSegmentLoop","checkSegmentDeadend","checkAlonePoint","checkConsequentLetter"]},"AnsCheck@angleloop":{checklist:["checkSegmentExist","checkSegmentPoint","checkSegmentBranch","checkSegmentOverClue","checkDuplicateSegment","checkOneSegmentLoop","checkSegmentDeadend","checkAlonePoint","checkCrossLine","checkAngle"]},"AnsCheck@tajmahal":{checklist:["checkSegmentOverClue","checkSquareIntegrity","checkDuplicateSegment","checkCrossLine","checkCornerOverClue","checkSegmentOverCorner","checkSourceIsClue","checkOneSegmentLoop+","checkClueCount","checkClueHasSquare"],checkCornerOverClue:function(){this.checkSegment(function(t){return 0<t.lcnt&&-1!==t.qnum},"lnOnClue")},getOriginMap:function(){var i,s=this.board;return this._info.origins||(i={},s.segment.each(function(t){var e=null===t.ox?"null":t.ox+","+t.oy;e in i||(i[e]={obj:null!==t.ox?s.getobj(t.ox,t.oy):null,segs:new s.klass.SegmentList}),i[e].segs.add(t)}),this._info.origins=i),this._info.origins},checkOrigins:function(t,e){var i,s=this.getOriginMap(),n=this.board;for(i in s){var r=s[i];if(t(r.obj,r.segs)){if(this.failcode.add(e),this.checkOnly)break;r.obj.seterr(1),r.segs.seterr(1),n.segment.setnoerr()}}},checkSourceIsClue:function(){this.checkOrigins(function(t,e){return null===t||-1===t.qnum},"lnIsolate")},checkSquareIntegrity:function(){this.checkOrigins(function(t,e){return e.length%4},"lnNotSq")},checkClueCount:function(){this.checkOrigins(function(t,e){if(null===t||t.qnum<0)return!1;var i=0;return e.each(function(t){i=(i+=t.sideobj[0].lcnt-2)+(t.sideobj[1].lcnt-2)}),t.qnum!==i/4},"crAdjacent")},checkClueHasSquare:function(){for(var t=this.getOriginMap(),e=this.board,i=0;i<e.dotsmax;i++){var s=e.dots[i],n=s.bx+","+s.by;if(!(-1===s.getDot()||n in t)){if(this.failcode.add("crNoSegment"),this.checkOnly)break;s.piece.seterr(1)}}},checkSegmentOverCorner:function(){var o=!0,a=this.board,t=a.segment;t.each(function(t){for(var e=[],i=0;i<t.lattices.length;i++){var s=t.lattices[i][2],n=t.lattices[i][3];null===s||0<(n=a[n][s]).lcnt&&e.push(n)}for(var r=0;r<e.length;r++)t.seterr(1),e[r].seterr(1),o=!1}),o||(this.failcode.add("lnOnCorner"),t.setnoerr())}}});
//# sourceMappingURL=kouchoku.js.map