/*! @license pzpr.js v7f9addbe (c) 2009-2025 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */
!function(t,e){"object"==typeof module&&module.exports?module.exports=[t,e]:pzpr.classmgr.makeCustom(t,e)}(["magnets"],{MouseEvent:{use:!0,inputModes:{edit:["border","number","empty"],play:["clear","numexist","numblank","completion"]},mouseinput_number:function(){this.mousestart&&(this.puzzle.editmode?this.inputqnum_excell():this.inputqnum())},mouseinput_auto:function(){var t;this.puzzle.playmode?(this.mousestart&&this.inputqcmp(),(t=this.getcell_excell()).isnull||"cell"!==t.group||this.inputqnum()):this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputborder():this.mouseend&&this.notInputted()&&this.inputqnum_excell())},inputqnum_excell:function(){var t=this.getcell_excell();if(t.isnull||"excell"!==t.group)return this.inputqnum();t!==this.cursor.getex()?this.setcursor(t):this.inputqnum_main(t)},inputqcmp:function(){var t=this.getcell_excell();t.isnull||t.noNum()||"excell"!==t.group||(t.setQcmp(+!t.qcmp),t.draw(),this.mousereset())},inputqnum:function(){var t=this.getcell();t.isnull||t===this.mouseCell||(this.puzzle.getConfig("mouseonly")&&this.puzzle.playmode?this.inputmouseonly(t):t!==this.cursor.getc()?this.setcursor(t):this.inputqnum_main(t),this.mouseCell=t)},inputmouseonly:function(t){var e,i;null===this.inputData&&(e=-1,i=t.getNum(),-1!==t.qnum?e="left"===this.btn?i:-1:2===this.puzzle.getConfig("use")?e=this.getNewNumber(t,i):"left"===this.btn?e=1===i?2:2===i?-1:1:-1===i&&1!==t.qsub&&(e=this.getNewNumber(t,i)),this.puzzle.getConfig("magnets_anti")||!t.parity()||1!==e&&2!==e?this.inputData=e:this.inputData=3-e),this.puzzle.getConfig("magnets_anti")||1!==this.inputData&&2!==this.inputData?t.setNum(this.inputData):(i=!t.parity()==(1===this.inputData)?1:2,t.setNum(i))}},KeyEvent:{enablemake:!0,enableplay:!0,keyinput:function(t){if(!this.cursor.getex().isnull)return this.key_inputexcell(t);if(!this.puzzle.getConfig("mouseonly")||!this.puzzle.playmode){var e;if(this.puzzle.editmode&&"q"===t)return(e=this.cursor.getc()).setNum(-1),e.setQues(0===e.ques?7:0),void e.draw();"q"===t||"a"===t||"z"===t||"o"===t?t=this.puzzle.playmode?"s1":" ":"w"===t||"s"===t||"x"===t?t=this.puzzle.playmode?"s2":" ":"e"===t||"d"===t||"c"===t?t=" ":"+"===t?t="1":"-"===t&&(t="2"),this.key_inputqnum(t)}},key_inputexcell:function(t){var e;this.puzzle.playmode||(e=this.cursor.getex(),null!==(t=this.getNewNumber(e,t,e.qnum))&&(e.setQnum(t),this.prev=e,this.cursor.draw()))}},TargetCursor:{initCursor:function(){this.init(-1,-1),this.adjust_init()},setminmax_customize:function(){this.puzzle.editmode||(this.minx=1,this.miny=1)}},ExCell:{disInputHatena:!0,minnum:0,maxnum:function(){var t=this.bx,e=this.by;return t<0&&e<0?0:((e<0?this.board.rows:this.board.cols)+1)/2|0}},Board:{hasborder:1,hasexcell:1,cols:8,rows:8,excellRows:function(t,e){return 2},excellCols:function(t,e){return 2}},BoardExec:{adjustBoardData:function(t,e){this.adjustExCellTopLeft_1(t,e)},adjustBoardData2:function(t,e){this.adjustExCellTopLeft_2(t,e,!0)}},Cell:{maxnum:2,numberWithMB:!0,disInputHatena:!0,parity:function(){return 0==(this.bx+this.by&2)},setNum:function(i){var s,n,t;this.puzzle.editmode&&-1!==i&&this.setQues(0),this.puzzle.editmode||-1!==this.qnum?this.common.setNum.call(this,i):this.puzzle.playmode&&!this.isValid()||(s=this.parity(),n=i<-1?-i-1:0,(t=2!==(t=this.room.clist).length?new this.klass.CellList([this]):t).each(function(t){var e=i<=-1?-1:t.parity()===s?i:3-i;t.setAnum(e),t.setQsub(n),t.draw()}))}},AreaRoomGraph:{enabled:!0},Graphic:{enablebcolor:!0,shadecolor:"#444444",paint:function(){this.drawBGCells(),this.drawGrid(),this.drawExCellDecorations(),this.drawNumbersExCell(),this.drawAnsSymbols(),this.drawQuesSymbols(),this.drawMBs(),this.drawChassis(!0),this.drawBorders(),this.drawCursor(!0,this.puzzle.editmode||!this.puzzle.getConfig("mouseonly"))},getBGCellColor:function(t){return t.isValid()?this.getBGCellColor_error1(t):"darkgray"},getBorderColor:function(t){return t.sidecell[0].isValid()!==t.sidecell[1].isValid()?"black":this.getBorderColor_ques(t)},drawSinglePole:function(t,e,i,s,n){t.vid=e+"_h";var u=Math.max(this.cw/12,3)/2,o=.7*this.bw;1<=n?t.fillRectCenter(i,s,o,u):t.vhide(),t.vid=e+"_v",1===n?t.fillRectCenter(i,s,u,o):t.vhide()},drawExCellDecorations:function(){var t=this.vinc("deco","crispEdges",!0);t.fillStyle=this.quescolor,this.drawSinglePole(t,"deco1",-this.bw,-this.bh,2),this.drawSinglePole(t,"deco2",3*-this.bw,-this.bh,1),this.drawSinglePole(t,"deco3",-this.bw,3*-this.bh,1)},drawQuesSymbols:function(){this.vinc("cell_symbol","auto"),this.drawSymbols_com(function(t){return t.qnum},this.getQuesNumberColor_qnum,"cell_symbol_")},drawAnsSymbols:function(){this.vinc("cell_ans_symbol","auto"),this.drawSymbols_com(function(t){return t.anum},this.getAnsNumberColor,"cell_ans_symbol_")},drawSymbols_com:function(t,e,i){for(var s=this.context,n=this.range.cells,u=0;u<n.length;u++){var o,l,r=n[u],c=t.call(this,r),a=i+r.id;1<=c?(s.fillStyle=e.call(this,r),o=r.bx*this.bw,l=r.by*this.bh,this.drawSinglePole(s,a,o,l,c)):this.drawSinglePole(s,a,o,l,0)}},getQuesNumberColor:function(t){return 1===t.error?this.errcolor1:t.qcmp?this.qcmpcolor:this.quescolor},getBoardCols:function(){return 2+this.board.maxbx/2},getBoardRows:function(){return 2+this.board.maxby/2}},Encode:{decodePzpr:function(t){this.decodeNumber16ExCell(),this.decodeBorder(),this.decodeCircle(),this.decodeEmpty(),this.puzzle.setConfig("magnets_anti",this.checkpflag("a"))},encodePzpr:function(t){this.outpflag=this.puzzle.getConfig("magnets_anti")?"a":null,this.encodeNumber16ExCell(),this.encodeBorder(),this.board.cell.some(function(t){return-1!==t.qnum||!t.isValid()})&&(this.encodeCircle(),this.encodeEmpty())}},FileIO:{decodeData:function(){this.decodeConfigFlag("a","magnets_anti"),this.decodeBorderQues(),this.decodeCellExCell(function(t,e){"."!==e&&("excell"!==t.group||t.isnull?"cell"===t.group&&("#"===e?t.ques=7:"q"===e[0]?t.qnum=+e.substring(1):"s"===e[0]?t.qsub=+e.substring(1):"a"===e[0]&&(t.anum=+e.substring(1))):("c"===e[0]&&(t.qcmp=1,e=e.substring(1)),t.qnum=+e))})},encodeData:function(){this.encodeConfigFlag("a","magnets_anti"),this.encodeBorderQues(),this.encodeCellExCell(function(t){if("excell"===t.group&&!t.isnull&&-1!==t.qnum)return(t.qcmp?"c":"")+t.qnum+" ";if("cell"===t.group){if(!t.isValid())return"# ";if(-1!==t.qnum)return"q"+t.qnum+" ";if(0!==t.qsub)return"s"+t.qsub+" ";if(-1!==t.anum)return"a"+t.anum+" "}return". "})}},AnsCheck:{checklist:["checkAdjacentDiffNumber_magnets","checkEqualNumber_magnets","checkNoTripleMagnet","checkNoSingleMagnet","checkPlusCount","checkMinusCount"],checkAdjacentDiffNumber_magnets:function(){this.puzzle.getConfig("magnets_anti")||this.checkAdjacentDiffNumber()},checkEqualNumber_magnets:function(){this.puzzle.getConfig("magnets_anti")&&this.checkSideAreaCell(function(t,e){return t.isValidNum()&&e.isValidNum()&&t.getNum()!==e.getNum()},!1,"nmAdjDiff")},checkNoSingleMagnet:function(){this.checkAllCell(function(t){if(!t.isNum()||1===t.room.clist.length)return!1;for(var e in t.adjacent){e=t.adjacent[e];if(e.room===t.room&&e.isNum())return!1}return!0},"bkNumLt2")},checkNoTripleMagnet:function(){for(var t=this.board.roommgr.components,e=0;e<t.length;e++){var i=t[e];if(!(i.clist.length<2)){i=i.clist.filter(function(t){return t.isNum()});if(!(i.length<=2)){if(this.failcode.add("bkNumGt2"),this.checkOnly)break;i.seterr(1)}}}},checkPlusCount:function(){this.checkRowsCols(this.isPlusCount,"exPlusNe")},isPlusCount:function(t){return this.isExCellCount(t,1,-3)},checkMinusCount:function(){this.checkRowsCols(this.isMinusCount,"exMinusNe")},isMinusCount:function(t){return this.isExCellCount(t,2,-1)},isExCellCount:function(t,e,i){var s,n=t.getRectSize(),u=this.board,o=t.filter(function(t){return t.getNum()===e}).length,l=!0;return n.x1===n.x2&&-1!==(s=u.getex(n.x1,i)).qnum&&s.qnum!==o&&(s.seterr(1),l=!1),n.y1===n.y2&&-1!==(s=u.getex(i,n.y1)).qnum&&s.qnum!==o&&(s.seterr(1),l=!1),l||t.seterr(1),l}}});
//# sourceMappingURL=magnets.js.map